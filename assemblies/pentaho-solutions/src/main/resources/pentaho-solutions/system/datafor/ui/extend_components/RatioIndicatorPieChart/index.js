"use strict";function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _defineProperty(e,t,r){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!==_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var o,n,i,a,l=[],u=!0,s=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(o=i.call(r)).done)&&(l.push(o.value),l.length!==t);u=!0);}catch(e){s=!0,n=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(s)throw n}}return l}}function _arrayWithHoles(e){if(Array.isArray(e))return e}define("RatioIndicatorPieChart",["Utility","Kit","RatioIndicatorPieChart/panel","ui/extendIconUI","echartbase/BasePiechart","underscore","model/Component","Base.Panel"],(function(e,t,r,o,n,i,a,l){new l;var u="RatioIndicatorPieChart",s=n.getLocaleFn(["components","extends",u]),d=i.extend(n.getBaseOption(),{animationDuration:1500,legend:{show:!1},xAxis:{show:!1},yAxis:{show:!1},grid:{left:10,top:10,right:10,bottom:10},series:[]}),c="primary_measure",m="target_measure",p="__shadow_pie",y=r(s,c,m),v=n.extend({type:u,classify:"_data",checkQm:function(){this.model.hslice("COLUMNS",0),this.model.hslice("ROWS",0),this.model.mslice(2);var e=this.model.getMeasures(!0).trimSimiMeasures().slice(0,2).map((function(e,t){return e.extend_properties=e.extend_properties||{},e.extend_properties.uuid=[0==t?c:m],e}));return this.model.toUpdateMeasures(e),null},onAutoComputeLayoutEvent:function(e){},onComponentQueryResponsed:function(e){var t,r=e.cellset,o=void 0===r?[]:r;if(2==(null==o?void 0:o.length)&&2==(null===(t=o[1])||void 0===t?void 0:t.length)){var n=_slicedToArray(o[1],2)[1],i=void 0===n?{}:n;Object.hasOwn(i.properties,"raw")||(i.properties.raw=Number.POSITIVE_INFINITY,i.value=""),Object.hasOwn(i.properties,"raw")&&0==Number(i.properties.raw)&&(i.properties.raw=Number.NEGATIVE_INFINITY,i.value="0")}},name:s("name"),description:s("name tip"),echartsInit:function(){var t=this,r=this.model.isValidQueryModel.bind(this.model);return this.model.isValidQueryModel=function(){var e;return r(!0)&&(null===(e=t.model.getMeasures().trimSimiMeasures())||void 0===e?void 0:e.length)},this.options=e.deepCopy(d),this.options.tooltip.showContent=!0,this.options.tooltip.show=!1,this},onPreviewdataEvent:function(e){var t,r=[],o=[],n={};return null===(t=e.data)||void 0===t||null===(t=t.data)||void 0===t||t.filter((function(e){return!String(e.name).match(/^UUID\-/)})).forEach((function(e,t){r.push({dataIndex:e.cateID,key:e.cateID,title:e.name,align:"right",halign:"center"}),n[e.cateID]=e.value||e.vtip})),o.push(n),{columns:r,datasets:o}},getStaticTargetValue:function(){var e,t=null===(e=this.options)||void 0===e||null===(e=e.extend_properties)||void 0===e?void 0:e.staticTargetValue;return isNaN(t)&&(t=this.getPanelControlValue("style","static.target.value")),t},beforeQuery:function(e){var t=new a({query:e}),r=t.getMeasures().trimSimiMeasures(),o=this.model.getMeasures(!0);if(1===(null==r?void 0:r.length)){var i,l,u=r[0],d="".concat(u.id,"_ratio_target"),c=this.getStaticTargetValue();l=1==(null==o?void 0:o.length)&&2==(null===(i=o[0])||void 0===i||null===(i=i.extend_properties)||void 0===i||null===(i=i.uuid)||void 0===i?void 0:i.length)?isNaN(c)||""===c||null===c?"".concat(u.id):"".concat(c):isNaN(c)||""===c||null===c?"2*".concat(u.id):"".concat(c),u.sort=1,t.includeCalculatedScopedMeasure({name:d,uniqueName:d,caption:s("target measure"),formula:l,extend_properties:{uuid:m}},2)}return e=t.get("query"),n.prototype.beforeQuery.call(this,e)},render:function(e,t){var r=this,o=this.options.extend_properties||{},i=o.radiusSize||95,a=function(e,t){var r=i,n=o.thinSize;if(e.top=5,e.bottom=5,e.left=5,e.right=5,e.radius=[r-n+"%",r+"%"],t){var a=(n-1)/2;e.radius=[r-n+a*t/100+"%",r-a*t/100+"%"]}},l="clockwise"==o.direction,u=function(e,t){e.itemStyle=e.itemStyle||{},e.itemStyle.normal=e.itemStyle.normal||{},e.itemStyle.normal.color=t||o.emptyBackground},d=o.dataFormat,c=void 0===d?"percent":d,m=o.dataValueFont,y=void 0===m?{}:m,v=o.showLabelName,f=void 0===v||v,h=o.labelName,b=void 0===h?s("label name default value"):h,g=o.labelNameFont,_=void 0===g?{}:g,S=o.subtext,I=void 0===S?[]:S,w=o.subtextFont,A=void 0===w?{}:w;return this.options.series.forEach((function(e){if(delete e.isAllZero,e.name==p)u(e),a(e);else{var t;e.clockwise=l;var n=_toConsumableArray(e.data||[]);null===(t=e.data)||void 0===t||t.forEach((function(e,t){if(1==t)u(e,"transparent");else{var i,a=[],l={};i=0==e.divide||e.divide==Number.NEGATIVE_INFINITY?"100":e.divide==Number.POSITIVE_INFINITY?"0":100*e.value/e.divide,"none"!=c&&(a.push("{a|".concat("percent"==c?isNaN(i)?"":Number(i).toFixed(o.percentDecimal)+"%":e.formatted,"}")),l.a=_objectSpread({},y)),f&&(a.push("{b|".concat(b,"}")),l.b=_objectSpread({},_)),I.length&&I.forEach((function(e,t){var r,o,i="c".concat(t);a.push("{".concat(i,"|").concat(null===(r=n[t])||void 0===r?void 0:r.name,": ").concat((null===(o=n[t])||void 0===o?void 0:o.formatted)||"","}")),l[i]=_objectSpread({},A)})),e.label.normal.formatter=a.join("\n"),e.label.normal.rich=l,r.applyProgressBarColor(e)}})),function(e){e.itemStyle=e.itemStyle||{},e.itemStyle.normal=e.itemStyle.normal||{},o.ringRadius?e.itemStyle.normal.borderRadius=["100%","100%"]:delete e.itemStyle.normal.borderRadius}(e),a(e,o.innerSpace)}})),n.prototype.render.call(this,e,t)},onExecuteJumpEvent:function(e,r,o){var n=this,i=this.model.getMeasures(!0).trimSimiMeasures(),a=this.model.getSavedJumpOptions(null,!0),l=null==i?void 0:i.find((function(e){var t;return null===(t=e.extend_properties)||void 0===t||null===(t=t.uuid)||void 0===t?void 0:t.includes(c)}));return null!=l&&l.id?(function(i){var l,u=null==a?void 0:a.find((function(e){return e.uniqueName==i})),s=(null===(l=e.data)||void 0===l||null===(l=l[0])||void 0===l?void 0:l.data)||{};if(!u)return n;var d=u.options;s.levels=s.levels||[],t.openLinkedPage({savedJumpOptions:_objectSpread({},d),component:n,params:{message:s},event:r},o)}(l.id),this):this},applyProgressBarColor:function(e){var t,r,o,n=null===(t=this.options.extend_properties)||void 0===t?void 0:t.colorsDef,i=n.configType,a=n.rules,l=100*e.value/e.divide,u=e.value,s={"><=":function(e,t,r){return r>e&&r<=t},">=<=":function(e,t,r){return r>=e&&r<=t},">=<":function(e,t,r){return r>=e&&r<t},"><":function(e,t,r){return r>e&&r<t}};if(null===(r=e.itemStyle)||void 0===r||null===(r=r.normal)||void 0===r||delete r.color,i&&Array.isArray(a)&&a.length){o="value"==i?u:l;var d=a.find((function(e){var t=e.start,r=e.end,n=e.start_value,i=e.end_value;return null!=n&&""!=n||(n=Number.NEGATIVE_INFINITY),null!=i&&""!=i||(i=Number.POSITIVE_INFINITY),s["".concat(t).concat(r)](n,i,o)}));d&&(e.itemStyle=e.itemStyle||{},e.itemStyle.normal=e.itemStyle.normal||{},e.itemStyle.normal.color=d.color)}},shouldUseConditionColor:function(){return!0},dataFormatter:function(e,t,r,o,a){var l,u;return n.prototype.dataFormatter.call(this,e,t,r,o,a),null!=a&&null!==(l=a.json)&&void 0!==l&&l.isEmpty||(null===(u=this.options.series)||void 0===u?void 0:u.length)<1||(this.enlargeMode,this.options.series[0].hoverAnimation=!1,this.options.series[0].data.forEach((function(e,t,r){if(1==t){var o,n;if(e.targetArea=!0,function(e){e.itemStyle=e.itemStyle||{},e.itemStyle.emphasis={disabled:!0}}(e),e.itemStyle.normal=e.itemStyle.normal||{},r[0].divide=e.value||2*r[0].value,e.value&&e.value<(null===(o=r[0])||void 0===o?void 0:o.value))e.value=0;else e.value=e.value-(null===(n=r[0])||void 0===n?void 0:n.value);e.label={show:!1}}else e.label=e.label||{},Array.isArray(e.data)&&e.data.every((function(e){return e.value=Math.abs(e.value),!0})),e.label.normal=e.label.normal||{},e.label.normal.show=!0,e.label.normal.position="center"})),this.options.series[0].z=10,i.find(this.options.series,{name:p})||this.options.series.push({type:"pie",name:p,z:1,center:["50%","50%"],hoverAnimation:!1,label:{normal:{show:!1},emphasis:{show:!1}},emphasis:{disabled:!0},labelLine:{normal:{show:!1}},itemStyle:{emphasis:{disabled:!0}},animation:!1,data:[{value:100,name:"bg",formatted:"bg"}]})),this}},{thumbnail:"icon iconfont icon-datafor-donut-pie",_sort_order:25,logo:o.getProgressPieIcon(),privates:{skipBuildDetailObject:!0,chartTypeSimilar:n.prototype.type,entranceConstraintsForLinkConfs:[c]},symbol:"pie-progress.svg",staticPanelOptions:_toConsumableArray(y)});return n.register(v),v}));
//# sourceMappingURL=RatioIndicatorPieChart.js.map