"use strict";define("BaseClosureTreeTable",["Utility","base/component.dataJoin","utility/DataFormat","lib/clipboard","lib/interact","utility/params","utility/colors","ui/extendIconUI","underscore","backbone","sizes","utility/runtime","utility/colors","model/Component","template/compile","base/ParamQueryListTable","log/Log","Base.Panel","render/Base","utility/CubeTreeNode","lib/backbone.select","render/Renderer","jqueryTree","nicescroll","treeExhide"],(function(e,t,n,l,a,i,o,r,s,d,c,u,p,h,m,g,y,f,b,v){var x,w="data.query.fields.list",C="parent.key.field",A="child.key.field",k="caption.key.field",S=g.extend({type:"BaseClosureTreeTable",classify:"_data",name:e.locale("components","extends","BaseClosureTreeTable","name"),checkQueryModel:function(){var e=this.model.getRegion(C),t=this.model.getRegion(A),n=this.model.getRegion(k);return e.length&&t.length&&n.length},description:e.locale("components","extends","BaseClosureTreeTable","name tip"),events:{"mouseenter .pq-grid-cell":"enterGridcell","mouseleave .pq-grid-cell":"leaveGridcell"},onExecuteJumpEvent:null,tableExtend:function(){g.prototype.tableExtend.call(this);var e=this.remove.bind(this);return this.remove=function(){try{this.$el.find(".pq-body-outer .pq-cont-right").getNiceScroll().remove(),this.$el.find(".ctable").pqGrid("destroy")}catch(e){}e()},console.log(">>parent child tree"),this._pqGridFirstLoading_=!0,this.$el.parent().addClass("n-shd"),this.options.datas=[],this.options.dims=[],this.options.metadata=[],this.options.headers=[],this.baseOptions={},this.options.pivotStyles=$.extend({},this.options.pivotStyles,{tableHeaderRowSizeY:30,enableRowPicked:!1,pickedRowBackgroundColor:"#aaa"}),this.$el.addClass("table-component").append(m.plainCompile(this.getMainLayout(!0))),this.model.isValidQueryModel=this.checkQueryModel.bind(this),this},getSelectedLabel:function(){var e=this.model.getDefaultsValue().value||[];return e.length?e.filter((function(e){return!0===e.leaf})).map((function(e){return e.caption})):[]},getLastDetailNode:function(t){var n=new Array;return this.baseOptions&&Array.isArray(this.baseOptions.colModel)&&e.deepFind(this.baseOptions.colModel,(function(e){Array.isArray(e.colModel)&&0!=e.colModel.length||e.hidden||n.push(e)}),"colModel"),t?s.find(n,(function(e){return e.dataIndx==t})):n},tableStyleUpdate:function(e,t){var n=this.baseOptions,l=this.$el.find(".ctable"),a=e||{};try{a.colModel=this.columnSizeMaping(n.colModel),a.scrollModel=n.scrollModel}catch(e){}try{for(var i in a)i?l.pqGrid("option",i,a[i]):l.pqGrid("option",a[i]);l.pqGrid("refreshView")}catch(e){}return t&&l.pqGrid("flex"),this},tryUpdateCollapseTreeLevel:function(e,t){var n,l=t||this.getPanelControlValue("style","collpase.level");if(null!=l)return l=Number(l),n=e.pageData().filter((function(e){return e.pq_level>l-1})),e.Tree().expandAll(),e.Tree().collapseNodes(n),this},getMainLayout:function(e){var t=new Array,n=this;return s.delay((function(){n.resize()}),5),t.push({class:"ctable clean",style:"height: 100%"}),t},cellRenderOveride:function(e){var t=this.hasQueryGrandSummary(),n=this,l=this.dataColumnRecord||{},a=n.options.pivotStyles||{},i=this.baseOptions.wrap,o=a.textIndentSize||25,r=o+3;return e.render=function(d){var c,u,p,h,m=n.model.getDefaultsValue().value||[],g=a.gridStyle,y={},f=d.cellData,b=n.getOutputLinkPoints()||[],v=n.shouldApplyHighlight(),x=d.rowData,w=function(){var e=d.rowData.myuuid,t=d.rowData.idKey;return'<span class="check-row-cell icon iconfont '+(s.find(m,(function(n){return s.isString(n)?n===t:n.myuuid===e}))?"icon-radiobuttonselect":s.find(m,(function(n){return s.isString(n)?n.indexOf(t)>=0:String(n.myuuid).indexOf(e)>=0}))?"icon-radio1":"icon-radiobuttonunselect")+'" style="margin-right:2px;font:inherit;"></span>'};if(null==f&&(f=""),d.Export)return f;if("empty_column_scroll"===d.column.dataIndx)return{style:"background:transparent;pointer-events:none;"};if(x.isLastEmptyRow)return{style:"background:transparent;pointer-events:none;",cls:"empty-scroll-row"};u=n.getRowBackgroundColor(d.rowIndx,d.rowData),y.display="flex",y["align-items"]="center",y["border-right"]=g,y["border-bottom"]=g,t||(0==d.colIndx?y["border-left"]=g:y["border-left"]="none"),y.padding="0px","left"==d.column.align?y["justify-content"]="flex-start":"center"==d.column.align?y["justify-content"]="center":y["justify-content"]="flex-end",y.color=a.contentColor,y.font=a.contentFont;var S=[];if(d.column.isLastColumn&&S.push("last-col"),l.hasOwnProperty(d.dataIndx)){var R=d.rowData.myuuid,M=l[d.dataIndx].map((function(e){return s.extend({},e)}));R=s.find(M,(function(e){return e.id===R}))}var q=d.rowData[d.dataIndx+"_matched"]||String(f).replace(/&lt;/g,"<").replace(/&gt;/g,">"),T="tree-basic-cell pq-group-icon ";if(y.background=u,S.push(i?"data-cell content-wrap":"data-cell"),v&&(n.isMatchedPoint(d.rowData,d.column,b,!1,d.colIndx)?S.push("pickout-cell"):S.push("transparent-cell")),x.isGrantSummary){var B=n.model.getRegion(C,A,k).map((function(e){return e.id}));y.font=a.grantSummaryFont,y.color=a.grantSummaryColor,y.background=a.grantSummaryBackgroundColor,y["border-top"]=a.gridStyle,y.padding="0px 8px";var _={style:Object.keys(y).reduce((function(e,t){return e+=t+":"+y[t]+";"}),"")};return d.column.isMeasureNode?_.text=(x[d.column.dataIndx]||{}).formatted:"caption"==e.dataIndx&&(_.text=B.reduce((function(e,t){return e||x[t]}),"")),_.cls=S.join(" "),_}return"caption"===d.dataIndx?(h=d.rowData.pq_level,d.rowData.children?(p=d.rowData.pq_close?"ui-icon fa fa-caret-right":"ui-icon fa fa-caret-down",c=n.isRadioType?'<div class="'+T+p+'" style="cursor:pointer;"></div><div class="tree-basic-cell pwrap" title="'+f+'">'+w()+"<p>"+q+"</p></div>":'<div class="'+T+p+'" style="cursor:pointer;"></div><div class="tree-basic-cell pwrap" title="'+f+'"><p>'+q+"</p></div>"):c=n.isRadioType?'<div class="'+T+'" style="cursor:pointer;padding-left:'+h*r+'px;"></div><div class="tree-basic-cell pwrap" title="'+f+'">'+w()+"<p>"+q+"</p></div>":'<div class="'+T+'" style="padding-left:'+h*r+'px;"></div><div class="tree-basic-cell pwrap" title="'+f+'"><p>'+q+"</p></div>",y["text-indent"]=3+h*o+"px"):c='<div class="tree-basic-cell pwrap" title="'+f+'"><p>'+q+"</p></div>",(n.isRadioType||a.enableRowPicked)&&(y.cursor="pointer"),{text:c,style:Object.keys(y).reduce((function(e,t){return e+=t+":"+y[t]+";"}),""),cls:S.join(" ")}},this},clearContent:function(){try{this.$el.find(".pq-body-outer .pq-cont-right").getNiceScroll().remove(),this.$el.find(".ctable").pqGrid("destroy")}catch(e){}return this.$el.children(".ctable").remove(),this.$el.closest(".panel").find(".c-mask").children().remove(),this},dataEmpty:function(t){return this.clearContent(),this.$el.append('<div class="empty"><span class="cell">'+(t||e.locale("components","universal","no data"))+"</span></div>"),this.$el.closest(".c-node").addClass("data-empty"),this},dataFormatter:function(n,l,a,i){var o,r,d=this.baseOptions;if(this.dataColumnRecord={},i.json.isEmpty){this.dataEmpty();try{this.baseOptions.dataModel.data=[]}catch(e){}return this}return(null===(o=i.json)||void 0===o||null===(o=o.data)||void 0===o||null===(o=o.dataModel)||void 0===o||null===(o=o.data)||void 0===o?void 0:o.find((function(e){return Array.isArray(e.children)})))?(d.dataFormatError=null,d=s.extend(d||{},i.json.data),Array.isArray(null===(r=d.dataModel)||void 0===r?void 0:r.data)&&(d.dataModel.data=d.dataModel.data.filter((function(e){return void 0!==e.id&&null!==e.id}))),this.dataColumnRecord=d.dataColumnsArray,t(this),this.hasQueryGrandSummary()&&s.delay((function(e){e.tryUpdateGridGrandSummary(e.options.grandSummary.data,i.json.columnLeafs,e.options.grandSummary.id)}),0,this),this):(d.dataFormatError=e.locale("components","extends","BaseClosureTreeTable","no parent-child data"),this)},beforeQuery:function(t){var n,l=this.model.getRegion([C,A,k]),a=this.model.getCustomizations()[w]||[],i=this.getCustomizeFunction("action","_preFetch"),o=this.model.getCustomizations()||{},r=new h({chartType:this.model.get("chartType"),query:t}),d=this.model.getSavedAutoTransform();n=r.get("query"),l.forEach((function(e,t){var n=r._getReference("level",e.id,"ROWS");n&&(n.sort=t)})),n.queryModel.axes.ROWS.hierarchies.every((function(e){var t=e.levels||{};if(0==Object.keys(t).length)return!0;for(var n in t)t[n].filters=new Array;return!0})),r.set("query",n),this.model.adjustFieldsQueryOrder(a.map((function(e){return e.id})),r,d,3),(n=r.get("query")).properties["datafor.query.formatter.debug"]=!0,n.properties["datafor.olap.result.formatter"]="mix",t.properties["datafor.query.sum.name"]=o["style.grandtotal.caption"]||e.locale("components","system default","table","summary total"),t.properties["datafor.query.total.name"]=o["style.grandtotal.caption"]||e.locale("components","system default","table","summary total"),this.model.__lastQueryDefs=JSON.stringify({axes:n.queryModel.axes,details:n.queryModel.details,parameters:n.parameters}),this.setPickedRowIndex({});try{this.searchKeywords="",this.$el.find("input.search-content").val(this.searchKeywords)}catch(e){}return s.isFunction(i)?i.call(this,n):n},triggerPivotCellClickEvent:function(t,n,l,a){return s.isFunction(a)&&a.call(this,{rowData:e.deepCopy(l.rowData),position:{y:l.rowIndx,x:l.colIndx},id:l.dataIndx},n),this},onPivotCellClickEvent:function(e,t){var n=this.getCustomizeFunction("action","_cell_click"),l=this,a=function(){var e={measures:[],levels:[]};try{JSON.parse(t.rowData[t.dataIndx])}catch(e){}return e.levels=t.rowData.datafor_rows.map((function(e){return e})).filter((function(e){return e&&e.hierarchy&&e.level})),e.detailNode=!t.rowData.isSummaryNode,{data:e}}();return e.stopPropagation(),!1===t.column.isMeasureNode||t.column.isGroup||t.column.isGroup||t.column.isGrand?(s.isFunction(n)&&this.triggerPivotCellClickEvent(a,e.originalEvent.originalEvent,t,n),this):(l.toUpdateDataJoinPoint(a,u.isCtrlKeyPressed(e.originalEvent.originalEvent,l)).then((function(i){s.isFunction(n)&&l.triggerPivotCellClickEvent(a,e.originalEvent.originalEvent,t,n),l.triggerLinkMenus({x:e.clientX,y:e.clientY},{levels:a.data.levels,measures:a.data.measures,data:i.map((function(e){return e}))})})),this)},tableUiUpdate:function(t){var n,l=this.baseOptions,a=this.getColumnCustomSizes(),o=this,r=this.options.pivotStyles,d=0;if(this.options.showNumeric=!0,l.dataModel=l.dataModel||{},l.numberCell=!1,!Array.isArray(l.dataModel.data)||l.dataModel.data.length<1)return this.dataEmpty(l.dataFormatError),this;e.deepFind(l.colModel,(function(t){var n,l=t.dataIndx;t.title=function(e){return o.getColumnHeaderUI(e)},Array.isArray(t.colModel)&&0!=t.colModel.length||(n=a.hasOwnProperty(l)?a[l]:t.width,t.width=n,t,t.cls&&(t.cls=t.cls.replace("grid-cell-no-border-left","")),e.isNumeric(a[l])&&(t.width=a[l]),t.width=t.width||120,"empty_column_scroll"===l&&(t.maxWidth=10,t.minWidth=10),d+=t.width),o.cellRenderOveride(t)}),"colModel"),l.showTop=!1,l.rowClick=function(e,t){var n=o.getPickedRowIndex();n&&n.pq_ri===t.rowData.pq_ri?o.setPickedRowIndex({}):o.setPickedRowIndex(t.rowData),this.refresh()},l.rowInit=function(e){return{attr:'data-y="'+e.rowIndx+'"'}};var c=!1;l.beforeTreeExpand=function(e,t){return c=!0,setTimeout((function(){c=!1}),200),!0},l.cellClick=function(){c?c=!1:o.onPivotCellClickEvent.apply(o,Array.prototype.slice.call(arguments,0))};var u=this.$el.closest(".c-node").attr("data-scale");try{u=u.split(",")}catch(e){u=this.dashboard&&this.dashboard.scaleFactor||[1,1]}this.enlargeMode&&(u=[1,1]),n=this.$el.css("z-index",0);try{n.find(".pq-body-outer .pq-cont-right").getNiceScroll().remove(),n.find(".ctable").pqGrid("destroy").children().remove(),n.children(".ctable").remove(),n.data("id",this.id),n.append(m.plainCompile(this.getMainLayout()))}catch(e){n.children(".ctable").remove(),n.append(m.plainCompile(this.getMainLayout()))}if(l.complete=function(){o.tryUpdateCollapseTreeLevel(this)},l.rowHtHead=Number(r.tableHeaderRowSizeY||30),l.rowHt=Number(r.tableHeaderRowSizeY||30),l.autoRow=!0,l.autoRowHead=!0,l.autoRowHeight=function(e,t){o.$el.find(".pq-body-outer>.pq-grid-cont .pq-cont-inner.pq-cont-right>.pq-table-right.pq-table").find(".pq-grid-row");s.delay((function(){}),0)},l.refresh=function(){var e=o.$el.find(".pq-body-outer .pq-cont-right"),t=e.getNiceScroll();o.baseOptions&&(i.isMobileEnv()||(t&&t.length?s.delay((function(){t&&t.resize()}),100):o.tryNiceScrollGridNode(e)))},l.pageModel={type:"local",rPP:1e6},l.pagination=!1,l.editable=!1,l.selectionModel={type:"none",native:!1},d>this.$el.closest(".c-node").width()?l.width="100%":l.width="flex",l.flex={on:!1},this.tryLockViewOnResizeColumnEvent(l),l.height="100%",l.columnResize=function(e,t){var n=t.dataIndx,l=t.newWidth,a=o.getColumnCustomSizes();a[n]=l,o.columnCustomSizesUpdate(a,!0),o.tableStyleUpdate({})},!1===(!s.isFunction(t)||t.call(this,require,l)))return this.$el.css("visibility","hidden"),this;try{this.gridInstance=this.$el.find(".ctable").css({background:"transparent",border:this.options.pivotStyles.gridStyle}).pqGrid(l).pqGrid("getInstance").grid,i.isMobileEnv()||o.tryNiceScrollGridNode(o.$el.find(".pq-body-outer .pq-cont-right")),this.hasQueryGrandSummary()?this.$el.find(".ctable").css("border",this.options.pivotStyles.gridStyle).addClass("on-grand-summary"):(this.$el.find(".ctable").css("border","none"),this.$el.find(".ctable .pq-grid-cont").css("border-bottom",this.options.pivotStyles.gridStyle))}catch(e){console.log(e)}return this},enterGridcell:function(e){var t=$(e.target).closest(".pq-grid-row"),n=t.attr("data-y"),l=this.getRowBackgroundColor(n,null,this.options.pivotStyles.hoverBackgroundColor);return t.find(".pq-grid-cell.data-cell").css("background",l),this},leaveGridcell:function(e){var t=$(e.target).closest(".pq-grid-row"),n=t.attr("data-y");if(this.gridInstance){var l=this.getRowBackgroundColor(n);t.find(".pq-grid-cell.data-cell").css("background",l)}return this},trySearchKeyContent:function(t,n,l){var a=this.getPanelControlValue("style","searched.highlight.font")||[14,"#ef0505","",!0,!0],i=["color: "+a[1],"font-size: "+Number(a[0])+"px","font-family: "+a[2],"font-weight: "+(a[3]?"bold":"normal"),"font-style: "+(a[4]?"italic":"normal")].join(";"),o=new RegExp(String(n).replace(/\./g,"\\.").replace(/\-/g,"\\-"),"ig");return e.bubbleRecurve(t,(function(e,t,n){l.every((function(t){var n=String(e[t]),l=n.match(o);return Array.isArray(l)&&l.length&&(e[t+"_matched"]=n.replace(o,'<span style="'+i+'">'+l[0]+"</span>"),e._matchedFlag=!0),!0})),Array.isArray(e.children)&&(e.children=e.children.filter((function(e){return!!(e._matchedFlag||Array.isArray(e.children)&&0!==e.children.length)})))}),"children"),0===t.filter((function(e){return!!(e._matchedFlag||Array.isArray(e.children)&&0!=e.children.length)})).length&&(t=new Array),t},getRowBackgroundColor:function(e,t,n){var l,a,i=this.getCustomizeFunction("style","_cellbgfn"),o=this.model.getDefaultsValue().value||[],r=t||this.gridInstance.getRowData({rowIndx:e}),d=r.myuuid,c=r.idKey,u=this.options.pivotStyles;return a=this.isRadioType?s.find(o,(function(e){return s.isString(e)?e===c:e.myuuid===d})):this.getPickedRowIndex().pq_ri===r.pq_ri,u.enableRowPicked&&a?l=u.pickedRowBackgroundColor:(l=e%2?u.evenRowBackgroundColor:u.oddRowBackgroundColor,s.isFunction(i)&&(l=i.call(this,r,null,e,l)||l),n&&(l=n)),l},tryAppendArrowStyle:function(e,t,n,l){var a=l||{},i=t-n||0,o=a.up||"red",r=a.down||"green",s=i>=0?o:r,d=i>=0?"fa fa-arrow-up":"fa fa-arrow-down",c=new Array({tagName:"span",html:e});return t!=n&&c.unshift({tagName:"i",style:"font-size:1em;float: left;position:relative;top:3px;color:"+s,class:d}),m.plainCompile([{style:"width:100%;",html:c}])},tryAppendBarStyle:function(e,t,n,l,a){var i=(this.dataColumnRecord[n]||[]).filter((function(e){return!a||e.level===a})).map((function(e){return e.v})),o=Math.min.apply(null,i),r=l||{},s=100*(t-o)/(Math.max.apply(null,i)-o)+"%",d="height:100%;position:absolute;top:0px;background:"+(r&&r.color?r.color:"#49c4ff")+";width:"+s;return"left"===r.align?d+=";left: 0px;":d+=";right: 0px;",m.plainCompile([{style:"width:100%;position:relative;height:100%;display:flex;align-items:center;justify-content:inherit;",html:[{tagName:"div",style:d},{tagName:"span",style:"position:relative;z-index:1",html:e}]}])},dimensionDatasourceUpdateEvent:function(t,n,l,a,i){var o=[C,A,k];if(o.indexOf(i)>=0)return t;var r=this.model.getRegion(o).map((function(e){return e.id}));return e.deepEnter(t,"children",(function(e){return r.indexOf(e.id)>=0&&(e.enable=!1),!0})),t}},{thumbnail:"icon iconfont icon-datafor-toushibiao",privates:{paginationComponent:!1,gridResizable:!0,skipBuildDetailObject:!0,scrollResponseScaleSize:!0,task:g.registerTask("BaseClosureTreeTable.task.js")},logo:r.getGeneralIcon({fontSize:19},'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="none" version="1.1" width="25" height="21" viewBox="0 0 25 21"><g><g><rect x="0" y="0" width="25" height="3" rx="0" fill="#096DD9" fill-opacity="1"/></g><g><rect x="0.5" y="0.5" width="24" height="20" rx="0" fill-opacity="0" stroke-opacity="1" stroke="#096DD9" fill="none" stroke-width="1"/></g><g><g><g transform="matrix(-1,5.400848479553133e-8,-5.400848479553133e-8,-1,10.000000351055151,12.999999729957576)"><path d="M5,8L7,8L6,6.5L5,8Z" fill="#FAAD14" fill-opacity="1"/></g><g><rect x="7" y="5" width="3" height="2" rx="0" fill="#FAAD14" fill-opacity="1"/></g><g><rect x="12" y="5" width="10" height="2" rx="0" fill="#FAAD14" fill-opacity="1"/></g></g><g><g transform="matrix(-1,5.400848479553133e-8,-5.400848479553133e-8,-1,8.000000787504833,20.33333279940795)" style="opacity:0;"><path d="M4.0000001192092896,11.666666507720947L5.0000001192092896,11.666666507720947L4.5000001192092896,10.166666507720947L4.0000001192092896,11.666666507720947Z" fill="#FAAD14" fill-opacity="1"/></g><g transform="matrix(-1,5.400848479553133e-8,-5.400848479553133e-8,-1,16.000000549086252,20.333332583374016)"><path d="M8,11.666666507720947L10,11.666666507720947L9,10.166666507720947L8,11.666666507720947Z" fill="#FAAD14" fill-opacity="1"/></g><g><rect x="10" y="8.666666507720947" width="3" height="2" rx="0" fill="#FAAD14" fill-opacity="1"/></g><g><rect x="15" y="8.666666507720947" width="7" height="2" rx="0" fill="#FAAD14" fill-opacity="1"/></g></g><g><g transform="matrix(-1,5.400848479553133e-8,-5.400848479553133e-8,-1,8.000000985535934,27.666665814849843)" style="opacity:0;"><path d="M4.0000001192092896,15.333333015441895L5.0000001192092896,15.333333015441895L4.5000001192092896,13.833333015441895L4.0000001192092896,15.333333015441895Z" fill="#FAAD14" fill-opacity="1"/></g><g transform="matrix(-1,5.400848479553133e-8,-5.400848479553133e-8,-1,14.000000747117355,27.666665652824395)" style="opacity:0;"><path d="M7,15.333333015441895L8,15.333333015441895L7.5,13.833333015441895L7,15.333333015441895Z" fill="#FAAD14" fill-opacity="1"/></g><g transform="matrix(-1,5.400848479553133e-8,-5.400848479553133e-8,-1,20.000000747117355,27.66666549079894)" style="opacity:0;"><path d="M10,15.333333015441895L11,15.333333015441895L10.5,13.833333015441895L10,15.333333015441895Z" fill="#FAAD14" fill-opacity="1"/></g><g><rect x="12" y="12.333333015441895" width="3" height="2" rx="0" fill="#FAAD14" fill-opacity="1"/></g><g><rect x="17" y="12.333333015441895" width="5" height="2" rx="0" fill="#FAAD14" fill-opacity="1"/></g></g><g><g transform="matrix(-1,5.400848479553133e-8,-5.400848479553133e-8,-1,10.000000945148484,34.99999972995758)"><path d="M5,19L7,19L6,17.5L5,19Z" fill="#FAAD14" fill-opacity="1"/></g><g><rect x="7" y="16" width="3" height="2" rx="0" fill="#FAAD14" fill-opacity="1"/></g><g><rect x="12" y="16" width="10" height="2" rx="0" fill="#FAAD14" fill-opacity="1"/></g></g></g></g></svg>'),extends_model:{getRegion:function(t){var n=Array.isArray(t)?t:t?[t]:["detail.fields","legend.fields"];return this.getAxisInitValue("ROWS",!0).filter((function(e){return!(!e.extend_properties||!e.extend_properties.identifyPosition||n.indexOf(e.extend_properties.identifyPosition.uuid)<0)&&(e._orderIndex=n.indexOf(e.extend_properties.identifyPosition.uuid),!0)})).sort((function(e,t){return e._orderIndex-t._orderIndex})).map((function(t){return delete t._orderIndex,e.deepCopy(t)}))},checkQueryDefsUpdated:function(){var e,t,n=!0,l=this.__lastQueryDefs||"";return this.backup?((e=new h(this.getJsonProperties(this.backup.query))).id=this.id,e.parent=this.parent,e.queryRestore(),e.doJoining=!0,e.tryPackageDynamicQueryies(),e.doJoining=!1,t=JSON.stringify({axes:e.get("query").queryModel.axes,details:e.get("query").queryModel.details,parameters:e.get("query").parameters}),l&&t&&l===t&&(n=!1),n):n=!1}},menus:function(){return{outer:[{value:"DrillReset"},{value:"Enlarge"}],inner:[{value:"Export",children:[{value:"Csv"},{value:"Excel"}]}]}},_sort_order:1.3,symbol:"parent_child_tree.svg",staticPanelOptions:(x=new f,[{name:"data",label:e.locale("panel","data"),active:!0,datasets:[x.datasource(),x.line(),x.enhanceDimensionPrimary(e.locale("components","extends","BaseClosureTreeTable","parent field"),null,1,e.locale("components","extends","BaseClosureTreeTable","parent field desc"),null,[],C),x.enhanceDimensionPrimary(e.locale("components","extends","BaseClosureTreeTable","child field"),null,1,e.locale("components","extends","BaseClosureTreeTable","child field desc"),null,[],A),x.enhanceDimensionPrimary(e.locale("components","extends","BaseClosureTreeTable","filed caption"),null,1,e.locale("components","extends","BaseClosureTreeTable","filed caption desc"),null,["rename","Topcount"],k),s.extend(b.getRendererBaseAttrs("DimMeasure"),{name:w.replace(/^data\./g,""),label:e.locale("components","system default","list table","fields"),mode:"mul",menuFilter:function(e){return e.filter((function(e){return["format","displayFormat","rename","Topcount"].indexOf(e.value)>=0}))},min:0,listeners:[],location:"ROWS",tooltip:e.locale("components","system default","list table","fields description"),chainLinker:function(e,t,n){var l=n.model.get("value"),a=e.value;if("datasource"==e.name){if(Array.isArray(l)&&l.length&&(n.model.set({value:[]},{silent:!0}),n.render()),this.model.clearAxisHierarchy("ROWS"),this.model.clearMeasures(),e.endListener&&this.model.commit(),a.length<1||e.value.length<1)return void n.crLe2val();n.level2ValuesArray(e.value[0])}},save:function(e,t){var n,l=t.getCustomizations()[w]||[],a=t.getRegion([C,A,k]),i=(e||[]).concat(a).filter((function(e){return!String(e.id).match(/^\[Measures\]/)})),o=(e||[]).filter((function(e){return!!String(e.id).match(/^\[Measures\]/)})),r=t.getCubeMessage(),s=JSON.stringify(l)!==JSON.stringify(e);t.customizationUpdate(w,e),t.clearAxisHierarchy("ROWS"),t.clearMeasures(),t.toUpdateAxisLevel("ROWS",i,!0),0===o.length?s&&t.commit():(n=new v({cube:r})).getNodes((function(e){var l;e&&((l=e.measures)&&o.every((function(e){var a=e.value,i=n.findMeasureNode(a,l)||t.getCalculatedMeasureNode(e.id);return i&&t.includeMeasure({caption:i.caption,name:i.name,id:e.uuid||e.id||i.uniqueName,uniqueName:i.uniqueName,type:i.type||"EXACT",extend_properties:e.extend_properties||{}}),s||(s=!!i),!0})),s&&t.commit())}))},init:function(e,t,n,l){return l[w]||[]}}),x.line(),x.dimensionDate(),x.line(),x.filters()]},{name:"style",label:e.locale("panel","styles"),active:!1,datasets:[x.label(e.locale("components","system default","table","primary title")),x.titleSwitch(e.locale("panel","shown")),x.titleParimary(e.locale("panel","content")),x.titlePrimaryAlign(),x.titlePrimaryStyle(),x.titleBackground("transparent"),x.line(),x.label(e.locale("panel","frame style")),x.background(e.locale("panel","background color")),x.border(e.locale("panel","border")),x.styleRadius(),x.shadow(),x.line(),x.label(e.locale("panel","style panel","axis","grid")),g.inheritPanelControl("style","_gridLine"),s.extend(b.getRendererBaseAttrs("Slider"),{name:"_ySizey",min:20,max:80,value:25,formatter:function(e){return e+"px"},step:1,label:e.locale("components","extends","BaseClosureTreeTable","row height"),tooltip:e.locale("components","extends","BaseClosureTreeTable","row height desc"),execute:function(e,t,n,l){s.extend(t.pivotStyles||{},{tableHeaderRowSizeY:e})}}),s.extend(b.getRendererBaseAttrs("ColorPicker"),{name:"_oddbg",value:"rgb(243, 243, 243)",label:e.locale("components","system default","table","odd row background"),tooltip:e.locale("components","system default","table","odd row background description"),chainLinker:function(e,t,n){var l=this.options.pivotStyles.oddRowBackgroundColor;n.model.get("execute").call(this,l,this.options,n.$el,l)},execute:function(e,t,n){s.extend(t.pivotStyles||{},{oddRowBackgroundColor:e})}}),s.extend(b.getRendererBaseAttrs("ColorPicker"),{name:"_evenbg",value:"rgba(255, 255, 255)",label:e.locale("components","system default","table","even row background"),tooltip:e.locale("components","system default","table","even row background description"),chainLinker:function(e,t,n){var l=this.options.pivotStyles.evenRowBackgroundColor;n.model.get("execute").call(this,l,this.options,n.$el,l)},execute:function(e,t,n){s.extend(t.pivotStyles||{},{evenRowBackgroundColor:e})}}),x.line(),x.label(e.locale("components","system default","table","table header")),s.extend(b.getRendererBaseAttrs("ColorPicker"),{name:"_headerBg",value:"white",label:e.locale("components","system default","table","header background"),tooltip:e.locale("components","system default","table","header background description"),execute:function(e,t,n){s.extend(t.pivotStyles||{},{headerBackgroundColor:e})}}),s.extend(b.getRendererBaseAttrs("Font"),{name:"_headerFont",tooltip:e.locale("components","system default","table","header font style settings"),label:e.locale("panel","style panel","title","font"),value:[12,"rgb(51, 51, 51)","",!1,!1],bold:!0,italic:!0,execute:function(e,t,n){s.extend(t.pivotStyles||{},{headerFont:[e[4]?"italic":"normal","normal",e[3]?"bold":"normal",e[0]+"px",e[2]||"sans-serif"].join(" "),headerColor:e[1]})}}),s.extend(b.getRendererBaseAttrs("TableColumnsAlign"),{name:"_headerAlign",value:[],alignAttr:"halign",tooltip:e.locale("components","system default","table","columns align description"),label:e.locale("components","system default","table","columns align"),execute:function(t,n,l){this.baseOptions&&Array.isArray(this.baseOptions.colModel)&&Array.isArray(t)&&t.every((function(t){var n=t.value,l=t.id||t.label,a=e.deepFind(this,(function(e){return e.dataIndx==l}),"colModel");return a&&(a.halign=n),!0}),this.baseOptions.colModel)}}),s.extend(b.getRendererBaseAttrs("RadioBox"),{name:"_head_wrap",value:!1,label:e.locale("components","system default","table","cell content wrap"),tooltip:e.locale("components","system default","table","cell content wrap description"),execute:function(e,t,n){this.baseOptions&&(this.baseOptions.hwrap=!!e,this.tableStyleUpdate({hwrap:this.baseOptions.hwrap}))}}),x.line(),x.label(e.locale("panel","content")),s.extend(b.getRendererBaseAttrs("RadioBox"),{name:"_cell_wrap",value:!1,label:e.locale("components","system default","table","cell content wrap"),tooltip:e.locale("components","system default","table","cell content wrap description"),execute:function(e,t,n){this.baseOptions&&(this.baseOptions.wrap=!!e,this.tableStyleUpdate({wrap:this.baseOptions.wrap}))}}),s.extend(b.getRendererBaseAttrs("Font"),{name:"_fontStyle",label:e.locale("components","system default","table","font style"),value:[12,o.tableFont(),"",!1,!1],bold:!0,tooltip:e.locale("components","system default","table","font style description"),italic:!0,execute:function(e,t,n){s.extend(t.pivotStyles||{},{contentFont:[e[4]?"italic":"normal","normal",e[3]?"bold":"normal",e[0]+"px",e[2]||"sans-serif"].join(" "),contentColor:e[1]})}}),s.extend(b.getRendererBaseAttrs("TableColumnsAlign"),{name:"content.align",value:[],alignAttr:"align",skipArray:["caption"],label:e.locale("components","extends","BaseClosureTreeTable","content align"),tooltip:e.locale("components","extends","BaseClosureTreeTable","content align desc"),execute:function(t,n,l){this.baseOptions&&Array.isArray(this.baseOptions.colModel)&&Array.isArray(t)&&t.every((function(t){var n=t.value,l=t.id||t.label,a=e.deepFind(this,(function(e){return e.dataIndx==l}),"colModel");return a&&(a.align=n),!0}),this.baseOptions.colModel)}}),s.extend(b.getRendererBaseAttrs("ColorPicker"),{name:"hover.row.background",value:"#c0c0c0",label:e.locale("components","extends","BaseClosureTreeTable","row hover bg"),tooltip:e.locale("components","extends","BaseClosureTreeTable","row hover bg desc"),listeners:["row.selected.highlight"],execute:function(e,t,n){s.extend(t.pivotStyles||{},{hoverBackgroundColor:e})}}),s.extend(b.getRendererBaseAttrs("NumericInput"),{name:"collpase.level",tooltip:e.locale("components","extends","BaseClosureTreeTable","expand levels desc"),value:1,min:0,max:999,step:1,label:e.locale("components","extends","BaseClosureTreeTable","expand levels"),execute:function(e,t,n){try{var l=n.find(".ctable").pqGrid("getInstance").grid;this.tryUpdateCollapseTreeLevel(l)}catch(e){}}}),{type:"Slider",name:"indent.size",queried:!1,label:e.locale("components","extends","BaseClosureTreeTable","indent size"),tooltip:e.locale("components","extends","BaseClosureTreeTable","indent size desc"),formatter:function(e){return e+"px"},value:25,step:1,min:5,max:50,execute:function(e,t){t.pivotStyles.textIndentSize=e}},x.line(),x.label(e.locale("components","system default","table","summary total")),g.inheritPanelControl("style","grandtotal.on"),g.inheritPanelControl("style","grandtotal.caption"),g.inheritPanelControl("style","_total_bg"),g.inheritPanelControl("style","_total_font"),x.line(),x.label(e.locale("panel","style panel","component menu settings","name")),x.menuEnable(),x.setOuterMenuColor(),x.enlargeBackground()]},{name:"action",label:e.locale("panel","actions"),datasets:[x.label(e.locale("panel","action panel","refresh")),x.refresh(),x.period(),x.line(),x.label(e.locale("panel","action panel","custom blocks")),x.dataPointClick(null,null,null,e.getFunctionContent("clickPlotArea",["params","event"],"return true")),x.preExecution(null,null,"https://paramquery.com/pro/api62"),x.preFetch(null,"function shouldFetch(msg){\n\t/*msg:组件订阅过的所有筛选组件最新状态值*/\n\treturn msg;\n}"),x.postExecution()]}])});return g.register(S),S}));
//# sourceMappingURL=BaseClosureTreeTable.js.map