"use strict";define("BaseURLComponent",["Utility","ui/Notification","ui/extendIconUI","underscore","template/compile","BaseQueryComponent","log/Log","validator","Base.Panel","render/Base","moment","utility/runtime","promise","render/Renderer"],(function(e,t,l,i,n,o,a,s,r,c,d,u,p){p.Promise;var m=new r,h=function(t){var l,i=t["style._titlePrimaryStyle"],n=!!t["style._titleOn"],o=t["style._titlePalign"],a=t["style._title"];return Array.isArray(i)&&5==i.length&&(l={color:i[1],textAlign:o||"center",fontSize:Number(i[0]),fontFamily:i[2],fontWeight:i[3]?"bold":"normal",fontStyle:i[4]?"italic":"normal"}),e.deepCopy({title:{text:a,show:n,textStyle:l||{textAlign:"center",color:"#666",fontSize:16,fontFamily:"serif",fontWeight:"normal",fontStyle:"normal"}},url:"",staticLinker:""})},y=o.extend({type:"BaseURLComponent",name:e.locale("components","system default","url component","name"),description:e.locale("components","system default","url component","name tip"),classify:"_statics",filterable:!1,valueRestore:function(){return this.render(),this},queryExtend:function(){var e,t=this.model.isValidQueryModel.bind(this.model),l=(this.model.getCustomizations(),this),i=this.model.commit.bind(this.model),n=this.draw.bind(this);return this.draw=function(){e&&clearTimeout(e),e=setTimeout((function(){n()}),500)},this.options=this.options||h(this.model.getCustomizations()),this.$el.addClass("flex"),this.model.isValidQueryModel=function(){var e,i,n=this.getAxesLevels("ROWS"),o=this.getCubeID();return o&&n.length?(o=this.getCubeMessage(),(i=(e=u.getMetadata(o,!1)||{measures:new Array})&&e.measures.length?e.measures[0]:null)&&this.includeMeasure({caption:i.caption,name:i.name,uniqueName:i.uniqueName,id:i.uniqueName,type:"EXACT"})):(l.options.url=null,this.clearMeasures()),t(!0)},this.model.commit=function(){var e,t=Array.prototype.slice.call(arguments),n=l.model.getCustomizations(),o=l.$el.find("iframe").attr("src")||n["data._static"]||"";if(l.model.isValidQueryModel())i.apply(l.model,t);else{if(!o)return;try{e=o.split("/").pop().split("?").shift()}catch(e){}"viewer"==e?l.dynamicUpdateLink(o):l.dashboard.postMessage2FramePage(l.id,"Normal",e)}},this},checkQm:function(e,t,l){return this.model.hslice("COLUMNS",0),this.model.hslice("ROWS",0),this.model.mslice(1),null},dataFormatter:function(e,t,l,i){e&&Array.isArray(e.resultset)&&e.resultset.length?this.options.url=e.resultset[0][0]:this.options.url=""},draw:function(){var e,t,l,n=this.getCustomizeFunction("action","_preChange"),o=this.$el,a=o.find("iframe"),s={},r=new Array,c=this.id;if(this.options.url?l=this.options.url:this.options.staticLinker&&(l=this.options.staticLinker),this.model&&this.model.parent&&Array.isArray(this.model.parent.get("children"))&&this.model.parent.get("children").filter((function(e){return!(!e||"FilterComponentModel"!==e.type||!i.isFunction(e.getListeners))&&!((e.getListeners()||[]).indexOf(c)<0)})).every((function(e){var t;try{t=e.getDefaultsValue()}catch(e){t={}}return!t.level||(s[t.level]=t.value,!0)})),i.isObject(s)&&Object.keys(s).length)for(var d in s)r.push(d+"="+s[d]);if(i.isFunction(n)&&(s=n.call(this,s)),null!==(e=l)&&void 0!==e&&e.match(/\?/)?l+=r.join("&"):l+="?"+r.join("&"),a.attr("src")===l)return this;if(o.empty(),l){o.append('<div class="linker-title">'+this.options.title.text+"</div><iframe></iframe>"),a=o.find(".linker-title"),this.options.title.show?(a.show().css({display:"block",width:"100%"}),this.options.title.textStyle&&Object.keys(this.options.title.textStyle).length&&a.css(this.options.title.textStyle)):a.hide(),(t=o.find("iframe").css({background:"transparent",width:"100%",height:"100%",border:"none",padding:"5px"})).load((function(){console.log(this)})),t.error((function(){t.addClass("error-iframe-style"),console.log("hello error")}));try{t.attr("src",l)}catch(e){console.log(e)}}return this},dynamicUpdateLink:function(e){return this.options.staticLinker=e,this.inValidQueryDetected(!0),this},inValidQueryDetected:function(t){var l,n=o.get(this.type).class;return n?(l=n.symbol,i.isFunction(this.clearContent)&&this.clearContent(),this.options.staticLinker?(this.draw(),t||this.chartPropertiesRebuild(!0),this):l?(0==this.$el.find(">.symbol_mode").length&&this.$el.append('<div class="symbol_mode"><div class="image"></div></div>'),this.$el.find(">.symbol_mode .image").css("background-image",'url("'+e.getWebAppName()+"/content/datafor/ui/images/components_symbol/"+l+'")'),this):this):this},clearContent:function(){var e,t;this.options.url?e=this.options.url:this.options.staticLinker&&(e=this.options.staticLinker);try{t=this.$el.find("iframe").attr("src")}catch(e){}return e===t||this.$el.children().remove(),this}},{thumbnail:"icon iconfont icon-datafor-url",logo:l.getLinkComponentIcon(),privates:{queryRequired:function(){return this.isValidQueryModel()}},_sort_order:23,menus:null,symbol:"linker.svg",staticPanelOptions:i.extend([],[{name:"data",label:e.locale("panel","data"),active:!0,datasets:[m.datasource(null,["row_dim","_static"]),m.line(),m.dimensionPrimary(e.locale("components","system default","url component","url level"),null,null,e.locale("components","system default","url component","url level description"),["_static"]),m.line(),i.extend(c.getRendererBaseAttrs("TextArea"),{name:"_static",value:"",tab:1,placeholder:e.locale("components","system default","url component","url placeholder"),disabled:!1,label:e.locale("components","system default","url component","static url"),chainLinker:function(t,l,i){var n,o=Boolean(this.model.getAxesLevels("ROWS").length>0);["datasource","row_dim"].indexOf(t.name)>=0?(Array.isArray(t.value)&&0!=t.value.length||this.draw(),i.model.set("readOnly",o),i.render()):"_server_file"===t.name&&(n=location.protocol+"//"+location.hostname,location.port&&(n+=":"+location.port),n=e.getWebAppName()+"/plugin/datafor/api/integrate/"+window.btoa(unescape(encodeURIComponent(t.value))).replace(/\+/g,"-").replace(/\//g,"_")+"?__compact=true&__xdmEnable=true&__forceAdjust=true",this.model.customizationUpdate("data._static",n),i.model.set({value:n},{silent:!0}),i.render(),this.options.staticLinker=n,this.draw())},tooltip:e.locale("components","system default","url component","static url description"),execute:function(e,t,l){t.staticLinker=e},init:function(e,t,l,i){var n=i["data._static"];return t.readOnly=Boolean(e.getAxesLevels("ROWS").length>0),t.value=n,this.options=this.options||h(this.model.getCustomizations()),this.options.staticLinker=n,n||""}}),i.extend(c.getRendererBaseAttrs("ServerFileSelect"),{name:"_server_file",value:"",listeners:["_static"],label:e.locale("components","system default","url component","select from repository"),tab:1,fileType:"datafor",tooltip:e.locale("components","system default","url component","select from repository description")})]},{name:"style",label:e.locale("panel","styles"),active:!1,datasets:[m.label(e.locale("panel","style panel","title","primary")),i.extend(c.getRendererBaseAttrs("RadioBox"),{name:"_titleOn",value:!1,tooltip:e.locale("panel","style panel","title","shown description"),label:e.locale("panel","style panel","title","shown"),execute:function(e,t,l){var i=l.find(".linker-title");t.title.show=!!e,t.title.show?i.show():i.hide()}}),i.extend(c.getRendererBaseAttrs("TextInput"),{name:"_title",value:e.locale("others","untitle"),label:e.locale("panel","content"),tooltip:e.locale("panel","style panel","title","primary description"),execute:function(e,t,l){t.title.text=e,l.find(".linker-title").html(e)}}),i.extend(c.getRendererBaseAttrs("QuickPicker"),{name:"_titlePalign",value:"center",tooltip:e.locale("panel","style panel","title","align description"),label:e.locale("panel","style panel","title","align"),execute:function(e,t,l){t.title.textStyle.textAlign=e,l.find(".linker-title").css("text-align",e)}}),i.extend(c.getRendererBaseAttrs("Font"),{name:"_titlePrimaryStyle",label:e.locale("panel","style panel","title","primary font style"),value:[16,"rgb(84, 105, 141)","",!1,!1],bold:!0,italic:!0,tooltip:e.locale("panel","style panel","title","style description"),execute:function(e,t,l){t.title.textStyle.color=e[1],t.title.textStyle.fontSize=Number(e[0]),t.title.textStyle.fontFamily=e[2],t.title.textStyle.fontWeight=e[3]?"bold":"normal",t.title.textStyle.fontStyle=e[4]?"italic":"normal",l.find(".linker-title").css(t.title.textStyle)}}),m.line(),m.label(e.locale("panel","frame style")),m.background(e.locale("panel","background color")),i.extend(c.getRendererBaseAttrs("Border"),{name:"_border",tooltip:e.locale("panel","border style description"),value:[0,"#f0f0f0","solid"],selectSize:[70,70],label:e.locale("panel","style panel","border","border style"),execute:function(t,l,i){var n,o=i.find("iframe");Array.isArray(t)&&(n=Number(t[0]),e.isNumeric(n)&&o.css("border-width",n),(n=t[1])&&o.css("border-color",n),(n=t[2])&&o.css("border-style",n))}}),m.shadow()]},{name:"action",label:e.locale("panel","actions"),datasets:[m.label(e.locale("panel","action panel","custom blocks")),{name:"_preChange",type:"Function",disable:!1,tooltip:e.locale("panel","action panel","pre change block description"),value:"function preChange(value){\n//value: url parameters dict\n\treturn value\n}",label:e.locale("panel","action panel","pre change block")}]}])});return o.register(y),y}));
//# sourceMappingURL=BaseURLComponent.js.map