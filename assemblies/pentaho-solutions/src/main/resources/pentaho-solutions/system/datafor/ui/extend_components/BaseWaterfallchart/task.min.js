"use strict";function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}var _excluded=["baseOptions","dataArray","columnLeafs"];function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _defineProperty(e,t,r){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!==_typeof(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _objectWithoutProperties(e,t){if(null==e)return{};var r,a,o=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(a=0;a<n.length;a++)r=n[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var r,a,o={},n=Object.keys(e);for(a=0;a<n.length;a++)r=n[a],t.indexOf(r)>=0||(o[r]=e[r]);return o}self.onmessage=function(e){var t=e.data;"dataFormat"==t.eventType&&dataFormatter(t)};var PLACEHOLDER_TEMPLATE={name:"PLACEHOLDER",type:"bar",stack:"TOTAL",silent:!0,visualizerHidden:!0,itemStyle:{borderColor:"transparent",color:"transparent"},emphasis:{itemStyle:{borderColor:"transparent",color:"transparent"}}},UP_TEMPLATE={name:"Income",type:"bar",stack:"TOTAL",label:{normal:{show:!0,position:"top",verticalAlign:"bottom"}}},DOWN_TEMPLATE={name:"Outcome",type:"bar",stack:"TOTAL",label:{normal:{show:!0,position:"bottom",verticalAlign:"top"}}},getLast=function(e){var t;return(null===(t=e[e.length-1])||void 0===t?void 0:t.originalValue)||0},dataFormatter=function(e){var t,r=e.baseOptions,a=e.dataArray,o=e.columnLeafs,n=(_objectWithoutProperties(e,_excluded),Object.values(o)),i=JSON.parse(r),l=n.filter((function(e){return e.isMeasureNode})),u=n.find((function(e){return e.isMeasureNode})),s=n.findLast((function(e){return!e.isMeasureNode})),p=null==u?void 0:u.key,c=null==s?void 0:s.key,y=0;i.xAxis.data=a.map((function(e){var r=e[c];return String(r).length>y&&(y=String(r).length,t=r),r})),i.xAxis.type="category",i.xAxis.axisMaxLabel=t;var f=_objectSpread(_objectSpread({},PLACEHOLDER_TEMPLATE),{},{data:[{value:0,measures:[]}]}),d=_objectSpread(_objectSpread({},UP_TEMPLATE),{},{data:[],name:"POSITIVE"}),m=_objectSpread(_objectSpread({},DOWN_TEMPLATE),{},{data:[],name:"NEGATIVE"});i.series=[f,d,m];var v=[0];a.forEach((function(e,t){var r,a,o=e[p],n=e.datafor_rows,i=o.hasOwnProperty("raw")?Number(o.raw):o,u=n.find((function(e){return"true"==e.istotal})),s={value:i,originalValue:i,isGrand:!0,levels:u?[]:null==n?void 0:n.map((function(e){return e})),formatted:o.hasOwnProperty("formatted")?o.formatted:o,measures:l.map((function(t){var r,a,o;return{caption:t.title,uniqueName:t.key,value:e.hasOwnProperty(t.key)?(null===(r=e[t.key])||void 0===r?void 0:r.raw)||e[t.key]:"",vtip:e.hasOwnProperty(t.key)?(null===(a=e[t.key])||void 0===a?void 0:a.vtip)||e[t.key]:"",formatted:e.hasOwnProperty(t.key)?(null===(o=e[t.key])||void 0===o?void 0:o.formatted)||e[t.key]:""}}))};if(u||delete s.isGrand,u);else if(t>0){var c=getLast(d.data),y=getLast(m.data),b="-"===c?y:c,O=getLast(f.data)+Math.max(0,b)+Math.min(0,i);f.data.push({value:O,originalValue:O,itemStyle:{normal:{color:"transparent"}},measures:[]})}s.value=Math.abs(s.value),i<0?(m.data.push(s),d.data.push({value:"-",itemStyle:{normal:{color:"transparent"}},measures:[]})):(d.data.push(s),m.data.push({value:"-",itemStyle:{normal:{color:"transparent"}},measures:[]})),v.push(((null===(r=f.data[t])||void 0===r?void 0:r.value)||0)+s.value),s.tip={rows:null==n?void 0:n.map((function(e){return{caption:e.levelCaption,value:e.value}})).concat(null===(a=s.measures)||void 0===a?void 0:a.map((function(e){return{caption:e.caption,value:e.hasOwnProperty("vtip")?e.vtip:e.formatted}})))}})),i.yAxis.axisMin=Math.min.apply(null,v),i.yAxis.axisMax=Math.max.apply(null,v),self.postMessage({eventType:"dataFormat",options:i})};
//# sourceMappingURL=BaseWaterfallchart.js.map