(self["webpackChunkdataforui_common"]=self["webpackChunkdataforui_common"]||[]).push([[71],{60055:function(){window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(e){try{var t=(t=document.getElementsByTagName("script"))[t.length-1],n=t.getAttribute("data-injectcss");t=t.getAttribute("data-disable-injectsvg");if(!t){var r,i,a,o,s,u=function(e,t){t.parentNode.insertBefore(e,t)};if(n&&!e.__iconfont__svg__cssinject__){e.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(t){console&&console.log(t)}}r=function(){var t,n=document.createElement("div");n.innerHTML=e._iconfont_svg_string_3580659,(n=n.getElementsByTagName("svg")[0])&&(n.setAttribute("aria-hidden","true"),n.style.position="absolute",n.style.width=0,n.style.height=0,n.style.overflow="hidden",(t=document.body).firstChild?u(n,t.firstChild):t.appendChild(n))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(r,0):(i=function(){document.removeEventListener("DOMContentLoaded",i,!1),r()},document.addEventListener("DOMContentLoaded",i,!1)):document.attachEvent&&(a=r,o=e.document,s=!1,c(),o.onreadystatechange=function(){"complete"==o.readyState&&(o.onreadystatechange=null,l())})}function l(){s||(s=!0,a())}function c(){try{o.documentElement.doScroll("left")}catch(t){return void setTimeout(c,50)}l()}}catch(f){}}(window)},7916:function(e,t,n){var r=n(723).default;function i(){"use strict";e.exports=i=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var t={},n=Object.prototype,a=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},u=s.iterator||"@@iterator",l=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function f(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(L){f=function(e,t,n){return e[t]=n}}function h(e,t,n,r){var i=t&&t.prototype instanceof v?t:v,a=Object.create(i.prototype),s=new T(r||[]);return o(a,"_invoke",{value:C(e,n,s)}),a}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(L){return{type:"throw",arg:L}}}t.wrap=h;var d={};function v(){}function g(){}function m(){}var y={};f(y,u,(function(){return this}));var _=Object.getPrototypeOf,x=_&&_(_(M([])));x&&x!==n&&a.call(x,u)&&(y=x);var b=m.prototype=v.prototype=Object.create(y);function S(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){function n(i,o,s,u){var l=p(e[i],e,o);if("throw"!==l.type){var c=l.arg,f=c.value;return f&&"object"==r(f)&&a.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,s,u)}),(function(e){n("throw",e,s,u)})):t.resolve(f).then((function(e){c.value=e,s(c)}),(function(e){return n("throw",e,s,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function(e,r){function a(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(a,a):a()}})}function C(e,t,n){var r="suspendedStart";return function(i,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw a;return O()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=k(o,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=p(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===d)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}function k(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator["return"]&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=p(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,d;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function M(e){if(e){var t=e[u];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(a.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:O}}function O(){return{value:void 0,done:!0}}return g.prototype=m,o(b,"constructor",{value:m,configurable:!0}),o(m,"constructor",{value:g,configurable:!0}),g.displayName=f(m,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,f(e,c,"GeneratorFunction")),e.prototype=Object.create(b),e},t.awrap=function(e){return{__await:e}},S(w.prototype),f(w.prototype,l,(function(){return this})),t.AsyncIterator=w,t.async=function(e,n,r,i,a){void 0===a&&(a=Promise);var o=new w(h(e,n,r,i),a);return t.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},S(b),f(b,c,"Generator"),f(b,u,(function(){return this})),f(b,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=M,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&a.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=a.call(i,"catchLoc"),u=a.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;E(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:M(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},t}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},723:function(e){function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},4630:function(e,t,n){var r=n(7916)();e.exports=r;try{regeneratorRuntime=r}catch(i){"object"===typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}},66011:function(e,t,n){var r=n(73516).default;function i(){"use strict";e.exports=i=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var t={},n=Object.prototype,a=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},u=s.iterator||"@@iterator",l=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function f(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(L){f=function(e,t,n){return e[t]=n}}function h(e,t,n,r){var i=t&&t.prototype instanceof v?t:v,a=Object.create(i.prototype),s=new T(r||[]);return o(a,"_invoke",{value:C(e,n,s)}),a}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(L){return{type:"throw",arg:L}}}t.wrap=h;var d={};function v(){}function g(){}function m(){}var y={};f(y,u,(function(){return this}));var _=Object.getPrototypeOf,x=_&&_(_(M([])));x&&x!==n&&a.call(x,u)&&(y=x);var b=m.prototype=v.prototype=Object.create(y);function S(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){function n(i,o,s,u){var l=p(e[i],e,o);if("throw"!==l.type){var c=l.arg,f=c.value;return f&&"object"==r(f)&&a.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,s,u)}),(function(e){n("throw",e,s,u)})):t.resolve(f).then((function(e){c.value=e,s(c)}),(function(e){return n("throw",e,s,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function(e,r){function a(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(a,a):a()}})}function C(e,t,n){var r="suspendedStart";return function(i,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw a;return O()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=k(o,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=p(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===d)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}function k(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator["return"]&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=p(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,d;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function M(e){if(e){var t=e[u];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(a.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:O}}function O(){return{value:void 0,done:!0}}return g.prototype=m,o(b,"constructor",{value:m,configurable:!0}),o(m,"constructor",{value:g,configurable:!0}),g.displayName=f(m,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,f(e,c,"GeneratorFunction")),e.prototype=Object.create(b),e},t.awrap=function(e){return{__await:e}},S(w.prototype),f(w.prototype,l,(function(){return this})),t.AsyncIterator=w,t.async=function(e,n,r,i,a){void 0===a&&(a=Promise);var o=new w(h(e,n,r,i),a);return t.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},S(b),f(b,c,"Generator"),f(b,u,(function(){return this})),f(b,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=M,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&a.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=a.call(i,"catchLoc"),u=a.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;E(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:M(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},t}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},73516:function(e){function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},41555:function(e,t,n){var r=n(66011)();e.exports=r;try{regeneratorRuntime=r}catch(i){"object"===typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}},78303:function(e,t,n){var r=n(81549).default;function i(){"use strict";e.exports=i=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var t={},n=Object.prototype,a=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},u=s.iterator||"@@iterator",l=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function f(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(L){f=function(e,t,n){return e[t]=n}}function h(e,t,n,r){var i=t&&t.prototype instanceof v?t:v,a=Object.create(i.prototype),s=new T(r||[]);return o(a,"_invoke",{value:C(e,n,s)}),a}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(L){return{type:"throw",arg:L}}}t.wrap=h;var d={};function v(){}function g(){}function m(){}var y={};f(y,u,(function(){return this}));var _=Object.getPrototypeOf,x=_&&_(_(M([])));x&&x!==n&&a.call(x,u)&&(y=x);var b=m.prototype=v.prototype=Object.create(y);function S(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){function n(i,o,s,u){var l=p(e[i],e,o);if("throw"!==l.type){var c=l.arg,f=c.value;return f&&"object"==r(f)&&a.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,s,u)}),(function(e){n("throw",e,s,u)})):t.resolve(f).then((function(e){c.value=e,s(c)}),(function(e){return n("throw",e,s,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function(e,r){function a(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(a,a):a()}})}function C(e,t,n){var r="suspendedStart";return function(i,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw a;return O()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=k(o,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=p(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===d)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}function k(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator["return"]&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=p(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,d;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function M(e){if(e){var t=e[u];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(a.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:O}}function O(){return{value:void 0,done:!0}}return g.prototype=m,o(b,"constructor",{value:m,configurable:!0}),o(m,"constructor",{value:g,configurable:!0}),g.displayName=f(m,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,f(e,c,"GeneratorFunction")),e.prototype=Object.create(b),e},t.awrap=function(e){return{__await:e}},S(w.prototype),f(w.prototype,l,(function(){return this})),t.AsyncIterator=w,t.async=function(e,n,r,i,a){void 0===a&&(a=Promise);var o=new w(h(e,n,r,i),a);return t.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},S(b),f(b,c,"Generator"),f(b,u,(function(){return this})),f(b,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=M,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&a.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=a.call(i,"catchLoc"),u=a.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;E(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:M(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},t}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},81549:function(e){function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},76172:function(e,t,n){var r=n(78303)();e.exports=r;try{regeneratorRuntime=r}catch(i){"object"===typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}},43819:function(e,t,n){var r=n(82476).default;function i(){"use strict";e.exports=i=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var t={},n=Object.prototype,a=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},u=s.iterator||"@@iterator",l=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function f(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(L){f=function(e,t,n){return e[t]=n}}function h(e,t,n,r){var i=t&&t.prototype instanceof v?t:v,a=Object.create(i.prototype),s=new T(r||[]);return o(a,"_invoke",{value:C(e,n,s)}),a}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(L){return{type:"throw",arg:L}}}t.wrap=h;var d={};function v(){}function g(){}function m(){}var y={};f(y,u,(function(){return this}));var _=Object.getPrototypeOf,x=_&&_(_(M([])));x&&x!==n&&a.call(x,u)&&(y=x);var b=m.prototype=v.prototype=Object.create(y);function S(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){function n(i,o,s,u){var l=p(e[i],e,o);if("throw"!==l.type){var c=l.arg,f=c.value;return f&&"object"==r(f)&&a.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,s,u)}),(function(e){n("throw",e,s,u)})):t.resolve(f).then((function(e){c.value=e,s(c)}),(function(e){return n("throw",e,s,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function(e,r){function a(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(a,a):a()}})}function C(e,t,n){var r="suspendedStart";return function(i,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw a;return O()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=k(o,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=p(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===d)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}function k(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator["return"]&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=p(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,d;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function M(e){if(e){var t=e[u];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(a.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:O}}function O(){return{value:void 0,done:!0}}return g.prototype=m,o(b,"constructor",{value:m,configurable:!0}),o(m,"constructor",{value:g,configurable:!0}),g.displayName=f(m,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,f(e,c,"GeneratorFunction")),e.prototype=Object.create(b),e},t.awrap=function(e){return{__await:e}},S(w.prototype),f(w.prototype,l,(function(){return this})),t.AsyncIterator=w,t.async=function(e,n,r,i,a){void 0===a&&(a=Promise);var o=new w(h(e,n,r,i),a);return t.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},S(b),f(b,c,"Generator"),f(b,u,(function(){return this})),f(b,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=M,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&a.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=a.call(i,"catchLoc"),u=a.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;E(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:M(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},t}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},82476:function(e){function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},68959:function(e,t,n){var r=n(43819)();e.exports=r;try{regeneratorRuntime=r}catch(i){"object"===typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}},33347:function(e,t,n){var r=n(34391).default;function i(){"use strict";e.exports=i=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var t={},n=Object.prototype,a=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},u=s.iterator||"@@iterator",l=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function f(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(L){f=function(e,t,n){return e[t]=n}}function h(e,t,n,r){var i=t&&t.prototype instanceof v?t:v,a=Object.create(i.prototype),s=new T(r||[]);return o(a,"_invoke",{value:C(e,n,s)}),a}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(L){return{type:"throw",arg:L}}}t.wrap=h;var d={};function v(){}function g(){}function m(){}var y={};f(y,u,(function(){return this}));var _=Object.getPrototypeOf,x=_&&_(_(M([])));x&&x!==n&&a.call(x,u)&&(y=x);var b=m.prototype=v.prototype=Object.create(y);function S(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){function n(i,o,s,u){var l=p(e[i],e,o);if("throw"!==l.type){var c=l.arg,f=c.value;return f&&"object"==r(f)&&a.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,s,u)}),(function(e){n("throw",e,s,u)})):t.resolve(f).then((function(e){c.value=e,s(c)}),(function(e){return n("throw",e,s,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function(e,r){function a(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(a,a):a()}})}function C(e,t,n){var r="suspendedStart";return function(i,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw a;return O()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=k(o,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=p(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===d)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}function k(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator["return"]&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=p(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,d;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function M(e){if(e){var t=e[u];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(a.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:O}}function O(){return{value:void 0,done:!0}}return g.prototype=m,o(b,"constructor",{value:m,configurable:!0}),o(m,"constructor",{value:g,configurable:!0}),g.displayName=f(m,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,f(e,c,"GeneratorFunction")),e.prototype=Object.create(b),e},t.awrap=function(e){return{__await:e}},S(w.prototype),f(w.prototype,l,(function(){return this})),t.AsyncIterator=w,t.async=function(e,n,r,i,a){void 0===a&&(a=Promise);var o=new w(h(e,n,r,i),a);return t.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},S(b),f(b,c,"Generator"),f(b,u,(function(){return this})),f(b,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=M,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&a.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=a.call(i,"catchLoc"),u=a.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;E(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:M(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},t}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},34391:function(e){function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},18080:function(e,t,n){var r=n(33347)();e.exports=r;try{regeneratorRuntime=r}catch(i){"object"===typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}},14071:function(e,t,n){"use strict";n.r(t),n.d(t,{$XMLHttpRequest:function(){return Ue.ft},$location:function(){return Ue.PG},$window:function(){return Ue.vO},AJAXError:function(){return Ue.Uj},AttributeType:function(){return yt.GC},BKDRHash:function(){return Ue.e2},BaseLayer:function(){return Aa},BaseMapService:function(){return gx.BaseMapService},BaseMapWrapper:function(){return gx.BaseMapWrapper},BaseModel:function(){return Oa},BasePostProcessingPass:function(){return yt.mp},BlendType:function(){return yt.h0},ButtonControl:function(){return lr},CameraUniform:function(){return yt.lv},CanvasLayer:function(){return Ga},CanvasUpdateType:function(){return Da},CityBuildingLayer:function(){return ns},Control:function(){return or},CoordinateSystem:function(){return yt.lo},CoordinateUniform:function(){return yt.kw},DOM:function(){return Ue.SO},Earth:function(){return gx.Earth},EarthLayer:function(){return Sh},ExportImage:function(){return Pr},FrequencyController:function(){return Ue.iH},Fullscreen:function(){return Gr},GaodeMap:function(){return gx.GaodeMap},GaodeMapV1:function(){return gx.GaodeMapV1},GaodeMapV2:function(){return gx.GaodeMapV2},GeoLocate:function(){return Yr},GeometryLayer:function(){return ws},HeatmapLayer:function(){return nu},IDebugLog:function(){return yt.Or},ILayerStage:function(){return yt.KD},ImageLayer:function(){return hu},InteractionEvent:function(){return yt.sm},LRUCache:function(){return Ue.z6},LayerPopup:function(){return yi},LayerSwitch:function(){return Kr},LineLayer:function(){return kl},LineTriangulation:function(){return Ue.sN},LinearDir:function(){return Pa},LoadTileDataStatus:function(){return Ue.Qj},Logo:function(){return Jr},Map:function(){return gx.Map},MapServiceEvent:function(){return yt.I9},MapTheme:function(){return ri},Mapbox:function(){return gx.Mapbox},Marker:function(){return Yn},MarkerLayer:function(){return Kn},MaskLayer:function(){return Ph},MaskOperation:function(){return yt.lE},MouseLocation:function(){return oi},PassType:function(){return yt.GR},PointFillTriangulation:function(){return Ue.oX},PointLayer:function(){return $c},PolygonLayer:function(){return Lf},PopperControl:function(){return gr},Popup:function(){return vi},PositionType:function(){return yt.d},RasterLayer:function(){return $f},RasterTileType:function(){return yt.n3},Satistics:function(){return Ue.a5},Scale:function(){return li},ScaleTypes:function(){return yt.vY},Scene:function(){return Hb},SceneEventList:function(){return yt.P7},SelectControl:function(){return Cr},SizeUnitType:function(){return Ia},Source:function(){return Mn},SourceTile:function(){return Ue.LZ},StencilType:function(){return yt.yn},StyleScaleType:function(){return yt.ee},TYPES:function(){return yt.vK},TextureBlend:function(){return Ra},TileDebugLayer:function(){return nh},TilesetManager:function(){return Ue.nx},UpdateTileStrategy:function(){return Ue.dD},Version:function(){return gx.Version},Viewport:function(){return gx.Viewport},WindLayer:function(){return dp},WorkerSourceMap:function(){return Ue.lN},Zoom:function(){return hi},aProjectFlat:function(){return Ue.Z},amap2Project:function(){return Ue.TG},amap2UnProject:function(){return Ue.S8},anchorTranslate:function(){return Ue.rQ},anchorType:function(){return Ue.bV},applyAnchorClass:function(){return Ue.zi},bBoxToBounds:function(){return Ue.ds},bindAll:function(){return Ue.Ev},boundsContains:function(){return Ue.oO},calAngle:function(){return Ue.mt},calDistance:function(){return Ue.Lw},calculateCentroid:function(){return Ue.SI},calculatePointsCenterAndRadius:function(){return Ue.Rx},container:function(){return yt.nC},createLayerContainer:function(){return yt.e7},createSceneContainer:function(){return yt.Hp},decodePickingColor:function(){return Ue.W0},dispatchMapCameraParams:function(){return Ue.Gi},dispatchMouseDown:function(){return Ue.Dd},dispatchMouseMove:function(){return Ue.YR},dispatchMouseUp:function(){return Ue.TS},dispatchPointerDown:function(){return Ue.fO},dispatchPointerMove:function(){return Ue.xr},dispatchPointerUp:function(){return Ue.VJ},dispatchTouchEnd:function(){return Ue.vJ},dispatchTouchMove:function(){return Ue.b0},dispatchTouchStart:function(){return Ue.om},djb2hash:function(){return Ue.h8},encodePickingColor:function(){return Ue.Z6},executeWorkerTask:function(){return Ue.hH},expandUrl:function(){return Ue.Gk},extent:function(){return Ue.We},flow:function(){return Ue.ls},formatImage:function(){return Ue.Co},generateCatRamp:function(){return Ue.hj},generateColorRamp:function(){return Ue.Cl},generateCustomRamp:function(){return Ue.Oc},generateLinearRamp:function(){return Ue.M4},generateQuantizeRamp:function(){return Ue.NJ},getAngle:function(){return Ue._O},getArrayBuffer:function(){return Ue.ks},getBBoxFromPoints:function(){return Ue.Ol},getCullFace:function(){return Ue.fj},getDefaultDomain:function(){return Ue.ZB},getImage:function(){return Ue.gJ},getJSON:function(){return Ue.xA},getReferrer:function(){return Ue.an},getTileIndices:function(){return Ue.rJ},getTileWarpXY:function(){return Ue.qD},getURLFromTemplate:function(){return Ue.z0},getWMTSURLFromTemplate:function(){return Ue.jG},gl:function(){return yt.gl},guid:function(){return Ue.M8},isAndroid:function(){return Ue.Dt},isColor:function(){return Ue.D5},isImageBitmap:function(){return Ue.fg},isMini:function(){return Ue.eW},isMiniAli:function(){return Ue.zh},isMiniScene:function(){return Ue.N_},isPC:function(){return Ue.Ro},isURLTemplate:function(){return Ue.Xj},isWeChatMiniProgram:function(){return Ue.FH},isWorker:function(){return Ue.hJ},isiOS:function(){return Ue.Tt},latitude:function(){return Ue.pq},lazyInject:function(){return yt.yT},lazyMultiInject:function(){return yt.yG},lineAtOffset:function(){return Ue.LT},lineAtOffsetAsyc:function(){return Ue.wj},lineStyleType:function(){return La},lngLatInExtent:function(){return Ue.if},lngLatToMeters:function(){return Ue.vP},lnglatDistance:function(){return Ue.yM},longitude:function(){return Ue.MS},makeXMLHttpRequestPromise:function(){return Ue.LF},metersToLngLat:function(){return Ue.Uv},miniWindow:function(){return Ue.RH},normalize:function(){return Ue.Fv},osmLonLat2TileXY:function(){return Ue.RV},osmTileXY2LonLat:function(){return Ue.cN},packCircleVertex:function(){return yt.wL},padBounds:function(){return Ue.yA},polygonFillTriangulation:function(){return Ue.yR},postData:function(){return Ue.qC},project:function(){return Ue.iV},rgb2arr:function(){return Ue.CI},sameOrigin:function(){return Ue._0},setL7WorkerSource:function(){return Ue.p3},setMiniScene:function(){return Ue.a},tileToBounds:function(){return Ue.Dv},tranfrormCoord:function(){return Ue.Jo},unProjectFlat:function(){return Ue.ih},validateLngLat:function(){return Ue.Fb},version:function(){return Wb}});var r={},i={},a=function(e){return i[e]},o=function(e,t){i[e]=t},s=function(e){return r[e]},u=function(e,t){r[e]=t},l={},c={},f=34,h=10,p=13;function d(e){return new Function("d","return {"+e.map((function(e,t){return JSON.stringify(e)+": d["+t+'] || ""'})).join(",")+"}")}function v(e,t){var n=d(e);return function(r,i){return t(n(r),i,e)}}function g(e){var t=Object.create(null),n=[];return e.forEach((function(e){for(var r in e)r in t||n.push(t[r]=r)})),n}function m(e,t){var n=e+"",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}function y(e){return e<0?"-"+m(-e,6):e>9999?"+"+m(e,6):m(e,4)}function _(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),r=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":y(e.getUTCFullYear(),4)+"-"+m(e.getUTCMonth()+1,2)+"-"+m(e.getUTCDate(),2)+(i?"T"+m(t,2)+":"+m(n,2)+":"+m(r,2)+"."+m(i,3)+"Z":r?"T"+m(t,2)+":"+m(n,2)+":"+m(r,2)+"Z":n||t?"T"+m(t,2)+":"+m(n,2)+"Z":"")}function x(e){var t=new RegExp('["'+e+"\n\r]"),n=e.charCodeAt(0);function r(e,t){var n,r,a=i(e,(function(e,i){if(n)return n(e,i-1);r=e,n=t?v(e,t):d(e)}));return a.columns=r||[],a}function i(e,t){var r,i=[],a=e.length,o=0,s=0,u=a<=0,d=!1;function v(){if(u)return c;if(d)return d=!1,l;var t,r,i=o;if(e.charCodeAt(i)===f){while(o++<a&&e.charCodeAt(o)!==f||e.charCodeAt(++o)===f);return(t=o)>=a?u=!0:(r=e.charCodeAt(o++))===h?d=!0:r===p&&(d=!0,e.charCodeAt(o)===h&&++o),e.slice(i+1,t-1).replace(/""/g,'"')}while(o<a){if((r=e.charCodeAt(t=o++))===h)d=!0;else if(r===p)d=!0,e.charCodeAt(o)===h&&++o;else if(r!==n)continue;return e.slice(i,t)}return u=!0,e.slice(i,a)}e.charCodeAt(a-1)===h&&--a,e.charCodeAt(a-1)===p&&--a;while((r=v())!==c){var g=[];while(r!==l&&r!==c)g.push(r),r=v();t&&null==(g=t(g,s++))||i.push(g)}return i}function a(t,n){return t.map((function(t){return n.map((function(e){return y(t[e])})).join(e)}))}function o(t,n){return null==n&&(n=g(t)),[n.map(y).join(e)].concat(a(t,n)).join("\n")}function s(e,t){return null==t&&(t=g(e)),a(e,t).join("\n")}function u(e){return e.map(m).join("\n")}function m(t){return t.map(y).join(e)}function y(e){return null==e?"":e instanceof Date?_(e):t.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:r,parseRows:i,format:o,formatBody:s,formatRows:u,formatRow:m,formatValue:y}}var b=x(","),S=b.parse;b.parseRows,b.format,b.formatBody,b.formatRows,b.formatRow,b.formatValue;function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function C(e){if(Array.isArray(e))return w(e)}function k(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function A(e,t){if(e){if("string"===typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?w(e,t):void 0}}function E(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function T(e){return C(e)||k(e)||A(e)||E()}function M(e){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},M(e)}function O(e,t){if("object"!==M(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==M(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function L(e){var t=O(e,"string");return"symbol"===M(t)?t:String(t)}function P(e,t,n){return t=L(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R(Object(n),!0).forEach((function(t){P(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var D=n(28422),z=n.n(D),N=n(41086);function F(e){if(Array.isArray(e))return e;if("Feature"===e.type){if(null!==e.geometry)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function j(e){return"Feature"===e.type?e.geometry:e}var B=n(62098);function U(e,t){var n=t.x,r=t.y,i=t.x1,a=t.y1,o=t.coordinates,s=t.geometry,u=[];if(!Array.isArray(e))return{dataArray:[]};if(s)return e.filter((function(e){return e[s]&&e[s].type&&e[s].coordinates&&e[s].coordinates.length>0})).forEach((function(e,t){var n=z()(I({},e[s]),!0);(0,B.nG)(n,(function(n){var r=F(n),i=I(I({},e),{},{_id:t,coordinates:r});u.push(i)}))})),{dataArray:u};for(var l=0;l<e.length;l++){var c=e[l],f=[];if(o){var h="Polygon";Array.isArray(o[0])||(h="Point"),Array.isArray(o[0])&&!Array.isArray(o[0][0])&&(h="LineString");var p=z()({type:h,coordinates:T(c[o])},!0);f=p.coordinates}else if(n&&r&&i&&a){var d=[parseFloat(c[n]),parseFloat(c[r])],v=[parseFloat(c[i]),parseFloat(c[a])];f=[d,v]}else n&&r&&(f=[parseFloat(c[n]),parseFloat(c[r])]);var g=I(I({},c),{},{_id:l,coordinates:f});u.push(g)}return{dataArray:u}}function V(e,t){var n=S(e);return U(n,t)}function G(e){var t=e.toString(),n=5381,r=t.length;while(r)n=33*n^t.charCodeAt(--r);return n>>>0}function H(e,t){return void 0===t?null:1*M(e.properties[t])==="number"?1*e.properties[t]:e.properties&&e.properties[t]?G(e.properties[t]+"")%1000019:null}function W(e,t){var n=[],r={};return e.features?(e.features=e.features.filter((function(e){var t=e.geometry;return null!=e&&t&&t.type&&t.coordinates&&t.coordinates.length>0})),z()(e,!0),0===e.features.length?{dataArray:[],featureKeys:r}:((0,B.nG)(e,(function(e,r){var i=H(e,null===t||void 0===t?void 0:t.featureId);null===i&&(i=r);var a=i,o=F(e),s=I(I({},e.properties),{},{coordinates:o,_id:a});n.push(s)})),{dataArray:n,featureKeys:r})):(e.features=[],{dataArray:[]})}function Y(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(l){return void n(l)}s.done?t(u):Promise.resolve(u).then(r,i)}function q(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){Y(a,r,i,o,s,"next",e)}function s(e){Y(a,r,i,o,s,"throw",e)}o(void 0)}))}}var Z=n(18080),K=n.n(Z);function X(e,t,n,r){for(var i,a=r,o=n-t>>1,s=n-t,u=e[t],l=e[t+1],c=e[n],f=e[n+1],h=t+3;h<n;h+=3){var p=Q(e[h],e[h+1],u,l,c,f);if(p>a)i=h,a=p;else if(p===a){var d=Math.abs(h-o);d<s&&(i=h,s=d)}}a>r&&(i-t>3&&X(e,t,i,r),e[i+2]=a,n-i>3&&X(e,i,n,r))}function Q(e,t,n,r,i,a){var o=i-n,s=a-r;if(0!==o||0!==s){var u=((e-n)*o+(t-r)*s)/(o*o+s*s);u>1?(n=i,r=a):u>0&&(n+=o*u,r+=s*u)}return o=e-n,s=t-r,o*o+s*s}function J(e,t,n,r){var i={id:"undefined"===typeof e?null:e,type:t,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return $(i),i}function $(e){var t=e.geometry,n=e.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)ee(e,t);else if("Polygon"===n||"MultiLineString"===n)for(var r=0;r<t.length;r++)ee(e,t[r]);else if("MultiPolygon"===n)for(r=0;r<t.length;r++)for(var i=0;i<t[r].length;i++)ee(e,t[r][i])}function ee(e,t){for(var n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}function te(e,t){var n=[];if("FeatureCollection"===e.type)for(var r=0;r<e.features.length;r++)ne(n,e.features[r],t,r);else"Feature"===e.type?ne(n,e,t):ne(n,{geometry:e},t);return n}function ne(e,t,n,r){if(t.geometry){var i=t.geometry.coordinates,a=t.geometry.type,o=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),s=[],u=t.id;if(n.promoteId?u=t.properties[n.promoteId]:n.generateId&&(u=r||0),"Point"===a)re(i,s);else if("MultiPoint"===a)for(var l=0;l<i.length;l++)re(i[l],s);else if("LineString"===a)ie(i,s,o,!1);else if("MultiLineString"===a){if(n.lineMetrics){for(l=0;l<i.length;l++)s=[],ie(i[l],s,o,!1),e.push(J(u,"LineString",s,t.properties));return}ae(i,s,o,!1)}else if("Polygon"===a)ae(i,s,o,!0);else{if("MultiPolygon"!==a){if("GeometryCollection"===a){for(l=0;l<t.geometry.geometries.length;l++)ne(e,{id:u,geometry:t.geometry.geometries[l],properties:t.properties},n,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(l=0;l<i.length;l++){var c=[];ae(i[l],c,o,!0),s.push(c)}}e.push(J(u,a,s,t.properties))}}function re(e,t){t.push(oe(e[0])),t.push(se(e[1])),t.push(0)}function ie(e,t,n,r){for(var i,a,o=0,s=0;s<e.length;s++){var u=oe(e[s][0]),l=se(e[s][1]);t.push(u),t.push(l),t.push(0),s>0&&(o+=r?(i*l-u*a)/2:Math.sqrt(Math.pow(u-i,2)+Math.pow(l-a,2))),i=u,a=l}var c=t.length-3;t[2]=1,X(t,0,c,n),t[c+2]=1,t.size=Math.abs(o),t.start=0,t.end=t.size}function ae(e,t,n,r){for(var i=0;i<e.length;i++){var a=[];ie(e[i],a,n,r),t.push(a)}}function oe(e){return e/360+.5}function se(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function ue(e,t,n,r,i,a,o,s){if(n/=t,r/=t,a>=n&&o<r)return e;if(o<n||a>=r)return null;for(var u=[],l=0;l<e.length;l++){var c=e[l],f=c.geometry,h=c.type,p=0===i?c.minX:c.minY,d=0===i?c.maxX:c.maxY;if(p>=n&&d<r)u.push(c);else if(!(d<n||p>=r)){var v=[];if("Point"===h||"MultiPoint"===h)le(f,v,n,r,i);else if("LineString"===h)ce(f,v,n,r,i,!1,s.lineMetrics);else if("MultiLineString"===h)he(f,v,n,r,i,!1);else if("Polygon"===h)he(f,v,n,r,i,!0);else if("MultiPolygon"===h)for(var g=0;g<f.length;g++){var m=[];he(f[g],m,n,r,i,!0),m.length&&v.push(m)}if(v.length){if(s.lineMetrics&&"LineString"===h){for(g=0;g<v.length;g++)u.push(J(c.id,h,v[g],c.tags));continue}"LineString"!==h&&"MultiLineString"!==h||(1===v.length?(h="LineString",v=v[0]):h="MultiLineString"),"Point"!==h&&"MultiPoint"!==h||(h=3===v.length?"Point":"MultiPoint"),u.push(J(c.id,h,v,c.tags))}}}return u.length?u:null}function le(e,t,n,r,i){for(var a=0;a<e.length;a+=3){var o=e[a+i];o>=n&&o<=r&&(t.push(e[a]),t.push(e[a+1]),t.push(e[a+2]))}}function ce(e,t,n,r,i,a,o){for(var s,u,l=fe(e),c=0===i?de:ve,f=e.start,h=0;h<e.length-3;h+=3){var p=e[h],d=e[h+1],v=e[h+2],g=e[h+3],m=e[h+4],y=0===i?p:d,_=0===i?g:m,x=!1;o&&(s=Math.sqrt(Math.pow(p-g,2)+Math.pow(d-m,2))),y<n?_>n&&(u=c(l,p,d,g,m,n),o&&(l.start=f+s*u)):y>r?_<r&&(u=c(l,p,d,g,m,r),o&&(l.start=f+s*u)):pe(l,p,d,v),_<n&&y>=n&&(u=c(l,p,d,g,m,n),x=!0),_>r&&y<=r&&(u=c(l,p,d,g,m,r),x=!0),!a&&x&&(o&&(l.end=f+s*u),t.push(l),l=fe(e)),o&&(f+=s)}var b=e.length-3;p=e[b],d=e[b+1],v=e[b+2],y=0===i?p:d,y>=n&&y<=r&&pe(l,p,d,v),b=l.length-3,a&&b>=3&&(l[b]!==l[0]||l[b+1]!==l[1])&&pe(l,l[0],l[1],l[2]),l.length&&t.push(l)}function fe(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function he(e,t,n,r,i,a){for(var o=0;o<e.length;o++)ce(e[o],t,n,r,i,a,!1)}function pe(e,t,n,r){e.push(t),e.push(n),e.push(r)}function de(e,t,n,r,i,a){var o=(a-t)/(r-t);return e.push(a),e.push(n+(i-n)*o),e.push(1),o}function ve(e,t,n,r,i,a){var o=(a-n)/(i-n);return e.push(t+(r-t)*o),e.push(a),e.push(1),o}function ge(e,t){var n=t.buffer/t.extent,r=e,i=ue(e,1,-1-n,n,0,-1,2,t),a=ue(e,1,1-n,2+n,0,-1,2,t);return(i||a)&&(r=ue(e,1,-n,1+n,0,-1,2,t)||[],i&&(r=me(i,1).concat(r)),a&&(r=r.concat(me(a,-1)))),r}function me(e,t){for(var n=[],r=0;r<e.length;r++){var i,a=e[r],o=a.type;if("Point"===o||"MultiPoint"===o||"LineString"===o)i=ye(a.geometry,t);else if("MultiLineString"===o||"Polygon"===o){i=[];for(var s=0;s<a.geometry.length;s++)i.push(ye(a.geometry[s],t))}else if("MultiPolygon"===o)for(i=[],s=0;s<a.geometry.length;s++){for(var u=[],l=0;l<a.geometry[s].length;l++)u.push(ye(a.geometry[s][l],t));i.push(u)}n.push(J(a.id,o,i,a.tags))}return n}function ye(e,t){var n=[];n.size=e.size,void 0!==e.start&&(n.start=e.start,n.end=e.end);for(var r=0;r<e.length;r+=3)n.push(e[r]+t,e[r+1],e[r+2]);return n}function _e(e,t){if(e.transformed)return e;var n,r,i,a=1<<e.z,o=e.x,s=e.y;for(n=0;n<e.features.length;n++){var u=e.features[n],l=u.geometry,c=u.type;if(u.geometry=[],1===c)for(r=0;r<l.length;r+=2)u.geometry.push(xe(l[r],l[r+1],t,a,o,s));else for(r=0;r<l.length;r++){var f=[];for(i=0;i<l[r].length;i+=2)f.push(xe(l[r][i],l[r][i+1],t,a,o,s));u.geometry.push(f)}}return e.transformed=!0,e}function xe(e,t,n,r,i,a){return[Math.round(n*(e*r-i)),Math.round(n*(t*r-a))]}function be(e,t,n,r,i){for(var a=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<e.length;s++){o.numFeatures++,Se(o,e[s],a,i);var u=e[s].minX,l=e[s].minY,c=e[s].maxX,f=e[s].maxY;u<o.minX&&(o.minX=u),l<o.minY&&(o.minY=l),c>o.maxX&&(o.maxX=c),f>o.maxY&&(o.maxY=f)}return o}function Se(e,t,n,r){var i=t.geometry,a=t.type,o=[];if("Point"===a||"MultiPoint"===a)for(var s=0;s<i.length;s+=3)o.push(i[s]),o.push(i[s+1]),e.numPoints++,e.numSimplified++;else if("LineString"===a)we(o,i,e,n,!1,!1);else if("MultiLineString"===a||"Polygon"===a)for(s=0;s<i.length;s++)we(o,i[s],e,n,"Polygon"===a,0===s);else if("MultiPolygon"===a)for(var u=0;u<i.length;u++){var l=i[u];for(s=0;s<l.length;s++)we(o,l[s],e,n,!0,0===s)}if(o.length){var c=t.tags||null;if("LineString"===a&&r.lineMetrics){for(var f in c={},t.tags)c[f]=t.tags[f];c["mapbox_clip_start"]=i.start/i.size,c["mapbox_clip_end"]=i.end/i.size}var h={geometry:o,type:"Polygon"===a||"MultiPolygon"===a?3:"LineString"===a||"MultiLineString"===a?2:1,tags:c};null!==t.id&&(h.id=t.id),e.features.push(h)}}function we(e,t,n,r,i,a){var o=r*r;if(r>0&&t.size<(i?o:r))n.numPoints+=t.length/3;else{for(var s=[],u=0;u<t.length;u+=3)(0===r||t[u+2]>o)&&(n.numSimplified++,s.push(t[u]),s.push(t[u+1])),n.numPoints++;i&&Ce(s,a),e.push(s)}}function Ce(e,t){for(var n=0,r=0,i=e.length,a=i-2;r<i;a=r,r+=2)n+=(e[r]-e[a])*(e[r+1]+e[a+1]);if(n>0===t)for(r=0,i=e.length;r<i/2;r+=2){var o=e[r],s=e[r+1];e[r]=e[i-2-r],e[r+1]=e[i-1-r],e[i-2-r]=o,e[i-1-r]=s}}function ke(e,t){return new Ae(e,t)}function Ae(e,t){t=this.options=Te(Object.create(this.options),t);var n=t.debug;if(n&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=te(e,t);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),r=ge(r,t),r.length&&this.splitTile(r,0,0,0),n&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ee(e,t,n){return 32*((1<<e)*n+t)+e}function Te(e,t){for(var n in t)e[n]=t[n];return e}function Me(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Oe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,L(r.key),r)}}function Le(e,t,n){return t&&Oe(e.prototype,t),n&&Oe(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}Ae.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ae.prototype.splitTile=function(e,t,n,r,i,a,o){var s=[e,t,n,r],u=this.options,l=u.debug;while(s.length){r=s.pop(),n=s.pop(),t=s.pop(),e=s.pop();var c=1<<t,f=Ee(t,n,r),h=this.tiles[f];if(!h&&(l>1&&console.time("creation"),h=this.tiles[f]=be(e,t,n,r,u),this.tileCoords.push({z:t,x:n,y:r}),l)){l>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,n,r,h.numFeatures,h.numPoints,h.numSimplified),console.timeEnd("creation"));var p="z"+t;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(h.source=e,i){if(t===u.maxZoom||t===i)continue;var d=1<<i-t;if(n!==Math.floor(a/d)||r!==Math.floor(o/d))continue}else if(t===u.indexMaxZoom||h.numPoints<=u.indexMaxPoints)continue;if(h.source=null,0!==e.length){l>1&&console.time("clipping");var v,g,m,y,_,x,b=.5*u.buffer/u.extent,S=.5-b,w=.5+b,C=1+b;v=g=m=y=null,_=ue(e,c,n-b,n+w,0,h.minX,h.maxX,u),x=ue(e,c,n+S,n+C,0,h.minX,h.maxX,u),e=null,_&&(v=ue(_,c,r-b,r+w,1,h.minY,h.maxY,u),g=ue(_,c,r+S,r+C,1,h.minY,h.maxY,u),_=null),x&&(m=ue(x,c,r-b,r+w,1,h.minY,h.maxY,u),y=ue(x,c,r+S,r+C,1,h.minY,h.maxY,u),x=null),l>1&&console.timeEnd("clipping"),s.push(v||[],t+1,2*n,2*r),s.push(g||[],t+1,2*n,2*r+1),s.push(m||[],t+1,2*n+1,2*r),s.push(y||[],t+1,2*n+1,2*r+1)}}},Ae.prototype.getTile=function(e,t,n){var r=this.options,i=r.extent,a=r.debug;if(e<0||e>24)return null;var o=1<<e;t=(t%o+o)%o;var s=Ee(e,t,n);if(this.tiles[s])return _e(this.tiles[s],i);a>1&&console.log("drilling down to z%d-%d-%d",e,t,n);var u,l=e,c=t,f=n;while(!u&&l>0)l--,c=Math.floor(c/2),f=Math.floor(f/2),u=this.tiles[Ee(l,c,f)];return u&&u.source?(a>1&&console.log("found parent tile z%d-%d-%d",l,c,f),a>1&&console.time("drilling down"),this.splitTile(u.source,l,c,f,e,t,n),a>1&&console.timeEnd("drilling down"),this.tiles[s]?_e(this.tiles[s],i):null):null};var Pe=function(){function e(t,n,r,i){Me(this,e),P(this,"vectorLayerCache",{}),this.x=n,this.y=r,this.z=i,this.vectorTile=t}return Le(e,[{key:"getTileData",value:function(e){if(!e||!this.vectorTile.layers[e])return[];if(this.vectorLayerCache[e])return this.vectorLayerCache[e];var t=this.vectorTile.layers[e];return t.features}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),Re={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0};function Ie(e){for(var t,n,r=0,i=0,a=e.length,o=a-1;i<a;o=i++)t=e[i],n=e[o],r+=(n.x-t.x)*(t.y+n.y);return r}function De(e){var t=e.length;if(t<=1)return[e];for(var n,r,i=[],a=0;a<t;a++){var o=Ie(e[a]);0!==o&&(void 0===r&&(r=o<0),r===o<0?(n&&i.push(n),n=[e[a]]):n.push(e[a]))}return n&&i.push(n),i}var ze=["Unknown","Point","LineString","Polygon"];function Ne(e,t,n,r,i){var a,o,s=i.geometry,u=i.type,l=i.tags,c=i.id,f=e*Math.pow(2,r),h=e*t,p=e*n,d=ze[u];function v(e){for(var t=0;t<e.length;t++){var n=e[t];if(n[3])break;var r=180-360*(n[1]+p)/f,i=360*(n[0]+h)/f-180,a=360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90;e[t]=[i,a,0,1]}}switch(u){case 1:var g=[];for(a=0;a<s.length;a++)g[a]=s[a][0];s=g,v(s);break;case 2:for(a=0;a<s.length;a++)v(s[a]);break;case 3:for(s=De(s),a=0;a<s.length;a++)for(o=0;o<s[a].length;o++)v(s[a][o]);break}1===s.length?s=s[0]:d="Multi"+d;var m={type:"Feature",geometry:{type:d,coordinates:s},properties:l,id:c,tileOrigin:[0,0],coord:""};return m}var Fe=function(){var e=q(K().mark((function e(t,n,r,i){return K().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var a=n.getTile(t.z,t.x,t.y),o=a?a.features.map((function(e){return Ne(i,r.x,r.y,r.z,e)})):[],s={layers:{defaultLayer:{features:o}}},u=new Pe(s,t.x,t.y,t.z);e(u)})));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}();function je(e){var t={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return void 0===e||"undefined"===typeof e.geojsonvtOptions?t:I(I({},t),e.geojsonvtOptions)}function Be(e,t){var n=je(t),r=n.extent||4096,i=ke(e,n),a=function(e,t){return Fe(t,i,e,r)},o=I(I(I({},Re),t),{},{getTileData:a});return{data:e,dataArray:[],tilesetOptions:o,isTile:!0}}var Ue=n(61478);function Ve(e,t){var n=t.extent,r=void 0===n?[121.168,30.2828,121.384,30.4219]:n,i=new Promise((function(t){e instanceof HTMLImageElement||(0,Ue.fg)(e)?t([e]):Ge(e,(function(e){t(e)}))})),a={originData:e,images:i,_id:1,dataArray:[{_id:0,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return a}function Ge(e,t){var n=e,r=[];if("string"===typeof n)(0,Ue.gJ)({url:n},(function(e,n){n&&(r.push(n),t(r))}));else{var i=n.length,a=0;n.forEach((function(e){(0,Ue.gJ)({url:e},(function(e,n){a++,n&&r.push(n),a===i&&t(r)}))}))}return Ve}var He=n(48816),We=n(76642),Ye=n.n(We),qe=function(){function e(t,n,r,i){Me(this,e),P(this,"vectorLayerCache",{}),this.x=n,this.y=r,this.z=i,this.vectorTile=new He.VectorTile(new(Ye())(t))}return Le(e,[{key:"getTileData",value:function(e){if(!e||!this.vectorTile.layers[e])return[];if(this.vectorLayerCache[e])return this.vectorLayerCache[e];var t=this.vectorTile.layers[e];if(Array.isArray(t.features))return this.vectorLayerCache[e]=t.features,t.features;for(var n=[],r=0;r<t.length;r++){var i=t.feature(r),a=i.toGeoJSON(this.x,this.y,this.z);n.push(I(I({},a),{},{properties:I({id:a.id},a.properties)}))}return this.vectorLayerCache[e]=n,n}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),Ze={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0},Ke=function(){var e=q(K().mark((function e(t,n,r,i,a){var o;return K().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return o=(0,Ue.z0)(t,n),e.abrupt("return",new Promise((function(e){if(a)a({x:r.x,y:r.y,z:r.z},(function(t,n){if(t||!n)e(void 0);else{var i=new qe(n,r.x,r.y,r.z);e(i)}}));else{var t=(0,Ue.ks)(I(I({},i),{},{url:o}),(function(t,n){if(t||!n)e(void 0);else{var i=new qe(n,r.x,r.y,r.z);e(i)}}));r.xhrCancel=function(){return t.abort()}}})));case 2:case"end":return e.stop()}}),e)})));return function(t,n,r,i,a){return e.apply(this,arguments)}}();function Xe(e,t){var n=Array.isArray(e)?e[0]:e,r=function(e,r){return Ke(n,e,r,null===t||void 0===t?void 0:t.requestParameters,null===t||void 0===t?void 0:t.getCustomData)},i=I(I(I({},Ze),t),{},{getTileData:r});return{data:n,dataArray:[],tilesetOptions:i,isTile:!0}}function Qe(e){if(Array.isArray(e))return e}function Je(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(c){l=!0,i=c}finally{try{if(!u&&null!=n["return"]&&(o=n["return"](),Object(o)!==o))return}finally{if(l)throw i}}return s}}function $e(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function et(e,t){return Qe(e)||Je(e,t)||A(e,t)||$e()}function tt(e,t,n){switch(e){case"+":return t+n;case"-":return t-n;case"*":return t*n;case"/":return t/n;case"%":return t%n;case"^":return Math.pow(t,n);case"abs":return Math.abs(t);case"floor":return Math.floor(t);case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"sin":return Math.sin(t);case"cos":return Math.cos(t);case"atan":return-1===n?Math.atan(t):Math.atan2(t,n);case"min":return Math.min(t,n);case"max":return Math.max(t,n);case"log10":return Math.log(t);case"log2":return Math.log2(t);default:return console.warn("Calculate symbol err! Return default 0"),0}}function nt(e,t){for(var n=t[0],r=n.width,i=n.height,a=t.map((function(e){return e.rasterData})),o=r*i,s=[],u=JSON.stringify(e),l=0;l<o;l++){var c=JSON.parse(u),f=rt(c,a,l);if("number"===typeof f)s.push(f);else{var h=at(c);s.push(h)}}return s}function rt(e,t,n){if(2===e.length&&"band"===e[0]&&"number"===typeof e[1])try{return t[e[1]][n]}catch(r){return console.warn("Raster Data err!"),0}e.map((function(i,a){if(Array.isArray(i)&&i.length>0)switch(i[0]){case"band":try{e[a]=t[i[1]][n]}catch(r){console.warn("Raster Data err!"),e[a]=0}break;default:rt(i,t,n)}}))}function it(e){var t=et(e,3),n=t[0],r=t[1],i=void 0===r?-1:r,a=t[2],o=void 0===a?-1:a;if(void 0===n)return console.warn("Express err!"),["+",0,0];var s=n.replace(/\s+/g,"");return[s,i,o]}function at(e){var t=it(e),n=t[0],r=t[1],i=t[2];return Array.isArray(r)&&(r=at(e[1])),Array.isArray(i)&&(i=at(e[2])),tt(n,r,i)}var ot={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:st}};function st(e,t){for(var n=e[0].rasterData,r=e[1].rasterData,i=e[2].rasterData,a=[],o=(null===t||void 0===t?void 0:t.countCut)||[2,98],s=et(o,2),u=s[0],l=s[1],c=(null===t||void 0===t?void 0:t.RMinMax)||ut(n,u,l),f=(null===t||void 0===t?void 0:t.GMinMax)||ut(r,u,l),h=(null===t||void 0===t?void 0:t.BMinMax)||ut(i,u,l),p=0;p<n.length;p++)a.push(Math.max(0,n[p]-c[0])),a.push(Math.max(0,r[p]-f[0])),a.push(Math.max(0,i[p]-h[0]));return{rasterData:a,rMinMax:c,gMinMax:f,bMinMax:h}}function ut(e,t,n){var r=e.slice().sort((function(e,t){return e-t})),i=r.length,a=r[Math.ceil(i*t/100)],o=r[Math.ceil(i*n/100)];return[a,o]}function lt(e,t,n){return ct.apply(this,arguments)}function ct(){return ct=q(K().mark((function e(t,n,r){var i,a,o,s,u,l;return K().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",{rasterData:[0],width:1,heigh:1});case 2:return e.next=4,Promise.all(t.map((function(e){var t=e.data,r=e.bands,i=void 0===r?[0]:r;return n(t,i)})));case 4:i=e.sent,a=[],i.forEach((function(e){Array.isArray(e)?a.push.apply(a,T(e)):a.push(e)})),o=a[0],s=o.width,u=o.height,e.t0=M(r),e.next="function"===e.t0?11:"object"===e.t0?13:15;break;case 11:return l=r(a),e.abrupt("break",16);case 13:return l=Array.isArray(r)?{rasterData:nt(r,a)}:ft(r,a),e.abrupt("break",16);case 15:l={rasterData:a[0].rasterData};case 16:return e.abrupt("return",I(I({},l),{},{width:s,height:u}));case 17:case"end":return e.stop()}}),e)}))),ct.apply(this,arguments)}function ft(e,t){var n=ot[e.type];return"function"===n.type?n.method(t,null===e||void 0===e?void 0:e.options):"operation"===n.type?"rgb"===e.type?ht(n.expression,t):{rasterData:nt(n.expression,t)}:void 0}function ht(e,t){void 0===e.r&&console.warn("Channel R lost in Operation! Use band[0] to fill!"),void 0===e.g&&console.warn("Channel G lost in Operation! Use band[0] to fill!"),void 0===e.b&&console.warn("Channel B lost in Operation! Use band[0] to fill!");var n=nt(e.r||["band",0],t),r=nt(e.g||["band",0],t),i=nt(e.b||["band",0],t);return[n,r,i]}function pt(e,t,n,r){return dt.apply(this,arguments)}function dt(){return dt=q(K().mark((function e(t,n,r,i){var a;return K().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,lt(t,n,r);case 2:a=e.sent,i(null,{data:a});case 4:case"end":return e.stop()}}),e)}))),dt.apply(this,arguments)}function vt(e,t){return e.map((function(e){return 1*e[t]}))}function gt(e){return!!Array.isArray(e)&&(0===e.length||"number"===typeof e[0])}function mt(e,t){var n,r,i,a=t.extent,o=t.width,s=t.height,u=t.min,l=t.max,c=t.format,f=t.operation;if(void 0===c||gt(e))n=Array.from(e),r=o,i=s;else{var h=Array.isArray(e)?e:[e];n=lt(h,c,f)}var p={_id:1,dataArray:[{_id:1,data:n,width:r,height:i,min:u,max:l,coordinates:[[a[0],a[1]],[a[2],a[3]]]}]};return p}var yt=n(24363),_t=function(){var e=q(K().mark((function e(t,n,r,i){return K().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){n({x:t.x,y:t.y,z:t.z},(function(t,n){t||0===n.length?a(t):n&&pt([{data:n,bands:[0]}],r,i,(function(t,n){t?a(t):n&&e(n)}))}))})));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),xt=function(){var e=q(K().mark((function e(t,n){return K().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){n({x:t.x,y:t.y,z:t.z},(function(t,n){!t&&n?n instanceof ArrayBuffer?(0,Ue.Co)(n,(function(t,n){t&&r(t),e(n)})):n instanceof HTMLImageElement?e(n):r(t):r(t)}))})));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();function bt(e,t){return Array.isArray(e)?"string"===typeof e[0]?e.map((function(e){return(0,Ue.z0)(e,t)})):e.map((function(e){return{url:(0,Ue.z0)(e.url,t),bands:e.bands||[0]}})):(0,Ue.z0)(e,t)}function St(e){return"string"===typeof e?[{url:e,bands:[0]}]:"string"===typeof e[0]?e.map((function(e){return{url:e,bands:[0]}})):e}function wt(e,t){e.xhrCancel=function(){t.map((function(e){e.abort()}))}}var Ct=function(){var e=q(K().mark((function e(t,n,r,i,a){var o,s,u,l,c,f;return K().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(o=St(n.url),!(o.length>1)){e.next=15;break}return e.next=4,kt(o,n);case 4:if(s=e.sent,u=s.rasterFiles,l=s.xhrList,c=s.errList,wt(t,l),!(c.length>0)){e.next=12;break}return r(c,null),e.abrupt("return");case 12:pt(u,i,a,r),e.next=17;break;case 15:f=(0,Ue.ks)(n,(function(e,t){if(e)r(e);else if(t){var n=[{data:t,bands:o[0].bands}];pt(n,i,a,r)}})),wt(t,[f]);case 17:case"end":return e.stop()}}),e)})));return function(t,n,r,i,a){return e.apply(this,arguments)}}();function kt(e,t){return At.apply(this,arguments)}function At(){return At=q(K().mark((function e(t,n){var r,i,a,o,s,u,l,c,f,h,p;return K().wrap((function(e){while(1)switch(e.prev=e.next){case 0:r=[],i=[],a=[],o=0;case 4:if(!(o<t.length)){e.next=20;break}return s=t[o],u=I(I({},n),{},{url:s.url}),l=s.bands,e.next=10,(0,Ue.LF)(I(I({},u),{},{type:"arrayBuffer"}));case 10:c=e.sent,f=c.err,h=c.data,p=c.xhr,f&&a.push(f),i.push(p),r.push({data:h,bands:l});case 17:o++,e.next=4;break;case 20:return e.abrupt("return",{rasterFiles:r,xhrList:i,errList:a});case 21:case"end":return e.stop()}}),e)}))),At.apply(this,arguments)}var Et=function(){var e=q(K().mark((function e(t,n,r,i,a){var o;return K().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return o={url:bt(t,n)},e.abrupt("return",new Promise((function(e,t){Ct(r,o,(function(n,r){n?t(n):r&&e(r)}),i,a)})));case 2:case"end":return e.stop()}}),e)})));return function(t,n,r,i,a){return e.apply(this,arguments)}}(),Tt=function(){var e=q(K().mark((function e(t,n,r,i){var a,o,s,u;return K().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return o=Array.isArray(t)?t[0]:t,i.wmtsOptions?(s=(null===i||void 0===i?void 0:i.getURLFromTemplate)||Ue.jG,a=s(o,I(I({},n),i.wmtsOptions))):(u=(null===i||void 0===i?void 0:i.getURLFromTemplate)||Ue.z0,a=u(o,n)),e.abrupt("return",new Promise((function(e,t){var n,o=(0,Ue.gJ)({url:a,type:(null===i||void 0===i||null===(n=i.requestParameters)||void 0===n?void 0:n.type)||"arrayBuffer"},(function(n,r){n?t(n):r&&e(r)}),i.transformResponse);r.xhrCancel=function(){return o.abort()}})));case 3:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),Mt=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},Ot={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0};yt.n3.ARRAYBUFFER,yt.n3.RGB;function Lt(e){return!(!Array.isArray(e)||0!==e.length)||!Array.isArray(e)&&"string"!==typeof e}function Pt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Lt(e))throw new Error("tile server url is error");var n=(null===t||void 0===t?void 0:t.dataType)||yt.n3.IMAGE;n===yt.n3.RGB&&(n=yt.n3.ARRAYBUFFER);var r=function(r,i){switch(n){case yt.n3.IMAGE:return Tt(e,r,i,t);case yt.n3.CUSTOMIMAGE:case yt.n3.CUSTOMTERRAINRGB:return xt(i,null===t||void 0===t?void 0:t.getCustomData);case yt.n3.ARRAYBUFFER:return Et(e,r,i,(null===t||void 0===t?void 0:t.format)||Mt,null===t||void 0===t?void 0:t.operation);case yt.n3.CUSTOMARRAYBUFFER:case yt.n3.CUSTOMRGB:return _t(i,null===t||void 0===t?void 0:t.getCustomData,(null===t||void 0===t?void 0:t.format)||Mt,null===t||void 0===t?void 0:t.operation);default:return Tt(e,r,i,t)}},i=I(I(I({},Ot),t),{},{getTileData:r});return{data:e,dataArray:[],tilesetOptions:i,isTile:!0}}function Rt(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}function It(e,t){if(null==e)return{};var n,r,i=Rt(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var Dt=["extent","min","max","width","height","format","operation"];function zt(e,t){var n,r=t.extent,i=t.min,a=t.max,o=t.width,s=t.height,u=t.format,l=t.operation,c=It(t,Dt);if(void 0===u||gt(e))n=Array.from(e);else{var f=Array.isArray(e)?e:[e];n=lt(f,u,l)}var h={_id:1,dataArray:[I(I({_id:1,data:n,width:o,height:s},c),{},{min:i,max:a,coordinates:[[r[0],r[1]],[r[2],r[3]]]})]};return h}var Nt={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},Ft=function(){var e=q(K().mark((function e(t){return K().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var n=et(t.bounds,4),r=n[0],i=n[1],a=n[2],o=n[3],s={layers:{testTile:{features:[{type:"Feature",properties:{key:t.x+"/"+t.y+"/"+t.z,x:(r+a)/2,y:(i+o)/2},geometry:{type:"LineString",coordinates:[[a,o],[a,i],[r,i],[r,i]]}}]}}};e(s)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function jt(e,t){var n=function(e){return Ft(e)},r=I(I(I({},Nt),t),{},{getTileData:n});return{data:e,dataArray:[],tilesetOptions:r,isTile:!0}}function Bt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ut(e,t){return Ut=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ut(e,t)}function Vt(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ut(e,t)}function Gt(e,t){if(t&&("object"===M(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Bt(e)}function Ht(e){return Ht=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ht(e)}var Wt=n(68160),Yt=n(10161),qt=n.n(Yt),Zt=n(76635),Kt=n(56992),Xt=n.n(Kt);function Qt(e,t){var n=t.radius,r=void 0===n?40:n,i=t.maxZoom,a=void 0===i?18:i,o=t.minZoom,s=void 0===o?0:o,u=t.zoom,l=void 0===u?2:u;if(e.pointIndex){var c=e.pointIndex.getClusters(e.extent,Math.floor(l));return e.dataArray=Jt(c),e}var f=new(Xt())({radius:r,minZoom:s,maxZoom:a}),h={type:"FeatureCollection",features:[]};return h.features=e.dataArray.map((function(e){return{type:"Feature",geometry:{type:"Point",coordinates:e.coordinates},properties:I({},e)}})),f.load(h.features),f}function Jt(e){return e.map((function(e,t){return I({coordinates:e.geometry.coordinates,_id:t+1},e.properties)}))}function $t(e){if(0===e.length)throw new Error("max requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]>t&&(t=e[n]);return t}function en(e){if(0===e.length)throw new Error("min requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]<t&&(t=e[n]);return t}function tn(e){if(0===e.length)return 0;for(var t,n=e[0],r=0,i=1;i<e.length;i++)t=n+1*e[i],Math.abs(n)>=Math.abs(e[i])?r+=n-t+e[i]:r+=e[i]-t+n,n=t;return n+1*r}function nn(e){if(0===e.length)throw new Error("mean requires at least one data point");return tn(e)/e.length}var rn={min:en,max:$t,mean:nn,sum:tn};function an(e){var t=on();return function(){var n,r=Ht(e);if(t){var i=Ht(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Gt(this,n)}}function on(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function sn(e,t){if(Array.isArray(t))return t}var un=function(e){Vt(n,e);var t=an(n);function n(e,r){var i;return Me(this,n),i=t.call(this),P(Bt(i),"type","source"),P(Bt(i),"isTile",!1),P(Bt(i),"inited",!1),P(Bt(i),"hooks",{init:new Wt.ni}),P(Bt(i),"parser",{type:"geojson"}),P(Bt(i),"transforms",[]),P(Bt(i),"cluster",!1),P(Bt(i),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),P(Bt(i),"invalidExtent",!1),P(Bt(i),"dataArrayChanged",!1),P(Bt(i),"cfg",{autoRender:!0}),i.originData=e,i.initCfg(r),i.init().then((function(){i.inited=!0,i.emit("update",{type:"inited"})})),i}return Le(n,[{key:"getSourceCfg",value:function(){return this.cfg}},{key:"getClusters",value:function(e){return this.clusterIndex.getClusters(this.caculClusterExtent(2),e)}},{key:"getClustersLeaves",value:function(e){return this.clusterIndex.getLeaves(e,1/0)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(e){var t=this,n=this.clusterOptions,r=n.method,i=void 0===r?"sum":r,o=n.field,s=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(e));this.clusterOptions.zoom=e,s.forEach((function(e){e.id||(e.properties.point_count=1)})),(o||(0,Zt.isFunction)(i))&&(s=s.map((function(e){var n=e.id;if(n){var r,a=t.clusterIndex.getLeaves(n,1/0),s=a.map((function(e){return e.properties}));if((0,Zt.isString)(i)&&o){var u=vt(s,o);r=rn[i](u)}(0,Zt.isFunction)(i)&&(r=i(s)),e.properties.stat=r}else e.properties.point_count=1;return e}))),this.data=a("geojson")({type:"FeatureCollection",features:s}),this.executeTrans()}},{key:"getFeatureById",value:function(e){var t=this.parser,n=t.type,r=void 0===n?"geojson":n,i=t.geometry;if("geojson"!==r||this.cluster)return"json"===r&&i?this.data.dataArray.find((function(t){return t._id===e})):e<this.data.dataArray.length?this.data.dataArray[e]:"null";var a=e<this.originData.features.length?this.originData.features[e]:"null",o=(0,Zt.cloneDeep)(a);if(null!==o&&void 0!==o&&o.properties&&(0!==this.transforms.length||this.dataArrayChanged)){var s=this.data.dataArray.find((function(t){return t._id===e}));o.properties=s}return o}},{key:"updateFeaturePropertiesById",value:function(e,t){this.data.dataArray=this.data.dataArray.map((function(n){return n._id===e?I(I({},n),t):n})),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}},{key:"getFeatureId",value:function(e,t){var n=this.data.dataArray.find((function(n){return n[e]===t}));return null===n||void 0===n?void 0:n._id}},{key:"setData",value:function(e,t){var n=this;this.originData=e,this.dataArrayChanged=!1,this.initCfg(t),this.init().then((function(){n.emit("update",{type:"update"})}))}},{key:"reloadAllTile",value:function(){var e;null===(e=this.tileset)||void 0===e||e.reloadAll()}},{key:"reloadTilebyId",value:function(e,t,n){var r;null===(r=this.tileset)||void 0===r||r.reloadTileById(e,t,n)}},{key:"reloadTileByLnglat",value:function(e,t,n){var r;null===(r=this.tileset)||void 0===r||r.reloadTileByLnglat(e,t,n)}},{key:"getTileExtent",value:function(e,t){var n;return null===(n=this.tileset)||void 0===n?void 0:n.getTileExtent(e,t)}},{key:"getTileByZXY",value:function(e,t,n){var r;return null===(r=this.tileset)||void 0===r?void 0:r.getTileByZXY(e,t,n)}},{key:"reloadTileByExtent",value:function(e,t){var n;null===(n=this.tileset)||void 0===n||n.reloadTileByExtent(e,t)}},{key:"destroy",value:function(){var e;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,null===(e=this.tileset)||void 0===e||e.destroy()}},{key:"processData",value:function(){var e=q(K().mark((function e(){var t=this;return K().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){try{t.excuteParser(),t.initCluster(),t.executeTrans(),e({})}catch(r){n(r)}})));case 1:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"initCfg",value:function(e){this.cfg=(0,Zt.mergeWith)(this.cfg,e,sn);var t=this.cfg;t&&(t.parser&&(this.parser=t.parser),t.transforms&&(this.transforms=t.transforms),this.cluster=t.cluster||!1,t.clusterOptions&&(this.cluster=!0,this.clusterOptions=I(I({},this.clusterOptions),t.clusterOptions)))}},{key:"init",value:function(){var e=q(K().mark((function e(){return K().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.inited=!1,e.next=3,this.processData();case 3:this.inited=!0;case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"excuteParser",value:function(){var e=this.parser,t=e.type||"geojson",n=a(t);this.data=n(this.originData,e),this.tileset=this.initTileset(),e.cancelExtent||(this.extent=(0,Ue.We)(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}},{key:"setCenter",value:function(e){this.center=[(e[0]+e[2])/2,(e[1]+e[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var e=this.data.tilesetOptions;if(e){if(this.isTile=!0,this.tileset)return this.tileset.updateOptions(e),this.tileset;var t=new Ue.nx(I({},e));return t}}},{key:"executeTrans",value:function(){var e=this,t=this.transforms;t.forEach((function(t){var n=t.type,r=s(n)(e.data,t);Object.assign(e.data,r)}))}},{key:"initCluster",value:function(){if(this.cluster){var e=this.clusterOptions||{};this.clusterIndex=Qt(this.data,e)}}},{key:"caculClusterExtent",value:function(e){var t=[[-1/0,-1/0],[1/0,1/0]];return this.invalidExtent||(t=(0,Ue.yA)((0,Ue.ds)(this.extent),e)),t[0].concat(t[1])}}]),n}(Yt.EventEmitter);function ln(e,t){var n=t.callback;return n&&(e.dataArray=e.dataArray.filter(n)),e}function cn(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=fn(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function fn(e,t){if(e){if("string"===typeof e)return hn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?hn(e,t):void 0}}function hn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var pn=6378e3;function dn(e,t){var n=e.dataArray,r=t.size,i=void 0===r?10:r,a=i/(2*Math.PI*pn)*(256<<20)/2,o=vn(n,i),s=o.gridHash,u=o.gridOffset,l=_n(s,u,t);return{yOffset:a,xOffset:a,radius:a,type:"grid",dataArray:l}}function vn(e,t){var n,r,i=1/0,a=-1/0,o=cn(e);try{for(o.s();!(r=o.n()).done;){var s=r.value;n=s.coordinates[1],Number.isFinite(n)&&(i=n<i?n:i,a=n>a?n:a)}}catch(_){o.e(_)}finally{o.f()}var u=(i+a)/2,l=gn(t,u);if(l.xOffset<=0||l.yOffset<=0)return{gridHash:{},gridOffset:l};var c,f={},h=cn(e);try{for(h.s();!(c=h.n()).done;){var p=c.value,d=p.coordinates[1],v=p.coordinates[0];if(Number.isFinite(d)&&Number.isFinite(v)){var g=Math.floor((d+90)/l.yOffset),m=Math.floor((v+180)/l.xOffset),y="".concat(g,"-").concat(m);f[y]=f[y]||{count:0,points:[]},f[y].count+=1,f[y].points.push(p)}}}catch(_){h.e(_)}finally{h.f()}return{gridHash:f,gridOffset:l}}function gn(e,t){var n=mn(e),r=yn(t,e);return{yOffset:n,xOffset:r}}function mn(e){return e/pn*(180/Math.PI)}function yn(e,t){return t/pn*(180/Math.PI)/Math.cos(e*Math.PI/180)}function _n(e,t,n){return Object.keys(e).reduce((function(r,i,a){var o=i.split("-"),s=parseInt(o[0],10),u=parseInt(o[1],10),l={};if(n.field&&n.method){var c=Ue.a5.getColumn(e[i].points,n.field);l[n.method]=Ue.a5.statMap[n.method](c)}return Object.assign(l,{_id:a,coordinates:(0,Ue.Z)([t.xOffset*(u+.5)-180,t.yOffset*(s+.5)-90]),rawData:e[i].points,count:e[i].count}),r.push(l),r}),[])}var xn=Math.PI/3,bn=[0,xn,2*xn,3*xn,4*xn,5*xn];function Sn(e){return e[0]}function wn(e){return e[1]}function Cn(){var e,t,n,r=0,i=0,a=1,o=1,s=Sn,u=wn;function l(e){var r,i={},a=[],o=e.length;for(r=0;r<o;++r)if(!isNaN(c=+s.call(null,l=e[r],r,e))&&!isNaN(f=+u.call(null,l,r,e))){var l,c,f,h=Math.round(f/=n),p=Math.round(c=c/t-(1&h)/2),d=f-h;if(3*Math.abs(d)>1){var v=c-p,g=p+(c<p?-1:1)/2,m=h+(f<h?-1:1),y=c-g,_=f-m;v*v+d*d>y*y+_*_&&(p=g+(1&h?1:-1)/2,h=m)}var x=p+"-"+h,b=i[x];b?b.push(l):(a.push(b=i[x]=[l]),b.x=(p+(1&h)/2)*t,b.y=h*n)}return a}function c(e){var t=0,n=0;return bn.map((function(r){var i=Math.sin(r)*e,a=-Math.cos(r)*e,o=i-t,s=a-n;return t=i,n=a,[o,s]}))}return l.hexagon=function(t){return"m"+c(null==t?e:+t).join("l")+"z"},l.centers=function(){for(var s=[],u=Math.round(i/n),l=Math.round(r/t),c=u*n;c<o+e;c+=n,++u)for(var f=l*t+(1&u)*t/2;f<a+t/2;f+=t)s.push([f,c]);return s},l.mesh=function(){var t=c(e).slice(0,4).join("l");return l.centers().map((function(e){return"M"+e+"m"+t})).join("")},l.x=function(e){return arguments.length?(s=e,l):s},l.y=function(e){return arguments.length?(u=e,l):u},l.radius=function(r){return arguments.length?(e=+r,t=2*e*Math.sin(xn),n=1.5*e,l):e},l.size=function(e){return arguments.length?(r=i=0,a=+e[0],o=+e[1],l):[a-r,o-i]},l.extent=function(e){return arguments.length?(r=+e[0][0],i=+e[0][1],a=+e[1][0],o=+e[1][1],l):[[r,i],[a,o]]},l.radius(1)}var kn=6378e3;function An(e,t){var n=e.dataArray,r=t.size,i=void 0===r?10:r,a=t.method,o=void 0===a?"sum":a,s=i/(2*Math.PI*kn)*(256<<20)/2,u=n.map((function(e){var t=(0,Ue.Z)(e.coordinates),n=et(t,2),r=n[0],i=n[1];return I(I({},e),{},{coordinates:[r,i]})})),l=Cn().radius(s).x((function(e){return e.coordinates[0]})).y((function(e){return e.coordinates[1]})),c=l(u),f={dataArray:c.map((function(e,n){var r;if(t.field&&o){var i=Ue.a5.getColumn(e,t.field);e[o]=Ue.a5.statMap[o](i)}return r={},P(r,t.method,e[o]),P(r,"count",e.length),P(r,"rawData",e),P(r,"coordinates",[e.x,e.y]),P(r,"_id",n),r})),radius:s,xOffset:s,yOffset:s,type:"hexagon"};return f}function En(e,t){var n=t.sourceField,r=t.targetField,i=t.data,a={};return i.forEach((function(e){a[e[n]]=e})),e.dataArray=e.dataArray.map((function(e){var t=e[r];return I(I({},e),a[t])})),e}function Tn(e,t){var n=t.callback;return n&&(e.dataArray=e.dataArray.map(n)),e}o("rasterTile",Pt),o("mvt",Xe),o("geojsonvt",Be),o("testTile",jt),o("geojson",W),o("image",Ve),o("csv",V),o("json",U),o("raster",mt),o("rasterRgb",zt),u("cluster",Qt),u("filter",ln),u("join",En),u("map",Tn),u("grid",dn),u("hexagon",An);var Mn=un;function On(e){return On="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},On(e)}function Ln(e,t){if("object"!==On(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==On(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function Pn(e){var t=Ln(e,"string");return"symbol"===On(t)?t:String(t)}function Rn(e,t,n){return t=Pn(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function In(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Dn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?In(Object(n),!0).forEach((function(t){Rn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):In(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function zn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Nn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Pn(r.key),r)}}function Fn(e,t,n){return t&&Nn(e.prototype,t),n&&Nn(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function jn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Bn(e,t){return Bn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Bn(e,t)}function Un(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Bn(e,t)}function Vn(e,t){if(t&&("object"===On(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return jn(e)}function Gn(e){return Gn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Gn(e)}function Hn(e){var t=Wn();return function(){var n,r=Gn(e);if(t){var i=Gn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Vn(this,n)}}function Wn(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Yn=function(e){Un(n,e);var t=Hn(n);function n(e){var r;return zn(this,n),r=t.call(this),Rn(jn(r),"added",!1),Rn(jn(r),"eventHandle",(function(e){r.polyfillEvent(e),r.emit(e.type,{target:e,data:r.markerOption.extData,lngLat:r.lngLat})})),r.markerOption=Dn(Dn({},r.getDefault()),e),(0,Ue.Ev)(["update","onMove","onMapClick"],jn(r)),r.init(),r}return Fn(n,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:Ue.bV.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(e){this.scene=e,this.mapsService=e.get(yt.vK.IMapService),this.sceneSerive=e.get(yt.vK.ISceneService);var t=this.markerOption.element;return this.mapsService.getMarkerContainer().appendChild(t),this.registerMarkerEvent(t),this.mapsService.on("camerachange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("camerachange",this.update)),this.unRegisterMarkerEvent(),this.removeAllListeners();var e=this.markerOption.element;return e&&Ue.SO.remove(e),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(e){return this.lngLat=e,Array.isArray(e)&&(this.lngLat={lng:e[0],lat:e[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(e){var t=this;if(!this.added)return this.once("added",(function(){t.setElement(e)})),this;var n=this.markerOption.element;return n&&Ue.SO.remove(n),this.markerOption.element=e,this.init(),this.mapsService.getMarkerContainer().appendChild(e),this.registerMarkerEvent(e),this.update(),this}},{key:"openPopup",value:function(){var e=this;if(!this.added)return this.once("added",(function(){e.openPopup()})),this;var t=this.popup;return t?(t.isOpen()||t.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var e=this;this.added||this.once("added",(function(){e.closePopup()}));var t=this.popup;return t&&t.remove(),this}},{key:"setPopup",value:function(e){return this.popup=e,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var e=this.popup;return e?(e.isOpen()?e.remove():e.addTo(this.scene),this):this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(e){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(e){this.markerOption.extData=e}},{key:"update",value:function(){if(this.mapsService){var e=this.markerOption,t=e.element,n=e.anchor;this.updatePosition(),Ue.SO.setTransform(t,"".concat(Ue.rQ[n]))}}},{key:"onMapClick",value:function(e){var t=this.markerOption.element;this.popup&&t&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var e=this.mapsService.getContainer();return{containerHeight:(null===e||void 0===e?void 0:e.scrollHeight)||0,containerWidth:(null===e||void 0===e?void 0:e.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updatePosition",value:function(){if(this.mapsService){var e=this.markerOption,t=e.element,n=e.offsets,r=this.lngLat,i=r.lng,a=r.lat,o=this.mapsService.lngLatToContainer([i,a]);if(t){t.style.display="block",t.style.whiteSpace="nowrap";var s=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),u=s.containerHeight,l=s.containerWidth,c=s.bounds;if(!c)return;if(Math.abs(c[0][0])>180||Math.abs(c[1][0])>180){if(o.x>l){var f=this.mapsService.lngLatToContainer([i-360,a]);o.x=f.x}if(o.x<0){var h=this.mapsService.lngLatToContainer([i+360,a]);o.x=h.x}}(o.x>l||o.x<0||o.y>u||o.y<0)&&(t.style.display="none"),t.style.left=o.x+n[0]+"px",t.style.top=o.y-n[1]+"px"}}}},{key:"init",value:function(){var e=this,t=this.markerOption.element,n=this.markerOption,r=n.color,i=n.anchor;if(!t){this.defaultMarker=!0,t=Ue.SO.create("div"),this.markerOption.element=t;var a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height","48px"),a.setAttributeNS(null,"width","48px"),a.setAttributeNS(null,"viewBox","0 0 1024 1024");var o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),o.setAttributeNS(null,"fill",r),a.appendChild(o),t.appendChild(a)}Ue.SO.addClass(t,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach((function(n){var r,i,a=(null===(r=e.markerOption)||void 0===r?void 0:r.style)&&(null===(i=e.markerOption)||void 0===i?void 0:i.style[n]);t&&(t.style[n]=a)})),(0,Ue.zi)(t,i,"marker")}},{key:"registerMarkerEvent",value:function(e){e.addEventListener("click",this.onMapClick),e.addEventListener("mousemove",this.eventHandle),e.addEventListener("click",this.eventHandle),e.addEventListener("mousedown",this.eventHandle),e.addEventListener("mouseup",this.eventHandle),e.addEventListener("dblclick",this.eventHandle),e.addEventListener("contextmenu",this.eventHandle),e.addEventListener("mouseover",this.eventHandle),e.addEventListener("mouseout",this.eventHandle),e.addEventListener("touchstart",this.eventHandle),e.addEventListener("touchend",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var e=this.getElement();e.removeEventListener("click",this.onMapClick),e.removeEventListener("mousemove",this.eventHandle),e.removeEventListener("click",this.eventHandle),e.removeEventListener("mousedown",this.eventHandle),e.removeEventListener("mouseup",this.eventHandle),e.removeEventListener("dblclick",this.eventHandle),e.removeEventListener("contextmenu",this.eventHandle),e.removeEventListener("mouseover",this.eventHandle),e.removeEventListener("mouseout",this.eventHandle),e.removeEventListener("touchstart",this.eventHandle),e.removeEventListener("touchend",this.eventHandle)}},{key:"polyfillEvent",value:function(e){this.mapsService&&"GAODE2.x"===this.mapsService.version&&((0,Ue.Ro)()||("touchstart"===e.type&&(this.touchStartTime=Date.now()),"touchend"===e.type&&Date.now()-this.touchStartTime<300&&this.emit("click",{target:e,data:this.markerOption.extData,lngLat:this.lngLat})))}},{key:"addDragHandler",value:function(e){return null}},{key:"onUp",value:function(e){throw new Error("Method not implemented.")}}]),n}(Yt.EventEmitter);function qn(e){var t=Zn();return function(){var n,r=Gn(e);if(t){var i=Gn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Vn(this,n)}}function Zn(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Kn=function(e){Un(n,e);var t=qn(n);function n(e){var r,i;return zn(this,n),i=t.call(this),Rn(jn(i),"markers",[]),Rn(jn(i),"points",[]),Rn(jn(i),"clusterMarkers",[]),i.markerLayerOption=(0,Zt.merge)(i.getDefault(),e),(0,Ue.Ev)(["update"],jn(i)),i.zoom=(null===(r=i.markerLayerOption.clusterOption)||void 0===r?void 0:r.zoom)||-99,i}return Fn(n,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(e){return this.scene=e,this.mapsService=e.get(yt.vK.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.mapsService.on("camerachange",this.setContainerSize.bind(this)),this.mapsService.on("viewchange",this.setContainerSize.bind(this)),this.addMarkers(),this.inited=!0,this}},{key:"setContainerSize",value:function(){if(this.mapsService){var e=this.mapsService.getContainer();this.containerSize={containerWidth:(null===e||void 0===e?void 0:e.scrollWidth)||0,containerHeight:(null===e||void 0===e?void 0:e.scrollHeight)||0,bounds:this.mapsService.getBounds()}}}},{key:"getContainerSize",value:function(){return this.containerSize}},{key:"addMarker",value:function(e){var t=this.markerLayerOption.cluster;if(e.getMarkerLayerContainerSize=this.getContainerSize.bind(this),t&&(this.addPoint(e,this.markers.length),this.mapsService)){var n=this.mapsService.getZoom(),r=this.mapsService.getBounds();this.bbox=(0,Ue.yA)(r,.5),this.zoom=Math.floor(n),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(e)}},{key:"removeMarker",value:function(e){this.markers.indexOf(e);var t=this.markers.indexOf(e);t>-1&&this.markers.splice(t,1)}},{key:"hide",value:function(){this.markers.map((function(e){e.getElement().style.opacity="0"})),this.clusterMarkers.map((function(e){e.getElement().style.opacity="0"}))}},{key:"show",value:function(){this.markers.map((function(e){e.getElement().style.opacity="1"})),this.clusterMarkers.map((function(e){e.getElement().style.opacity="1"}))}},{key:"getMarkers",value:function(){var e=this.markerLayerOption.cluster;return e?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var e=this;this.getMarkers().forEach((function(t){t.addTo(e.scene)}))}},{key:"clear",value:function(){this.markers.forEach((function(e){e.remove()})),this.clusterMarkers.forEach((function(e){e.remove()})),this.markers=[],this.points=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners(),this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("camerachange",this.setContainerSize.bind(this)),this.mapsService.off("viewchange",this.setContainerSize.bind(this))}},{key:"addPoint",value:function(e,t){var n=e.getLnglat(),r=n.lng,i=n.lat,a={geometry:{type:"Point",coordinates:[r,i]},properties:Dn(Dn({},e.getExtData()),{},{marker_id:t})};this.points.push(a),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(this.markerLayerOption.cluster){var e=this.markerLayerOption.clusterOption,t=e.radius,n=e.minZoom,r=void 0===n?0:n,i=e.maxZoom;this.clusterIndex=new(Xt())({radius:t,minZoom:r,maxZoom:i}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(e,t){var n=this,r=e[0].concat(e[1]),i=this.clusterIndex.getClusters(r,t);this.clusterMarkers.forEach((function(e){e.remove()})),this.clusterMarkers=[],i.forEach((function(e){var t,r=n.markerLayerOption.clusterOption,i=r.field,a=r.method;if(null!==(t=e.properties)&&void 0!==t&&t.cluster_id){var o,s=n.getLeaves(null===(o=e.properties)||void 0===o?void 0:o.cluster_id);if(e.properties.clusterData=s,i&&a){var u=null===s||void 0===s?void 0:s.map((function(e){var t=Rn({},i,e.properties[i]);return t})),l=Ue.a5.getColumn(u,i),c=Ue.a5.getSatByColumn(a,l),f="point_"+a;e.properties[f]=c.toFixed(2)}}var h=n.clusterMarker(e);n.clusterMarkers.push(h),h.addTo(n.scene)}))}},{key:"getLeaves",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e?this.clusterIndex.getLeaves(e,t,n):null}},{key:"clusterMarker",value:function(e){var t=this.markerLayerOption.clusterOption,n=t,r=n.element,i=void 0===r?this.generateElement.bind(this):r,a=new Yn({element:i(e)}).setLnglat({lng:e.geometry.coordinates[0],lat:e.geometry.coordinates[1]});return a}},{key:"normalMarker",value:function(e){var t=e.properties.marker_id;return this.markers[t]}},{key:"update",value:function(){if(this.mapsService&&0!==this.markers.length){var e=this.mapsService.getZoom(),t=this.mapsService.getBounds();(!this.bbox||Math.abs(e-this.zoom)>=1||!(0,Ue.oO)(this.bbox,t))&&(this.bbox=(0,Ue.yA)(t,.5),this.zoom=Math.floor(e),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(e){var t=Ue.SO.create("div","l7-marker-cluster"),n=Ue.SO.create("div","",t),r=Ue.SO.create("span","",n),i=this.markerLayerOption.clusterOption,a=i.field,o=i.method;e.properties.point_count=e.properties.point_count||1;var s=a&&o?e.properties["point_"+o]||e.properties[a]:e.properties.point_count;return r.textContent=s,t}}]),n}(Yt.EventEmitter);n(60055);function Xn(e,t){while(!Object.prototype.hasOwnProperty.call(e,t))if(e=Gn(e),null===e)break;return e}function Qn(){return Qn="undefined"!==typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=Xn(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},Qn.apply(this,arguments)}function Jn(e){if(Array.isArray(e))return e}function $n(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(c){l=!0,i=c}finally{try{if(!u&&null!=n["return"]&&(o=n["return"](),Object(o)!==o))return}finally{if(l)throw i}}return s}}function er(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function tr(e,t){if(e){if("string"===typeof e)return er(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?er(e,t):void 0}}function nr(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function rr(e,t){return Jn(e)||$n(e,t)||tr(e,t)||nr()}function ir(e){var t=ar();return function(){var n,r=Gn(e);if(t){var i=Gn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Vn(this,n)}}function ar(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var or=function(e){Un(n,e);var t=ir(n);function n(e){var r;return zn(this,n),r=t.call(this),n.controlCount++,r.controlOption=Dn(Dn({},r.getDefault(e)),e||{}),r}return Fn(n,[{key:"getOptions",value:function(){return this.controlOption}},{key:"setOptions",value:function(e){var t=this.getDefault(e);Object.entries(e).forEach((function(n){var r=rr(n,2),i=r[0],a=r[1];void 0===a&&(e[i]=t[i])})),"position"in e&&this.setPosition(e.position),"className"in e&&this.setClassName(e.className),"style"in e&&this.setStyle(e.style),this.controlOption=Dn(Dn({},this.controlOption),e)}},{key:"addTo",value:function(e){this.mapsService=e.get(yt.vK.IMapService),this.renderService=e.get(yt.vK.IRendererService),this.layerService=e.get(yt.vK.ILayerService),this.controlService=e.get(yt.vK.IControlService),this.configService=e.get(yt.vK.IGlobalConfigService),this.scene=e.get(yt.vK.ISceneService),this.sceneContainer=e,this.isShow=!0,this.container=this.onAdd(),Ue.SO.addClass(this.container,"l7-control");var t=this.controlOption,n=t.className,r=t.style;return n&&this.setClassName(n),r&&this.setStyle(r),this.insertContainer(),this.emit("add",this),this}},{key:"remove",value:function(){if(!this.mapsService)return this;Ue.SO.remove(this.container),this.onRemove(),this.emit("remove",this)}},{key:"onAdd",value:function(){return Ue.SO.create("div")}},{key:"onRemove",value:function(){}},{key:"show",value:function(){var e=this.container;Ue.SO.removeClass(e,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){var e=this.container;Ue.SO.addClass(e,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}},{key:"getDefault",value:function(e){return{position:yt.d.TOPRIGHT,name:"".concat(n.controlCount)}}},{key:"getContainer",value:function(){return this.container}},{key:"getIsShow",value:function(){return this.isShow}},{key:"_refocusOnMap",value:function(e){if(this.mapsService&&e&&e.screenX>0&&e.screenY>0){var t=this.mapsService.getContainer();null!==t&&t.focus()}}},{key:"setPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:yt.d.TOPLEFT,t=this.controlService;return t&&t.removeControl(this),this.controlOption.position=e,t&&t.addControl(this,this.sceneContainer),this}},{key:"setClassName",value:function(e){var t=this.container,n=this.controlOption.className;n&&Ue.SO.removeClass(t,n),e&&Ue.SO.addClass(t,e)}},{key:"setStyle",value:function(e){var t=this.container;e?t.setAttribute("style",e):t.removeAttribute("style")}},{key:"insertContainer",value:function(){var e=this.controlOption.position,t=this.container;if(e instanceof Element)e.appendChild(t);else{var n=this.controlService.controlCorners[e];["bottomleft","bottomright","righttop","rightbottom"].includes(e)?n.insertBefore(t,n.firstChild):n.appendChild(t)}}},{key:"checkUpdateOption",value:function(e,t){return t.some((function(t){return t in e}))}}]),n}(qt());function sr(e){var t=ur();return function(){var n,r=Gn(e);if(t){var i=Gn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Vn(this,n)}}function ur(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}Rn(or,"controlCount",0);var lr=function(e){Un(n,e);var t=sr(n);function n(){var e;zn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Rn(jn(e),"isDisable",!1),e}return Fn(n,[{key:"setIsDisable",value:function(e){var t,n;(this.isDisable=e,e)?null===(t=this.button)||void 0===t||t.setAttribute("disabled","true"):null===(n=this.button)||void 0===n||n.removeAttribute("disabled")}},{key:"createButton",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return Ue.SO.create("button","l7-button-control ".concat(e))}},{key:"onAdd",value:function(){this.button=this.createButton(),this.isDisable=!1;var e=this.controlOption,t=e.title,n=e.btnText,r=e.btnIcon;return this.setBtnTitle(t),this.setBtnText(n),this.setBtnIcon(r),this.button}},{key:"onRemove",value:function(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}},{key:"setOptions",value:function(e){var t=e.title,r=e.btnText,i=e.btnIcon;this.checkUpdateOption(e,["title"])&&this.setBtnTitle(t),this.checkUpdateOption(e,["btnIcon"])&&this.setBtnIcon(i),this.checkUpdateOption(e,["btnText"])&&this.setBtnText(r),Qn(Gn(n.prototype),"setOptions",this).call(this,e)}},{key:"setBtnTitle",value:function(e){var t;null===(t=this.button)||void 0===t||t.setAttribute("title",null!==e&&void 0!==e?e:"")}},{key:"setBtnIcon",value:function(e){if(this.buttonIcon&&Ue.SO.remove(this.buttonIcon),e){var t,n,r,i=null===(t=this.button)||void 0===t?void 0:t.firstChild;if(i)null===(n=this.button)||void 0===n||n.insertBefore(e,i);else null===(r=this.button)||void 0===r||r.appendChild(e);this.buttonIcon=e}}},{key:"setBtnText",value:function(e){if(this.button)if(Ue.SO.removeClass(this.button,"l7-button-control--row"),Ue.SO.removeClass(this.button,"l7-button-control--column"),e){var t,n=this.buttonText;if(!n)n=Ue.SO.create("div","l7-button-control__text"),null===(t=this.button)||void 0===t||t.appendChild(n),this.buttonText=n;n.innerText=e,Ue.SO.addClass(this.button,this.controlOption.vertical?"l7-button-control--column":"l7-button-control--row")}else!e&&this.buttonText&&(Ue.SO.remove(this.buttonText),this.buttonText=void 0)}}]),n}(or);function cr(e){var t=fr();return function(){var n,r=Gn(e);if(t){var i=Gn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Vn(this,n)}}function fr(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var hr=function(e){Un(n,e);var t=cr(n);function n(e,r){var i;return zn(this,n),i=t.call(this),Rn(jn(i),"isShow",!1),Rn(jn(i),"timeout",null),Rn(jn(i),"show",(function(){return i.isShow||!i.contentDOM.innerHTML||(i.resetPopperPosition(),Ue.SO.removeClass(i.popperDOM,"l7-popper-hide"),i.isShow=!0,i.option.unique&&n.conflictPopperList.forEach((function(e){e!==jn(i)&&e.isShow&&e.hide()})),i.emit("show")),jn(i)})),Rn(jn(i),"hide",(function(){return i.isShow?(Ue.SO.addClass(i.popperDOM,"l7-popper-hide"),i.isShow=!1,i.emit("hide"),jn(i)):jn(i)})),Rn(jn(i),"setHideTimeout",(function(){i.timeout||(i.timeout=window.setTimeout((function(){i.isShow&&(i.hide(),i.timeout=null)}),300))})),Rn(jn(i),"clearHideTimeout",(function(){i.timeout&&(window.clearTimeout(i.timeout),i.timeout=null)})),Rn(jn(i),"onBtnClick",(function(){i.isShow?i.hide():i.show()})),Rn(jn(i),"onBtnMouseLeave",(function(){i.setHideTimeout()})),Rn(jn(i),"onBtnMouseMove",(function(){i.clearHideTimeout(),i.isShow||i.show()})),i.button=e,i.option=r,i.init(),r.unique&&n.conflictPopperList.push(jn(i)),i}return Fn(n,[{key:"buttonRect",get:function(){return this.button.getBoundingClientRect()}},{key:"getPopperDOM",value:function(){return this.popperDOM}},{key:"getIsShow",value:function(){return this.isShow}},{key:"getContent",value:function(){return this.content}},{key:"setContent",value:function(e){"string"===typeof e?this.contentDOM.innerHTML=e:e instanceof HTMLElement&&(Ue.SO.clearChildren(this.contentDOM),this.contentDOM.appendChild(e)),this.content=e}},{key:"init",value:function(){var e=this.option.trigger;this.popperDOM=this.createPopper(),"click"===e?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}},{key:"destroy",value:function(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),Ue.SO.remove(this.popperDOM)}},{key:"resetPopperPosition",value:function(){var e={},t=this.option,n=t.container,r=t.offset,i=void 0===r?[0,0]:r,a=t.placement,o=rr(i,2),s=o[0],u=o[1],l=this.button.getBoundingClientRect(),c=n.getBoundingClientRect(),f=Ue.SO.getDiffRect(l,c),h=f.left,p=f.right,d=f.top,v=f.bottom,g=!1,m=!1;/^(left|right)/.test(a)?(a.includes("left")?e.right="".concat(l.width+p,"px"):a.includes("right")&&(e.left="".concat(l.width+h,"px")),a.includes("start")?e.top="".concat(d,"px"):a.includes("end")?e.bottom="".concat(v,"px"):(e.top="".concat(d+l.height/2,"px"),m=!0,e.transform="translate(".concat(s,"px, calc(").concat(u,"px - 50%))"))):/^(top|bottom)/.test(a)&&(a.includes("top")?e.bottom="".concat(l.height+v,"px"):a.includes("bottom")&&(e.top="".concat(l.height+d,"px")),a.includes("start")?e.left="".concat(h,"px"):a.includes("end")?e.right="".concat(p,"px"):(e.left="".concat(h+l.width/2,"px"),g=!0,e.transform="translate(calc(".concat(s,"px - 50%), ").concat(u,"px)"))),e.transform="translate(calc(".concat(s,"px - ").concat(g?"50%":"0%","), calc(").concat(u,"px - ").concat(m?"50%":"0%",")");var y=a.split("-");y.length&&Ue.SO.addClass(this.popperDOM,y.map((function(e){return"l7-popper-".concat(e)})).join(" ")),Ue.SO.addStyle(this.popperDOM,Ue.SO.css2Style(e))}},{key:"createPopper",value:function(){var e=this.option,t=e.container,n=e.className,r=void 0===n?"":n,i=e.content,a=Ue.SO.create("div","l7-popper l7-popper-hide ".concat(r)),o=Ue.SO.create("div","l7-popper-content"),s=Ue.SO.create("div","l7-popper-arrow");return a.appendChild(o),a.appendChild(s),t.appendChild(a),this.popperDOM=a,this.contentDOM=o,i&&this.setContent(i),a}}]),n}(Yt.EventEmitter);function pr(e){var t=dr();return function(){var n,r=Gn(e);if(t){var i=Gn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Vn(this,n)}}function dr(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}Rn(hr,"conflictPopperList",[]);var vr={topleft:"right-start",topcenter:"bottom",topright:"left-start",bottomleft:"right-end",bottomcenter:"top",bottomright:"left-end",lefttop:"bottom-start",leftcenter:"right",leftbottom:"top-start",righttop:"bottom-end",rightcenter:"left",rightbottom:"top-end"},gr=function(e){Un(n,e);var t=pr(n);function n(){return zn(this,n),t.apply(this,arguments)}return Fn(n,[{key:"getPopper",value:function(){return this.popper}},{key:"hide",value:function(){this.popper.hide(),Qn(Gn(n.prototype),"hide",this).call(this)}},{key:"getDefault",value:function(e){var t,r=Qn(Gn(n.prototype),"getDefault",this).call(this,e),i=null!==(t=null===e||void 0===e?void 0:e.position)&&void 0!==t?t:r.position;return Dn(Dn({},Qn(Gn(n.prototype),"getDefault",this).call(this,e)),{},{popperPlacement:i instanceof Element?"bottom":vr[i],popperTrigger:"click"})}},{key:"onAdd",value:function(){var e=Qn(Gn(n.prototype),"onAdd",this).call(this);return this.initPopper(),e}},{key:"onRemove",value:function(){this.popper.destroy()}},{key:"initPopper",value:function(){var e=this,t=this.controlOption,n=t.popperClassName,r=t.popperPlacement,i=t.popperTrigger,a=this.mapsService.getMapContainer();return this.popper=new hr(this.button,{className:n,placement:r,trigger:i,container:a,unique:!0}),this.popper.on("show",(function(){e.emit("popperShow",e)})).on("hide",(function(){e.emit("popperHide",e)})),this.popper}},{key:"setOptions",value:function(e){if(Qn(Gn(n.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["popperPlacement","popperTrigger","popperClassName"])){var t=this.popper.getContent();this.popper.destroy(),this.initPopper(),this.popper.setContent(t)}}}]),n}(lr);function mr(e){if(Array.isArray(e))return er(e)}function yr(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _r(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function xr(e){return mr(e)||yr(e)||tr(e)||_r()}function br(e){var t=Sr();return function(){var n,r=Gn(e);if(t){var i=Gn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Vn(this,n)}}function Sr(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var wr=function(e){return e["ActiveOptionClassName"]="l7-select-control-item-active",e["OptionValueAttrKey"]="data-option-value",e["OptionIndexAttrKey"]="data-option-index",e}(wr||{}),Cr=function(e){Un(n,e);var t=br(n);function n(){var e;zn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Rn(jn(e),"selectValue",[]),Rn(jn(e),"createNormalOption",(function(t){var n=e.selectValue.includes(t.value),r=Ue.SO.create("div","l7-select-control-item ".concat(n?wr.ActiveOptionClassName:""));e.getIsMultiple()&&r.appendChild(e.createCheckbox(n)),t.icon&&r.appendChild(t.icon);var i=Ue.SO.create("span");return i.innerText=t.text,r.appendChild(i),r})),Rn(jn(e),"onItemClick",(function(t){if(e.getIsMultiple()){var n=e.selectValue.findIndex((function(e){return e===t.value}));n>-1?e.selectValue.splice(n,1):e.selectValue=[].concat(xr(e.selectValue),[t.value])}else e.selectValue=[t.value];e.setSelectValue(e.selectValue)})),e}return Fn(n,[{key:"setOptions",value:function(e){Qn(Gn(n.prototype),"setOptions",this).call(this,e);var t=e.options;t&&this.popper.setContent(this.getPopperContent(t))}},{key:"onAdd",value:function(){var e=Qn(Gn(n.prototype),"onAdd",this).call(this),t=this.controlOption.defaultValue;return t&&(this.selectValue=this.transSelectValue(t)),this.popper.setContent(this.getPopperContent(this.controlOption.options)),e}},{key:"getSelectValue",value:function(){return this.getIsMultiple()?this.selectValue:this.selectValue[0]}},{key:"setSelectValue",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.transSelectValue(e);this.optionDOMList.forEach((function(e){var n=e.getAttribute(wr.OptionValueAttrKey),i=t.getIsMultiple()?e.querySelector("input[type=checkbox]"):void 0;r.includes(n)?(Ue.SO.addClass(e,wr.ActiveOptionClassName),i&&Ue.SO.setChecked(i,!0)):(Ue.SO.removeClass(e,wr.ActiveOptionClassName),i&&Ue.SO.setChecked(i,!1))})),this.selectValue=r,n&&this.emit("selectChange",this.getIsMultiple()?r:r[0])}},{key:"getIsMultiple",value:function(){return!1}},{key:"getPopperContent",value:function(e){var t=this,n=this.isImageOptions(),r=Ue.SO.create("div",n?"l7-select-control--image":"l7-select-control--normal");this.getIsMultiple()&&Ue.SO.addClass(r,"l7-select-control--multiple");var i=e.map((function(e,r){var i=n?t.createImageOption(e):t.createNormalOption(e);return i.setAttribute(wr.OptionValueAttrKey,e.value),i.setAttribute(wr.OptionIndexAttrKey,window.String(r)),i.addEventListener("click",t.onItemClick.bind(t,e)),i}));return r.append.apply(r,xr(i)),this.optionDOMList=i,r}},{key:"createImageOption",value:function(e){var t=this.selectValue.includes(e.value),n=Ue.SO.create("div","l7-select-control-item ".concat(t?wr.ActiveOptionClassName:"")),r=Ue.SO.create("img");r.setAttribute("src",e.img),Ue.SO.setUnDraggable(r),n.appendChild(r);var i=Ue.SO.create("div","l7-select-control-item-row");this.getIsMultiple()&&n.appendChild(this.createCheckbox(t));var a=Ue.SO.create("span");return a.innerText=e.text,i.appendChild(a),n.appendChild(i),n}},{key:"createCheckbox",value:function(e){var t=Ue.SO.create("input");return t.setAttribute("type","checkbox"),e&&Ue.SO.setChecked(t,!0),t}},{key:"isImageOptions",value:function(){return!!this.controlOption.options.find((function(e){return e.img}))}},{key:"transSelectValue",value:function(e){return Array.isArray(e)?e:[e]}}]),n}(gr);function kr(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(l){return void n(l)}s.done?t(u):Promise.resolve(u).then(r,i)}function Ar(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){kr(a,r,i,o,s,"next",e)}function s(e){kr(a,r,i,o,s,"throw",e)}o(void 0)}))}}var Er=n(4630),Tr=n.n(Er),Mr=function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add("l7-iconfont"),t.setAttribute("aria-hidden","true");var n=document.createElementNS("http://www.w3.org/2000/svg","use");return n.setAttributeNS("http://www.w3.org/1999/xlink","href","#".concat(e)),t.appendChild(n),t};function Or(e){var t=Lr();return function(){var n,r=Gn(e);if(t){var i=Gn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Vn(this,n)}}function Lr(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Pr=function(e){Un(n,e);var t=Or(n);function n(){var e;zn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Rn(jn(e),"onClick",Ar(Tr().mark((function t(){var n;return Tr().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.controlOption.onExport,null!==n&&void 0!==n){t.next=5;break}t.next=10;break;case 5:return t.t0=n,t.next=8,e.getImage();case 8:t.t1=t.sent,(0,t.t0)(t.t1);case 10:case"end":return t.stop()}}),t)})))),Rn(jn(e),"mergeImage",Ar(Tr().mark((function t(){var n,r,i,a,o,s,u,l,c,f,h,p,d,v,g=arguments;return Tr().wrap((function(t){while(1)switch(t.prev=t.next){case 0:for(i=e.controlOption.imageType,a=null!==(n=null===(r=e.mapsService.getContainer())||void 0===r?void 0:r.getBoundingClientRect())&&void 0!==n?n:{},o=a.width,s=void 0===o?0:o,u=a.height,l=void 0===u?0:u,c=document.createElement("canvas"),c.width=s,c.height=l,f=c.getContext("2d"),h=g.length,p=new Array(h),d=0;d<h;d++)p[d]=g[d];return t.next=9,Promise.all(p.map((function(e){return new Promise((function(t){var n=new Image;n.onload=function(){t(n)},n.src=e}))})));case 9:return v=t.sent,v.forEach((function(e){null===f||void 0===f||f.drawImage(e,0,0,s,l)})),t.abrupt("return",c.toDataURL("image/".concat(i)));case 12:case"end":return t.stop()}}),t)})))),e}return Fn(n,[{key:"onAdd",value:function(){var e=Qn(Gn(n.prototype),"onAdd",this).call(this);return e.addEventListener("click",this.onClick),e}},{key:"getDefault",value:function(e){return Dn(Dn({},Qn(Gn(n.prototype),"getDefault",this).call(this,e)),{},{title:"\u5bfc\u51fa\u56fe\u7247",btnIcon:Mr("l7-icon-export-picture"),imageType:"png"})}},{key:"getImage",value:function(){var e=Ar(Tr().mark((function e(){var t,n;return Tr().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.mapsService.exportMap("png");case 2:return t=e.sent,e.next=5,this.scene.exportPng("png");case 5:return n=e.sent,e.abrupt("return",this.mergeImage.apply(this,xr([t,n].filter((function(e){return e})))));case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),n}(lr);function Rr(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Ir(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Ir(e,t){if(e){if("string"===typeof e)return Dr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Dr(e,t):void 0}}function Dr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var zr=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],Nr=function(){if("undefined"===typeof document)return!1;for(var e=zr[0],t={},n=0,r=zr;n<r.length;n++){var i=r[n],a=null===i||void 0===i?void 0:i[1];if(a in document){var o,s=Rr(i.entries());try{for(s.s();!(o=s.n()).done;){var u=rr(o.value,2),l=u[0],c=u[1];t[e[l]]=c}}catch(f){s.e(f)}finally{s.f()}return t}}return!1}(),Fr={change:Nr.fullscreenchange,error:Nr.fullscreenerror},jr={request:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.documentElement,t=arguments.length>1?arguments[1]:void 0;return new Promise((function(n,r){var i=function e(){jr.off("change",e),n()};jr.on("change",i);var a=e[Nr.requestFullscreen](t);a instanceof Promise&&a.then(i).catch(r)}))},exit:function(){return new Promise((function(e,t){if(jr.isFullscreen){var n=function t(){jr.off("change",t),e()};jr.on("change",n);var r=document[Nr.exitFullscreen]();r instanceof Promise&&r.then(n).catch(t)}else e()}))},toggle:function(e,t){return jr.isFullscreen?jr.exit():jr.request(e,t)},onchange:function(e){jr.on("change",e)},onerror:function(e){jr.on("error",e)},on:function(e,t){var n=Fr[e];n&&document.addEventListener(n,t,!1)},off:function(e,t){var n=Fr[e];n&&document.removeEventListener(n,t,!1)},raw:Nr};Object.defineProperties(jr,{isFullscreen:{get:function(){return Boolean(document[Nr.fullscreenElement])}},element:{enumerable:!0,get:function(){var e;return null!==(e=document[Nr.fullscreenElement])&&void 0!==e?e:void 0}},isEnabled:{enumerable:!0,get:function(){return Boolean(document[Nr.fullscreenEnabled])}}}),Nr||(jr={isEnabled:!1});var Br=jr;function Ur(e){var t=Vr();return function(){var n,r=Gn(e);if(t){var i=Gn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Vn(this,n)}}function Vr(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Gr=function(e){Un(n,e);var t=Ur(n);function n(e){var r;return zn(this,n),r=t.call(this,e),Rn(jn(r),"isFullscreen",!1),Rn(jn(r),"toggleFullscreen",Ar(Tr().mark((function e(){return Tr().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!Br.isEnabled){e.next=3;break}return e.next=3,Br.toggle(r.mapContainer);case 3:case"end":return e.stop()}}),e)})))),Rn(jn(r),"onClick",(function(){r.toggleFullscreen()})),Rn(jn(r),"onFullscreenChange",(function(){r.isFullscreen=!!document.fullscreenElement;var e=r.controlOption,t=e.btnText,n=e.btnIcon,i=e.title,a=e.exitBtnText,o=e.exitBtnIcon,s=e.exitTitle;r.isFullscreen?(r.setBtnTitle(s),r.setBtnText(a),r.setBtnIcon(o)):(r.setBtnTitle(i),r.setBtnText(t),r.setBtnIcon(n)),r.emit("fullscreenChange",r.isFullscreen)})),Br.isEnabled||console.warn("\u5f53\u524d\u6d4f\u89c8\u5668\u73af\u5883\u4e0d\u652f\u6301\u5bf9\u5730\u56fe\u5168\u5c4f\u5316"),r}return Fn(n,[{key:"setOptions",value:function(e){var t=e.exitBtnText,r=e.exitBtnIcon,i=e.exitTitle;this.isFullscreen&&(this.checkUpdateOption(e,["exitBtnIcon"])&&this.setBtnIcon(r),this.checkUpdateOption(e,["exitBtnText"])&&this.setBtnText(t),this.checkUpdateOption(e,["exitTitle"])&&this.setBtnTitle(i)),Qn(Gn(n.prototype),"setOptions",this).call(this,e)}},{key:"onAdd",value:function(){var e=Qn(Gn(n.prototype),"onAdd",this).call(this);return e.addEventListener("click",this.onClick),this.mapContainer=Ue.SO.getContainer(this.scene.getSceneConfig().id),this.mapContainer.addEventListener("fullscreenchange",this.onFullscreenChange),e}},{key:"onRemove",value:function(){Qn(Gn(n.prototype),"onRemove",this).call(this),this.mapContainer.removeEventListener("fullscreenchange",this.onFullscreenChange)}},{key:"getDefault",value:function(e){return Dn(Dn({},Qn(Gn(n.prototype),"getDefault",this).call(this,e)),{},{title:"\u5168\u5c4f",btnIcon:Mr("l7-icon-fullscreen"),exitTitle:"\u9000\u51fa\u5168\u5c4f",exitBtnIcon:Mr("l7-icon-exit-fullscreen")})}}]),n}(lr);function Hr(e){var t=Wr();return function(){var n,r=Gn(e);if(t){var i=Gn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Vn(this,n)}}function Wr(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Yr=function(e){Un(n,e);var t=Hr(n);function n(e){var r;return zn(this,n),r=t.call(this,e),Rn(jn(r),"getGeoLocation",(function(){return new Promise((function(e,t){window.navigator.geolocation.getCurrentPosition((function(n){var r=n.coords,i=null!==r&&void 0!==r?r:{},a=i.longitude,o=i.latitude;(0,Zt.isNaN)(a)||(0,Zt.isNaN)(o)?t():e([a,o])}),(function(e){t(e)}))}))})),Rn(jn(r),"onClick",Ar(Tr().mark((function e(){var t,n,i;return Tr().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(window.navigator.geolocation){e.next=2;break}return e.abrupt("return");case 2:return t=r.controlOption.transform,e.next=5,r.getGeoLocation();case 5:if(n=e.sent,i=r.mapsService.getZoom(),e.t0=r.mapsService,e.t1=i>15?i:15,!t){e.next=15;break}return e.next=12,t(n);case 12:e.t2=e.sent,e.next=16;break;case 15:e.t2=n;case 16:e.t3=e.t2,e.t0.setZoomAndCenter.call(e.t0,e.t1,e.t3);case 18:case"end":return e.stop()}}),e)})))),window.navigator.geolocation||console.warn("\u5f53\u524d\u6d4f\u89c8\u5668\u73af\u5883\u4e0d\u652f\u6301\u83b7\u53d6\u5730\u7406\u5b9a\u4f4d"),r}return Fn(n,[{key:"getDefault",value:function(e){return Dn(Dn({},Qn(Gn(n.prototype),"getDefault",this).call(this,e)),{},{title:"\u5b9a\u4f4d",btnIcon:Mr("l7-icon-reposition")})}},{key:"onAdd",value:function(){var e=Qn(Gn(n.prototype),"onAdd",this).call(this);return e.addEventListener("click",this.onClick),e}}]),n}(lr);function qr(e){var t=Zr();return function(){var n,r=Gn(e);if(t){var i=Gn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Vn(this,n)}}function Zr(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Kr=function(e){Un(n,e);var t=qr(n);function n(){var e;zn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Rn(jn(e),"onLayerChange",(function(){var t;null!==(t=e.controlOption.layers)&&void 0!==t&&t.length||(e.selectValue=e.getLayerVisible(),e.setOptions({options:e.getLayerOptions()}))})),Rn(jn(e),"onLayerVisibleChane",(function(){e.setSelectValue(e.getLayerVisible())})),Rn(jn(e),"onSelectChange",(function(){e.layers.forEach((function(t){var n=e.selectValue.includes(t.name),r=t.isVisible();n&&!r&&t.show(),!n&&r&&t.hide()}))})),e}return Fn(n,[{key:"layers",get:function(){var e=this.layerService,t=this.controlOption.layers;if(Array.isArray(t)&&t.length){var n=[];return t.forEach((function(t){if(t instanceof Object&&n.push(t),"string"===typeof t){var r=e.getLayer(t)||e.getLayerByName(t);r&&n.push(r)}})),n}return e.getLayers()||[]}},{key:"getDefault",value:function(e){return Dn(Dn({},Qn(Gn(n.prototype),"getDefault",this).call(this,e)),{},{title:"\u56fe\u5c42\u63a7\u5236",btnIcon:Mr("l7-icon-layer"),options:[]})}},{key:"getLayerVisible",value:function(){return this.layers.filter((function(e){return e.isVisible()})).map((function(e){return e.name}))}},{key:"getLayerOptions",value:function(){return this.layers.map((function(e){return{text:e.name,value:e.name}}))}},{key:"setOptions",value:function(e){var t=this.checkUpdateOption(e,["layers"]);Qn(Gn(n.prototype),"setOptions",this).call(this,e),t&&(this.selectValue=this.getLayerVisible(),this.controlOption.options=this.getLayerOptions(),this.popper.setContent(this.getPopperContent(this.controlOption.options)))}},{key:"onAdd",value:function(){var e;return null!==(e=this.controlOption.options)&&void 0!==e&&e.length||(this.controlOption.options=this.getLayerOptions()),this.controlOption.defaultValue||(this.controlOption.defaultValue=this.getLayerVisible()),this.on("selectChange",this.onSelectChange),this.layerService.on("layerChange",this.onLayerChange),Qn(Gn(n.prototype),"onAdd",this).call(this)}},{key:"onRemove",value:function(){this.off("selectChange",this.onSelectChange),this.layerService.off("layerChange",this.onLayerChange)}},{key:"getIsMultiple",value:function(){return!0}}]),n}(Cr);function Xr(e){var t=Qr();return function(){var n,r=Gn(e);if(t){var i=Gn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Vn(this,n)}}function Qr(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Jr=function(e){Un(n,e);var t=Xr(n);function n(){return zn(this,n),t.apply(this,arguments)}return Fn(n,[{key:"getDefault",value:function(){return{position:yt.d.BOTTOMLEFT,name:"logo",href:"https://l7.antv.antgroup.com/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}},{key:"onAdd",value:function(){var e=Ue.SO.create("div","l7-control-logo");return this.setLogoContent(e),e}},{key:"onRemove",value:function(){return null}},{key:"setOptions",value:function(e){Qn(Gn(n.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["img","href"])&&(Ue.SO.clearChildren(this.container),this.setLogoContent(this.container))}},{key:"setLogoContent",value:function(e){var t=this.controlOption,n=t.href,r=t.img,i=Ue.SO.create("img");if(i.setAttribute("src",r),i.setAttribute("aria-label","AntV logo"),Ue.SO.setUnDraggable(i),n){var a=Ue.SO.create("a","l7-control-logo-link");a.target="_blank",a.href=n,a.rel="noopener nofollow",a.setAttribute("rel","noopener nofollow"),a.appendChild(i),e.appendChild(a)}else e.appendChild(i)}}]),n}(or),$r={normal:{text:"\u6807\u51c6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*qdFDSbvIalgAAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u6708\u5149\u94f6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d-vcRLzu8WIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u5e7b\u5f71\u9ed1",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*HMbRTI3XnpIAAAAAAAAAAAAADmJ7AQ/original"},fresh:{text:"\u8349\u8272\u9752",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kqaGQ5kjSiAAAAAAAAAAAAAADmJ7AQ/original"},grey:{text:"\u96c5\u58eb\u7070",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*XegrTpZIbqAAAAAAAAAAAAAADmJ7AQ/original"},graffiti:{text:"\u6d82\u9e26",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*G5g9SZ_Jg4cAAAAAAAAAAAAADmJ7AQ/original"},macaron:{text:"\u9a6c\u5361\u9f99",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*irVvQbDpQMwAAAAAAAAAAAAADmJ7AQ/original"},darkblue:{text:"\u6781\u591c\u84dd",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*lKRzQYB4iR0AAAAAAAAAAAAADmJ7AQ/original"},wine:{text:"\u9171\u7c7d",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*orY0T7QL-lwAAAAAAAAAAAAADmJ7AQ/original"}},ei={normal:{text:"\u6807\u51c6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kIyZTok4Uk0AAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u4eae",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*Z3JRQKDI-cIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u6697",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d7HCQbfmyaoAAAAAAAAAAAAADmJ7AQ/original"},satellite:{text:"\u536b\u661f",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*TytUT6pS9okAAAAAAAAAAAAADmJ7AQ/original"},outdoors:{text:"\u6237\u5916",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*hWwFSYJEFWsAAAAAAAAAAAAADmJ7AQ/original"}};function ti(e){var t=ni();return function(){var n,r=Gn(e);if(t){var i=Gn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Vn(this,n)}}function ni(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var ri=function(e){Un(n,e);var t=ti(n);function n(){var e;zn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Rn(jn(e),"onMapThemeChange",(function(){e.mapsService.setMapStyle(e.selectValue[0])})),e}return Fn(n,[{key:"getDefault",value:function(e){return Dn(Dn({},Qn(Gn(n.prototype),"getDefault",this).call(this,e)),{},{title:"\u5730\u56fe\u6837\u5f0f",btnIcon:Mr("l7-icon-color"),options:[]})}},{key:"getStyleOptions",value:function(){var e="mapbox"===this.mapsService.getType()?ei:$r;return Object.entries(this.mapsService.getMapStyleConfig()).filter((function(e){var t=rr(e,2),n=t[0],r=t[1];return"string"===typeof r&&"blank"!==n})).map((function(t){var n,r=rr(t,2),i=r[0],a=r[1],o=null!==(n=e[i])&&void 0!==n?n:{},s=o.text,u=o.img;return{text:null!==s&&void 0!==s?s:i,value:a,img:u,key:i}}))}},{key:"getMapStyle",value:function(){return this.mapsService.getMapStyle()}},{key:"onAdd",value:function(){var e,t=this;if(null!==(e=this.controlOption.options)&&void 0!==e&&e.length||(this.controlOption.options=this.getStyleOptions()),this.controlOption.defaultValue){var r,i,a=this.controlOption.defaultValue;this.controlOption.defaultValue=null!==(r=null===(i=this.controlOption.options.find((function(e){return e.key===a})))||void 0===i?void 0:i.value)&&void 0!==r?r:a}else{var o=this.getMapStyle();o?this.controlOption.defaultValue=o:this.mapsService.map.once("styledata",(function(){var e=t.mapsService.getMapStyle();t.controlOption.defaultValue=e,t.setSelectValue(e,!1)}))}return this.on("selectChange",this.onMapThemeChange),Qn(Gn(n.prototype),"onAdd",this).call(this)}},{key:"getIsMultiple",value:function(){return!1}}]),n}(Cr);function ii(e){var t=ai();return function(){var n,r=Gn(e);if(t){var i=Gn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Vn(this,n)}}function ai(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var oi=function(e){Un(n,e);var t=ii(n);function n(){var e;zn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Rn(jn(e),"location",[0,0]),Rn(jn(e),"onMouseMove",(function(t){var n=e.location,r=t.lngLat||t.lnglat,i=e.controlOption.transform;r&&(n=[r.lng,r.lat]),e.location=n,i&&(n=i(n)),e.insertLocation2HTML(n),e.emit("locationChange",n)})),e}return Fn(n,[{key:"getLocation",value:function(){return this.location}},{key:"getDefault",value:function(e){return Dn(Dn({},Qn(Gn(n.prototype),"getDefault",this).call(this,e)),{},{position:yt.d.BOTTOMLEFT,transform:function(e){var t=rr(e,2),n=t[0],r=t[1];return[+(+n).toFixed(6),+(+r).toFixed(6)]}})}},{key:"onAdd",value:function(){var e=Ue.SO.create("div","l7-control-mouse-location");return e.innerHTML="&nbsp;",this.mapsService.on("mousemove",this.onMouseMove),e}},{key:"onRemove",value:function(){this.mapsService.off("mousemove",this.onMouseMove)}},{key:"insertLocation2HTML",value:function(e){this.container.innerText=e.join(", ")}}]),n}(or);function si(e){var t=ui();return function(){var n,r=Gn(e);if(t){var i=Gn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Vn(this,n)}}function ui(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var li=function(e){Un(n,e);var t=si(n);function n(){var e;zn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Rn(jn(e),"update",(function(){var t=e.mapsService,n=e.controlOption.maxWidth,r=t.getSize()[1]/2,i=t.containerToLngLat([0,r]),a=t.containerToLngLat([n,r]),o=(0,Ue.yM)([i.lng,i.lat],[a.lng,a.lat]);e.updateScales(o)})),e}return Fn(n,[{key:"getDefault",value:function(e){return Dn(Dn({},Qn(Gn(n.prototype),"getDefault",this).call(this,e)),{},{name:"scale",position:yt.d.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}},{key:"onAdd",value:function(){var e="l7-control-scale",t=Ue.SO.create("div",e);this.resetScaleLines(t);var n=this.controlOption.updateWhenIdle;return this.mapsService.on(n?"moveend":"mapmove",this.update),this.mapsService.on(n?"zoomend":"zoomchange",this.update),t}},{key:"onRemove",value:function(){var e=this.controlOption.updateWhenIdle;this.mapsService.off(e?"zoomend":"zoomchange",this.update),this.mapsService.off(e?"moveend":"mapmove",this.update)}},{key:"setOptions",value:function(e){Qn(Gn(n.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}},{key:"updateScales",value:function(e){var t=this.controlOption,n=t.metric,r=t.imperial;n&&e&&this.updateMetric(e),r&&e&&this.updateImperial(e)}},{key:"resetScaleLines",value:function(e){Ue.SO.clearChildren(e);var t=this.controlOption,n=t.metric,r=t.imperial,i=t.maxWidth,a=t.lockWidth;a&&Ue.SO.addStyle(e,"width: ".concat(i,"px")),n&&(this.mScale=Ue.SO.create("div","l7-control-scale-line",e)),r&&(this.iScale=Ue.SO.create("div","l7-control-scale-line",e)),this.update()}},{key:"updateScale",value:function(e,t,n){var r=this.controlOption.maxWidth;e.style.width=Math.round(r*n)+"px",e.innerHTML=t}},{key:"getRoundNum",value:function(e){var t=Math.pow(10,(Math.floor(e)+"").length-1),n=e/t;return n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1,t*n}},{key:"updateMetric",value:function(e){var t=this.getRoundNum(e),n=t<1e3?t+" m":t/1e3+" km";this.updateScale(this.mScale,n,t/e)}},{key:"updateImperial",value:function(e){var t,n,r,i=3.2808399*e;i>5280?(t=i/5280,n=this.getRoundNum(t),this.updateScale(this.iScale,n+" mi",n/t)):(r=this.getRoundNum(i),this.updateScale(this.iScale,r+" ft",r/i))}}]),n}(or);function ci(e){var t=fi();return function(){var n,r=Gn(e);if(t){var i=Gn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Vn(this,n)}}function fi(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var hi=function(e){Un(n,e);var t=ci(n);function n(){var e;zn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Rn(jn(e),"zoomIn",(function(){!e.disabled&&e.mapsService.getZoom()<e.mapsService.getMaxZoom()&&e.mapsService.zoomIn()})),Rn(jn(e),"zoomOut",(function(){!e.disabled&&e.mapsService.getZoom()>e.mapsService.getMinZoom()&&e.mapsService.zoomOut()})),Rn(jn(e),"updateDisabled",(function(){var t=e.mapsService;e.zoomInButton.removeAttribute("disabled"),e.zoomOutButton.removeAttribute("disabled"),(e.disabled||t.getZoom()<=t.getMinZoom())&&e.zoomOutButton.setAttribute("disabled","true"),(e.disabled||t.getZoom()>=t.getMaxZoom())&&e.zoomInButton.setAttribute("disabled","true")})),e}return Fn(n,[{key:"getDefault",value:function(e){return Dn(Dn({},Qn(Gn(n.prototype),"getDefault",this).call(this,e)),{},{position:yt.d.BOTTOMRIGHT,name:"zoom",zoomInText:Mr("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:Mr("l7-icon-narrow"),zoomOutTitle:"Zoom out"})}},{key:"setOptions",value:function(e){Qn(Gn(n.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle"])&&this.resetButtonGroup(this.container)}},{key:"onAdd",value:function(){var e=Ue.SO.create("div","l7-control-zoom");return this.resetButtonGroup(e),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),e}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"resetButtonGroup",value:function(e){Ue.SO.clearChildren(e),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",e,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",e,this.zoomOut),this.updateDisabled()}},{key:"createButton",value:function(e,t,n,r,i){var a=Ue.SO.create("button",n,r);return"string"===typeof e?a.innerHTML=e:a.append(e),a.title=t,a.addEventListener("click",i),a}}]),n}(or);function pi(e){var t=di();return function(){var n,r=Gn(e);if(t){var i=Gn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Vn(this,n)}}function di(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var vi=function(e){Un(n,e);var t=pi(n);function n(e){var r;zn(this,n),r=t.call(this),Rn(jn(r),"isShow",!0),Rn(jn(r),"onMouseMove",(function(e){var t,n=r.mapsService.getMapContainer(),i=null!==(t=null===n||void 0===n?void 0:n.getBoundingClientRect())&&void 0!==t?t:{},a=i.left,o=void 0===a?0:a,s=i.top,u=void 0===s?0:s;r.setPopupPosition(e.clientX-o,e.clientY-u)})),Rn(jn(r),"updateLngLatPosition",(function(){if(r.mapsService&&!r.popupOption.followCursor){var e=r.lngLat,t=e.lng,n=e.lat,i=r.mapsService.lngLatToContainer([t,n]),a=i.x,o=i.y;r.setPopupPosition(a,o)}})),Rn(jn(r),"onKeyDown",(function(e){27===e.keyCode&&r.remove()})),Rn(jn(r),"onCloseButtonClick",(function(e){e.stopPropagation&&e.stopPropagation(),r.hide()})),Rn(jn(r),"update",(function(){var e=!!r.lngLat,t=r.popupOption,n=t.className,i=t.style,a=t.maxWidth,o=t.anchor,s=t.stopPropagation;if(r.mapsService&&e&&r.content){var u=r.mapsService.getMarkerContainer();if(!r.container&&u&&(r.container=Ue.SO.create("div","l7-popup ".concat(null!==n&&void 0!==n?n:""," ").concat(r.isShow?"":"l7-popup-hide"),u),i&&r.container.setAttribute("style",i),r.tip=Ue.SO.create("div","l7-popup-tip",r.container),r.container.appendChild(r.content),s&&["mousemove","mousedown","mouseup","click","dblclick"].forEach((function(e){r.container.addEventListener(e,(function(e){e.stopPropagation()}))})),r.container.style.whiteSpace="nowrap"),r.updateLngLatPosition(),Ue.SO.setTransform(r.container,"".concat(Ue.rQ[o])),(0,Ue.zi)(r.container,o,"popup"),a){var l=r.container.getBoundingClientRect(),c=l.width;c>parseFloat(a)&&(r.container.style.width=a)}else r.container.style.removeProperty("width")}})),r.popupOption=Dn(Dn({},r.getDefault(null!==e&&void 0!==e?e:{})),e);var i=r.popupOption.lngLat;return i&&(r.lngLat=i),r}return Fn(n,[{key:"lngLat",get:function(){var e;return null!==(e=this.popupOption.lngLat)&&void 0!==e?e:{lng:0,lat:0}},set:function(e){this.popupOption.lngLat=e}},{key:"getIsShow",value:function(){return this.isShow}},{key:"addTo",value:function(e){this.mapsService=e.get(yt.vK.IMapService),this.sceneService=e.get(yt.vK.ISceneService),this.layerService=e.get(yt.vK.ILayerService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=e,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();var t=this.popupOption,n=t.html,r=t.text,i=t.title;return n?this.setHTML(n):r&&this.setText(r),i&&this.setTitle(i),this.emit("open"),this}},{key:"remove",value:function(){if(null!==this&&void 0!==this&&this.isOpen())return this.content&&Ue.SO.remove(this.content),this.container&&(Ue.SO.remove(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}},{key:"getOptions",value:function(){return this.popupOption}},{key:"setOptions",value:function(e){return this.show(),this.popupOption=Dn(Dn({},this.popupOption),e),this.checkUpdateOption(e,["html","text","title","closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","className","style","lngLat","offsets"])&&(this.container&&(Ue.SO.remove(this.container),this.container=void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text),this.popupOption.title&&this.setTitle(this.popupOption.title)),this.checkUpdateOption(e,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(e,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(e,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(e,["html"])&&e.html?this.setHTML(e.html):this.checkUpdateOption(e,["text"])&&e.text&&this.setText(e.text),this.checkUpdateOption(e,["lngLat"])&&e.lngLat&&this.setLnglat(e.lngLat),this}},{key:"open",value:function(){return this.addTo(this.scene),this}},{key:"close",value:function(){return this.remove(),this}},{key:"show",value:function(){if(!this.isShow)return this.container&&Ue.SO.removeClass(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}},{key:"hide",value:function(){if(this.isShow)return this.container&&Ue.SO.addClass(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}},{key:"setHTML",value:function(e){return this.popupOption.html=e,this.setDOMContent(e)}},{key:"setText",value:function(e){return this.popupOption.text=e,this.setDOMContent(window.document.createTextNode(e))}},{key:"setTitle",value:function(e){this.show(),this.popupOption.title=e,e?(this.contentTitle||(this.contentTitle=Ue.SO.create("div","l7-popup-content__title"),this.content.firstChild?this.content.insertBefore(this.contentTitle,this.content.firstChild):this.content.append(this.contentTitle)),Ue.SO.clearChildren(this.contentTitle),Ue.SO.appendElementType(this.contentTitle,e)):this.contentTitle&&(Ue.SO.remove(this.contentTitle),this.contentTitle=void 0)}},{key:"panToPopup",value:function(){var e=this.lngLat,t=e.lng,n=e.lat;return this.popupOption.autoPan&&this.mapsService.panTo([t,n]),this}},{key:"setLngLat",value:function(e){return this.setLnglat(e)}},{key:"setLnglat",value:function(e){var t=this;return this.show(),this.lngLat=e,Array.isArray(e)&&(this.lngLat={lng:e[0],lat:e[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout((function(){t.panToPopup()}),0),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setMaxWidth",value:function(e){return this.popupOption.maxWidth=e,this.update(),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"getDefault",value:function(e){return{closeButton:!0,closeOnClick:!1,maxWidth:"240px",offsets:[0,0],anchor:Ue.bV.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}},{key:"setDOMContent",value:function(e){return this.show(),this.createContent(),Ue.SO.appendElementType(this.contentPanel,e),this.update(),this}},{key:"updateCloseOnClick",value:function(e){var t=this,n=this.mapsService;n&&(null===n||void 0===n||n.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!e&&requestAnimationFrame((function(){null===n||void 0===n||n.on("click",t.onCloseButtonClick)})))}},{key:"updateCloseOnEsc",value:function(e){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!e&&window.addEventListener("keydown",this.onKeyDown)}},{key:"updateFollowCursor",value:function(e){var t,n=null===(t=this.mapsService)||void 0===t?void 0:t.getContainer();n&&(null===n||void 0===n||n.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!e&&(null===n||void 0===n||n.addEventListener("mousemove",this.onMouseMove)))}},{key:"createContent",value:function(){var e=this;if(this.content&&Ue.SO.remove(this.content),this.contentTitle=void 0,this.content=Ue.SO.create("div","l7-popup-content",this.container),this.setTitle(this.popupOption.title),this.popupOption.closeButton){var t=Mr("l7-icon-guanbi");Ue.SO.addClass(t,"l7-popup-close-button"),this.content.appendChild(t),this.popupOption.closeButtonOffsets&&(t.style.right=this.popupOption.closeButtonOffsets[0]+"px",t.style.top=this.popupOption.closeButtonOffsets[1]+"px"),t.setAttribute("aria-label","Close popup"),t.addEventListener("click",(function(){e.hide()})),this.closeButton=t}else this.closeButton=void 0;this.contentPanel=Ue.SO.create("div","l7-popup-content__panel",this.content)}},{key:"setPopupPosition",value:function(e,t){if(this.container){var n=this.popupOption.offsets;this.container.style.left=e+n[0]+"px",this.container.style.top=t-n[1]+"px"}}},{key:"checkUpdateOption",value:function(e,t){return t.some((function(t){return t in e}))}}]),n}(Yt.EventEmitter);function gi(e){var t=mi();return function(){var n,r=Gn(e);if(t){var i=Gn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Vn(this,n)}}function mi(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var yi=function(e){Un(n,e);var t=gi(n);function n(){var e;zn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Rn(jn(e),"layerConfigMap",new WeakMap),e}return Fn(n,[{key:"layerConfigItems",get:function(){var e,t=this.popupOption,n=t.config,r=t.items;return null!==(e=null!==n&&void 0!==n?n:r)&&void 0!==e?e:[]}},{key:"addTo",value:function(e){return Qn(Gn(n.prototype),"addTo",this).call(this,e),this.bindLayerEvent(),this.hide(),this}},{key:"remove",value:function(){return Qn(Gn(n.prototype),"remove",this).call(this),this.unbindLayerEvent(),this}},{key:"setOptions",value:function(e){return this.unbindLayerEvent(),Qn(Gn(n.prototype),"setOptions",this).call(this,e),this.bindLayerEvent(),this}},{key:"getDefault",value:function(e){var t="click"===e.trigger;return Dn(Dn({},Qn(Gn(n.prototype),"getDefault",this).call(this,e)),{},{trigger:"hover",followCursor:!t,lngLat:{lng:0,lat:0},offsets:[0,10],closeButton:!1,closeOnClick:!1,autoClose:!1,closeOnEsc:!1})}},{key:"bindLayerEvent",value:function(){var e=this,t=this.popupOption.trigger;this.layerConfigItems.forEach((function(n){var r,i=e.getLayerByConfig(n);if(i){var a=Dn({},n);if("hover"===t){var o=e.onLayerMouseMove.bind(e,i),s=e.onLayerMouseOut.bind(e,i);a.onMouseMove=o,a.onMouseOut=s,null===i||void 0===i||i.on("mousemove",o),null===i||void 0===i||i.on("mouseout",s)}else{var u=e.onLayerClick.bind(e,i);a.onClick=u,null===i||void 0===i||i.on("click",u)}var l=null===i||void 0===i||null===(r=i.getSource)||void 0===r?void 0:r.call(i),c=e.onSourceUpdate.bind(e,i);null===l||void 0===l||l.on("update",c),a.onSourceUpdate=c,e.layerConfigMap.set(i,a)}}))}},{key:"unbindLayerEvent",value:function(){var e=this;this.layerConfigItems.forEach((function(t){var n=e.getLayerByConfig(t),r=n&&e.layerConfigMap.get(n);if(r){var i,a=r.onMouseMove,o=r.onMouseOut,s=r.onClick,u=r.onSourceUpdate;if(a&&n.off("mousemove",a),o&&n.off("mouseout",o),s&&n.off("click",s),u)null===n||void 0===n||null===(i=n.getSource())||void 0===i||i.off("update",u)}}))}},{key:"onLayerMouseMove",value:function(e,t){if(!this.isSameFeature(e,t.featureId)){var n=this.getLayerInfoFrag(e,t),r=n.title,i=n.content;this.setDOMContent(i),this.setTitle(r),this.displayFeatureInfo={layer:e,featureId:t.featureId},this.show()}}},{key:"onLayerMouseOut",value:function(e,t){this.displayFeatureInfo=void 0,this.isShow&&this.hide()}},{key:"onLayerClick",value:function(e,t){if(this.isShow&&this.isSameFeature(e,t.featureId))this.hide();else{var n=this.getLayerInfoFrag(e,t),r=n.title,i=n.content;this.setDOMContent(i),this.setLnglat(t.lngLat),this.setTitle(r),this.displayFeatureInfo={layer:e,featureId:t.featureId},this.show()}}},{key:"onSourceUpdate",value:function(e){this.hide(),this.displayFeatureInfo=void 0}},{key:"getLayerInfoFrag",value:function(e,t){var n,r=this.layerConfigMap.get(e),i=document.createDocumentFragment();if(r){var a=t.feature;"Feature"===a.type&&"properties"in a&&"geometry"in a&&(a=a.properties);var o=r.title,s=r.fields,u=r.customContent;if(o){n=document.createDocumentFragment();var l=o instanceof Function?o(a):o;Ue.SO.appendElementType(n,l)}if(u){var c=u instanceof Function?u(a):u;Ue.SO.appendElementType(i,c)}else null!==s&&void 0!==s&&s.length&&(null===s||void 0===s||s.forEach((function(e){var n,r,o="string"===typeof e?{field:e}:e,s=o.field,u=o.formatField,l=o.formatValue,c=o.getValue,f=Ue.SO.create("div","l7-layer-popup__row"),h=c?c(t.feature):(0,Zt.get)(a,s),p=null!==(n=u instanceof Function?u(s,a):u)&&void 0!==n?n:s,d=null!==(r=l instanceof Function?l(h,a):l)&&void 0!==r?r:h,v=Ue.SO.create("span","l7-layer-popup__key",f);Ue.SO.appendElementType(v,p),Ue.SO.appendElementType(v,document.createTextNode("\uff1a"));var g=Ue.SO.create("span","l7-layer-popup__value",f);Array.isArray(d)&&d.every((function(e){return!(e instanceof Object)}))&&(d=d.map((function(e){return String(e)})).join(",")),Ue.SO.appendElementType(g,d),i.appendChild(f)})))}return{title:n,content:i}}},{key:"getLayerByConfig",value:function(e){var t=e.layer;return t instanceof Object?t:"string"===typeof t?this.layerService.getLayer(t)||this.layerService.getLayerByName(t):void 0}},{key:"isSameFeature",value:function(e,t){var n=this.displayFeatureInfo;return n&&e===n.layer&&t===n.featureId}}]),n}(vi);function _i(e,t){var n="undefined"!==typeof my&&!!my&&"function"===typeof my.showToast&&!0!==my.isFRM,r="undefined"!==typeof wx&&null!==wx&&("undefined"!==typeof wx.request||"undefined"!==typeof wx.miniProgram);if(!n&&!r&&(t||(t=document),t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var a=t.body||t.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):t.documentElement.appendChild(i)}var o=t.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(t.createTextNode(e)),i.appendChild(o),o}}function xi(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(l){return void n(l)}s.done?t(u):Promise.resolve(u).then(r,i)}function bi(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){xi(a,r,i,o,s,"next",e)}function s(e){xi(a,r,i,o,s,"throw",e)}o(void 0)}))}}function Si(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function wi(e){return wi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wi(e)}function Ci(e,t){if("object"!==wi(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==wi(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function ki(e){var t=Ci(e,"string");return"symbol"===wi(t)?t:String(t)}function Ai(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ki(r.key),r)}}function Ei(e,t,n){return t&&Ai(e.prototype,t),n&&Ai(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ti(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Mi(e,t){return Mi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Mi(e,t)}function Oi(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Mi(e,t)}function Li(e,t){if(t&&("object"===wi(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Ti(e)}function Pi(e){return Pi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Pi(e)}function Ri(e,t,n){return t=ki(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}_i(".l7-marker-container {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n}\n.l7-marker {\n  position: absolute !important;\n  top: 0;\n  left: 0;\n  z-index: 5;\n  cursor: pointer;\n}\n.l7-marker-cluster {\n  width: 40px;\n  height: 40px;\n  background-color: rgba(181, 226, 140, 0.6);\n  background-clip: padding-box;\n  border-radius: 20px;\n}\n.l7-marker-cluster div {\n  width: 30px;\n  height: 30px;\n  margin-top: 5px;\n  margin-left: 5px;\n  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n  text-align: center;\n  background-color: rgba(110, 204, 57, 0.6);\n  border-radius: 15px;\n}\n.l7-marker-cluster span {\n  line-height: 30px;\n}\n.l7-touch .l7-control-attribution,\n.l7-touch .l7-control-layers,\n.l7-touch .l7-bar {\n  -webkit-box-shadow: none;\n          box-shadow: none;\n}\n.l7-touch .l7-control-layers,\n.l7-touch .l7-bar {\n  background-clip: padding-box;\n  border: 2px solid rgba(0, 0, 0, 0.2);\n}\n.mapboxgl-ctrl-logo,\n.amap-logo {\n  display: none !important;\n}\n.l7-select-box {\n  border: 3px dashed gray;\n  border-radius: 2px;\n  position: absolute;\n  z-index: 1000;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n}\n.l7-control-container {\n  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;\n}\n.l7-control-container .l7-control {\n  position: relative;\n  z-index: 800;\n  float: left;\n  clear: both;\n  color: #595959;\n  font-size: 12px;\n  pointer-events: visiblePainted;\n  /* IE 9-10 doesn't have auto */\n  pointer-events: auto;\n}\n.l7-control-container .l7-control.l7-control--hide {\n  display: none;\n}\n.l7-control-container .l7-top {\n  top: 0;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  position: absolute;\n  z-index: 1000;\n  pointer-events: none;\n}\n.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {\n  margin-top: 8px;\n}\n.l7-control-container .l7-right {\n  right: 0;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  position: absolute;\n  z-index: 1000;\n  pointer-events: none;\n}\n.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {\n  margin-right: 8px;\n}\n.l7-control-container .l7-bottom {\n  bottom: 0;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  position: absolute;\n  z-index: 1000;\n  pointer-events: none;\n}\n.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {\n  margin-bottom: 8px;\n}\n.l7-control-container .l7-left {\n  left: 0;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  position: absolute;\n  z-index: 1000;\n  pointer-events: none;\n}\n.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {\n  margin-left: 8px;\n}\n.l7-control-container .l7-center {\n  position: absolute;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n}\n.l7-control-container .l7-center.l7-top,\n.l7-control-container .l7-center.l7-bottom {\n  width: 100%;\n}\n.l7-control-container .l7-center.l7-left,\n.l7-control-container .l7-center.l7-right {\n  height: 100%;\n}\n.l7-control-container .l7-center .l7-control {\n  margin-right: 8px;\n  margin-bottom: 8px;\n}\n.l7-control-container .l7-row {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: row;\n          flex-direction: row;\n}\n.l7-control-container .l7-row.l7-top {\n  -webkit-box-align: start;\n      -ms-flex-align: start;\n          align-items: flex-start;\n}\n.l7-control-container .l7-row.l7-bottom {\n  -webkit-box-align: end;\n      -ms-flex-align: end;\n          align-items: flex-end;\n}\n.l7-control-container .l7-column {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.l7-control-container .l7-column.l7-left {\n  -webkit-box-align: start;\n      -ms-flex-align: start;\n          align-items: flex-start;\n}\n.l7-control-container .l7-column.l7-right {\n  -webkit-box-align: end;\n      -ms-flex-align: end;\n          align-items: flex-end;\n}\n.l7-button-control {\n  min-width: 28px;\n  height: 28px;\n  background-color: #fff;\n  border-width: 0;\n  border-radius: 2px;\n  outline: 0;\n  cursor: pointer;\n  -webkit-transition: all 0.2s;\n  transition: all 0.2s;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  padding: 0 6px;\n  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n  line-height: 16px;\n}\n.l7-button-control .l7-iconfont {\n  fill: #595959;\n  color: #595959;\n  width: 16px;\n  height: 16px;\n}\n.l7-button-control.l7-button-control--row {\n  padding: 0 16px 0 13px;\n}\n.l7-button-control.l7-button-control--row * + .l7-button-control__text {\n  margin-left: 8px;\n}\n.l7-button-control.l7-button-control--column {\n  height: 44px;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.l7-button-control.l7-button-control--column .l7-iconfont {\n  margin-top: 3px;\n}\n.l7-button-control.l7-button-control--column .l7-button-control__text {\n  margin-top: 3px;\n  font-size: 10px;\n  -webkit-transform: scale(0.83333);\n          transform: scale(0.83333);\n}\n.l7-button-control:not(:disabled):hover {\n  background-color: #f3f3f3;\n}\n.l7-button-control:not(:disabled):active {\n  background-color: #f3f3f3;\n}\n.l7-button-control:disabled {\n  background-color: #fafafa;\n  color: #bdbdbd;\n  cursor: not-allowed;\n}\n.l7-button-control:disabled .l7-iconfont {\n  fill: #bdbdbd;\n  color: #bdbdbd;\n}\n.l7-button-control:disabled:hover {\n  background-color: #fafafa;\n}\n.l7-button-control:disabled:active {\n  background-color: #fafafa;\n}\n.l7-popper {\n  position: absolute;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  z-index: 5;\n  color: #595959;\n}\n.l7-popper.l7-popper-hide {\n  display: none;\n}\n.l7-popper .l7-popper-content {\n  min-height: 28px;\n  background: #fff;\n  border-radius: 2px;\n  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n}\n.l7-popper .l7-popper-arrow {\n  width: 0;\n  height: 0;\n  border-width: 4px;\n  border-style: solid;\n  border-top-color: transparent;\n  border-bottom-color: transparent;\n  border-left-color: transparent;\n  border-right-color: transparent;\n  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n}\n.l7-popper.l7-popper-left {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: row;\n          flex-direction: row;\n}\n.l7-popper.l7-popper-left .l7-popper-arrow {\n  border-left-color: #fff;\n  margin: 10px 0;\n}\n.l7-popper.l7-popper-right {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: reverse;\n      -ms-flex-direction: row-reverse;\n          flex-direction: row-reverse;\n}\n.l7-popper.l7-popper-right .l7-popper-arrow {\n  border-right-color: #fff;\n  margin: 10px 0;\n}\n.l7-popper.l7-popper-top {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.l7-popper.l7-popper-top .l7-popper-arrow {\n  border-top-color: #fff;\n  margin: 0 10px;\n}\n.l7-popper.l7-popper-bottom {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: reverse;\n      -ms-flex-direction: column-reverse;\n          flex-direction: column-reverse;\n}\n.l7-popper.l7-popper-bottom .l7-popper-arrow {\n  border-bottom-color: #fff;\n  margin: 0 10px;\n}\n.l7-popper.l7-popper-start {\n  -webkit-box-align: start;\n      -ms-flex-align: start;\n          align-items: flex-start;\n}\n.l7-popper.l7-popper-end {\n  -webkit-box-align: end;\n      -ms-flex-align: end;\n          align-items: flex-end;\n}\n.l7-select-control--normal {\n  padding: 4px 0;\n}\n.l7-select-control--normal .l7-select-control-item {\n  height: 24px;\n  line-height: 24px;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  padding: 0 16px;\n  font-size: 12px;\n}\n.l7-select-control--normal .l7-select-control-item > * + * {\n  margin-left: 6px;\n}\n.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {\n  height: 14px;\n  width: 14px;\n}\n.l7-select-control--normal .l7-select-control-item:hover {\n  background-color: #f3f3f3;\n}\n.l7-select-control--image {\n  padding: 12px 12px 0 12px;\n  width: 474px;\n  height: 320px;\n  overflow: auto;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-wrap: wrap;\n      flex-wrap: wrap;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  -webkit-box-align: start;\n      -ms-flex-align: start;\n          align-items: flex-start;\n}\n.l7-select-control--image .l7-select-control-item {\n  margin-right: 12px;\n  border-radius: 2px;\n  overflow: hidden;\n  border: 1px solid #fff;\n  -webkit-box-sizing: content-box;\n          box-sizing: content-box;\n  width: calc((100% - 36px) / 3);\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  margin-bottom: 12px;\n  position: relative;\n  font-size: 12px;\n}\n.l7-select-control--image .l7-select-control-item img {\n  width: 142px;\n  height: 80px;\n}\n.l7-select-control--image .l7-select-control-item input[type='checkbox'] {\n  position: absolute;\n  right: 0;\n  top: 0;\n}\n.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  line-height: 26px;\n}\n.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {\n  margin-left: 8px;\n}\n.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {\n  border-color: #0370fe;\n}\n.l7-select-control--image .l7-select-control-item:nth-child(3n) {\n  margin-right: 0;\n}\n.l7-select-control-item {\n  cursor: pointer;\n}\n.l7-select-control-item input[type='checkbox'] {\n  margin: 0;\n  cursor: pointer;\n}\n.l7-select-control--multiple .l7-select-control-item:hover {\n  background-color: transparent;\n}\n.l7-control-logo {\n  width: 89px;\n  height: 16px;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n}\n.l7-control-logo img {\n  height: 100%;\n  width: 100%;\n}\n.l7-control-logo .l7-control-logo-link {\n  display: block;\n  cursor: pointer;\n}\n.l7-control-logo .l7-control-logo-link img {\n  cursor: pointer;\n}\n.l7-control-mouse-location {\n  background-color: #fff;\n  border-radius: 2px;\n  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n  padding: 2px 4px;\n  min-width: 130px;\n}\n.l7-control-zoom {\n  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n  border-radius: 2px;\n  overflow: hidden;\n}\n.l7-control-zoom .l7-button-control {\n  -webkit-box-shadow: 0 0 0;\n          box-shadow: 0 0 0;\n  border-radius: 0;\n  font-size: 16px;\n}\n.l7-control-zoom .l7-button-control .l7-iconfont {\n  width: 14px;\n  height: 14px;\n}\n.l7-control-zoom .l7-button-control:first-child {\n  border-bottom: 1px solid #f0f0f0;\n}\n.l7-control-scale {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.l7-control-scale .l7-control-scale-line {\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  padding: 2px 5px 1px;\n  overflow: hidden;\n  color: #595959;\n  font-size: 10px;\n  line-height: 1.1;\n  white-space: nowrap;\n  background: #fff;\n  border: 2px solid #000;\n  border-top: 0;\n  -webkit-transition: width 0.1s;\n  transition: width 0.1s;\n}\n.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {\n  margin-top: -2px;\n  border-top: 2px solid #777;\n  border-bottom: none;\n}\n.l7-right .l7-control-scale {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: end;\n      -ms-flex-align: end;\n          align-items: flex-end;\n}\n.l7-right .l7-control-scale .l7-control-scale-line {\n  text-align: right;\n}\n.l7-popup {\n  position: absolute;\n  top: 0;\n  left: 0;\n  z-index: 5;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  will-change: transform;\n  pointer-events: none;\n}\n.l7-popup.l7-popup-hide {\n  display: none;\n}\n.l7-popup .l7-popup-content {\n  position: relative;\n  padding: 16px;\n  font-size: 14px;\n  background: #fff;\n  border-radius: 3px;\n  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n}\n.l7-popup .l7-popup-content .l7-popup-content__title {\n  margin-bottom: 8px;\n  font-weight: bold;\n}\n.l7-popup .l7-popup-content .l7-popup-close-button,\n.l7-popup .l7-popup-content .l7-popup-content__title,\n.l7-popup .l7-popup-content .l7-popup-content__panel {\n  white-space: normal;\n  -webkit-user-select: text;\n     -moz-user-select: text;\n      -ms-user-select: text;\n          user-select: text;\n  pointer-events: initial;\n}\n.l7-popup .l7-popup-content .l7-popup-close-button {\n  position: absolute;\n  top: 0;\n  right: 0;\n  width: 18px;\n  height: 18px;\n  padding: 0;\n  font-size: 14px;\n  line-height: 18px;\n  text-align: center;\n  background-color: transparent;\n  border: 0;\n  border-radius: 0 3px 0 0;\n  cursor: pointer;\n}\n.l7-popup .l7-popup-tip {\n  position: relative;\n  z-index: 1;\n  width: 0;\n  height: 0;\n  border: 10px solid transparent;\n}\n.l7-popup.l7-popup-anchor-bottom,\n.l7-popup.l7-popup-anchor-bottom-left,\n.l7-popup.l7-popup-anchor-bottom-right {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: reverse;\n      -ms-flex-direction: column-reverse;\n          flex-direction: column-reverse;\n}\n.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,\n.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,\n.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {\n  bottom: 1px;\n}\n.l7-popup.l7-popup-anchor-top,\n.l7-popup.l7-popup-anchor-top-left,\n.l7-popup.l7-popup-anchor-top-right {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.l7-popup.l7-popup-anchor-top .l7-popup-tip,\n.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,\n.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {\n  top: 1px;\n}\n.l7-popup.l7-popup-anchor-left {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: row;\n          flex-direction: row;\n}\n.l7-popup.l7-popup-anchor-right {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: reverse;\n      -ms-flex-direction: row-reverse;\n          flex-direction: row-reverse;\n}\n.l7-popup-anchor-top .l7-popup-tip {\n  position: relative;\n  -webkit-align-self: center;\n  -ms-flex-item-align: center;\n      align-self: center;\n  border-top: none;\n  border-bottom-color: #fff;\n}\n.l7-popup-anchor-top-left .l7-popup-tip {\n  -webkit-align-self: flex-start;\n  -ms-flex-item-align: start;\n      align-self: flex-start;\n  border-top: none;\n  border-bottom-color: #fff;\n  border-left: none;\n}\n.l7-popup-anchor-top-right .l7-popup-tip {\n  -webkit-align-self: flex-end;\n  -ms-flex-item-align: end;\n      align-self: flex-end;\n  border-top: none;\n  border-right: none;\n  border-bottom-color: #fff;\n}\n.l7-popup-anchor-bottom .l7-popup-tip {\n  -webkit-align-self: center;\n  -ms-flex-item-align: center;\n      align-self: center;\n  border-top-color: #fff;\n  border-bottom: none;\n}\n.l7-popup-anchor-bottom-left .l7-popup-tip {\n  -webkit-align-self: flex-start;\n  -ms-flex-item-align: start;\n      align-self: flex-start;\n  border-top-color: #fff;\n  border-bottom: none;\n  border-left: none;\n}\n.l7-popup-anchor-bottom-right .l7-popup-tip {\n  -webkit-align-self: flex-end;\n  -ms-flex-item-align: end;\n      align-self: flex-end;\n  border-top-color: #fff;\n  border-right: none;\n  border-bottom: none;\n}\n.l7-popup-anchor-left .l7-popup-tip {\n  -webkit-align-self: center;\n  -ms-flex-item-align: center;\n      align-self: center;\n  border-right-color: #fff;\n  border-left: none;\n}\n.l7-popup-anchor-right .l7-popup-tip {\n  right: 1px;\n  -webkit-align-self: center;\n  -ms-flex-item-align: center;\n      align-self: center;\n  border-right: none;\n  border-left-color: #fff;\n}\n.l7-popup-anchor-top-left .l7-popup-content {\n  border-top-left-radius: 0;\n}\n.l7-popup-anchor-top-right .l7-popup-content {\n  border-top-right-radius: 0;\n}\n.l7-popup-anchor-bottom-left .l7-popup-content {\n  border-bottom-left-radius: 0;\n}\n.l7-popup-anchor-bottom-right .l7-popup-content {\n  border-bottom-right-radius: 0;\n}\n.l7-popup-track-pointer {\n  display: none;\n}\n.l7-popup-track-pointer * {\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n  pointer-events: none;\n}\n.l7-map:hover .l7-popup-track-pointer {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n}\n.l7-map:active .l7-popup-track-pointer {\n  display: none;\n}\n.l7-layer-popup__row {\n  font-size: 12px;\n}\n.l7-layer-popup__row + .l7-layer-popup__row {\n  margin-top: 4px;\n}\n");var Ii,Di=n(41555),zi=n.n(Di);function Ni(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Fi(e){if(Array.isArray(e))return Ni(e)}function ji(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function Bi(e,t){if(e){if("string"===typeof e)return Ni(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ni(e,t):void 0}}function Ui(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Vi(e){return Fi(e)||ji(e)||Bi(e)||Ui()}function Gi(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}function Hi(e,t){if(null==e)return{};var n,r,i=Gi(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function Wi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Yi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Wi(Object(n),!0).forEach((function(t){Ri(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Wi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function qi(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function Zi(e,t,n,r,i){var a={};return Object.keys(r).forEach((function(e){a[e]=r[e]})),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),a),i&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}var Ki=(Ii={},Ri(Ii,yt.h0.additive,{enable:!0,func:{srcRGB:yt.gl.ONE,dstRGB:yt.gl.ONE,srcAlpha:1,dstAlpha:1}}),Ri(Ii,yt.h0.none,{enable:!1}),Ri(Ii,yt.h0.normal,{enable:!0,func:{srcRGB:yt.gl.SRC_ALPHA,dstRGB:yt.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),Ri(Ii,yt.h0.subtractive,{enable:!0,func:{srcRGB:yt.gl.ONE,dstRGB:yt.gl.ONE,srcAlpha:yt.gl.ZERO,dstAlpha:yt.gl.ONE_MINUS_SRC_COLOR},equation:{rgb:yt.gl.FUNC_SUBTRACT,alpha:yt.gl.FUNC_SUBTRACT}}),Ri(Ii,yt.h0.max,{enable:!0,func:{srcRGB:yt.gl.ONE,dstRGB:yt.gl.ONE},equation:{rgb:yt.gl.MAX_EXT}}),Ri(Ii,yt.h0.min,{enable:!0,func:{srcRGB:yt.gl.ONE,dstRGB:yt.gl.ONE},equation:{rgb:yt.gl.MIN_EXT}}),Ii),Xi=n(14479);function Qi(e,t){var n=[t[0]-e[0],t[1]-e[1]],r=(0,Ue.Fv)(n),i=[e[0]+1e-4*r[0],e[1]+1e-4*r[1]];return i}function Ji(e,t,n){if(e.length>0&&t.version===Xi.G["GAODE2.x"]){var r=n.coordCenter;e[0].coordinates[0],e.filter((function(e){return!e.originCoordinates})).map((function(e){e.version=Xi.G["GAODE2.x"],e.originCoordinates=(0,Zt.cloneDeep)(e.coordinates),e.coordinates=t.coordToAMap2RelativeCoordinates(e.coordinates,r)}))}}function $i(e,t){e.length>0&&t.version===Xi.G.SIMPLE&&e.map((function(e){e.simpleCoordinate||(e.coordinates=ea(e.coordinates,t),e.simpleCoordinate=!0)}))}function ea(e,t){if("number"===typeof e[0])return t.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var n=[];return e.map((function(e){var r=[];e.map((function(e){r.push(t.simpleMapCoord.unproject(e))})),n.push(r)})),n}var r=[];return e.map((function(e){r.push(t.simpleMapCoord.unproject(e))})),r}function ta(e,t){var n;if(!e.scale)return[];var r=(null===e||void 0===e||null===(n=e.scale)||void 0===n?void 0:n.scalers)||[],i=[];r.forEach((function(n){var r,a=n.field;(t.hasOwnProperty(a)||"variable"===(null===(r=e.scale)||void 0===r?void 0:r.type))&&i.push(t[a])}));var a=e.mapping?e.mapping(i):[];return a}function na(e,t,n,r,i){var a=null===i||void 0===i?void 0:i.getLayerConfig(),o=a.arrow,s=void 0===o?{enable:!1}:o,u=t.map((function(t){var r={id:t._id,coordinates:t.coordinates};if(e.filter((function(e){return void 0!==e.scale})).forEach((function(e){var i=ta(e,t);e.needRemapping=!1,"color"===e.name&&(i=i.map((function(e){return(0,Ue.CI)(e)}))),r[e.name]=Array.isArray(i)&&1===i.length?i[0]:i,"shape"===e.name&&(r.shape=n.getIconFontKey(r[e.name]))})),"line"===r.shape&&s.enable){var i=r.coordinates,a=Qi(i[0],i[1]);r.coordinates.splice(1,0,a,a)}return r}));return Ji(u,r,i),$i(u,r),u}function ra(e,t,n,r,i,a){var o=new Mn(i,a),s=r.getLayerStyleAttributes()||[],u=o.data.dataArray,l=u,c=na(s,l,t,n,e);return o.destroy(),c}function ia(e){if(Array.isArray(e))return e}function aa(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(c){l=!0,i=c}finally{try{if(!u&&null!=n["return"]&&(o=n["return"](),Object(o)!==o))return}finally{if(l)throw i}}return s}}function oa(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function sa(e,t){return ia(e)||aa(e,t)||Bi(e,t)||oa()}function ua(e){return e.map((function(e){return"string"===typeof e&&(e=[e,{}]),e}))}function la(e,t,n,r){var i=e.multiPassRenderer,a=e.getLayerConfig(),o=a.enableTAA;return o?i.add(r("taa")):i.add(r("render")),ua(t).forEach((function(e){var t=sa(e,2),r=t[0],a=t[1];i.add(n(r),a)})),i.add(n("copy")),i}var ca,fa,ha,pa=function(){function e(t){Si(this,e),this.layer=t}return Ei(e,[{key:"pickRender",value:function(e){var t=this.layer.getContainer(),n=t.get(yt.vK.ILayerService),r=this.layer;if(r.tileLayer)return r.tileLayer.pickRender(e);r.hooks.beforePickingEncode.call(),n.renderTileLayerMask(r),r.renderModels({ispick:!0}),r.hooks.afterPickingEncode.call()}},{key:"pick",value:function(e,t){var n=this.layer.getContainer(),r=n.get(yt.vK.IPickingService);return"RasterLayer"===e.type?this.pickRasterLayer(e,t):(this.pickRender(t),r.pickFromPickingFBO(e,t))}},{key:"pickRasterLayer",value:function(e,t,n){var r=this.layer.getContainer(),i=r.get(yt.vK.IPickingService),a=r.get(yt.vK.IMapService),o=this.layer.getSource().extent,s=(0,Ue.if)(t.lngLat,o),u={x:t.x,y:t.y,type:t.type,lngLat:t.lngLat,target:t,rasterValue:null},l=n||e;if(s){var c=this.readRasterValue(e,o,a,t.x,t.y);return u.rasterValue=c,i.triggerHoverOnLayer(l,u),!0}return u.type="mousemove"===t.type?"mouseout":"un"+t.type,i.triggerHoverOnLayer(l,Yi(Yi({},u),{},{type:"unpick"})),i.triggerHoverOnLayer(l,u),!1}},{key:"readRasterValue",value:function(e,t,n,r,i){var a=e.getSource().data.dataArray[0],o=sa(t,4),s=o[0],u=void 0===s?0:s,l=o[1],c=void 0===l?0:l,f=o[2],h=void 0===f?10:f,p=o[3],d=void 0===p?-10:p,v=n.lngLatToContainer([u,c]),g=n.lngLatToContainer([h,d]),m=g.x-v.x,y=v.y-g.y,_=[(r-v.x)/m,(i-g.y)/y],x=a.width||1,b=a.height||1,S=Math.floor(_[0]*x),w=Math.floor(_[1]*b),C=Math.max(0,w-1)*x+S,k=a.data[C];return k}},{key:"selectFeature",value:function(e){var t=this.layer,n=sa(e,3),r=n[0],i=n[1],a=n[2];t.hooks.beforeSelect.call([r,i,a])}},{key:"highlightPickedFeature",value:function(e){var t=sa(e,3),n=t[0],r=t[1],i=t[2];this.layer.hooks.beforeHighlight.call([n,r,i])}},{key:"getFeatureById",value:function(e){return this.layer.getSource().getFeatureById(e)}}]),e}(),da=function(){function e(t){Si(this,e),this.layer=t;var n=this.layer.getContainer();this.rendererService=n.get(yt.vK.IRendererService)}return Ei(e,[{key:"getColorTexture",value:function(e,t){var n=this.getTextureKey(e,t);return this.key===n||(this.createColorTexture(e,t),this.key=n),this.colorTexture}},{key:"createColorTexture",value:function(e,t){var n=this.rendererService.createTexture2D,r=this.getColorRampBar(e,t),i=n({data:new Uint8Array(r.data),width:r.width,height:r.height,flipY:!1});return this.colorTexture=i,i}},{key:"setColorTexture",value:function(e,t,n){this.key=this.getTextureKey(t,n),this.colorTexture=e}},{key:"destroy",value:function(){var e;null===(e=this.colorTexture)||void 0===e||e.destroy()}},{key:"getColorRampBar",value:function(e,t){switch(e.type){case"cat":return(0,Ue.hj)(e);case"quantize":return(0,Ue.NJ)(e);case"custom":return(0,Ue.Oc)(e,t);case"linear":return(0,Ue.M4)(e,t);default:return(0,Ue.Cl)(e)}}},{key:"getTextureKey",value:function(e,t){var n;return"".concat(e.colors.join("_"),"_").concat(null===e||void 0===e||null===(n=e.positions)||void 0===n?void 0:n.join("_"),"_").concat(e.type,"_").concat(null===t||void 0===t?void 0:t.join("_"))}}]),e}(),va=["passes"],ga=["moduleName","vertexShader","fragmentShader","inject","triangulation","segmentNumber"];function ma(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=ya(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function ya(e,t){if(e){if("string"===typeof e)return _a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_a(e,t):void 0}}function _a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function xa(e){var t=ba();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function ba(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Sa,wa,Ca,ka=0,Aa=(ca=(0,yt.yT)(yt.vK.IGlobalConfigService),fa=function(e){Oi(n,e);var t=xa(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Si(this,n),e=t.call(this),Ri(Ti(e),"id","".concat(ka++)),Ri(Ti(e),"name","".concat(ka)),Ri(Ti(e),"visible",!0),Ri(Ti(e),"zIndex",0),Ri(Ti(e),"inited",!1),Ri(Ti(e),"layerModelNeedUpdate",!1),Ri(Ti(e),"pickedFeatureID",null),Ri(Ti(e),"selectedFeatureID",null),Ri(Ti(e),"styleNeedUpdate",!1),Ri(Ti(e),"forceRender",!1),Ri(Ti(e),"clusterZoom",0),Ri(Ti(e),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),Ri(Ti(e),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),Ri(Ti(e),"hooks",{init:new Wt.S$,afterInit:new Wt.oI,beforeRender:new Wt.oI,beforeRenderData:new Wt.bf,afterRender:new Wt.ni,beforePickingEncode:new Wt.ni,afterPickingEncode:new Wt.ni,beforeHighlight:new Wt.ni(["pickedColor"]),afterHighlight:new Wt.ni,beforeSelect:new Wt.ni(["pickedColor"]),afterSelect:new Wt.ni,beforeDestroy:new Wt.ni,afterDestroy:new Wt.ni}),Ri(Ti(e),"models",[]),Ri(Ti(e),"startInit",!1),Ri(Ti(e),"layerChildren",[]),Ri(Ti(e),"masks",[]),qi(Ti(e),"configService",ha,Ti(e)),Ri(Ti(e),"animateOptions",{enable:!1}),Ri(Ti(e),"currentPickId",null),Ri(Ti(e),"encodeStyleAttribute",{}),Ri(Ti(e),"enableShaderEncodeStyles",[]),Ri(Ti(e),"enableDataEncodeStyles",[]),Ri(Ti(e),"enablg",[]),Ri(Ti(e),"pendingStyleAttributes",[]),Ri(Ti(e),"scaleOptions",{}),Ri(Ti(e),"animateStatus",!1),Ri(Ti(e),"isDestroyed",!1),Ri(Ti(e),"encodeDataLength",0),Ri(Ti(e),"sourceEvent",(function(){e.dataState.dataSourceNeedUpdate=!0;var t=e.getLayerConfig();t&&t.autoFit&&e.fitBounds(t.fitBoundsOptions);var n=e.layerSource.getSourceCfg().autoRender;n&&e.reRender()})),e.name=r.name||e.id,e.zIndex=r.zIndex||0,e.rawConfig=r,e}return Ei(n,[{key:"addMask",value:function(e){this.masks.push(e),this.enableMask()}},{key:"removeMask",value:function(e){var t=this.masks.indexOf(e);t>-1&&this.masks.splice(t,1)}},{key:"disableMask",value:function(){this.updateLayerConfig({enableMask:!1})}},{key:"enableMask",value:function(){this.updateLayerConfig({enableMask:!0})}},{key:"addMaskLayer",value:function(e){this.masks.push(e)}},{key:"removeMaskLayer",value:function(e){var t=this.masks.indexOf(e);t>-1&&this.masks.splice(t,1),e.destroy()}},{key:"getAttribute",value:function(e){return this.styleAttributeService.getLayerStyleAttribute(e)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(e){var t=this;if(Object.keys(e).map((function(n){n in t.rawConfig&&(t.rawConfig[n]=e[n])})),this.startInit){var n=this.container.get(yt.vK.SceneID);this.configService.setLayerConfig(n,this.id,Yi(Yi(Yi({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),e)),this.needUpdateConfig={}}else this.needUpdateConfig=Yi(Yi({},this.needUpdateConfig),e)}},{key:"setContainer",value:function(e,t){this.container=e,this.sceneContainer=t}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(e){return this.plugins.push(e),this}},{key:"init",value:function(){var e=bi(zi().mark((function e(){var t,n,r,i,a,o,s,u=this;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=this.container.get(yt.vK.SceneID),this.startInit=!0,this.configService.setLayerConfig(t,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(yt.vK.IIconService),this.fontService=this.container.get(yt.vK.IFontService),this.rendererService=this.container.get(yt.vK.IRendererService),this.layerService=this.container.get(yt.vK.ILayerService),this.debugService=this.container.get(yt.vK.IDebugService),this.interactionService=this.container.get(yt.vK.IInteractionService),this.pickingService=this.container.get(yt.vK.IPickingService),this.mapService=this.container.get(yt.vK.IMapService),n=this.getLayerConfig(),r=n.enableMultiPassRenderer,i=n.passes,r&&null!==i&&void 0!==i&&i.length&&i.length>0&&this.mapService.on("mapAfterFrameChange",(function(){u.renderLayers()})),this.cameraService=this.container.get(yt.vK.ICameraService),this.coordinateService=this.container.get(yt.vK.ICoordinateSystemService),this.shaderModuleService=this.container.get(yt.vK.IShaderModuleService),this.postProcessingPassFactory=this.container.get(yt.vK.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(yt.vK.IFactoryNormalPass),this.styleAttributeService=this.container.get(yt.vK.IStyleAttributeService),r&&(this.multiPassRenderer=this.container.get(yt.vK.IMultiPassRenderer),this.multiPassRenderer.setLayer(this)),this.pendingStyleAttributes.forEach((function(e){var t=e.attributeName,n=e.attributeField,r=e.attributeValues,i=e.updateOptions;u.styleAttributeService.updateStyleAttribute(t,{scale:Yi({field:n},u.splitValuesAndCallbackInAttribute(r,u.getLayerConfig()[t]))},i)})),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(yt.vK.ILayerPlugin),a=ma(this.plugins);try{for(a.s();!(o=a.n()).done;)s=o.value,s.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}catch(l){a.e(l)}finally{a.f()}return this.layerPickService=new pa(this),this.textureService=new da(this),this.log(yt.Or.LayerInitStart),e.next=31,this.hooks.init.promise();case 31:this.log(yt.Or.LayerInitEnd),this.inited=!0,this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this.hooks.afterInit.call();case 36:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"log",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"init";if(!this.tileLayer&&!this.isTileLayer){var r="".concat(this.id,".").concat(n,".").concat(e),i={id:this.id,type:this.type};null===(t=this.debugService)||void 0===t||t.log(r,i)}}},{key:"updateModelData",value:function(e){e.attributes&&e.elements?this.models.map((function(t){t.updateAttributesAndElements(e.attributes,e.elements)})):console.warn("data error")}},{key:"createModelData",value:function(e,t){var n;if(null!==(n=this.layerModel)&&void 0!==n&&n.createModelData)return this.layerModel.createModelData(t);var r=this.calculateEncodeData(e,t),i=this.triangulation;return r&&i?this.styleAttributeService.createAttributesAndIndices(r,i):{attributes:void 0,elements:void 0}}},{key:"setLayerPickService",value:function(e){this.layerPickService=e}},{key:"calculateEncodeData",value:function(e,t){return this.inited?ra(this,this.fontService,this.mapService,this.styleAttributeService,e,t):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){0!==Object.keys(this.needUpdateConfig||{}).length&&this.updateLayerConfig({});var e=this.getLayerConfig(),t=e.animateOption;null!==t&&void 0!==t&&t.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}},{key:"color",value:function(e,t,n){return this.updateStyleAttribute("color",e,t,n),this}},{key:"texture",value:function(e,t,n){return this.updateStyleAttribute("texture",e,t,n),this}},{key:"rotate",value:function(e,t,n){return this.updateStyleAttribute("rotate",e,t,n),this}},{key:"size",value:function(e,t,n){return this.updateStyleAttribute("size",e,t,n),this}},{key:"filter",value:function(e,t,n){var r=this.updateStyleAttribute("filter",e,t,n);return this.dataState.dataSourceNeedUpdate=r&&this.inited,this}},{key:"shape",value:function(e,t,n){this.shapeOption={field:e,values:t};var r=this.updateStyleAttribute("shape",e,t,n);return this.dataState.dataSourceNeedUpdate=r&&this.inited,this}},{key:"label",value:function(e,t,n){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:e,attributeValues:t,updateOptions:n}),this}},{key:"animate",value:function(e){var t={};return(0,Zt.isObject)(e)?(t.enable=!0,t=Yi(Yi({},t),e)):t.enable=e,this.updateLayerConfig({animateOption:t}),this}},{key:"source",value:function(e,t){return"source"===(null===e||void 0===e?void 0:e.type)?(this.setSource(e),this):(this.sourceOption={data:e,options:t},this.clusterZoom=0,this)}},{key:"setData",value:function(e,t){var n=this;return this.inited?(this.log(yt.Or.SourceInitStart,yt.KD.UPDATE),this.layerSource.setData(e,t),this.log(yt.Or.SourceInitEnd,yt.KD.UPDATE)):this.on("inited",(function(){n.log(yt.Or.SourceInitStart,yt.KD.UPDATE);var r=n.getSource();r?n.layerSource.setData(e,t):n.source(new Mn(e,t)),n.layerSource.once("update",(function(){n.log(yt.Or.SourceInitEnd,yt.KD.UPDATE)}))})),this}},{key:"style",value:function(e){var t=this,n=e.passes,r=Hi(e,va);n&&ua(n).forEach((function(e){var n=t.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(e[0]);n&&n.updateOptions(e[1])}));var i=r;return Object.keys(r).forEach((function(e){var t=r[e];!Array.isArray(t)||2!==t.length||(0,Zt.isNumber)(t[0])||(0,Zt.isNumber)(t[1])||(i[e]={field:t[0],value:t[1]})})),this.encodeStyle(i),this.updateLayerConfig(i),this}},{key:"encodeStyle",value:function(e){var t=this;Object.keys(e).forEach((function(n){[t.enableShaderEncodeStyles].concat(Vi(t.enableDataEncodeStyles)).includes(n)&&(0,Zt.isPlainObject)(e[n])&&(e[n].field||e[n].value)&&!(0,Zt.isEqual)(t.encodeStyleAttribute[n],e[n])?(t.encodeStyleAttribute[n]=e[n],t.updateStyleAttribute(n,e[n].field,e[n].value),t.inited&&(t.dataState.dataMappingNeedUpdate=!0)):t.encodeStyleAttribute[n]&&(delete t.encodeStyleAttribute[n],t.dataState.dataSourceNeedUpdate=!0)}))}},{key:"scale",value:function(e,t){var n=Yi({},this.scaleOptions);if((0,Zt.isObject)(e)?this.scaleOptions=Yi(Yi({},this.scaleOptions),e):this.scaleOptions[e]=t,this.styleAttributeService&&!(0,Zt.isEqual)(n,this.scaleOptions)){var r=(0,Zt.isObject)(e)?e:Ri({},e,t);this.styleAttributeService.updateScaleAttribute(r)}return this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.reRender(),this.rendering=!1}},{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender||this.renderModels(e),this)}},{key:"renderMultiPass",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(this.encodeDataLength<=0)||this.forceRender){e.next=2;break}return e.abrupt("return");case 2:if(!this.multiPassRenderer||!this.multiPassRenderer.getRenderFlag()){e.next=7;break}return e.next=5,this.multiPassRenderer.render();case 5:e.next=8;break;case 7:this.multiPassRenderer,this.renderModels();case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"active",value:function(e){var t={};return t.enableHighlight=!!(0,Zt.isObject)(e)||e,(0,Zt.isObject)(e)?(t.enableHighlight=!0,e.color&&(t.highlightColor=e.color),e.mix&&(t.activeMix=e.mix)):t.enableHighlight=!!e,this.updateLayerConfig(t),this}},{key:"setActive",value:function(e,t){var n=this;if((0,Zt.isObject)(e)){var r=e.x,i=void 0===r?0:r,a=e.y,o=void 0===a?0:a;this.updateLayerConfig({highlightColor:(0,Zt.isObject)(t)?t.color:this.getLayerConfig().highlightColor,activeMix:(0,Zt.isObject)(t)?t.mix:this.getLayerConfig().activeMix}),this.pick({x:i,y:o})}else this.updateLayerConfig({pickedFeatureID:e,highlightColor:(0,Zt.isObject)(t)?t.color:this.getLayerConfig().highlightColor,activeMix:(0,Zt.isObject)(t)?t.mix:this.getLayerConfig().activeMix}),this.hooks.beforeHighlight.call((0,Ue.Z6)(e)).then((function(){setTimeout((function(){n.reRender()}),1)}))}},{key:"select",value:function(e){var t={};return t.enableSelect=!!(0,Zt.isObject)(e)||e,(0,Zt.isObject)(e)?(t.enableSelect=!0,e.color&&(t.selectColor=e.color),e.mix&&(t.selectMix=e.mix)):t.enableSelect=!!e,this.updateLayerConfig(t),this}},{key:"setSelect",value:function(e,t){var n=this;if((0,Zt.isObject)(e)){var r=e.x,i=void 0===r?0:r,a=e.y,o=void 0===a?0:a;this.updateLayerConfig({selectColor:(0,Zt.isObject)(t)?t.color:this.getLayerConfig().selectColor,selectMix:(0,Zt.isObject)(t)?t.mix:this.getLayerConfig().selectMix}),this.pick({x:i,y:o})}else this.updateLayerConfig({pickedFeatureID:e,selectColor:(0,Zt.isObject)(t)?t.color:this.getLayerConfig().selectColor,selectMix:(0,Zt.isObject)(t)?t.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call((0,Ue.Z6)(e)).then((function(){setTimeout((function(){n.reRender()}),1)}))}},{key:"setBlend",value:function(e){return this.updateLayerConfig({blend:e}),this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}},{key:"setIndex",value:function(e){return this.zIndex=e,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(e){this.currentPickId=e}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(e){this.selectedFeatureID=e}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var e=this.mapService.getZoom(),t=this.getLayerConfig(),n=t.visible,r=t.minZoom,i=void 0===r?-1/0:r,a=t.maxZoom,o=void 0===a?1/0:a;return!!n&&e>=i&&e<o}},{key:"setMultiPass",value:function(e,t){if(this.updateLayerConfig({enableMultiPassRenderer:e}),t&&this.updateLayerConfig({passes:t}),e){var n=this.getLayerConfig(),r=n.passes,i=void 0===r?[]:r;this.multiPassRenderer=la(this,i,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var a=this.rendererService.getViewportSize(),o=a.width,s=a.height;this.multiPassRenderer.resize(o,s)}return this}},{key:"setMinZoom",value:function(e){return this.updateLayerConfig({minZoom:e}),this}},{key:"getMinZoom",value:function(){var e=this.getLayerConfig(),t=e.minZoom;return t}},{key:"getMaxZoom",value:function(){var e=this.getLayerConfig(),t=e.maxZoom;return t}},{key:"get",value:function(e){var t=this.getLayerConfig();return t[e]}},{key:"setMaxZoom",value:function(e){return this.updateLayerConfig({maxZoom:e}),this}},{key:"setAutoFit",value:function(e){return this.updateLayerConfig({autoFit:e}),this}},{key:"fitBounds",value:function(e){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var t=this.getSource(),n=t.extent,r=n.some((function(e){return Math.abs(e)===1/0}));return r||this.mapService.fitBounds([[n[0],n[1]],[n[2],n[3]]],e),this}},{key:"destroy",value:function(){var e,t,n,r,i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!this.isDestroyed){this.layerChildren.map((function(e){return e.destroy(!1)})),this.layerChildren=[];var a=this.getLayerConfig(),o=a.maskfence;o&&(this.masks.map((function(e){return e.destroy(!1)})),this.masks=[]),this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),null===(e=this.multiPassRenderer)||void 0===e||e.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),null===(t=this.layerModel)||void 0===t||t.clearModels(i),null===(n=this.tileLayer)||void 0===n||n.destroy(),this.models=[],null===(r=this.debugService)||void 0===r||r.removeLog(this.id),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0}}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var e;this.models.forEach((function(e){return e.destroy()})),null===(e=this.layerModel)||void 0===e||e.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter((function(e){return e.needRescale||e.needRemapping||e.needRegenerateVertices})).length}},{key:"setSource",value:function(e){var t=this;if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=e,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var n=this.mapService.getZoom();this.layerSource.updateClusterData(n)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",(function(e){var n=e.type;if(void 0===t.coordCenter){var r,i=t.layerSource.center;t.coordCenter=i,null!==(r=t.mapService)&&void 0!==r&&r.setCoordCenter&&t.mapService.setCoordCenter(i)}if("update"===n){if(t.tileLayer)return void t.tileLayer.reload();t.sourceEvent()}}))}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(e){this.encodedData=e,this.encodeDataLength=e.length}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(e){return this.styleAttributeService.getLayerAttributeScale(e)}},{key:"getLegend",value:function(e){var t,n,r,i=this.styleAttributeService.getLayerStyleAttribute(e),a=(null===i||void 0===i||null===(t=i.scale)||void 0===t?void 0:t.scalers)||[];return{type:null===(n=a[0].option)||void 0===n?void 0:n.type,field:null===i||void 0===i||null===(r=i.scale)||void 0===r?void 0:r.field,items:this.getLegendItems(e)}}},{key:"getLegendItems",value:function(e){var t=this.styleAttributeService.getLayerAttributeScale(e);if(!t)return[];if(t.invertExtent){var n=t.range().map((function(n){return Ri({value:t.invertExtent(n)},e,n)}));return n}if(t.ticks){var r=t.ticks().map((function(n){return Ri({value:n},e,t(n))}));return r}if(null!==t&&void 0!==t&&t.domain){var i=t.domain().filter((function(e){return!(0,Zt.isUndefined)(e)})).map((function(n){return Ri({value:n},e,t(n))}));return i}return[]}},{key:"pick",value:function(e){var t=e.x,n=e.y;this.interactionService.triggerHover({x:t,y:n})}},{key:"boxSelect",value:function(e,t){this.pickingService.boxPickLayer(this,e,t)}},{key:"buildLayerModel",value:function(){var e=bi(zi().mark((function e(t){var n,r,i,a,o,s,u,l,c,f,h,p,d=this;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.moduleName,r=t.vertexShader,i=t.fragmentShader,a=t.inject,o=t.triangulation,s=t.segmentNumber,u=Hi(t,ga),this.shaderModuleService.registerModule(n,{vs:r,fs:i,inject:a}),l=this.shaderModuleService.getModule(n),c=l.vs,f=l.fs,h=l.uniforms,p=this.rendererService.createModel,e.abrupt("return",new Promise((function(e){var t=d.styleAttributeService.createAttributesAndIndices(d.encodedData,o,s),n=t.attributes,r=t.elements,i=t.count,a=Yi({attributes:n,uniforms:h,fs:f,vs:c,elements:r,blend:Ki[yt.h0.normal]},u);i&&(a.count=i);var l=p(a);e(l)})));case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"createAttributes",value:function(e){var t=e.triangulation,n=this.styleAttributeService.createAttributes(this.encodedData,t),r=n.attributes;return r}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(e){var t=this.getLayerConfig(),n=t.enableHighlight,r=void 0===n||n,i=t.enableSelect,a=void 0===i||i,o=-1!==this.eventNames().indexOf(e)||-1!==this.eventNames().indexOf("un"+e);return"click"!==e&&"dblclick"!==e||!a||(o=!0),"mousemove"!==e||!r&&-1===this.eventNames().indexOf("mouseenter")&&-1===this.eventNames().indexOf("unmousemove")&&-1===this.eventNames().indexOf("mouseout")||(o=!0),this.isVisible()&&o}},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"rebuildModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.buildModels();case 2:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"renderMulPass",value:function(){var e=bi(zi().mark((function e(t){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.render();case 2:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"renderModels",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.encodeDataLength<=0&&!this.forceRender?(this.clearModels(),this):(this.hooks.beforeRender.call(),this.models.forEach((function(n){n.draw({uniforms:e.layerModel.getUninforms(),blend:e.layerModel.getBlend(),stencil:e.layerModel.getStencil(t)},(null===t||void 0===t?void 0:t.ispick)||!1)})),this.hooks.afterRender.call(),this)}},{key:"updateStyleAttribute",value:function(e,t,n,r){var i=this.configService.getAttributeConfig(this.id)||{};return!(0,Zt.isEqual)(i[e],{field:t,values:n})&&(-1!==["color","size","texture","rotate","filter","label","shape"].indexOf(e)&&this.configService.setAttributeConfig(this.id,Ri({},e,{field:t,values:n})),this.startInit?this.styleAttributeService.updateStyleAttribute(e,{scale:Yi({field:t},this.splitValuesAndCallbackInAttribute(n,this.getLayerConfig()[t]))},r):this.pendingStyleAttributes.push({attributeName:e,attributeField:t,attributeValues:n,updateOptions:r}),!0)}},{key:"getLayerAttributeConfig",value:function(){return this.configService.getAttributeConfig(this.id)}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(e){console.warn("empty fn")}},{key:"processData",value:function(e){return e}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"initLayerModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.models.forEach((function(e){return e.destroy()})),this.models=[],e.next=4,this.layerModel.initModels();case 4:this.models=e.sent;case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"reRender",value:function(){this.inited&&this.layerService.reRender()}},{key:"splitValuesAndCallbackInAttribute",value:function(e,t){return{values:(0,Zt.isFunction)(e)?void 0:e||t,callback:(0,Zt.isFunction)(e)?e:void 0}}}]),n}(Yt.EventEmitter),ha=Zi(fa.prototype,"configService",[ca],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fa);function Ea(e,t){return{enable:e,mask:255,func:{cmp:yt.gl.EQUAL,ref:t?1:0,mask:1}}}function Ta(e){return e.maskOperation===yt.lE.OR?{enable:!0,mask:255,func:{cmp:yt.gl.ALWAYS,ref:1,mask:255},opFront:{fail:yt.gl.KEEP,zfail:yt.gl.REPLACE,zpass:yt.gl.REPLACE}}:{enable:!0,mask:255,func:{cmp:e.stencilType===yt.yn.SINGLE||0===e.stencilIndex?yt.gl.ALWAYS:yt.gl.LESS,ref:e.stencilType===yt.yn.SINGLE?1:0===e.stencilIndex?2:1,mask:255},opFront:{fail:yt.gl.KEEP,zfail:yt.gl.REPLACE,zpass:yt.gl.REPLACE}}}function Ma(e){switch(e){case"stroke":return{name:"stroke",type:yt.GC.Attribute,descriptor:{name:"a_Stroke",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:4,update:function(e){var t=e.stroke,n=void 0===t?[1,1,1,1]:t;return n}}};case"opacity":return{name:"opacity",type:yt.GC.Attribute,descriptor:{name:"a_Opacity",buffer:{usage:yt.gl.STATIC_DRAW,data:[],type:yt.gl.FLOAT},size:1,update:function(e){var t=e.opacity,n=void 0===t?1:t;return[n]}}};case"offsets":return{name:"offsets",type:yt.GC.Attribute,descriptor:{name:"a_Offsets",buffer:{usage:yt.gl.STATIC_DRAW,data:[],type:yt.gl.FLOAT},size:2,update:function(e){var t=e.offsets;return t}}};default:return}}var Oa=(Sa=(0,yt.yT)(yt.vK.IGlobalConfigService),wa=function(){function e(t){Si(this,e),Ri(this,"preStyleAttribute",{}),Ri(this,"encodeStyleAttribute",{}),qi(this,"configService",Ca,this),this.layer=t,this.rendererService=t.getContainer().get(yt.vK.IRendererService),this.pickingService=t.getContainer().get(yt.vK.IPickingService),this.shaderModuleService=t.getContainer().get(yt.vK.IShaderModuleService),this.styleAttributeService=t.getContainer().get(yt.vK.IStyleAttributeService),this.mapService=t.getContainer().get(yt.vK.IMapService),this.iconService=t.getContainer().get(yt.vK.IIconService),this.fontService=t.getContainer().get(yt.vK.IFontService),this.cameraService=t.getContainer().get(yt.vK.ICameraService),this.layerService=t.getContainer().get(yt.vK.ILayerService),this.registerStyleAttribute(),this.registerBuiltinAttributes(),this.startModelAnimate();var n=this.rendererService.createTexture2D;this.createTexture2D=n}return Ei(e,[{key:"getBlend",value:function(){var e=this.layer.getLayerConfig(),t=e.blend,n=void 0===t?"normal":t;return Ki[yt.h0[n]]}},{key:"getStencil",value:function(e){var t=this.layer.getLayerConfig(),n=t.mask,r=void 0!==n&&n,i=t.maskInside,a=void 0===i||i,o=t.enableMask,s=t.maskOperation,u=void 0===s?yt.lE.AND:s;if("MaskLayer"===this.layer.type)return Ta({isStencil:!0,stencilType:yt.yn.SINGLE});if(e.isStencil)return Ta(Yi(Yi({},e),{},{maskOperation:u}));var l=r||o&&0!==this.layer.masks.length||void 0!==this.layer.tileMask;return Ea(l,a)}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",!1);case 1:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(e){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.duration||4,e.interval||.2,e.trailLength||.1]}},{key:"startModelAnimate",value:function(){var e=this.layer.getLayerConfig(),t=e.animateOption;t.enable&&this.layer.setAnimateStartTime()}},{key:"getInject",value:function(){var e=this.layer.encodeStyleAttribute,t="",n={opacity:"float",stroke:"vec4",offsets:"vec2",textOffset:"vec2"};this.layer.enableShaderEncodeStyles.forEach((function(r){e[r]&&(t+="#define USE_ATTRIBUTE_".concat(r.toUpperCase()," 0.0; \n\n")),t+="\n          #ifdef USE_ATTRIBUTE_".concat(r.toUpperCase(),"\n      attribute ").concat(n[r]," a_").concat(r.charAt(0).toUpperCase()+r.slice(1),";\n    #else\n      uniform ").concat(n[r]," u_").concat(r,";\n    #endif\n\n    ")}));var r="";return this.layer.enableShaderEncodeStyles.forEach((function(e){r+="\n\n#ifdef USE_ATTRIBUTE_".concat(e.toUpperCase(),"\n  ").concat(n[e]," ").concat(e,"  = a_").concat(e.charAt(0).toUpperCase()+e.slice(1),";\n#else\n  ").concat(n[e]," ").concat(e," = u_").concat(e,";\n#endif\n\n")})),{"vs:#decl":t,"vs:#main-start":r}}},{key:"getStyleAttribute",value:function(){var e=this,t={},n={opacity:1,stroke:[1,0,0,1],offsets:[0,0]};return this.layer.enableShaderEncodeStyles.forEach((function(r){if(!e.layer.encodeStyleAttribute[r]){var i=e.layer.getLayerConfig()[r],a="undefined"===typeof i?n[r]:i;"stroke"===r&&(a=(0,Ue.CI)(a)),t["u_"+r]=a}})),t}},{key:"registerStyleAttribute",value:function(){var e=this;Object.keys(this.layer.encodeStyleAttribute).forEach((function(t){var n=Ma(t);n&&e.styleAttributeService.registerStyleAttribute(n)}))}},{key:"updateEncodeAttribute",value:function(e,t){this.encodeStyleAttribute[e]=t}}]),e}(),Ca=Zi(wa.prototype,"configService",[Sa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wa),La=function(e){return e[e["solid"]=0]="solid",e[e["dash"]=1]="dash",e}({}),Pa=function(e){return e["VERTICAL"]="vertical",e["HORIZONTAL"]="horizontal",e}({}),Ra=function(e){return e["NORMAL"]="normal",e["REPLACE"]="replace",e}({}),Ia=function(e){return e[e["pixel"]=0]="pixel",e[e["meter"]=1]="meter",e}({}),Da=function(e){return e["ALWAYS"]="always",e["DRAGEND"]="dragend",e}({});function za(e){var t=Na();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function Na(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Fa=function(e){Oi(n,e);var t=za(n);function n(){var e;Si(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Ri(Ti(e),"updateMode",Da.ALWAYS),Ri(Ti(e),"renderUpdate",(function(){var t=e.layer.getLayerConfig(),n=t.zIndex,r=void 0===n?10:n,i=t.update,a=void 0===i?Da.ALWAYS:i,o=t.animateOption,s=void 0===o?{enable:!1,duration:20}:o;+e.canvas.style.zIndex===r&&(e.canvas.style.zIndex=r+""),e.updateMode!==a&&(e.updateMode=a,e.unBindListener(),e.bindListener()),e.updateMode===Da.ALWAYS&&s.enable&&e.renderCanvas()})),Ri(Ti(e),"unBindListener",(function(){e.mapService.off("mapchange",e.renderCanvas),e.mapService.off("zoomstart",e.clearCanvas),e.mapService.off("zoomend",e.renderCanvas),e.mapService.off("movestart",e.clearCanvas),e.mapService.off("moveend",e.renderCanvas)})),Ri(Ti(e),"bindListener",(function(){e.updateMode===Da.ALWAYS?e.mapService.on("mapchange",e.renderCanvas):(e.mapService.on("zoomstart",e.clearCanvas),e.mapService.on("zoomend",e.renderCanvas),e.mapService.on("movestart",e.clearCanvas),e.mapService.on("moveend",e.renderCanvas))})),Ri(Ti(e),"clearCanvas",(function(){if(e.ctx){var t=e.rendererService.getViewportSize(),n=t.width,r=t.height;e.ctx.clearRect(0,0,n,r)}})),Ri(Ti(e),"renderCanvas",(function(){var t=e.rendererService.getViewportSize(),n=t.width,r=t.height;if(e.prevSize[0]!==n||e.prevSize[1]!==r){e.prevSize=[n,r];var i=e.mapService.getSize(),a=sa(i,2),o=a[0],s=a[1];e.canvas.width=n,e.canvas.height=r,e.canvas.style.width=o+"px",e.canvas.style.height=s+"px"}var u=e.layer.getLayerConfig(),l=u.drawingOnCanvas;e.ctx&&l({canvas:e.canvas,ctx:e.ctx,mapService:e.mapService,size:[n,r]})})),e}return Ei(n,[{key:"clearModels",value:function(){var e;this.canvas&&(null===(e=this.mapService.getContainer())||void 0===e||e.removeChild(this.canvas),this.canvas=null);this.unBindListener()}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){var t,n,r;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.update,r=void 0===n?Da.ALWAYS:n,this.updateMode=r,this.initCanvas(),this.renderCanvas(),this.bindListener(),this.mapService.getContainer(),e.abrupt("return",[]);case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"initCanvas",value:function(){var e,t=this.layer.getLayerConfig(),n=t.zIndex,r=this.mapService.getSize(),i=sa(r,2),a=i[0],o=i[1],s=this.rendererService.getViewportSize(),u=s.width,l=s.height;this.prevSize=[u,l];var c=document.createElement("canvas");this.canvas=c,c.width=u,c.height=l,c.style.pointerEvents="none",c.style.width=a+"px",c.style.height=o+"px",c.style.position="absolute",c.style.top="0",c.style.left="0",c.style.zIndex=n+"",null===(e=this.mapService.getContainer())||void 0===e||e.appendChild(c);var f=c.getContext("2d");this.ctx=f}},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){}}]),n}(Oa),ja={canvas:Fa},Ba=ja;function Ua(e){var t=Va();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function Va(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Ga=function(e){Oi(n,e);var t=Ua(n);function n(){var e;Si(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Ri(Ti(e),"type","CanvasLayer"),Ri(Ti(e),"forceRender",!0),e}return Ei(n,[{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new Ba[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"hide",value:function(){return this.layerModel.clearCanvas&&this.layerModel.clearCanvas(),this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"renderModels",value:function(){var e,t=this;return null!==this&&void 0!==this&&null!==(e=this.layerModel)&&void 0!==e&&e.renderUpdate&&this.layerModel.renderUpdate(),this.models.forEach((function(e){e.draw({uniforms:t.layerModel.getUninforms()},!1)})),this}},{key:"getDefaultConfig",value:function(){var e=this.getModelType(),t={canvas:{}};return t[e]}},{key:"getModelType",value:function(){return"canvas"}}]),n}(Aa),Ha=n(29502),Wa=n.n(Ha),Ya=n(70159),qa=n(66867),Za=100,Ka=36,Xa=40;function Qa(e){return e/180*Math.acos(-1)}function Ja(e){var t=Qa(e[0])+Math.PI/2,n=Qa(e[1]),r=Za+.4*Math.random(),i=r*Math.cos(n)*Math.cos(t),a=r*Math.cos(n)*Math.sin(t),o=r*Math.sin(n);return[a,o,i]}function $a(e,t){var n=Ya.create(),r=Ya.create(),i=qa.fromValues(0,1,0),a=qa.fromValues(0,0,0);t=t||{},e="undefined"!==typeof e?e:1;for(var o="undefined"!==typeof t.segments?t.segments:32,s=2+o,u=2*s,l=[],c=[],f=[],h=[],p=[],d=[],v=0;v<=s;v++){for(var g=v/s,m=g*Math.PI,y=0;y<=u;y++){var _=y/u,x=_*Math.PI*2;Ya.identity(r),Ya.rotateZ(r,r,-m),Ya.identity(n),Ya.rotateY(n,n,x),qa.transformMat4(a,i,r),qa.transformMat4(a,a,n),qa.scale(a,a,-e),f.push(a.slice()),h.push.apply(h,Vi(a.slice())),qa.normalize(a,a),p.push.apply(p,Vi(a.slice())),d.push([_,1-g]),h.push(_,1-g)}if(v>0)for(var b=f.length,S=b-2*(u+1);S+u+2<b;S++)l.push([S,S+1,S+u+1]),c.push(S,S+1,S+u+1),l.push([S+u+1,S+1,S+u+2]),c.push(S+u+1,S+1,S+u+2)}return{cells:l,positions:f,uvs:d,positionsArr:h,indicesArr:c,normalArr:p}}var eo=n(15730),to=eo.Ue(),no=(eo.Ue(),eo.Ue()),ro=eo.Ue(),io=eo.Ue();function ao(e,t,n,r,i){eo.IH(e,n,r),eo.Fv(e,e),t=eo.al(-e[1],e[0]);var a=eo.al(-n[1],n[0]);return[i/eo.AK(t,a),t]}function oo(e,t){return eo.t8(e,-t[1],t[0])}function so(e,t,n){return eo.lu(e,t,n),eo.Fv(e,e),e}function uo(e,t){return e[0]===t[0]&&e[1]===t[1]}var lo,co=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Si(this,e),Ri(this,"lastFlip",-1),Ri(this,"miter",eo.al(0,0)),Ri(this,"started",!1),Ri(this,"dash",!1),Ri(this,"totalDistance",0),Ri(this,"currentIndex",0),this.join=t.join||"miter",this.cap=t.cap||"butt",this.miterLimit=t.miterLimit||10,this.thickness=t.thickness||1,this.dash=t.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return Ei(e,[{key:"simpleExtrude",value:function(e){var t=this.complex;if(e.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=e.length,r=t.startIndex,i=1;i<n;i++){var a=e[i-1],o=e[i],s=i<e.length-1?e[i+1]:null,u=this.simpleSegment(t,r,a,o,s);r+=u}if(this.dash)for(var l=0;l<t.positions.length/6;l++)t.positions[6*l+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"simpleExtrude_gaode2",value:function(e,t){var n=this.complex;if(e.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=e.length,i=n.startIndex,a=1;a<r;a++){var o,s,u,l=e[a-1];l.push(null!==(o=t[a-1][2])&&void 0!==o?o:0);var c=t[a-1],f=e[a];f.push(null!==(s=t[a][2])&&void 0!==s?s:0);var h=t[a],p=a<e.length-1?[].concat(Vi(e[a+1]),[null!==(u=t[a+1][2])&&void 0!==u?u:0]):null,d=a<t.length-1?t[a+1]:null,v=this.simpleSegment(n,i,l,f,p,c,h,d);i+=v}if(this.dash)for(var g=0;g<n.positions.length/6;g++)n.positions[6*g+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"extrude_gaode2",value:function(e,t){var n=this.complex;if(e.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=e.length,i=n.startIndex,a=1;a<r;a++){var o,s,u,l=e[a-1];l.push(null!==(o=t[a-1][2])&&void 0!==o?o:0);var c=t[a-1],f=e[a];f.push(null!==(s=t[a][2])&&void 0!==s?s:0);var h=t[a],p=a<e.length-1?[].concat(Vi(e[a+1]),[null!==(u=t[a+1][2])&&void 0!==u?u:0]):null,d=a<t.length-1?t[a+1]:null,v=this.segment_gaode2(n,i,l,f,p,c,h,d);i+=v}if(this.dash)for(var g=0;g<n.positions.length/6;g++)n.positions[6*g+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"extrude",value:function(e){var t=this.complex;if(e.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=e.length,r=t.startIndex,i=1;i<n;i++){var a=e[i-1],o=e[i],s=i<e.length-1?e[i+1]:null,u=this.segment(t,r,a,o,s);r+=u}if(this.dash)for(var l=0;l<t.positions.length/6;l++)t.positions[6*l+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"simpleSegment",value:function(e,t,n,r,i){var a=0,o=e.indices,s=e.positions,u=e.normals,l=(0,Ue.Z)([r[0],r[1]]),c=(0,Ue.Z)([n[0],n[1]]);so(no,l,c);var f=0;if(this.dash&&(f=this.lineSegmentDistance(l,c),this.totalDistance+=f),this.normal||(this.normal=eo.Ue(),oo(this.normal,no)),this.started||(this.started=!0,this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-f)),o.push(t+0,t+1,t+2),i){var h=(0,Ue.Z)([i[0],i[1]]);uo(l,h)&&eo.IH(h,l,eo.Fv(h,eo.$X(h,l,c))),so(ro,h,l);var p=ao(io,eo.Ue(),no,ro,this.thickness),d=sa(p,2),v=d[0],g=d[1],m=eo.AK(io,this.normal)<0?-1:1;this.extrusions(s,u,r,g,v,this.totalDistance),o.push.apply(o,Vi(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),m=-1,eo.JG(this.normal,g),a+=2,this.lastFlip=m}else oo(this.normal,no),this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance),o.push.apply(o,Vi(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),a+=2;return a}},{key:"segment_gaode2",value:function(e,t,n,r,i,a,o,s){var u=0,l=e.indices,c=e.positions,f=e.normals,h="square"===this.cap,p="bevel"===this.join,d=(0,Ue.Z)([o[0],o[1]]),v=(0,Ue.Z)([a[0],a[1]]);so(no,r,n);var g=0;if(this.dash&&(g=this.lineSegmentDistance(d,v),this.totalDistance+=g),this.normal||(this.normal=eo.Ue(),oo(this.normal,no)),!this.started)if(this.started=!0,h){var m=eo.Ue(),y=eo.Ue();eo.IH(m,this.normal,no),eo.IH(y,this.normal,no),f.push(y[0],y[1],0),f.push(m[0],m[1],0),c.push(n[0],n[1],0|n[2],this.totalDistance-g,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),c.push(n[0],n[1],0|n[2],this.totalDistance-g,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(c,f,n,this.normal,this.thickness,this.totalDistance-g);if(l.push(t+0,t+1,t+2),i){uo(r,i)&&eo.IH(i,r,eo.Fv(i,eo.$X(i,r,n))),so(ro,i,r);var _=ao(io,eo.Ue(),no,ro,this.thickness),x=sa(_,2),b=x[0],S=x[1],w=eo.AK(io,this.normal)<0?-1:1,C=p;if(!C&&"miter"===this.join){var k=b;k>this.miterLimit&&(C=!0)}C?(f.push(this.normal[0],this.normal[1],0),f.push(S[0],S[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*w,0|r[2]),this.complex.indexes.push(this.currentIndex),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*w,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l.push.apply(l,Vi(this.lastFlip!==-w?[t,t+2,t+3]:[t+2,t+1,t+3])),l.push(t+2,t+3,t+4),oo(to,ro),eo.JG(this.normal,to),f.push(this.normal[0],this.normal[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*w,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,u+=3):(this.extrusions(c,f,r,S,b,this.totalDistance),l.push.apply(l,Vi(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),w=-1,eo.JG(this.normal,S),u+=2),this.lastFlip=w}else{if(oo(this.normal,no),h){var A=eo.Ue(),E=eo.Ue();eo.lu(E,no,this.normal),eo.IH(A,no,this.normal),f.push(E[0],E[1],0),f.push(A[0],A[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(c,f,r,this.normal,this.thickness,this.totalDistance);l.push.apply(l,Vi(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),u+=2}return u}},{key:"segment",value:function(e,t,n,r,i){var a=0,o=e.indices,s=e.positions,u=e.normals,l="square"===this.cap,c="bevel"===this.join,f=(0,Ue.Z)([r[0],r[1]]),h=(0,Ue.Z)([n[0],n[1]]);so(no,f,h);var p=0;if(this.dash&&(p=this.lineSegmentDistance(f,h),this.totalDistance+=p),this.normal||(this.normal=eo.Ue(),oo(this.normal,no)),!this.started)if(this.started=!0,l){var d=eo.Ue(),v=eo.Ue();eo.IH(d,this.normal,no),eo.IH(v,this.normal,no),u.push(v[0],v[1],0),u.push(d[0],d[1],0),s.push(n[0],n[1],0|n[2],this.totalDistance-p,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),s.push(n[0],n[1],0|n[2],this.totalDistance-p,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-p);if(o.push(t+0,t+1,t+2),i){var g=(0,Ue.Z)([i[0],i[1]]);uo(f,g)&&eo.IH(g,f,eo.Fv(g,eo.$X(g,f,h))),so(ro,g,f);var m=ao(io,eo.Ue(),no,ro,this.thickness),y=sa(m,2),_=y[0],x=y[1],b=eo.AK(io,this.normal)<0?-1:1,S=c;if(!S&&"miter"===this.join){var w=_;w>this.miterLimit&&(S=!0)}S?(u.push(this.normal[0],this.normal[1],0),u.push(x[0],x[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*b,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*b,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,o.push.apply(o,Vi(this.lastFlip!==-b?[t,t+2,t+3]:[t+2,t+1,t+3])),o.push(t+2,t+3,t+4),oo(to,ro),eo.JG(this.normal,to),u.push(this.normal[0],this.normal[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*b,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a+=3):(this.extrusions(s,u,r,x,_,this.totalDistance),o.push.apply(o,Vi(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),b=-1,eo.JG(this.normal,x),a+=2),this.lastFlip=b}else{if(oo(this.normal,no),l){var C=eo.Ue(),k=eo.Ue();eo.lu(k,no,this.normal),eo.IH(C,no,this.normal),u.push(k[0],k[1],0),u.push(C[0],C[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance);o.push.apply(o,Vi(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),a+=2}return a}},{key:"extrusions",value:function(e,t,n,r,i,a){t.push(r[0],r[1],0),t.push(r[0],r[1],0),e.push(n[0],n[1],0|n[2],a,-i,0|n[2]),this.complex.indexes.push(this.currentIndex),e.push(n[0],n[1],0|n[2],a,i,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}}]),e}();function fo(e){var t=e[0][0],n=e[0][e[0].length-1];t[0]===n[0]&&t[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var r=e[0].length,i=Wa().flatten(e),a=i.vertices,o=i.dimensions,s=[],u=[],l=0;l<a.length/o;l++)2===o?s.push(a[2*l],a[2*l+1],1):s.push(a[3*l],a[3*l+1],1);var c=Wa()(i.vertices,i.holes,i.dimensions);u.push.apply(u,Vi(c));for(var f=function(){var e=i.vertices.slice(h*o,(h+1)*o),t=i.vertices.slice((h+1)*o,(h+2)*o);0===t.length&&(t=i.vertices.slice(0,o));var n=s.length/3;s.push(e[0],e[1],1,t[0],t[1],1,e[0],e[1],0,t[0],t[1],0),u.push.apply(u,Vi([0,2,1,2,3,1].map((function(e){return e+n}))))},h=0;h<r;h++)f();return{positions:s,index:u}}function ho(e){var t=Wa().flatten(e),n=Wa()(t.vertices,t.holes,t.dimensions);return{positions:t.vertices,index:n}}function po(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e[0][0],r=e[0][e[0].length-1];n[0]===r[0]&&n[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var i=e[0].length,a=Wa().flatten(e),o=a.vertices,s=a.dimensions,u=[],l=[],c=[],f=0;f<o.length/s;f++)u.push(o[f*s],o[f*s+1],1,-1,-1),c.push(0,0,1);var h=Wa()(a.vertices,a.holes,a.dimensions);l.push.apply(l,Vi(h));for(var p=function(){var e=a.vertices.slice(d*s,(d+1)*s),n=a.vertices.slice((d+1)*s,(d+2)*s);0===n.length&&(n=a.vertices.slice(0,s));var r=u.length/5;u.push(e[0],e[1],1,0,0,n[0],n[1],1,.1,0,e[0],e[1],0,0,.8,n[0],n[1],0,.1,.8);var i=vo([n[0],n[1],1],[e[0],e[1],0],[e[0],e[1],1],t);c.push.apply(c,Vi(i).concat(Vi(i),Vi(i),Vi(i))),l.push.apply(l,Vi([1,2,0,3,2,1].map((function(e){return e+r}))))},d=0;d<i;d++)p();return{positions:u,index:l,normals:c}}function vo(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=qa.create(),a=qa.create(),o=qa.create();r&&(e=(0,Ue.vP)(e),t=(0,Ue.vP)(t),n=(0,Ue.vP)(n));var s=qa.fromValues.apply(qa,Vi(e)),u=qa.fromValues.apply(qa,Vi(t)),l=qa.fromValues.apply(qa,Vi(n));qa.sub(i,l,u),qa.sub(a,s,u),qa.cross(o,i,a);var c=qa.create();return qa.normalize(c,o),c}var go=function(e){return e["CYLINDER"]="cylinder",e["SQUARECOLUMN"]="squareColumn",e["TRIANGLECOLUMN"]="triangleColumn",e["HEXAGONCOLUMN"]="hexagonColumn",e["PENTAGONCOLUMN"]="pentagonColumn",e}({}),mo=function(e){return e["CIRCLE"]="circle",e["SQUARE"]="square",e["TRIANGLE"]="triangle",e["HEXAGON"]="hexagon",e["PENTAGON"]="pentagon",e}({});function yo(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=2*Math.PI/e,r=[],i=0;i<e;i++)r.push(n*i+t*Math.PI/12);var a=r.map((function(e){var t=Math.sin(e+Math.PI/4),n=Math.cos(e+Math.PI/4);return[t,n,0]}));return a}function _o(){return yo(30)}function xo(){return yo(4)}function bo(){return yo(3)}function So(){return yo(6,1)}function wo(){return yo(5)}var Co=(lo={},Ri(lo,mo.CIRCLE,_o),Ri(lo,mo.HEXAGON,So),Ri(lo,mo.TRIANGLE,bo),Ri(lo,mo.SQUARE,xo),Ri(lo,mo.PENTAGON,wo),Ri(lo,go.CYLINDER,_o),Ri(lo,go.HEXAGONCOLUMN,So),Ri(lo,go.TRIANGLECOLUMN,bo),Ri(lo,go.SQUARECOLUMN,xo),Ri(lo,go.PENTAGONCOLUMN,wo),lo),ko={};function Ao(e){var t=(0,Ue.SI)(e.coordinates);return{vertices:[].concat(Vi(t),Vi(t),Vi(t),Vi(t)),indices:[0,1,2,2,3,0],size:t.length}}function Eo(e){var t=(0,Ue.SI)(e.coordinates),n=Ja(t);return{vertices:[].concat(Vi(n),Vi(n),Vi(n),Vi(n)),indices:[0,1,2,2,3,0],size:n.length}}function To(e){var t=e.shape,n=Ho(t,!1),r=n.positions,i=n.index,a=n.normals;return{vertices:r,indices:i,normals:a,size:5}}function Mo(e){var t=(0,Ue.SI)(e.coordinates);return{vertices:Vi(t),indices:[0],size:t.length}}function Oo(e){var t=e.coordinates,n=e.originCoordinates,r=e.version,i=new co({dash:!0,join:"bevel"});if("GAODE2.x"===r){var a=t;Array.isArray(a[0][0])||(a=[t]);var o=n;Array.isArray(o[0][0])||(o=[n]);for(var s=0;s<a.length;s++){var u=a[s],l=o[s];i.extrude_gaode2(u,l)}}else{var c=t;c[0]&&!Array.isArray(c[0][0])&&(c=[t]),c.forEach((function(e){i.extrude(e)}))}var f=i.complex;return{vertices:f.positions,indices:f.indices,normals:f.normals,indexes:f.indexes,size:6}}function Lo(e){var t=e.coordinates.flat(),n=1,r=1;return{vertices:[1,0,0].concat(Vi(t),[1,2,-3],Vi(t),[1,1,-3],Vi(t),[0,1,0],Vi(t),[0,0,0],Vi(t),[1,0,0],Vi(t),[1,2,-3],Vi(t),[1,1,-3],Vi(t),[0,1,0],Vi(t),[0,0,0],Vi(t)),normals:[-n,2*r,1,2*r,-r,1,r,-r,1,r,-r,1,-n,-r,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function Po(e){var t=e.coordinates,n=[];if(!Array.isArray(t[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};var r=Do(t),i=r.results,a=r.totalDistance;return i.map((function(e){n.push(e[0],e[1],e[2],e[3],0,a)})),{vertices:n,indices:[],normals:[],size:6,count:i.length}}function Ro(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}function Io(e,t){return e.length<3&&e.push(0),void 0!==t&&e.push(t),e}function Do(e){var t=e;Array.isArray(t)&&Array.isArray(t[0])&&Array.isArray(t[0][0])&&(t=e.flat());var n=0;if(t.length<2)return{results:t,totalDistance:0};var r=[],i=Io(t[0],n);r.push(i);for(var a=1;a<t.length-1;a++){var o=Ro(t[a-1],t[a]);n+=o;var s=Io(t[a],n);r.push(s),r.push(s)}var u=Ro(t[t.length-2],t[t.length-1]);return n+=u,r.push(Io(t[t.length-1],n)),{results:r,totalDistance:n}}function zo(e){var t=e.coordinates,n=Wa().flatten(t),r=n.vertices,i=n.dimensions,a=n.holes;return{indices:Wa()(r,a,i),vertices:r,size:i}}function No(e){var t=e.coordinates,n=Wa().flatten(t),r=n.vertices,i=n.dimensions,a=n.holes;return{indices:Wa()(r,a,i),vertices:Fo(r),size:i+4}}function Fo(e){for(var t=[],n=(0,Ue.Rx)(e),r=n.center,i=n.radius,a=0;a<e.length;a+=2){var o=e[a],s=e[a+1];t.push.apply(t,[o,s,0].concat(Vi(r),[i]))}return t}function jo(e){var t=e.coordinates,n=po(t,!0),r=n.positions,i=n.index,a=n.normals;return{vertices:r,indices:i,normals:a,size:5}}function Bo(e){var t=e.shape,n=Wo(t),r=n.positions,i=n.index;return{vertices:r,indices:i,size:3}}function Uo(e){var t=e.coordinates,n=[].concat(Vi(t[0]),[0,0,1,t[1][0],t[0][1],0,1,1],Vi(t[1]),[0,1,0],Vi(t[0]),[0,0,1],Vi(t[1]),[0,1,0,t[0][0],t[1][1],0,0,0]),r=[0,1,2,3,4,5];return{vertices:n,indices:r,size:5}}function Vo(e,t){for(var n=t||30,r=e.coordinates,i=[],a=[],o=function(e){i.push(e,1,e,r[0][0],r[0][1],r[1][0],r[1][1],e,-1,e,r[0][0],r[0][1],r[1][0],r[1][1]),e!==n-1&&a.push.apply(a,Vi([0,1,2,1,3,2].map((function(t){return 2*e+t}))))},s=0;s<n;s++)o(s);return{vertices:i,indices:a,size:7}}function Go(e){var t=e.coordinates;2===t.length&&t.push(0);var n=Yo(-1,1),r=Yo(1,1),i=Yo(-1,-1),a=Yo(1,-1),o=[].concat(Vi(t),Vi(n),Vi(t),Vi(i),Vi(t),Vi(a),Vi(t),Vi(r)),s=[0,1,2,3,0,2];return{vertices:o,indices:s,size:5}}function Ho(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(ko&&ko[e])return ko[e];var n=Co[e]?Co[e]():Co.cylinder(),r=po([n],t);return ko[e]=r,r}function Wo(e){var t=["cylinder","triangleColumn","hexagonColumn","squareColumn"],n=Co[e]?Co[e]():Co.circle(),r=-1===t.indexOf(e)?ho([n]):fo([n]);return r}function Yo(e,t){var n=(e+1)/2,r=(t+1)/2;return[n,r]}function qo(){var e=$a(Za,{segments:Ka}),t=e.positionsArr,n=e.indicesArr,r=e.normalArr;return{vertices:t,indices:n,size:5,normals:r}}function Zo(){var e=$a(Za+Xa,{segments:Ka}),t=e.positionsArr,n=e.indicesArr,r=e.normalArr;return{vertices:t,indices:n,size:5,normals:r}}function Ko(e){var t=Xo();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function Xo(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Qo='uniform float u_opacity: 1.0;\nuniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];\nuniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];\nuniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];\nuniform float u_near : 0;\nuniform float u_far : 1;\nvarying vec4 v_Color;\nvarying vec2 v_texCoord;\nuniform float u_Zoom : 1;\nuniform float u_time;\n\nuniform float u_circleSweep;\nuniform float u_cityMinSize;\nuniform vec3 u_circleSweepColor;\nuniform float u_circleSweepSpeed;\n\nvarying float v_worldDis;\n\n#pragma include "picking"\n\nvec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {\n    float s = step(hot, n);\n    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);\n\n    return mix(darkColor, color, s);\n}\nfloat random (vec2 st) {\n    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);\n}\n\nfloat LinearizeDepth()\n{\n    float z = gl_FragCoord.z * 2.0 - 1.0;\n    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));\n}\n\nvec3 fog(vec3 color, vec3 fogColor, float depth){\n    float fogFactor=clamp(depth,0.0,1.0);\n    vec3 output_color=mix(fogColor,color,fogFactor);\n    return output_color;\n}\n\nfloat sdRect(vec2 p, vec2 sz) {\n  vec2 d = abs(p) - sz;\n  float outside = length(max(d, 0.));\n  float inside = min(max(d.x, d.y), 0.);\n  return outside + inside;\n}\n\nvoid main() {\n  gl_FragColor = v_Color;\n  vec3 baseColor = u_baseColor.xyz;\n  vec3 brightColor = u_brightColor.xyz;\n  vec3 windowColor = u_windowColor.xyz;\n  float targetColId = 5.;\n  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;\n  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);\n  if(v_texCoord.x < 0.) { //\u9876\u90e8\u989c\u8272\n       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);\n       gl_FragColor = vec4( foggedColor, v_Color.w);\n  }else { // \u4fa7\u9762\u989c\u8272\n        vec2 st = v_texCoord;\n        vec2  UvScale = v_texCoord;\n        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));\n        float tStart = 0.25 * tStep;\n        float tEnd = 0.75 * tStep;\n        float u = mod(UvScale.x, tStep);\n        float v = mod(UvScale.y, tStep);\n        float ux = floor(UvScale.x/tStep);\n        float uy = floor(UvScale.y/tStep);\n        float n = random(vec2(ux,uy));\n        float lightP = u_time;\n        float head = 1.0- step(0.005,st.y);\n        /*step3*/\n        // \u5c06\u7a97\u6237\u989c\u8272\u548c\u5899\u9762\u989c\u8272\u533a\u522b\u5f00\u6765\n        float sU = step(tStart, u) - step(tEnd, u);\n        float sV = step(tStart, v) - step(tEnd, v);\n        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));\n        float dist = sdRect(vec2(u,v), windowSize);\n        float s = sU * sV;\n\n        float curColId = floor(UvScale.x / tStep);\n        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);\n\n        float mLightP = mod(lightP, 2.);\n        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);\n        if(ux == targetColId){\n            n =0.;\n        }\n        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );\n        float hot = smoothstep(1.0,0.0,timeP);\n        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);\n        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);\n        float sFinal = s * sCol * sRow;\n        color += mix(baseColor, brightColor, sFinal*n);\n        if (st.y<0.01){\n        color = baseColor;\n         }\n        if(head ==1.0) { // \u9876\u90e8\u4eae\u7ebf\n            color = brightColor;\n        }\n        color = color * v_Color.rgb;\n\n        vec3 foggedColor = fog(color,fogColor,depth);\n\n        gl_FragColor = vec4(foggedColor,1.0);\n  }\n\n\n  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {\n    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);\n    gl_FragColor.rgb += r * r * u_circleSweepColor;\n  }\n   \n  gl_FragColor.a *= u_opacity;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',Jo='precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\n\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n\nvarying vec4 v_Color;\nuniform mat4 u_Mvp;\n\nuniform float u_circleSweep;\nuniform vec2 u_cityCenter;\n\nvarying float v_worldDis;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\n\nvoid main() {\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  vec4 project_pos = project_position(pos);\n\n   v_texCoord = a_Uv;\n\n  if(u_circleSweep > 0.0) {\n     vec2 lnglatscale = vec2(0.0);\n    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {\n      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);\n    }\n    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);\n  }\n \n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  float lightWeight = calc_lighting(pos);\n  // v_Color = a_Color;\n  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);\n\n  setPickingColor(a_PickingColor);\n}\n',$o=function(e){Oi(n,e);var t=Ko(n);function n(){return Si(this,n),t.apply(this,arguments)}return Ei(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.baseColor,i=void 0===r?"rgb(16,16,16)":r,a=e.brightColor,o=void 0===a?"rgb(255,176,38)":a,s=e.windowColor,u=void 0===s?"rgb(30,60,89)":s,l=e.time,c=void 0===l?0:l,f=e.sweep,h=void 0===f?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:f;return{u_cityCenter:h.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*h.sweepRadius,u_circleSweep:h.enable?1:0,u_circleSweepColor:(0,Ue.CI)(h.sweepColor).slice(0,3),u_circleSweepSpeed:h.sweepSpeed,u_opacity:n,u_baseColor:(0,Ue.CI)(i),u_brightColor:(0,Ue.CI)(o),u_windowColor:(0,Ue.CI)(u),u_time:this.layer.getLayerAnimateTime()||c}}},{key:"calCityGeo",value:function(){var e=sa(this.layer.getSource().extent,4),t=e[0],n=e[1],r=e[2],i=e[3];if("GAODE2.x"===this.mapService.version){this.cityCenter=this.mapService.lngLatToCoord([(r+t)/2,(i+n)/2]);var a=this.mapService.lngLatToCoord([r,i]),o=this.mapService.lngLatToCoord([t,n]);this.cityMinSize=Math.sqrt(Math.pow(a[0]-o[0],2)+Math.pow(a[1]-o[1],2))/4}else{var s=r-t,u=i-n;this.cityCenter=[(r+t)/2,(i+n)/2],this.cityMinSize=Math.sqrt(Math.pow(s,2)+Math.pow(u,2))/4}}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.calCityGeo(),this.startModelAnimate(),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:Jo,fragmentShader:Qo,triangulation:jo,depth:{enable:!0},cull:{enable:!0,face:yt.gl.BACK}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:yt.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:yt.gl.STATIC_DRAW,data:[],type:yt.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:yt.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?10:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:yt.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),n}(Oa);function es(e){var t=ts();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function ts(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var ns=function(e){Oi(n,e);var t=es(n);function n(){var e;Si(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Ri(Ti(e),"type","CityBuildingLayer"),e}return Ei(n,[{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.layerModel=new $o(this),e.next=3,this.initLayerModels();case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"setLight",value:function(e){this.updateLayerConfig({time:e})}},{key:"getModelType",value:function(){return"citybuilding"}}]),n}(Aa);function rs(e){var t=is();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function is(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var as='\nuniform sampler2D u_texture;\nuniform float u_opacity;\n\nvarying vec3 v_Color;\nvarying vec2 v_uv;\n\n#pragma include "picking"\nvoid main() {\n  gl_FragColor = texture2D(u_texture, vec2(v_uv.x, 1.0 - v_uv.y));\n  gl_FragColor.a *= u_opacity;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',os='precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform float u_raisingHeight: 0.0;\nuniform mat4 u_Mvp;\nuniform float u_opacity;\nuniform vec2 u_size: [1.0, 1.0];\nuniform mat2 u_RotateMatrix;\n\nattribute vec3 a_Extrude;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nattribute vec3 a_Color;\n\nvarying vec3 v_Color;\nvarying vec2 v_uv;\n\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\n   vec3 extrude = a_Extrude;\n   v_Color = a_Color;\n   v_uv = a_Uv;\n\n   float raiseHeight = u_raisingHeight;\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raiseHeight = u_raisingHeight * mapboxZoomScale;\n   }\n\n   // \u8ba1\u7b97\u7ecf\u7eac\u5ea6\u70b9\u4f4d\u5750\u6807\n   vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\n\n   // \u8ba1\u7b97\u7ed5 z \u8f74\u65cb\u8f6c\u540e\u7684\u504f\u79fb\n   vec2 offsetXY = project_pixel(u_RotateMatrix * vec2(extrude.x * u_size.x, 0.0));\n   // \u7ed5 z \u8f74\u65cb\u8f6c\n   float x = project_pos.x + offsetXY.x;\n   float y = project_pos.y + offsetXY.y;\n   // z \u8f74\u4e0d\u53c2\u4e0e\u65cb\u8f6c\n   float z = project_pixel(extrude.y * u_size.y + raiseHeight);\n\n\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      // gl_Position = u_Mvp * (vec4(project_pos.xy, a_Position.z, 1.0));\n      gl_Position = u_Mvp * (vec4(x, y, z, 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(x , y, z , 1.0));\n   }\n\n   setPickingColor(a_PickingColor);\n}\n',ss=function(e){Oi(n,e);var t=rs(n);function n(){var e;Si(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Ri(Ti(e),"radian",0),Ri(Ti(e),"planeGeometryTriangulation",(function(){var t=e.layer.getLayerConfig(),n=t.center,r=void 0===n?[120,30]:n;return{size:4,indices:[0,1,2,2,3,0],vertices:[].concat(Vi(r),[1,1],Vi(r),[0,1],Vi(r),[0,0],Vi(r),[1,0])}})),e}return Ei(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=e.width,r=void 0===n?1:n,i=e.height,a=void 0===i?1:i,o=e.raisingHeight,s=void 0===o?0:o,u=1;return"GAODE2.x"!==this.mapService.version&&"GAODE1.x"!==this.mapService.version||(u=-1),this.radian=u*Math.PI*(this.mapService.getRotation()%360)/180,{u_raisingHeight:Number(s),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_opacity:t||1,u_texture:this.texture,u_size:[r,a]}}},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){var t,n,r,i;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.drawCanvas,r=this.rendererService.createTexture2D,this.texture=r({height:0,width:0}),n&&this.updateTexture(n),e.next=6,this.layer.buildLayerModel({moduleName:"geometryBillboard",vertexShader:os,fragmentShader:as,triangulation:this.planeGeometryTriangulation,primitive:yt.gl.TRIANGLES,depth:{enable:!0}});case 6:return i=e.sent,e.abrupt("return",[i]);case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"updateTexture",value:function(e){var t=this.rendererService.createTexture2D,n=this.layer.getLayerConfig(),r=n.canvasWidth,i=void 0===r?1:r,a=n.canvasHeight,o=void 0===a?1:a,s=document.createElement("canvas");s.width=i,s.height=o;var u=s.getContext("2d");u&&(e(s),this.texture=t({data:s,width:s.width,height:s.height,wrapS:yt.gl.CLAMP_TO_EDGE,wrapT:yt.gl.CLAMP_TO_EDGE}),this.layerService.reRender())}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:yt.GC.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:3,update:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],a=r%4*3;return[i[a],i[a+1],i[a+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:yt.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:2,update:function(e,t,n){return[n[2],n[3]]}}})}}]),n}(Oa);function us(e){var t=ls();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function ls(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var cs='\nuniform sampler2D u_texture;\nuniform float u_mapFlag;\nuniform float u_opacity;\n\nvarying vec3 v_Color;\nvarying vec2 v_uv;\nvarying float v_clip;\n\n#pragma include "picking"\nvoid main() {\n  // gl_FragColor = vec4(v_Color, u_opacity);\n  if(u_mapFlag > 0.0) {\n    gl_FragColor = texture2D(u_texture, vec2(v_uv.x, 1.0 - v_uv.y));\n    gl_FragColor.a *= u_opacity;\n  } else {\n    // gl_FragColor = vec4(v_uv, 0.0, u_opacity);\n    gl_FragColor = vec4(v_Color, u_opacity);\n  }\n  gl_FragColor.a *= v_clip;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',fs='precision highp float;\nuniform mat4 u_ModelMatrix;\n\nuniform mat4 u_Mvp;\nuniform float u_opacity;\nuniform float u_terrainClipHeight;\n\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nattribute vec3 a_Color;\n\nvarying vec3 v_Color;\nvarying vec2 v_uv;\nvarying float v_clip;\n\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\n   v_Color = a_Color;\n   v_uv = a_Uv;\n  \n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n   v_clip = 1.0;\n   if(a_Position.z < u_terrainClipHeight) {\n      v_clip = 0.0;\n   }\n  \n   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n\n   // float x = 1.0;\n   // float y = 0.0;\n   // float z = 0.0;\n   // mat3 translateMatrix = mat3(\n   //    1.0, 0.0, 0.0 \n   //    0.0, 1.0, 0.0\n   //    -project_pos.x,    -project_pos.y,  1.0\n   // );\n   //  mat4 translateMatrix = mat4(\n   //    1.0, 0.0, 0.0, 0.0 ,\n   //    0.0, 1.0, 0.0, 0.0,\n   //    0.0, 0.0, 1.0, 0.0,\n   //    1.0, 0.0, 0.0, 1.0\n   // );\n\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy, a_Position.z, 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, a_Position.z, 1.0));\n   }\n\n   setPickingColor(a_PickingColor);\n}\n',hs=function(e){Oi(n,e);var t=us(n);function n(){var e;Si(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Ri(Ti(e),"terrainImageLoaded",!1),Ri(Ti(e),"planeGeometryTriangulation",(function(){var t,n=e.layer.getLayerConfig(),r=n.width,i=void 0===r?1:r,a=n.height,o=void 0===a?1:a,s=n.widthSegments,u=void 0===s?1:s,l=n.heightSegments,c=void 0===l?1:l,f=n.center,h=void 0===f?[120,30]:f,p=n.terrainTexture,d=(t=e).initPlane.apply(t,[i,o,u,c].concat(Vi(h))),v=d.indices,g=d.positions;return p&&e.loadTerrainTexture(g,v),{vertices:g,indices:v,size:5}})),e}return Ei(n,[{key:"initPlane",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:120,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:30,o=e/2,s=t/2,u=Math.floor(n),l=Math.floor(r),c=u+1,f=l+1,h=e/u,p=t/l,d=[],v=[],g=0;g<f;g++)for(var m=g*p-s,y=0;y<c;y++){var _=y*h-o;if(this.mapService.version===Xi.G["GAODE2.x"]){var x=this.mapService.lngLatToCoord([_+i,-m+a]),b=sa(x,2),S=b[0],w=b[1];v.push(S,w,0)}else v.push(_+i,-m+a,0);v.push(y/u),v.push(1-g/l)}for(var C=0;C<l;C++)for(var k=0;k<u;k++){var A=k+c*C,E=k+c*(C+1),T=k+1+c*(C+1),M=k+1+c*C;d.push(A,E,M),d.push(E,T,M)}return{indices:d,positions:v}}},{key:"getUninforms",value:function(){var e,t=this.layer.getLayerConfig(),n=t.opacity,r=t.mapTexture,i=t.terrainClipHeight,a=void 0===i?0:i,o=t.terrainTexture;this.mapTexture!==r&&(this.mapTexture=r,null===(e=this.texture)||void 0===e||e.destroy(),this.updateTexture(r));return{u_opacity:n||1,u_mapFlag:r?1:0,u_terrainClipHeight:o?a:-1,u_texture:this.texture}}},{key:"clearModels",value:function(){var e;this.terrainImage=null,null===(e=this.texture)||void 0===e||e.destroy()}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){var t,n,r,i;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.mapTexture,this.mapTexture=n,r=this.rendererService.createTexture2D,this.texture=r({height:0,width:0}),this.updateTexture(n),e.next=7,this.layer.buildLayerModel({moduleName:"geometryPlane",vertexShader:fs,fragmentShader:cs,triangulation:this.planeGeometryTriangulation,primitive:yt.gl.TRIANGLES,depth:{enable:!0},cull:{enable:!0,face:yt.gl.BACK}});case 7:return i=e.sent,e.abrupt("return",[i]);case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"createModelData",value:function(e){if(e){var t=this.layer.getLayerConfig(),n=t.widthSegments,r=t.heightSegments,i=t.width,a=t.height,o=e,s=o.widthSegments,u=o.heightSegments,l=o.width,c=o.height;this.layer.style({widthSegments:void 0!==s?s:n,heightSegments:void 0!==u?u:r,width:void 0!==l?l:i,height:void 0!==c?c:a})}var f=this.layer.getEncodedData(),h=this.styleAttributeService.createAttributesAndIndices(f,this.planeGeometryTriangulation);return h}},{key:"updateTexture",value:function(e){var t=this,n=this.rendererService.createTexture2D;if(e){var r=new Image;r.crossOrigin="anonymous",r.onload=function(){t.texture=n({data:r,width:r.width,height:r.height,wrapS:yt.gl.CLAMP_TO_EDGE,wrapT:yt.gl.CLAMP_TO_EDGE}),t.layerService.reRender()},r.src=e}else this.texture=n({width:0,height:0})}},{key:"getImageData",value:function(e){var t=document.createElement("canvas"),n=t.getContext("2d"),r=e.width,i=e.height;t.width=r,t.height=i,n.drawImage(e,0,0,r,i);var a=n.getImageData(0,0,r,i);return a}},{key:"translateVertex",value:function(e,t,n,r,i,a){for(var o=n.width,s=n.height,u=this.getImageData(n).data,l=Math.floor(r),c=Math.floor(i),f=l+1,h=c+1,p=o/l,d=s/c,v=0;v<h;v++)for(var g=Math.floor(v*d),m=g*o,y=0;y<f;y++){var _=Math.floor(y*p),x=4*(m+_),b=u[x],S=u[x+1],w=u[x+2],C=5*(v*f+y)+2;e[C]=a(b,S,w)}var k=this.layer.getEncodedData(),A=this.styleAttributeService.createAttributesAndIndices(k,(function(){return{vertices:e,indices:t,size:5}}));this.layer.updateModelData(A),this.layerService.throttleRenderLayers()}},{key:"loadTerrainTexture",value:function(e,t){var n=this,r=this.layer.getLayerConfig(),i=r.widthSegments,a=void 0===i?1:i,o=r.heightSegments,s=void 0===o?1:o,u=r.terrainTexture,l=r.rgb2height,c=void 0===l?function(e,t,n){return e+t+n}:l;if(this.terrainImage)this.terrainImageLoaded?this.translateVertex(e,t,this.terrainImage,a,s,c):this.terrainImage.onload=function(){n.translateVertex(e,t,n.terrainImage,a,s,c)};else{var f=new Image;this.terrainImage=f,f.crossOrigin="anonymous",f.onload=function(){n.terrainImageLoaded=!0,setTimeout((function(){return n.layer.emit("terrainImageLoaded",null)})),n.translateVertex(e,t,f,a,s,c)},f.src=u}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:yt.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),n}(Oa);function ps(e){var t=ds();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function ds(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var vs="\nuniform sampler2D u_texture;\nuniform float u_mapFlag;\nuniform float u_opacity;\n\nvarying vec3 v_Color;\nvarying float v_d;\n\nvoid main() {\n\n  if(v_d < 0.0) {\n    discard;\n  }\n\n  if(u_mapFlag > 0.0) {\n    gl_FragColor = texture2D(u_texture, gl_PointCoord);\n    gl_FragColor.a *= u_opacity;\n  } else {\n    gl_FragColor = vec4(v_Color, u_opacity);\n  }\n}\n",gs='precision highp float;\n\nattribute vec3 a_Position;\nattribute vec3 a_Color;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_opacity;\nuniform float u_Scale;\nvarying vec3 v_Color;\nvarying float v_d;\n\n#pragma include "projection"\nvoid main() {\n   v_Color = a_Color;\n  \n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n   v_d = a_Position.z;\n\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy, a_Position.z, 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, a_Position.z, 1.0));\n   }\n\n   gl_PointSize = pow((u_Zoom - 1.0), 2.0) * u_Scale;\n}\n',ms=function(e){return e["UP"]="up",e["DOWN"]="down",e}(ms||{}),ys=function(e){Oi(n,e);var t=ps(n);function n(){var e;Si(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Ri(Ti(e),"planeGeometryUpdateTriangulation",(function(){for(var t=e.layer.getLayerConfig(),n=t.spriteBottom,r=void 0===n?-1e5:n,i=e.spriteUpdate,a=r,o=e.spriteTop,s=0;s<e.positions.length;s+=5)e.spriteAnimate===ms.UP?(e.positions[s+2]+=i,e.positions[s+2]>o&&(e.positions[s+2]=a)):(e.positions[s+2]-=i,e.positions[s+2]<a&&(e.positions[s+2]=o));return{vertices:e.positions,indices:e.indices,size:5}})),Ri(Ti(e),"updateModel",(function(){var t=e.layer.createAttributes({triangulation:e.planeGeometryUpdateTriangulation});e.layer.models.map((function(e){e.updateAttributes(t)})),e.layerService.throttleRenderLayers(),e.timer=requestAnimationFrame(e.updateModel)})),Ri(Ti(e),"planeGeometryTriangulation",(function(){var t,n=e.layer.getLayerConfig(),r=n.center,i=void 0===r?[120,30]:r,a=n.spriteCount,o=void 0===a?100:a,s=n.spriteRadius,u=void 0===s?10:s,l=(t=e).initSprite.apply(t,[u,o].concat(Vi(i))),c=l.indices,f=l.positions;return e.positions=f,e.indices=c,{vertices:f,indices:c,size:5}})),e}return Ei(n,[{key:"initSprite",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:120,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30,i=[],a=[],o=this.mapService,s=this.spriteAnimate===ms.UP?-this.spriteTop:this.spriteTop,u=0;u<t;u++){var l=Math.random()*s;a.push.apply(a,Vi(f(l)))}for(var c=0;c<t;c++)i.push(c);function f(t){var i=e*Math.random(),a=e*Math.random(),s=-e/2+i,u=-e/2+a;if(o.version===Xi.G["GAODE2.x"]){var l=o.lngLatToCoord([s+n,-u+r]),c=sa(l,2),f=c[0],h=c[1];return[f,h,t,0,0]}return[s+n,-u+r,t,0,0]}return{indices:i,positions:a}}},{key:"getUninforms",value:function(){var e,t=this.layer.getLayerConfig(),n=t.opacity,r=t.mapTexture,i=t.spriteScale,a=void 0===i?1:i;this.mapTexture!==r&&(this.mapTexture=r,null===(e=this.texture)||void 0===e||e.destroy(),this.updateTexture(r));return{u_opacity:n||1,u_mapFlag:r?1:0,u_texture:this.texture,u_Scale:a}}},{key:"clearModels",value:function(){var e;cancelAnimationFrame(this.timer),null===(e=this.texture)||void 0===e||e.destroy()}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){var t,n,r,i,a,o,s,u,l,c,f=this;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.mapTexture,r=t.spriteTop,i=void 0===r?5e6:r,a=t.spriteUpdate,o=void 0===a?1e4:a,s=t.spriteAnimate,u=void 0===s?ms.DOWN:s,this.mapTexture=n,this.spriteTop=i,this.spriteUpdate=o,this.spriteAnimate="up"===u?ms.UP:ms.DOWN,l=this.rendererService.createTexture2D,this.texture=l({height:0,width:0}),this.updateTexture(n),setTimeout((function(){f.updateModel()}),100),e.next=11,this.layer.buildLayerModel({moduleName:"geometrySprite",vertexShader:gs,fragmentShader:vs,triangulation:this.planeGeometryTriangulation,primitive:yt.gl.POINTS,depth:{enable:!1},blend:this.getBlend()});case 11:return c=e.sent,e.abrupt("return",[c]);case 13:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"updateTexture",value:function(e){var t=this,n=this.rendererService.createTexture2D;if(e){var r=new Image;r.crossOrigin="anonymous",r.onload=function(){t.texture=n({data:r,width:r.width,height:r.height,wrapS:yt.gl.CLAMP_TO_EDGE,wrapT:yt.gl.CLAMP_TO_EDGE}),t.layerService.reRender()},r.src=e}else this.texture=n({width:0,height:0})}},{key:"registerBuiltinAttributes",value:function(){return""}}]),n}(Oa),_s={plane:hs,sprite:ys,billboard:ss},xs=_s;function bs(e){var t=Ss();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function Ss(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var ws=function(e){Oi(n,e);var t=bs(n);function n(){var e;Si(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Ri(Ti(e),"type","GeometryLayer"),Ri(Ti(e),"defaultSourceConfig",{data:[{x:0,y:0}],options:{parser:{type:"json",x:"x",y:"y"}}}),e}return Ei(n,[{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new xs[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getDefaultConfig",value:function(){var e=this.getModelType(),t={plane:{},sprite:{},billboard:{}};return t[e]}},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=null===t||void 0===t||null===(e=t.scale)||void 0===e?void 0:e.field;return"plane"===n?"plane":"sprite"===n?"sprite":"billboard"===n?"billboard":"plane"}}]),n}(Aa);function Cs(e){var t=ks();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function ks(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var As='precision highp float;\r\n// \u591a\u8fb9\u5f62\u9876\u70b9\u5750\u6807\r\nattribute vec3 a_Position;\r\n// \u591a\u8fb9\u5f62\u7ecf\u7eac\u5ea6\u5750\u6807\r\nattribute vec3 a_Pos;\r\nattribute float a_Size;\r\nattribute vec4 a_Color;\r\nuniform vec2 u_radius;\r\nuniform float u_coverage: 0.9;\r\nuniform float u_angle: 0;\r\nuniform mat4 u_ModelMatrix;\r\nuniform mat4 u_Mvp;\r\nvarying vec4 v_color;\r\n\r\nuniform vec2 u_sceneCenterMercator;\r\n\r\n#pragma include "projection"\r\n#pragma include "project"\r\n#pragma include "picking"\r\n\r\nvoid main() {\r\n  v_color = a_Color;\r\n\r\n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r\n  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r\n  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\n  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r\n  // gl_Position = project_common_position_to_clipspace(project_pos);\r\n\r\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r\n    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\n    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // \u5c06\u7ecf\u7eac\u5ea6\u8f6c\u6362\u4e3a\u9ad8\u5fb72.0\u9700\u8981\u7684\u5e73\u9762\u5750\u6807\r\n    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r\n    gl_Position = u_Mvp * (project_pos);\r\n  } else {\r\n     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\n    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r\n    gl_Position = project_common_position_to_clipspace(project_pos);\r\n  }\r\n\r\n  setPickingColor(a_PickingColor);\r\n}\r\n',Es='precision highp float;\nvarying vec4 v_color;\nuniform float u_opacity: 1;\n\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n  gl_FragColor.a *= u_opacity;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',Ts=function(e){Oi(n,e);var t=Cs(n);function n(){return Si(this,n),t.apply(this,arguments)}return Ei(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=e.coverage,r=e.angle;return{u_opacity:t||1,u_coverage:n||.9,u_angle:r||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:As,fragmentShader:Es,triangulation:Bo,primitive:yt.gl.TRIANGLES,depth:{enable:!1}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:yt.GC.Attribute,descriptor:{name:"a_Pos",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:3,update:function(e){var t="GAODE2.x"===e.version?e.originCoordinates:e.coordinates;return[t[0],t[1],0]}}})}}]),n}(Oa);function Ms(e){var t=Os();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function Os(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Ls,Ps,Rs='precision highp float;\n// \u591a\u8fb9\u5f62\u9876\u70b9\u5750\u6807\nattribute vec3 a_Position;\n// \u591a\u8fb9\u5f62\u7ecf\u7eac\u5ea6\u5750\u6807\nattribute vec3 a_Pos;\n\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec4 a_Color;\nuniform vec2 u_radius;\nuniform float u_coverage: 0.9;\nuniform float u_angle: 0;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\n\nuniform vec2 u_sceneCenterMercator;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "light"\n#pragma include "picking"\n\n\nvoid main() {\n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\n  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));\n\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n \n    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ecf\u7eac\u5ea6\n    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // \u5c06\u7ecf\u7eac\u5ea6\u8f6c\u6362\u4e3a\u9ad8\u5fb72.0\u9700\u8981\u7684\u5e73\u9762\u5750\u6807\n    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));\n\n    float lightWeight = calc_lighting(project_pos);\n    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);\n  \n    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);\n  } else {\n    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5b9e\u9645\u7684\u7ecf\u7eac\u5ea6\n    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));\n    \n    float lightWeight = calc_lighting(project_pos);\n    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);\n    \n    gl_Position = project_common_position_to_clipspace(project_pos);\n  }\n\n\n\n  setPickingColor(a_PickingColor);\n}\n',Is='precision highp float;\nvarying vec4 v_color;\nuniform float u_opacity: 1;\n\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n  gl_FragColor.a *= u_opacity;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',Ds=function(e){Oi(n,e);var t=Ms(n);function n(){return Si(this,n),t.apply(this,arguments)}return Ei(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=e.coverage,r=e.angle;return{u_opacity:t||1,u_coverage:n||1,u_angle:r||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:Rs,fragmentShader:Is,triangulation:To,primitive:yt.gl.TRIANGLES,depth:{enable:!0}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:yt.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:1,update:function(e){var t=e.size;return Array.isArray(t)?[t[0]]:[t]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:yt.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:yt.gl.STATIC_DRAW,data:[],type:yt.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:yt.GC.Attribute,descriptor:{name:"a_Pos",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:3,update:function(e){var t="GAODE2.x"===e.version?e.originCoordinates:e.coordinates;return[t[0],t[1],0]}}})}}]),n}(Oa),zs=n(22674);n(1738);function Ns(e,t){for(var n=[],r=[],i=[],a=e+1,o=t+1,s=e/2,u=t/2,l=0;l<o;l++)for(var c=l-u,f=0;f<a;f++){var h=f-s;r.push(h/s,-c/u,0),i.push(f/e),i.push(1-l/t)}for(var p=0;p<t;p++)for(var d=0;d<e;d++){var v=d+a*p,g=d+a*(p+1),m=d+1+a*(p+1),y=d+1+a*p;n.push(v,g,y),n.push(g,m,y)}return{vertices:r,indices:n,uvs:i}}function Fs(e){var t=js();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function js(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Bs="uniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nuniform float u_opacity;\nvarying vec2 v_texCoord;\nvarying float v_intensity;\n\nvoid main(){\n   \n     float intensity = texture2D(u_texture, v_texCoord).r;\n    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));\n    gl_FragColor = color;\n    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;\n     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;\n}\n",Us='precision highp float;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_InverseViewProjectionMatrix;\nuniform mat4 u_ViewProjectionMatrixUncentered;\nvarying float v_intensity;\n\n\nvec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {\n    float t2 = t * t;\n    float one_minus_t = 1.0 - t;\n    float one_minus_t2 = one_minus_t * one_minus_t;\n    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);\n}\nvec2 toBezier(float t, vec4 p){\n    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));\n}\n#pragma include "projection"\nvoid main() {\n  v_texCoord = a_Uv;\n\n  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5c06\u539f\u672c 0 -> 1 \u7684 uv \u8f6c\u6362\u4e3a -1 -> 1 \u7684\u6807\u51c6\u5750\u6807\u7a7a\u95f4\uff08NDC\uff09\n\n  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5e73\u9762\u4e0a\u7684\u70b9\uff08z == 0\uff09\u53ef\u4ee5\u8ba4\u4e3a\u662f\u4e09\u7ef4\u4e0a\u7684\u70b9\u88ab\u6295\u5f71\u5230\u5e73\u9762\u540e\u7684\u70b9\n\tvec4 p2 = vec4(pos, 1.0, 1.0); // \u5e73\u884c\u4e8ex/y\u5e73\u9762\u3001z==1 \u7684\u5e73\u9762\u4e0a\u7684\u70b9\n\n\tvec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636e\u89c6\u56fe\u6295\u5f71\u77e9\u9635\u7684\u9006\u77e9\u9635\u5e73\u9762\u4e0a\u7684\u53cd\u7b97\u51fa\u4e09\u7ef4\u7a7a\u95f4\u4e2d\u7684\u70b9\uff08p1\u5e73\u9762\u4e0a\u7684\u70b9\uff09\n\tvec4 inverseP2 = u_InverseViewProjectionMatrix * p2;\n\n  inverseP1 = inverseP1 / inverseP1.w; // \u5f52\u4e00\u5316\u64cd\u4f5c\uff08\u5f52\u4e00\u5316\u540e\u4e3a\u4e16\u754c\u5750\u6807\uff09\n\tinverseP2 = inverseP2 / inverseP2.w;\n\n\tfloat zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??\n\tvec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);\n\n  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);\n  float fh;\n\n  v_intensity = texture2D(u_texture, v_texCoord).r;\n  fh = toBezier(v_intensity, b).y;\n  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);\n \n}\n',Vs="uniform sampler2D u_texture;        // \u70ed\u529b\u5f3a\u5ea6\u56fe\nuniform sampler2D u_colorTexture;   // \u6839\u636e\u5f3a\u5ea6\u5206\u5e03\u7684\u8272\u5e26\nuniform float u_opacity;\nvarying vec2 v_texCoord;\n\nuniform vec2 u_ViewportSize;\n\nfloat getBlurIndusty() {\n    float vW = 2.0/u_ViewportSize.x;\n    float vH = 2.0/u_ViewportSize.y;\n    vec2 vUv = v_texCoord;\n    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;\n    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;\n    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;\n\n    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;\n    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;\n    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;\n\n    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;\n    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;\n    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;\n\n    return(\n        i11 + \n        i12 + \n        i13 + \n        i21 + \n        i21 + \n        i22 + \n        i23 + \n        i31 + \n        i32 + \n        i33\n        )/9.0;\n}\n\n\nvoid main(){\n    // float intensity = texture2D(u_texture, v_texCoord).r;\n    float intensity = getBlurIndusty();\n    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));\n\n    gl_FragColor =color;\n    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;\n\n}\n",Gs="precision highp float;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n\nvoid main() {\n  v_texCoord = a_Uv;\n\n  gl_Position = vec4(a_Position.xy, 0, 1.);\n}\n",Hs="precision highp float;\nuniform float u_intensity;\nvarying float v_weight;\nvarying vec2 v_extrude;\n#define GAUSS_COEF  0.3989422804014327\nvoid main(){\n    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);\n    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);\n    gl_FragColor = vec4(val, 1., 1., 1.);\n}\n",Ws='precision highp float;\nattribute vec3 a_Position;\nattribute float a_Size;\nattribute vec2 a_Dir;\nuniform float u_intensity;\nuniform float u_radius;\nvarying vec2 v_extrude;\nvarying float v_weight;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\n#define GAUSS_COEF  0.3989422804014327\n\n#pragma include "projection"\n\nvoid main(){\n    v_weight = a_Size;\n    float ZERO = 1.0 / 255.0 / 16.0;\n    float extrude_x = a_Dir.x * 2.0 -1.0;\n    float extrude_y = a_Dir.y * 2.0 -1.0;\n    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));\n    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;\n    v_extrude = extrude_dir * S;\n\n    vec2 offset = project_pixel(v_extrude * u_radius);\n    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\n\n    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));\n    } else {\n        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n    }\n}\n',Ys=(Ls=(0,zs.b2)(),Ls(Ps=function(e){Oi(n,e);var t=Fs(n);function n(){return Si(this,n),t.apply(this,arguments)}return Ei(n,[{key:"render",value:function(e){var t=this,n=this.rendererService,r=n.clear,i=n.useFramebuffer,a=this.layer.getLayerConfig(),o=a.rampColors;i(this.heatmapFramerBuffer,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:t.heatmapFramerBuffer}),t.drawIntensityMode()})),(0,Zt.isEqual)(this.preRampColors,o)||this.updateColorTexture(),"heatmap"===this.shapeType?this.drawColorMode(e):this.draw3DHeatMap(e)}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){var t,n,r,i,a,o,s,u,l,c;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=this.rendererService,r=n.createFramebuffer,i=n.getViewportSize,a=n.createTexture2D,o=this.styleAttributeService.getLayerStyleAttribute("shape"),s=(null===o||void 0===o||null===(t=o.scale)||void 0===t?void 0:t.field)||"heatmap",this.shapeType=s,e.next=6,this.buildHeatMapIntensity();case 6:return this.intensityModel=e.sent,this.colorModel="heatmap"===s?this.buildHeatmapColor():this.build3dHeatMap(),u=i(),l=u.width,c=u.height,this.heatmapFramerBuffer=r({color:a({width:Math.floor(l/4),height:Math.floor(c/4),wrapS:yt.gl.CLAMP_TO_EDGE,wrapT:yt.gl.CLAMP_TO_EDGE,min:yt.gl.LINEAR,mag:yt.gl.LINEAR}),depth:!1}),this.updateColorTexture(),e.abrupt("return",[this.intensityModel,this.colorModel]);case 12:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:yt.GC.Attribute,descriptor:{name:"a_Dir",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:yt.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return[n]}}})}},{key:"buildHeatMapIntensity",value:function(){var e=bi(zi().mark((function e(){var t;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.layer.triangulation=Go,e.next=3,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:Ws,fragmentShader:Hs,triangulation:Go,depth:{enable:!1},cull:{enable:!0,face:(0,Ue.fj)(this.mapService.version)}});case 3:return t=e.sent,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:Gs,fs:Vs});var e=this.shaderModuleService.getModule("heatmapColor"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService,a=i.createAttribute,o=i.createElements,s=i.createBuffer,u=i.createModel;return u({vs:t,fs:n,attributes:{a_Position:a({buffer:s({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:yt.gl.FLOAT}),size:3}),a_Uv:a({buffer:s({data:[0,1,1,1,0,0,1,0],type:yt.gl.FLOAT}),size:2})},uniforms:Yi({},r),depth:{enable:!1},elements:o({data:[0,2,1,2,3,1],type:yt.gl.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var e,t=this.layer.getLayerConfig(),n=t.opacity,r=t.intensity,i=void 0===r?10:r,a=t.radius,o=void 0===a?5:a;this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),null===(e=this.intensityModel)||void 0===e||e.draw({uniforms:{u_opacity:n||1,u_radius:o,u_intensity:i},blend:{enable:!0,func:{srcRGB:yt.gl.ONE,srcAlpha:1,dstRGB:yt.gl.ONE,dstAlpha:1}},stencil:{enable:!1,mask:255,func:{cmp:514,ref:1,mask:255}}}),this.layer.hooks.afterRender.call()}},{key:"drawColorMode",value:function(e){var t,n=this.layer.getLayerConfig(),r=n.opacity;null===(t=this.colorModel)||void 0===t||t.draw({uniforms:{u_opacity:r||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer},blend:this.getBlend(),stencil:this.getStencil(e)})}},{key:"draw3DHeatMap",value:function(e){var t,n=this.layer.getLayerConfig(),r=n.opacity,i=Ya.create();Ya.invert(i,this.cameraService.getViewProjectionMatrixUncentered()),null===(t=this.colorModel)||void 0===t||t.draw({uniforms:{u_opacity:r||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:Vi(i)},blend:{enable:!0,func:{srcRGB:yt.gl.SRC_ALPHA,srcAlpha:1,dstRGB:yt.gl.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},stencil:this.getStencil(e)})}},{key:"build3dHeatMap",value:function(){var e=this.rendererService.getViewportSize,t=e(),n=t.width,r=t.height,i=Ns(n/4,r/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:Us,fs:Bs});var a=this.shaderModuleService.getModule("heatmap3dColor"),o=a.vs,s=a.fs,u=a.uniforms,l=this.rendererService,c=l.createAttribute,f=l.createElements,h=l.createBuffer,p=l.createModel;return p({vs:o,fs:s,attributes:{a_Position:c({buffer:h({data:i.vertices,type:yt.gl.FLOAT}),size:3}),a_Uv:c({buffer:h({data:i.uvs,type:yt.gl.FLOAT}),size:2})},primitive:yt.gl.TRIANGLES,uniforms:Yi({},u),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:yt.gl.SRC_ALPHA,srcAlpha:1,dstRGB:yt.gl.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:f({data:i.indices,type:yt.gl.UNSIGNED_INT,count:i.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var e=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var t=this.layer.getLayerConfig(),n=t.rampColors,r=(0,Ue.Cl)(n);this.colorTexture=e({data:new Uint8Array(r.data),width:r.width,height:r.height,wrapS:yt.gl.CLAMP_TO_EDGE,wrapT:yt.gl.CLAMP_TO_EDGE,min:yt.gl.NEAREST,mag:yt.gl.NEAREST,flipY:!1}),this.preRampColors=n}}]),n}(Oa))||Ps);function qs(e){var t=Zs();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function Zs(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Ks='precision highp float;\nvarying vec4 v_color;\nuniform float u_opacity: 1;\n\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n  gl_FragColor.a *= u_opacity;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',Xs='precision highp float;\n// \u591a\u8fb9\u5f62\u9876\u70b9\u5750\u6807\nattribute vec3 a_Position;\n// \u591a\u8fb9\u5f62\u7ecf\u7eac\u5ea6\u5750\u6807\nattribute vec3 a_Pos;\nattribute float a_Size;\nattribute vec4 a_Color;\nuniform vec2 u_radius;\nuniform float u_coverage: 0.9;\nuniform float u_angle: 0;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\n\nuniform vec2 u_sceneCenterMercator;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nvoid main() {\n  v_color = a_Color;\n    \n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\n  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));\n  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\n \n  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));\n    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));\n    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator;\n    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\n    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);\n  } else {\n    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));\n  }\n  setPickingColor(a_PickingColor);\n}\n',Qs=function(e){Oi(n,e);var t=qs(n);function n(){return Si(this,n),t.apply(this,arguments)}return Ei(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=e.coverage,r=e.angle;return{u_opacity:t||1,u_coverage:n||.9,u_angle:r||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:Xs,fragmentShader:Ks,triangulation:Bo,depth:{enable:!1},primitive:yt.gl.TRIANGLES});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:yt.GC.Attribute,descriptor:{name:"a_Pos",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:3,update:function(e){var t="GAODE2.x"===e.version?e.originCoordinates:e.coordinates;return[t[0],t[1],0]}}})}}]),n}(Oa),Js={heatmap:Ys,heatmap3d:Ys,grid:Ts,grid3d:Ds,hexagon:Qs},$s=Js;function eu(e){var t=tu();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function tu(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var nu=function(e){Oi(n,e);var t=eu(n);function n(){var e;Si(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Ri(Ti(e),"type","HeatMapLayer"),e}return Ei(n,[{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new $s[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"renderModels",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.getModelType();return"heatmap"===n?(this.layerModel&&this.layerModel.render(t),this):(this.encodeDataLength<=0&&!this.forceRender||(this.hooks.beforeRender.call(),this.models.forEach((function(n){return n.draw({uniforms:e.layerModel.getUninforms(),blend:e.layerModel.getBlend(),stencil:e.layerModel.getStencil(t)})})),this.hooks.afterRender.call()),this)}},{key:"updateModelData",value:function(e){e.attributes&&e.elements?this.models[0].updateAttributesAndElements(e.attributes,e.elements):console.warn("data error")}},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=this.getLayerConfig(),r=n.shape3d,i=this.getSource(),a=i.data.type,o=(null===t||void 0===t||null===(e=t.scale)||void 0===e?void 0:e.field)||"heatmap";return"heatmap"===o||"heatmap3d"===o?"heatmap":"hexagon"===a?-1===(null===r||void 0===r?void 0:r.indexOf(o))?"hexagon":"grid3d":"grid"===a?-1===(null===r||void 0===r?void 0:r.indexOf(o))?"grid":"grid3d":"heatmap"}}]),n}(Aa);function ru(e){var t=iu();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function iu(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var au="precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nvoid main() {\n  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\n  gl_FragColor = color;\n  gl_FragColor.a *= u_opacity;\n  if(gl_FragColor.a < 0.01)\n    discard;\n}\n",ou='precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',su=function(e){Oi(n,e);var t=ru(n);function n(){return Si(this,n),t.apply(this,arguments)}return Ei(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity;return{u_opacity:t||1,u_texture:this.texture}}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){var t,n,r,i,a,o,s=this;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.layer.getSource(),n=this.rendererService.createTexture2D,this.texture=n({height:0,width:0}),!Ue.eW){e.next=11;break}r=this.layerService.sceneService.getSceneConfig().canvas,i=r.createImage(),i.crossOrigin="anonymous",i.src=t.data.originData,i.onload=function(){s.texture=n({data:i,width:i.width,height:i.height}),s.layerService.reRender()},e.next=15;break;case 11:return e.next=13,t.data.images;case 13:a=e.sent,this.texture=n({data:a[0],width:a[0].width,height:a[0].height,mag:yt.gl.LINEAR,min:yt.gl.LINEAR});case 15:return e.next=17,this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:ou,fragmentShader:au,triangulation:Uo,primitive:yt.gl.TRIANGLES,blend:{enable:!0},depth:{enable:!1}});case 17:return o=e.sent,e.abrupt("return",[o]);case 19:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:yt.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),n}(Oa),uu={image:su},lu=uu;function cu(e){var t=fu();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function fu(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var hu=function(e){Oi(n,e);var t=cu(n);function n(){var e;Si(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Ri(Ti(e),"type","ImageLayer"),e}return Ei(n,[{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new lu[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getDefaultConfig",value:function(){var e=this.getModelType(),t={image:{}};return t[e]}},{key:"getModelType",value:function(){return"image"}}]),n}(Aa);function pu(e){var t=du();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function du(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var vu='\nuniform float u_opacity;\n\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nvarying float v_distance_ratio;\n\nuniform float segmentNumber;\n\n\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n\n\n  float flag = 0.;\n  float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n    flag = 1.;\n  };\n  gl_FragColor.a *=flag;\n  \n  gl_FragColor = filterColor(gl_FragColor);\n}',gu='\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nvarying vec4 v_color;\n\n\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nuniform float u_lineDir: 1.0;\nvarying vec4 v_dash_array;\nvarying float v_distance_ratio;\n\nuniform float u_thetaOffset: 0.314;\n\nuniform float u_opacity: 1.0;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = arcThetaOffset;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  if(u_lineDir == 1.0) { // \u6b63\u5411\n    return mid;\n  } else { // \u9006\u5411\n    // (mid + vmin)/2 = (s + t)/2\n    vec2 vmid = source + target - mid;\n    return vmid;\n  }\n  // return mid;\n}\nfloat getSegmentRatio(float index) {\n  // dash: index / (segmentNumber - 1.);\n  // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n  return index / (segmentNumber - 1.);\n}\nvec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  vec2 mid = midPoint(source, target, arcThetaOffset);\n  vec3 x = vec3(source.x, mid.x, target.x);\n  vec3 y = vec3(source.y, mid.y, target.y);\n  return vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nvoid main() {\n  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity);\n  \n  vec2 source = a_Instance.rg;  // \u8d77\u59cb\u70b9\n  vec2 target =  a_Instance.ba; // \u7ec8\u70b9\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n\n  vec2 s = source;\n  vec2 t = target;\n  \n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    s = unProjCustomCoord(source);\n    t = unProjCustomCoord(target);\n  }\n  float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;\n\n  v_distance_ratio = segmentIndex / segmentNumber;\n\n  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, u_thetaOffset), 0.0, 1.0));\n  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, u_thetaOffset), 0.0, 1.0));\n \n  \n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  }\n  gl_PointSize = 5.0;\n  setPickingColor(a_PickingColor);\n}\n',mu='\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform float u_opacity;\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\n// varying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\n\nuniform float segmentNumber;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_lineData;\n\n\n#pragma include "picking"\n\nvoid main() {\n  float animateSpeed = 0.0; // \u8fd0\u52a8\u901f\u5ea6\n  gl_FragColor = v_color;\n  \n  gl_FragColor.a *= u_opacity;\n\n  if(u_animate.x == Animate && u_line_texture != LineTexture) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- v_lineData.b, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n  }\n\n  // \u5f53\u5b58\u5728\u8d34\u56fe\u65f6\u5728\u5e95\u8272\u4e0a\u8d34\u4e0a\u8d34\u56fe\n  if(u_line_texture == LineTexture) { // while load texture\n    float arcRadio = smoothstep( 0.0, 1.0, (v_lineData.r / segmentNumber));\n    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);\n\n    float count = v_lineData.g; // \u8d34\u56fe\u5728\u5f27\u7ebf\u4e0a\u91cd\u590d\u7684\u6570\u91cf\n\n    float time = 0.0;\n    if(u_animate.x == Animate) {\n      time = u_time / u_animate.y;\n    }\n    float redioCount = arcRadio * count;\n\n    float u = fract(redioCount - time);\n    float v = v_lineData.a; // \u6a2a\u5411 v\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n\n    vec4 pattern = texture2D(u_texture, uv);\n\n    if(u_animate.x == Animate) {\n      float currentPlane = floor(redioCount - time);\n      float textureStep = floor(count * u_animate.z);\n      float a = mod(currentPlane, textureStep);\n      if(a < textureStep - 1.0) {\n        pattern = vec4(0.0);\n      }\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= u_opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        gl_FragColor = filterColor(pattern);\n    }\n    \n  } else {\n     gl_FragColor = filterColor(gl_FragColor);\n  }\n}',yu='#define Animate 0.0\n#define LineTexture 1.0\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_color;\n\nuniform float u_lineDir: 1.0;\n\nuniform float u_thetaOffset: 0.314;\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_lineData;\nvarying vec2 v_distance_ratio;\n\nuniform float u_opacity: 1.0;\n\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = arcThetaOffset;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  if(u_lineDir == 1.0) { // \u6b63\u5411\n    return mid;\n  } else { // \u9006\u5411\n    // (mid + vmin)/2 = (s + t)/2\n    vec2 vmid = source + target - mid;\n    return vmid;\n  }\n  // return mid;\n}\nfloat getSegmentRatio(float index) {\n    // dash: index / (segmentNumber - 1.);\n    // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n    //  return index / (segmentNumber - 1.);\n}\nvec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  vec2 mid = midPoint(source, target, arcThetaOffset);\n  vec3 x = vec3(source.x, mid.x, target.x);\n  vec3 y = vec3(source.y, mid.y, target.y);\n  return vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nvoid main() {\n  v_color = a_Color;\n\n  vec2 source = a_Instance.rg;  // \u8d77\u59cb\u70b9\n  vec2 target =  a_Instance.ba; // \u7ec8\u70b9\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  float d_distance_ratio;\n  \n  if(u_animate.x == Animate) {\n      d_distance_ratio = segmentIndex / segmentNumber;\n      if(u_lineDir != 1.0) {\n        d_distance_ratio = 1.0 - d_distance_ratio;\n      }\n  }\n\n v_lineData.b = d_distance_ratio;\n\n  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, u_thetaOffset), 0.0, 1.0));\n  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, u_thetaOffset), 0.0, 1.0));\n\n  \n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n\n\n  float d_segmentIndex = a_Position.x + 1.0; // \u5f53\u524d\u9876\u70b9\u5728\u5f27\u7ebf\u4e2d\u6240\u5904\u7684\u5206\u6bb5\u4f4d\u7f6e\n v_lineData.r = d_segmentIndex;\n\n  if(LineTexture == u_line_texture) { // \u5f00\u542f\u8d34\u56fe\u6a21\u5f0f\n\n    float arcDistrance = length(source - target); // \u8d77\u59cb\u70b9\u548c\u7ec8\u70b9\u7684\u8ddd\u79bb\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap\n      arcDistrance *= 1000000.0;\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox\n      // arcDistrance *= 8.0;\n      arcDistrance = project_pixel_allmap(arcDistrance);\n    }\n    v_iconMapUV = a_iconMapUV;\n\n    float pixelLen = project_pixel_texture(u_icon_step); // \u8d34\u56fe\u6cbf\u5f27\u7ebf\u65b9\u5411\u7684\u957f\u5ea6 - \u968f\u5730\u56fe\u7f29\u653e\u6539\u53d8\n    float texCount = floor(arcDistrance/pixelLen); // \u8d34\u56fe\u5728\u5f27\u7ebf\u4e0a\u91cd\u590d\u7684\u6570\u91cf\n    v_lineData.g = texCount;\n\n    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7ebf\u6a2a\u5411\u504f\u79fb\u7684\u8ddd\u79bb\n    float linePixelSize = project_pixel(a_Size); // \u5b9a\u70b9\u4f4d\u7f6e\u504f\u79fb\n    v_lineData.a = lineOffsetWidth/linePixelSize; // \u7ebf\u56fe\u5c42\u8d34\u56fe\u90e8\u5206\u7684 v \u5750\u6807\u503c\n  }\n  \n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  }\n  setPickingColor(a_PickingColor);\n}\n',_u='varying vec4 v_color;\n\n#pragma include "picking"\n\nvoid main() {\n// \u5f53\u524d\u9876\u70b9\u5728\u5f27\u7ebf\u4e2d\u6240\u5904\u7684\u5206\u6bb5\u4f4d\u7f6e\n\n  gl_FragColor = v_color;\n  gl_FragColor = filterColor(gl_FragColor);\n}',xu='\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nvarying vec4 v_color;\nvarying float v_segmentIndex;\n\nuniform float u_lineDir: 1.0;\nuniform float u_opacity: 1.0;\n\nuniform float u_thetaOffset: 0.314;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\n\n\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = arcThetaOffset;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  if(u_lineDir == 1.0) { // \u6b63\u5411\n    return mid;\n  } else { // \u9006\u5411\n    // (mid + vmin)/2 = (s + t)/2\n    vec2 vmid = source + target - mid;\n    return vmid;\n  }\n  // return mid;\n}\nfloat getSegmentRatio(float index) {\n    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n}\nvec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  vec2 mid = midPoint(source, target, arcThetaOffset);\n  vec3 x = vec3(source.x, mid.x, target.x);\n  vec3 y = vec3(source.y, mid.y, target.y);\n  return vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nvoid main() {\n  v_color = a_Color;\n\n  vec2 source = a_Instance.rg;  // \u8d77\u59cb\u70b9\n  vec2 target =  a_Instance.ba; // \u7ec8\u70b9\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  float d_distance_ratio;\n  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, u_thetaOffset), 0.0, 1.0));\n  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, u_thetaOffset), 0.0, 1.0));\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n  //unProjCustomCoord\n  \n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n\n\n  float d_segmentIndex = a_Position.x + 1.0; // \u5f53\u524d\u9876\u70b9\u5728\u5f27\u7ebf\u4e2d\u6240\u5904\u7684\u5206\u6bb5\u4f4d\u7f6e\n\n  v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);\n  v_color.a *= u_opacity;\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  }\n  setPickingColor(a_PickingColor);\n}\n',bu={solid:0,dash:1},Su=function(e){Oi(n,e);var t=pu(n);function n(){var e;Si(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Ri(Ti(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:yt.gl.NEAREST,min:yt.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})})),e}return Ei(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.sourceColor,i=e.targetColor,a=e.textureBlend,o=void 0===a?"normal":a,s=e.lineType,u=void 0===s?"solid":s,l=e.dashArray,c=void 0===l?[10,5]:l,f=e.forward,h=void 0===f||f,p=e.lineTexture,d=void 0!==p&&p,v=e.iconStep,g=void 0===v?100:v,m=e.segmentNumber,y=void 0===m?30:m,_=e.thetaOffset,x=void 0===_?.314:_;2===c.length&&c.push(0,0);var b=0,S=[0,0,0,0],w=[0,0,0,0];return r&&i&&(S=(0,Ue.CI)(r),w=(0,Ue.CI)(i),b=1),this.rendererService.getDirty()&&this.texture.bind(),{u_thetaOffset:x,u_opacity:(0,Zt.isNumber)(n)?n:1,u_textureBlend:"normal"===o?0:1,segmentNumber:y,u_line_type:bu[u||"solid"],u_dash_array:c,u_blur:.9,u_lineDir:h?1:-1,u_texture:this.texture,u_line_texture:d?1:0,u_icon_step:g,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:b,u_sourceColor:S,u_targetColor:w}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig(),t=e.animateOption;return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor,r=e.lineType;return"dash"===r?{frag:vu,vert:gu,type:"Dash"}:t&&n?{frag:_u,vert:xu,type:"Linear"}:{frag:mu,vert:yu,type:""}}},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t,n,r,i,a,o,s,u;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.segmentNumber,r=void 0===n?30:n,i=this.getShaders(),a=i.frag,o=i.vert,s=i.type,e.next=4,this.layer.buildLayerModel({moduleName:"lineArc2d"+s,vertexShader:o,fragmentShader:a,triangulation:Vo,depth:{enable:!1},segmentNumber:r});case 4:return u=e.sent,e.abrupt("return",[u]);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:yt.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:yt.GC.Attribute,descriptor:{name:"a_Instance",buffer:{usage:yt.gl.STATIC_DRAW,data:[],type:yt.gl.FLOAT},size:4,update:function(e,t,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:yt.GC.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap(),r=t.texture,i=n[r]||{x:0,y:0},a=i.x,o=i.y;return[a,o]}}})}}]),n}(Oa);function wu(e){var t=Cu();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function Cu(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var ku='#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\n// varying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nvarying vec4 v_line_data;\n\nuniform float u_line_texture: 0.0;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nvarying float v_segmentIndex;\nuniform float segmentNumber;\nuniform float u_opacity;\n\nvarying vec2 v_iconMapUV;\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = u_opacity;\n  float animateSpeed = 0.0; // \u8fd0\u52a8\u901f\u5ea6\n  float d_distance_ratio = v_line_data.g; // \u5f53\u524d\u70b9\u4f4d\u8ddd\u79bb\u5360\u7ebf\u603b\u957f\u7684\u6bd4\u4f8b\n  gl_FragColor = v_color;\n\n  gl_FragColor.a *= opacity;\n  if(u_line_type == LineTypeDash) {\n    float flag = 0.;\n    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n      flag = 1.;\n    }\n    gl_FragColor.a *=flag;\n  }\n\n  if(u_animate.x == Animate && u_line_texture != LineTexture) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n\n      // u_animate \n      // x enable\n      // y duration\n      // z interval\n      // w trailLength\n  }\n\n  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture\n    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));\n    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);\n    float count = v_line_data.b; // // \u8d34\u56fe\u5728\u5f27\u7ebf\u4e0a\u91cd\u590d\u7684\u6570\u91cf\n\n    float time = 0.0;\n    if(u_animate.x == Animate) {\n      time = u_time / u_animate.y;\n    }\n    float redioCount = arcRadio * count;\n\n    float u = fract(redioCount - time);\n\n    float v = v_line_data.a;  // \u7ebf\u56fe\u5c42\u8d34\u56fe\u90e8\u5206\u7684 v \u5750\u6807\u503c\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture2D(u_texture, uv);\n\n    if(u_animate.x == Animate) {\n      float currentPlane = floor(redioCount - time);\n      float textureStep = floor(count * u_animate.z);\n      float a = mod(currentPlane, textureStep);\n      if(a < textureStep - 1.0) {\n        pattern = vec4(0.0);\n      }\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n          discard;\n        } else {\n          gl_FragColor = filterColor(pattern);\n        }\n    }\n\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n',Au='#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\n\nuniform float u_globel;\nuniform float u_globel_radius;\nuniform float u_global_height: 10;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_color;\n\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\n\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nvarying float v_segmentIndex;\n\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_line_data;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n  );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nfloat torad(float deg) {\n  return (deg / 180.0) * acos(-1.0);\n}\n\nvec3 lglt2xyz(vec2 lnglat) {\n  float pi = 3.1415926;\n  // + Math.PI/2 \u662f\u4e3a\u4e86\u5bf9\u9f50\u5750\u6807\n  float lng = torad(lnglat.x) + pi / 2.0;\n  float lat = torad(lnglat.y);\n\n  // \u624b\u52a8\u589e\u52a0\u4e00\u4e9b\u504f\u79fb\uff0c\u51cf\u8f7b\u9762\u7684\u51b2\u7a81\n  float radius = u_globel_radius;\n\n  float z = radius * cos(lat) * cos(lng);\n  float x = radius * cos(lat) * sin(lng);\n  float y = radius * sin(lat);\n  return vec3(x, y, z);\n}\n\nvoid main() {\n\n  v_color = a_Color;\n  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\n  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  float d_distance_ratio;\n   if(u_line_type == LineTypeDash) {\n    d_distance_ratio = segmentIndex / segmentNumber;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  }\n    if(u_animate.x == Animate) {\n      d_distance_ratio = segmentIndex / segmentNumber;\n  }\n  v_line_data.g = d_distance_ratio; // \u5f53\u524d\u70b9\u4f4d\u8ddd\u79bb\u5360\u7ebf\u603b\u957f\u7684\u6bd4\u4f8b\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  vec3 curr = getPos(source, target, segmentRatio);\n  vec3 next = getPos(source, target, nextSegmentRatio);\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n\n\n  v_segmentIndex = a_Position.x;\n  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5f00\u542f\u8d34\u56fe\u6a21\u5f0f  \n\n    float arcDistrance = length(source - target);\n    float pixelLen =  project_pixel_texture(u_icon_step);\n    v_line_data.b = floor(arcDistrance/pixelLen); // \u8d34\u56fe\u5728\u5f27\u7ebf\u4e0a\u91cd\u590d\u7684\u6570\u91cf\n\n    vec2 projectOffset = project_pixel(offset);\n    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7ebf\u6a2a\u5411\u504f\u79fb\u7684\u8ddd\u79bb\n    float linePixelSize = project_pixel(a_Size);  // \u5b9a\u70b9\u4f4d\u7f6e\u504f\u79fb\uff0c\u6309\u5730\u56fe\u7b49\u7ea7\u7f29\u653e\u540e\u7684\u8ddd\u79bb\n    v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7ebf\u56fe\u5c42\u8d34\u56fe\u90e8\u5206\u7684 v \u5750\u6807\u503c\n\n    v_iconMapUV = a_iconMapUV;\n  }\n  \n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  }\n\n  // \u5730\u7403\u6a21\u5f0f\n  if(u_globel > 0.0) {\n    vec3 startLngLat = lglt2xyz(a_Instance.rg);\n    vec3 endLngLat = lglt2xyz(a_Instance.ba);\n    float globalRadius = length(startLngLat);\n\n    vec3 lineDir = normalize(endLngLat - startLngLat);\n    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\n\n    // \u7ebf\u7684\u504f\u79fb\n    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\n    // \u8ba1\u7b97\u8d77\u59cb\u70b9\u548c\u7ec8\u6b62\u70b9\u7684\u8ddd\u79bb\n    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\n    // \u8ba1\u7b97\u98de\u7ebf\u5404\u4e2a\u8282\u70b9\u76f8\u5e94\u7684\u9ad8\u5ea6\n    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\n    // \u5730\u7403\u70b9\u4f4d\n    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\n    \n    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n  }\n \n\n  setPickingColor(a_PickingColor);\n}\n',Eu='\n#define Animate 0.0\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_Color;\n\nvarying float v_distance_ratio;\n#pragma include "picking"\n\nvoid main() {\n\n  float animateSpeed = 0.0; // \u8fd0\u52a8\u901f\u5ea6\n  gl_FragColor = v_Color;\n\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n\n      // u_animate \n      // x enable\n      // y duration\n      // z interval\n      // w trailLength\n  }\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',Tu='#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\nattribute vec2 a_iconMapUV;\n\nuniform float u_globel;\nuniform float u_globel_radius;\nuniform float u_global_height: 10;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nvarying float v_distance_ratio;\n\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_Color;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n  );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nfloat torad(float deg) {\n  return (deg / 180.0) * acos(-1.0);\n}\n\nvec3 lglt2xyz(vec2 lnglat) {\n  float pi = 3.1415926;\n  // + Math.PI/2 \u662f\u4e3a\u4e86\u5bf9\u9f50\u5750\u6807\n  float lng = torad(lnglat.x) + pi / 2.0;\n  float lat = torad(lnglat.y);\n\n  // \u624b\u52a8\u589e\u52a0\u4e00\u4e9b\u504f\u79fb\uff0c\u51cf\u8f7b\u9762\u7684\u51b2\u7a81\n  float radius = u_globel_radius;\n\n  float z = radius * cos(lat) * cos(lng);\n  float x = radius * cos(lat) * sin(lng);\n  float y = radius * sin(lat);\n  return vec3(x, y, z);\n}\n\nvoid main() {\n  // cal style mapping - \u6570\u636e\u7eb9\u7406\u6620\u5c04\u90e8\u5206\u7684\u8ba1\u7b97\n\n  v_color = a_Color;\n  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\n  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  float d_distance_ratio;\n   if(u_line_type == LineTypeDash) {\n    d_distance_ratio = segmentIndex / segmentNumber;\n    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  }\n    if(u_animate.x == Animate) {\n      v_distance_ratio = segmentIndex / segmentNumber;\n  }\n\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  vec3 curr = getPos(source, target, segmentRatio);\n  vec3 next = getPos(source, target, nextSegmentRatio);\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\n\n  float animateSpeed = 0.0; // \u8fd0\u52a8\u901f\u5ea6\n  v_Color = mix(u_sourceColor, u_targetColor, a_Position.x/segmentNumber);\n\n  v_Color.a *= opacity;\n\n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  }\n\n  // \u5730\u7403\u6a21\u5f0f\n  if(u_globel > 0.0) {\n    vec3 startLngLat = lglt2xyz(a_Instance.rg);\n    vec3 endLngLat = lglt2xyz(a_Instance.ba);\n    float globalRadius = length(startLngLat);\n\n    vec3 lineDir = normalize(endLngLat - startLngLat);\n    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\n\n    // \u7ebf\u7684\u504f\u79fb\n    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\n    // \u8ba1\u7b97\u8d77\u59cb\u70b9\u548c\u7ec8\u6b62\u70b9\u7684\u8ddd\u79bb\n    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\n    // \u8ba1\u7b97\u98de\u7ebf\u5404\u4e2a\u8282\u70b9\u76f8\u5e94\u7684\u9ad8\u5ea6\n    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\n    // \u5730\u7403\u70b9\u4f4d\n    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\n    \n    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n  }\n \n\n  setPickingColor(a_PickingColor);\n}\n',Mu={solid:0,dash:1},Ou=function(e){Oi(n,e);var t=wu(n);function n(){var e;Si(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Ri(Ti(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:yt.gl.NEAREST,min:yt.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})})),e}return Ei(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor,r=e.textureBlend,i=void 0===r?"normal":r,a=e.lineType,o=void 0===a?"solid":a,s=e.dashArray,u=void 0===s?[10,5]:s,l=e.lineTexture,c=void 0!==l&&l,f=e.iconStep,h=void 0===f?100:f,p=e.segmentNumber,d=void 0===p?30:p,v=e.globalArcHeight,g=void 0===v?10:v;2===u.length&&u.push(0,0);var m=0,y=[0,0,0,0],_=[0,0,0,0];return t&&n&&(y=(0,Ue.CI)(t),_=(0,Ue.CI)(n),m=1),this.rendererService.getDirty()&&this.texture.bind(),Yi({u_globel:"GLOBEL"===this.mapService.version?1:0,u_globel_radius:Za,u_global_height:g,u_textureBlend:"normal"===i?0:1,segmentNumber:d,u_line_type:Mu[o]||0,u_dash_array:u,u_texture:this.texture,u_line_texture:c?1:0,u_icon_step:h,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:m,u_sourceColor:y,u_targetColor:_},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig(),t=e.animateOption;return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor;return t&&n?{frag:Eu,vert:Tu,type:"Linear"}:{frag:ku,vert:Au,type:""}}},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t,n,r,i,a,o,s,u;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.segmentNumber,r=void 0===n?30:n,i=this.getShaders(),a=i.frag,o=i.vert,s=i.type,e.next=4,this.layer.buildLayerModel({moduleName:"lineArc3d"+s,vertexShader:o,fragmentShader:a,inject:this.getInject(),triangulation:Vo,segmentNumber:r});case 4:return u=e.sent,e.abrupt("return",[u]);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:yt.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:yt.GC.Attribute,descriptor:{name:"a_Instance",buffer:{usage:yt.gl.STATIC_DRAW,data:[],type:yt.gl.FLOAT},size:4,update:function(e,t,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:yt.GC.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap(),r=t.texture,i=n[r]||{x:0,y:0},a=i.x,o=i.y;return[a,o]}}})}}]),n}(Oa);function Lu(e){var t=Pu();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function Pu(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Ru='#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\n// varying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nvarying vec4 v_line_data;\n\nuniform float u_line_texture: 0.0;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nvarying float v_segmentIndex;\nuniform float segmentNumber;\nuniform float u_opacity;\n\nvarying vec2 v_iconMapUV;\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = u_opacity;\n  float animateSpeed = 0.0; // \u8fd0\u52a8\u901f\u5ea6\n  float d_distance_ratio = v_line_data.g; // \u5f53\u524d\u70b9\u4f4d\u8ddd\u79bb\u5360\u7ebf\u603b\u957f\u7684\u6bd4\u4f8b\n  gl_FragColor = v_color;\n\n  gl_FragColor.a *= opacity;\n  if(u_line_type == LineTypeDash) {\n    float flag = 0.;\n    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n      flag = 1.;\n    }\n    gl_FragColor.a *=flag;\n  }\n\n  if(u_animate.x == Animate && u_line_texture != LineTexture) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n\n      // u_animate \n      // x enable\n      // y duration\n      // z interval\n      // w trailLength\n  }\n\n  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture\n    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));\n    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);\n    float count = v_line_data.b; // // \u8d34\u56fe\u5728\u5f27\u7ebf\u4e0a\u91cd\u590d\u7684\u6570\u91cf\n\n    float time = 0.0;\n    if(u_animate.x == Animate) {\n      time = u_time / u_animate.y;\n    }\n    float redioCount = arcRadio * count;\n\n    float u = fract(redioCount - time);\n\n    float v = v_line_data.a;  // \u7ebf\u56fe\u5c42\u8d34\u56fe\u90e8\u5206\u7684 v \u5750\u6807\u503c\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture2D(u_texture, uv);\n\n    if(u_animate.x == Animate) {\n      float currentPlane = floor(redioCount - time);\n      float textureStep = floor(count * u_animate.z);\n      float a = mod(currentPlane, textureStep);\n      if(a < textureStep - 1.0) {\n        pattern = vec4(0.0);\n      }\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n          discard;\n        } else {\n          gl_FragColor = filterColor(pattern);\n        }\n    }\n\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n',Iu='#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\n\nuniform float u_globel;\nuniform float u_globel_radius;\nuniform float u_global_height: 10;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_color;\n\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\n\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nvarying float v_segmentIndex;\n\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_line_data;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n  );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nfloat torad(float deg) {\n  return (deg / 180.0) * acos(-1.0);\n}\n\nvec3 lglt2xyz(vec2 lnglat) {\n  float pi = 3.1415926;\n  // + Math.PI/2 \u662f\u4e3a\u4e86\u5bf9\u9f50\u5750\u6807\n  float lng = torad(lnglat.x) + pi / 2.0;\n  float lat = torad(lnglat.y);\n\n  // \u624b\u52a8\u589e\u52a0\u4e00\u4e9b\u504f\u79fb\uff0c\u51cf\u8f7b\u9762\u7684\u51b2\u7a81\n  float radius = u_globel_radius;\n\n  float z = radius * cos(lat) * cos(lng);\n  float x = radius * cos(lat) * sin(lng);\n  float y = radius * sin(lat);\n  return vec3(x, y, z);\n}\n\nvoid main() {\n\n  v_color = a_Color;\n  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\n  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  float d_distance_ratio;\n   if(u_line_type == LineTypeDash) {\n    d_distance_ratio = segmentIndex / segmentNumber;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  }\n    if(u_animate.x == Animate) {\n      d_distance_ratio = segmentIndex / segmentNumber;\n  }\n  v_line_data.g = d_distance_ratio; // \u5f53\u524d\u70b9\u4f4d\u8ddd\u79bb\u5360\u7ebf\u603b\u957f\u7684\u6bd4\u4f8b\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  vec3 curr = getPos(source, target, segmentRatio);\n  vec3 next = getPos(source, target, nextSegmentRatio);\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n\n\n  v_segmentIndex = a_Position.x;\n  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5f00\u542f\u8d34\u56fe\u6a21\u5f0f  \n\n    float arcDistrance = length(source - target);\n    float pixelLen =  project_pixel_texture(u_icon_step);\n    v_line_data.b = floor(arcDistrance/pixelLen); // \u8d34\u56fe\u5728\u5f27\u7ebf\u4e0a\u91cd\u590d\u7684\u6570\u91cf\n\n    vec2 projectOffset = project_pixel(offset);\n    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7ebf\u6a2a\u5411\u504f\u79fb\u7684\u8ddd\u79bb\n    float linePixelSize = project_pixel(a_Size);  // \u5b9a\u70b9\u4f4d\u7f6e\u504f\u79fb\uff0c\u6309\u5730\u56fe\u7b49\u7ea7\u7f29\u653e\u540e\u7684\u8ddd\u79bb\n    v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7ebf\u56fe\u5c42\u8d34\u56fe\u90e8\u5206\u7684 v \u5750\u6807\u503c\n\n    v_iconMapUV = a_iconMapUV;\n  }\n  \n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  }\n\n  // \u5730\u7403\u6a21\u5f0f\n  if(u_globel > 0.0) {\n    vec3 startLngLat = lglt2xyz(a_Instance.rg);\n    vec3 endLngLat = lglt2xyz(a_Instance.ba);\n    float globalRadius = length(startLngLat);\n\n    vec3 lineDir = normalize(endLngLat - startLngLat);\n    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\n\n    // \u7ebf\u7684\u504f\u79fb\n    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\n    // \u8ba1\u7b97\u8d77\u59cb\u70b9\u548c\u7ec8\u6b62\u70b9\u7684\u8ddd\u79bb\n    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\n    // \u8ba1\u7b97\u98de\u7ebf\u5404\u4e2a\u8282\u70b9\u76f8\u5e94\u7684\u9ad8\u5ea6\n    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\n    // \u5730\u7403\u70b9\u4f4d\n    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\n    \n    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n  }\n \n\n  setPickingColor(a_PickingColor);\n}\n',Du='\n#define Animate 0.0\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_Color;\n\nvarying float v_distance_ratio;\n#pragma include "picking"\n\nvoid main() {\n\n  float animateSpeed = 0.0; // \u8fd0\u52a8\u901f\u5ea6\n  gl_FragColor = v_Color;\n\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n\n      // u_animate \n      // x enable\n      // y duration\n      // z interval\n      // w trailLength\n  }\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',zu='#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\nattribute vec2 a_iconMapUV;\n\nuniform float u_globel;\nuniform float u_globel_radius;\nuniform float u_global_height: 10;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nvarying float v_distance_ratio;\n\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_Color;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n  );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nfloat torad(float deg) {\n  return (deg / 180.0) * acos(-1.0);\n}\n\nvec3 lglt2xyz(vec2 lnglat) {\n  float pi = 3.1415926;\n  // + Math.PI/2 \u662f\u4e3a\u4e86\u5bf9\u9f50\u5750\u6807\n  float lng = torad(lnglat.x) + pi / 2.0;\n  float lat = torad(lnglat.y);\n\n  // \u624b\u52a8\u589e\u52a0\u4e00\u4e9b\u504f\u79fb\uff0c\u51cf\u8f7b\u9762\u7684\u51b2\u7a81\n  float radius = u_globel_radius;\n\n  float z = radius * cos(lat) * cos(lng);\n  float x = radius * cos(lat) * sin(lng);\n  float y = radius * sin(lat);\n  return vec3(x, y, z);\n}\n\nvoid main() {\n  // cal style mapping - \u6570\u636e\u7eb9\u7406\u6620\u5c04\u90e8\u5206\u7684\u8ba1\u7b97\n\n  v_color = a_Color;\n  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\n  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  float d_distance_ratio;\n   if(u_line_type == LineTypeDash) {\n    d_distance_ratio = segmentIndex / segmentNumber;\n    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  }\n    if(u_animate.x == Animate) {\n      v_distance_ratio = segmentIndex / segmentNumber;\n  }\n\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  vec3 curr = getPos(source, target, segmentRatio);\n  vec3 next = getPos(source, target, nextSegmentRatio);\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\n\n  float animateSpeed = 0.0; // \u8fd0\u52a8\u901f\u5ea6\n  v_Color = mix(u_sourceColor, u_targetColor, a_Position.x/segmentNumber);\n\n  v_Color.a *= opacity;\n\n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  }\n\n  // \u5730\u7403\u6a21\u5f0f\n  if(u_globel > 0.0) {\n    vec3 startLngLat = lglt2xyz(a_Instance.rg);\n    vec3 endLngLat = lglt2xyz(a_Instance.ba);\n    float globalRadius = length(startLngLat);\n\n    vec3 lineDir = normalize(endLngLat - startLngLat);\n    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\n\n    // \u7ebf\u7684\u504f\u79fb\n    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\n    // \u8ba1\u7b97\u8d77\u59cb\u70b9\u548c\u7ec8\u6b62\u70b9\u7684\u8ddd\u79bb\n    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\n    // \u8ba1\u7b97\u98de\u7ebf\u5404\u4e2a\u8282\u70b9\u76f8\u5e94\u7684\u9ad8\u5ea6\n    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\n    // \u5730\u7403\u70b9\u4f4d\n    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\n    \n    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n  }\n \n\n  setPickingColor(a_PickingColor);\n}\n',Nu={solid:0,dash:1},Fu=function(e){Oi(n,e);var t=Lu(n);function n(){var e;Si(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Ri(Ti(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:yt.gl.NEAREST,min:yt.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})})),e}return Ei(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.sourceColor,i=e.targetColor,a=e.textureBlend,o=void 0===a?"normal":a,s=e.lineType,u=void 0===s?"solid":s,l=e.dashArray,c=void 0===l?[10,5]:l,f=e.lineTexture,h=void 0!==f&&f,p=e.iconStep,d=void 0===p?100:p,v=e.segmentNumber,g=void 0===v?30:v,m=e.globalArcHeight,y=void 0===m?10:m;2===c.length&&c.push(0,0);var _=0,x=[0,0,0,0],b=[0,0,0,0];return r&&i&&(x=(0,Ue.CI)(r),b=(0,Ue.CI)(i),_=1),this.rendererService.getDirty()&&this.texture.bind(),{u_globel:1,u_globel_radius:Za,u_global_height:y,u_opacity:n,u_textureBlend:"normal"===o?0:1,segmentNumber:g,u_line_type:Nu[u]||0,u_dash_array:c,u_texture:this.texture,u_line_texture:h?1:0,u_icon_step:d,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:_,u_sourceColor:x,u_targetColor:b}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig(),t=e.animateOption;return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor;return t&&n?{frag:Du,vert:zu,type:"Linear"}:{frag:Ru,vert:Iu,type:""}}},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t,n,r,i,a,o,s,u;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.segmentNumber,r=void 0===n?30:n,i=this.getShaders(),a=i.frag,o=i.vert,s=i.type,e.next=4,this.layer.buildLayerModel({moduleName:"lineEarthArc3d"+s,vertexShader:o,fragmentShader:a,triangulation:Vo,depth:{enable:!0},segmentNumber:r});case 4:return u=e.sent,e.abrupt("return",[u]);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:yt.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:yt.GC.Attribute,descriptor:{name:"a_Instance",buffer:{usage:yt.gl.STATIC_DRAW,data:[],type:yt.gl.FLOAT},size:4,update:function(e,t,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:yt.GC.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap(),r=t.texture,i=n[r]||{x:0,y:0},a=i.x,o=i.y;return[a,o]}}})}}]),n}(Oa);function ju(e){var t=Bu();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function Bu(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Uu='#extension GL_OES_standard_derivatives : enable\n\nvarying vec4 v_color;\n\n\n// line texture\n\n#pragma include "picking"\n\nvoid main() {\ngl_FragColor = v_color;\ngl_FragColor = filterColor(gl_FragColor);\n}\n',Vu='attribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec4 a_Instance;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\n#pragma include "projection"\n#pragma include "picking"\nvarying vec4 v_color;\nuniform float u_gap_width: 1.0;\nuniform float u_stroke_width: 1.0;\nuniform float u_stroke_opacity: 1.0;\n\n\nvoid main() {\n\n// #ifdef USE_ATTRIBUTE_OPACITY\n//   float opacity  = a_Opacity;\n// #else\n//   float opacity = u_opacity;\n// #endif\n\n\n// #ifdef USE_ATTRIBUTE_OFFSETS\n//   vec2 offsets  = a_Offsets;\n// #else\n//   vec2 offsets = u_offsets;\n// #endif\n\n  // float opacity = u_opacity;\n// \u900f\u660e\u5ea6\u8ba1\u7b97\n  vec2 source = a_Instance.rg;  // \u8d77\u59cb\u70b9\n  vec2 target =  a_Instance.ba; // \u7ec8\u70b9\n  vec2 flowlineDir = normalize(target - source);\n  vec2 perpendicularDir = vec2(-flowlineDir.y, flowlineDir.x);\n\n\n  vec2 position = mix(source, target, a_Position.x);\n\n  float lengthCommon = length(target - source);    \n  vec2 offsetDistances = a_Size.x * project_pixel(a_Position.yz);\n  vec2 limitedOffsetDistances = clamp(   \n   offsetDistances,\n    -lengthCommon*.8, lengthCommon*.8\n  );\n\n  float startOffsetCommon = project_pixel(offsets[0]);\n  float endOffsetCommon = project_pixel(offsets[1]);\n  float endpointOffset = mix(\n    clamp(startOffsetCommon, 0.0, lengthCommon*.2),\n    -clamp(endOffsetCommon, 0.0, lengthCommon*.2),\n    a_Position.x\n  );\n\n  vec2 normalsCommon =  u_stroke_width * project_pixel(a_Normal.xy);\n\n  float gapCommon =  project_pixel(u_gap_width);\n  vec3 offsetCommon = vec3(\n    flowlineDir * (limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -\n    perpendicularDir * (limitedOffsetDistances[0] + gapCommon + normalsCommon.x),\n    0.0\n  );\n\n\n  vec4 project_pos = project_position(vec4(position.xy, 0, 1.0));\n\n  vec4 fillColor = vec4(a_Color.rgb, a_Color.a * opacity);\n  v_color = mix(fillColor, vec4(u_stroke.xyz, u_stroke.w * fillColor.w * u_stroke_opacity), a_Normal.z);\n\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(project_pos.xy + offsetCommon.xy, 0., 1.0);\n  } else {\n     gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offsetCommon.xy, 0., 1.0));\n  }\n\n\n\n  setPickingColor(a_PickingColor);\n}\n',Gu=function(e){Oi(n,e);var t=ju(n);function n(){return Si(this,n),t.apply(this,arguments)}return Ei(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.gapWidth,n=void 0===t?2:t,r=e.strokeWidth,i=void 0===r?1:r,a=e.stroke,o=void 0===a?"#000":a,s=e.strokeOpacity,u=void 0===s?1:s;return Yi({u_gap_width:n,u_stroke_width:i,u_stroke:(0,Ue.CI)(o),u_stroke_opacity:u},this.getStyleAttribute())}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"flow_line",vertexShader:Vu,fragmentShader:Uu,inject:this.getInject(),triangulation:Lo,primitive:yt.gl.TRIANGLES,depth:{enable:!1},pick:!1});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:yt.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:yt.GC.Attribute,descriptor:{name:"a_Instance",buffer:{usage:yt.gl.STATIC_DRAW,data:[],type:yt.gl.FLOAT},size:4,update:function(e,t,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:yt.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:yt.gl.STATIC_DRAW,data:[],type:yt.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}})}}]),n}(Oa);function Hu(e){var t=Wu();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function Wu(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Yu='#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform float u_opacity;\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\n// varying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying float v_distance_ratio;\nvarying vec4 v_color;\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\nuniform float u_line_texture: 0.0;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float segmentNumber;\n\nvarying vec2 v_iconMapUV;\n\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nvarying vec4 v_line_data;\n\n#pragma include "picking"\n#pragma include "project"\n#pragma include "projection"\n\nvoid main() {\n  float opacity = u_opacity;\n  float animateSpeed = 0.0;\n  float d_segmentIndex = v_line_data.g;\n  \n  // \u8bbe\u7f6e\u5f27\u7ebf\u7684\u5e95\u8272\n  if(u_linearColor == 1.0) { // \u4f7f\u7528\u6e10\u53d8\u989c\u8272\n    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);\n  } else { // \u4f7f\u7528 color \u65b9\u6cd5\u4f20\u5165\u7684\u989c\u8272\n     gl_FragColor = v_color;\n  }\n\n  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));\n  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));\n  gl_FragColor.a *= opacity;\n  if(u_line_type == LineTypeDash) {\n    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n      // \u5b9e\u7ebf\u90e8\u5206\n    } else {\n      // \u865a\u7ebf\u90e8\u5206\n      discard;\n    };\n  }\n\n  // \u8bbe\u7f6e\u5f27\u7ebf\u7684\u52a8\u753b\u6a21\u5f0f\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      alpha = smoothstep(0., 1., alpha);\n      gl_FragColor.a *= alpha;\n  }\n\n  // \u8bbe\u7f6e\u5f27\u7ebf\u7684\u8d34\u56fe\n  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { \n    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));\n    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);\n    float count = v_line_data.b; // \u8d34\u56fe\u5728\u5f27\u7ebf\u4e0a\u91cd\u590d\u7684\u6570\u91cf\n    float u = fract(arcRadio * count - animateSpeed * count);\n    // float u = fract(arcRadio * count - animateSpeed);\n    if(u_animate.x == Animate) {\n      u = gl_FragColor.a/opacity;\n    }\n\n    float v = v_line_data.a; // \u7ebf\u56fe\u5c42\u8d34\u56fe\u90e8\u5206\u7684 v \u5750\u6807\u503c\n\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture2D(u_texture, uv);\n    \n    // \u8bbe\u7f6e\u8d34\u56fe\u548c\u5e95\u8272\u7684\u53e0\u52a0\u6a21\u5f0f\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        gl_FragColor = filterColor(pattern);\n    }\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n\n  // gl_FragColor = filterColor(gl_FragColor);\n}',qu='#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_color;\n\nvarying float v_distance_ratio;\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\n\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\n\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_line_data;\n\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n    return index / (segmentNumber - 1.);\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n    vec2 x = mix(source, target, ratio);\n    vec2 center = mix(source, target, 0.5);\n    float dSourceCenter = distance(source, center);\n    float dXCenter = distance(x, center);\n    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n     float vertex_height = paraboloid(source, target, segmentRatio);\n\n    return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n    );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\nfloat getAngularDist (vec2 source, vec2 target) {\n  vec2 delta = source - target;\n  vec2 sin_half_delta = sin(delta / 2.0);\n  float a =\n    sin_half_delta.y * sin_half_delta.y +\n    cos(source.y) * cos(target.y) *\n    sin_half_delta.x * sin_half_delta.x;\n  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));\n}\n\nvec2 midPoint(vec2 source, vec2 target) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = 0.314;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  return mid;\n}\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\n\nvec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    vec2 mid = midPoint(source, target);\n    vec3 x = vec3(source.x, mid.x, target.x);\n    vec3 y = vec3(source.y, mid.y, target.y);\n    return vec2(bezier3(x ,t), bezier3(y,t));\n  }else {\n    if(abs(angularDist - PI) < 0.001) {\n      return (1.0 - t) * source + t * target;\n    }\n    float a = sin((1.0 - t) * angularDist) / sin(angularDist);\n    float b = sin(t * angularDist) / sin(angularDist);\n    vec2 sin_source = sin(source);\n    vec2 cos_source = cos(source);\n    vec2 sin_target = sin(target);\n    vec2 cos_target = cos(target);\n    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;\n    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;\n    float z = a * sin_source.y + b * sin_target.y;\n    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));\n  }\n}\n\nvoid main() {\n  \n\n  v_color = a_Color;\n  vec2 source = radians(a_Instance.rg);\n  vec2 target = radians(a_Instance.ba);\n  float angularDist = getAngularDist(source, target);\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  if(u_line_type == LineTypeDash) {\n    v_distance_ratio = segmentIndex / segmentNumber;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    total_Distance = total_Distance*16.0; // total_Distance*16.0 \u8c03\u6574\u9ed8\u8ba4\u7684\u6548\u679c\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;\n  }\n\n  if(u_animate.x == Animate) {\n      v_distance_ratio = segmentIndex / segmentNumber;\n  }\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  v_distance_ratio = segmentIndex / segmentNumber;\n  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));\n  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));\n\nv_line_data.g = a_Position.x; // \u8be5\u9876\u70b9\u5728\u5f27\u7ebf\u4e0a\u7684\u5206\u6bb5\u6392\u5e8f\n  if(LineTexture == u_line_texture) { // \u5f00\u542f\u8d34\u56fe\u6a21\u5f0f  \n    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;\n    float d_arcDistrance = length(source - target);\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap\n      d_arcDistrance = d_arcDistrance * 1000000.0;\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox\n      d_arcDistrance = project_pixel_allmap(d_arcDistrance);\n    }\n    float d_pixelLen = project_pixel(u_icon_step)/8.0;\nv_line_data.b = floor(d_arcDistrance/d_pixelLen); // \u8d34\u56fe\u5728\u5f27\u7ebf\u4e0a\u91cd\u590d\u7684\u6570\u91cf\n\n    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7ebf\u6a2a\u5411\u504f\u79fb\u7684\u8ddd\u79bb\n    float linePixelSize = project_pixel(a_Size);  // \u5b9a\u70b9\u4f4d\u7f6e\u504f\u79fb\uff0c\u6309\u5730\u56fe\u7b49\u7ea7\u7f29\u653e\u540e\u7684\u8ddd\u79bb\nv_line_data.a = lineOffsetWidth/linePixelSize;  // \u7ebf\u56fe\u5c42\u8d34\u56fe\u90e8\u5206\u7684 v \u5750\u6807\u503c\n\n    v_iconMapUV = a_iconMapUV;\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));\n  }\n  setPickingColor(a_PickingColor);\n}\n\n',Zu={solid:0,dash:1},Ku=function(e){Oi(n,e);var t=Hu(n);function n(){var e;Si(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Ri(Ti(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:yt.gl.NEAREST,min:yt.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})})),e}return Ei(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.sourceColor,i=e.targetColor,a=e.textureBlend,o=void 0===a?"normal":a,s=e.lineType,u=void 0===s?"solid":s,l=e.dashArray,c=void 0===l?[10,5]:l,f=e.lineTexture,h=void 0!==f&&f,p=e.iconStep,d=void 0===p?100:p,v=e.segmentNumber,g=void 0===v?30:v;2===c.length&&c.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var m=0,y=[0,0,0,0],_=[0,0,0,0];return r&&i&&(y=(0,Ue.CI)(r),_=(0,Ue.CI)(i),m=1),{u_opacity:n,u_textureBlend:"normal"===o?0:1,segmentNumber:g,u_line_type:Zu[u]||0,u_dash_array:c,u_texture:this.texture,u_line_texture:h?1:0,u_icon_step:d,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:m,u_sourceColor:y,u_targetColor:_}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig(),t=e.animateOption;return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:qu,fragmentShader:Yu,triangulation:Vo,depth:{enable:!1}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:yt.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:yt.GC.Attribute,descriptor:{name:"a_Instance",buffer:{usage:yt.gl.STATIC_DRAW,data:[],type:yt.gl.FLOAT},size:4,update:function(e,t,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:yt.GC.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap(),r=t.texture,i=n[r]||{x:0,y:0},a=i.x,o=i.y;return[a,o]}}})}}]),n}(Oa);function Xu(e){var t=Qu();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function Qu(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Ju='#define LineTypeSolid 0.0\nvarying vec4 v_color;\n\n// dash\nvarying vec4 v_dash_array;\nvarying float v_d_distance_ratio;\n\n#pragma include "picking"\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // \u63a7\u5236\u8fd0\u52a8\n\n// [animate, duration, interval, trailLength],\nvoid main() {\n\n  gl_FragColor = v_color;\n\n \n  float dashLength = mod(v_d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n    // \u5b9e\u7ebf\u90e8\u5206\n  } else {\n    // \u865a\u7ebf\u90e8\u5206\n    discard;\n  };\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',$u='#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\n\nattribute vec2 a_iconMapUV;\n\n// dash line\nattribute float a_Total_Distance;\nattribute vec2 a_DistanceAndIndex;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\n\nuniform float u_vertexScale: 1.0;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvarying vec4 v_color;\nvarying vec4 v_dash_array;\nvarying float v_d_distance_ratio;\n\n\nvoid main() {\n\n  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n\n  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\n  vec2 offset = project_pixel(size.xy);\n  v_d_distance_ratio = a_DistanceAndIndex.x / a_Total_Distance;\n\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));\n  } else {\n    float lineHeight = a_Size.y;\n \n    // #define COORDINATE_SYSTEM_P20 5.0\n    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0\n    // amap1.x\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n      // \u4fdd\u6301\u9ad8\u5ea6\u76f8\u5bf9\u4e0d\u53d8\n      lineHeight *= pow(2.0, 20.0 - u_Zoom);\n    }\n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',el='#extension GL_OES_standard_derivatives : enable\n#define Animate 0.0\n#define LineTexture 1.0\nuniform float u_textureBlend;\n\nuniform float u_borderWidth: 0.0;\n\nuniform vec3 u_blur;\nuniform vec4 u_borderColor;\nvarying vec4 v_color;\n\n// line texture\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_texture_data;\n\n\n#pragma include "picking"\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1, 2., 1.0, 0.2 ]; // \u63a7\u5236\u8fd0\u52a8\n// [animate, duration, interval, trailLength],\nvoid main() {\n  float animateSpeed = 0.0; // \u8fd0\u52a8\u901f\u5ea6\n  float d_distance_ratio = v_texture_data.r; // \u5f53\u524d\u70b9\u4f4d\u8ddd\u79bb\u5360\u7ebf\u603b\u957f\u7684\u6bd4\u4f8b\n  gl_FragColor = v_color;\n  // anti-alias\n  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      alpha = smoothstep(0., 1., alpha);\n      gl_FragColor.a *= alpha;\n  }\n\n  if(u_line_texture == LineTexture) { // while load texture\n    float aDistance = v_texture_data.g;      // \u5f53\u524d\u9876\u70b9\u7684\u8ddd\u79bb\n    float d_texPixelLen = v_texture_data.b;  // \u8d34\u56fe\u7684\u50cf\u7d20\u957f\u5ea6\uff0c\u6839\u636e\u5730\u56fe\u5c42\u7ea7\u7f29\u653e\n    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);\n    float v = v_texture_data.a;  // \u7ebf\u56fe\u5c42\u8d34\u56fe\u90e8\u5206\u7684 v \u5750\u6807\u503c\n\n    // v = max(smoothstep(0.95, 1.0, v), v);\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n     vec4 pattern = texture2D(u_texture, uv);\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor += pattern;\n    } else { // replace\n        pattern.a *= v_color.a;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        gl_FragColor = pattern;\n    }\n  } \n\n  float v = v_texture_data.a;\n  float borderWidth = min(0.5, u_borderWidth);\n  // \u7ed8\u5236 border\n  if(borderWidth > 0.01) {\n    float borderOuterWidth = borderWidth / 2.0;\n\n\n    if(v >= 1.0 - borderWidth || v <= borderWidth) {\n      if(v > borderWidth) { // \u5916\u4fa7\n        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);\n        //  float linear = step(0.0, (v - (1.0 - borderWidth))/borderWidth);\n        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);\n      } else if(v <= borderWidth) {\n        float linear = smoothstep(0.0, 1.0, v/borderWidth);\n        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);\n      }\n    }\n\n    if(v < borderOuterWidth) {\n      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);\n    } else if(v > 1.0 - borderOuterWidth) {\n      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);\n    }\n  }\n\n  // blur\n  float blurV = v_texture_data.a;\n  if(blurV < 0.5) {\n    gl_FragColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);\n  } else {\n    gl_FragColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);\n  }\n  \n  gl_FragColor = filterColor(gl_FragColor);\n}\n',tl='\n#define Animate 0.0\n\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\n\nattribute vec2 a_iconMapUV;\n\n// dash line\nattribute float a_Total_Distance;\nattribute vec2 a_DistanceAndIndex;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform float u_icon_step: 100;\n\nuniform float u_heightfixed: 0.0;\nuniform float u_vertexScale: 1.0;\nuniform float u_raisingHeight: 0.0;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvarying vec4 v_color;\n\n// texV \u7ebf\u56fe\u5c42 - \u8d34\u56fe\u90e8\u5206\u7684 v \u5750\u6807\uff08\u7ebf\u7684\u5bbd\u5ea6\u65b9\u5411\uff09\nvarying vec2 v_iconMapUV;\n\n\nuniform float u_linearColor: 0;\nuniform float u_arrow: 0.0;\nuniform float u_arrowHeight: 3.0;\nuniform float u_arrowWidth: 2.0;\nuniform float u_tailWidth: 1.0;\n\nvarying vec4 v_texture_data;\n\nvec2 calculateArrow(vec2 offset) {\n  /*\n  * \u5728\u652f\u6301\u7bad\u5934\u7684\u65f6\u5019\uff0c\u7b2c\u4e8c\u3001\u7b2c\u4e09\u7ec4\u9876\u70b9\u662f\u989d\u5916\u63d2\u5165\u7528\u4e8e\u6784\u5efa\u9876\u70b9\u7684\n  */\n  float arrowFlag = -1.0;\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // \u9ad8\u5fb7 2.0 \u7684\u65cb\u8f6c\u89d2\u5ea6\u4e0d\u540c\n    arrowFlag = 1.0;\n  }\n  float pi = arrowFlag * 3.1415926/2.;\n  if(a_Miter < 0.) {\n    // \u6839\u636e\u7ebf\u7684\u4e24\u4fa7\u504f\u79fb\u4e0d\u540c\u3001\u65cb\u8f6c\u7684\u65b9\u5411\u76f8\u53cd\n    pi = -pi;\n  }\n  highp float angle_sin = sin(pi);\n  highp float angle_cos = cos(pi);\n  // \u8ba1\u7b97\u5782\u76f4\u4e0e\u7ebf\u65b9\u5411\u7684\u65cb\u8f6c\u77e9\u9635\n  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n  float arrowWidth = u_arrowWidth;\n  float arrowHeight = u_arrowHeight;\n\n  vec2 arrowOffset = vec2(0.0);\n  /*\n  * a_DistanceAndIndex.y \u7528\u4e8e\u6807\u8bb0\u5f53\u524d\u9876\u70b9\u5c5e\u4e8e\u54ea\u4e00\u7ec4\uff08\u4e24\u4e2a\u9876\u70b9\u4e00\u7ec4\uff0c\u6784\u6210\u7ebf\u7684\u5176\u5b9e\u662f\u77e9\u5f62\uff0c\u6700\u7b80\u9700\u8981\u56db\u4e2a\u9876\u70b9\u3001\u4e24\u7ec4\u9876\u70b9\u6784\u6210\uff09\n  */\n  if(a_DistanceAndIndex.y == 0.0) {\n    // \u7bad\u5934\u5c16\u90e8\n    offset = vec2(0.0);\n  } else if(a_DistanceAndIndex.y == 1.0) {\n    // \u7bad\u5934\u4e24\u4fa7\n    arrowOffset = rotation_matrix*(offset * arrowHeight);\n    offset += arrowOffset; // \u6cbf\u7ebf\u504f\u79fb\n    offset = offset * arrowWidth; // \u5782\u76f4\u7ebf\u5411\u5916\u504f\u79fb\uff08\u662f\u6784\u5efa\u7bad\u5934\u4e24\u4fa7\u7684\u9876\u70b9\uff09\n  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {\n    // \u504f\u79fb\u5176\u4f59\u7684\u70b9\u4f4d\uff08\u5c06\u957f\u5ea6\u8ba9\u4f4d\u7ed9\u7bad\u5934\uff09\n    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;\n    offset += arrowOffset;// \u6cbf\u7ebf\u504f\u79fb\n  }\n\n  return offset;\n}\n\nvoid main() {\n  // cal style mapping - \u6570\u636e\u7eb9\u7406\u6620\u5c04\u90e8\u5206\u7684\u8ba1\u7b97\n\n  \n  float d_texPixelLen;    // \u8d34\u56fe\u7684\u50cf\u7d20\u957f\u5ea6\uff0c\u6839\u636e\u5730\u56fe\u5c42\u7ea7\u7f29\u653e\n\n  v_iconMapUV = a_iconMapUV;\n  d_texPixelLen = project_float_pixel(u_icon_step);\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    d_texPixelLen *= 10.0;\n  }\n\n  v_color = a_Color;\n  v_color.a *= opacity;\n\n  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\n  \n  vec2 offset = project_pixel(size.xy);\n\n  float lineDistance = a_DistanceAndIndex.x;\n  float currentLinePointRatio = lineDistance / a_Total_Distance;\n \n  if(u_arrow > 0.0) {\n      //  \u8ba1\u7b97\u7bad\u5934\n    offset = calculateArrow(offset);\n\n    if(a_DistanceAndIndex.y > 4.0) {\n      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);\n    }\n  }\n\n  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7ebf\u6a2a\u5411\u504f\u79fb\u7684\u8ddd\u79bb\uff08\u5411\u4e24\u4fa7\u504f\u79fb\u7684\u548c\uff09\n  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5b9a\u70b9\u4f4d\u7f6e\u504f\u79fb\uff0c\u6309\u5730\u56fe\u7b49\u7ea7\u7f29\u653e\u540e\u7684\u8ddd\u79bb \u5355\u4fa7 * 2\n  float texV = lineOffsetWidth/linePixelSize; // \u7ebf\u56fe\u5c42\u8d34\u56fe\u90e8\u5206\u7684 v \u5750\u6807\u503c\n  \n  v_texture_data = vec4(currentLinePointRatio, lineDistance, d_texPixelLen, texV);\n  // \u8bbe\u7f6e\u6570\u636e\u96c6\u7684\u53c2\u6570\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));\n\n  float h = float(a_Position.z) * u_vertexScale; // \u7ebf\u9876\u70b9\u7684\u9ad8\u5ea6 - \u517c\u5bb9\u4e0d\u5b58\u5728\u7b2c\u4e09\u4e2a\u6570\u503c\u7684\u60c5\u51b5 vertex height\n  float lineHeight = a_Size.y; // size \u7b2c\u4e8c\u4e2a\u53c2\u6570\u4ee3\u8868\u7684\u9ad8\u5ea6 [linewidth, lineheight]\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    lineHeight *= 0.2; // \u4fdd\u6301\u548c amap/mapbox \u4e00\u81f4\u7684\u6548\u679c\n    h *= 0.2;\n    if(u_heightfixed < 1.0) {\n      lineHeight = project_pixel(a_Size.y);\n    }\n    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));\n  } else {\n    // mapbox -  amap\n    \n    // \u517c\u5bb9 mapbox \u5728\u7ebf\u9ad8\u5ea6\u4e0a\u7684\u6548\u679c\u8868\u73b0\u57fa\u672c\u4e00\u81f4\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      // mapbox\n      // \u4fdd\u6301\u9ad8\u5ea6\u76f8\u5bf9\u4e0d\u53d8\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      h *= mapboxZoomScale;\n      h += u_raisingHeight * mapboxZoomScale;\n      if(u_heightfixed > 0.0) {\n        lineHeight *= mapboxZoomScale;\n      }\n      \n    } else {\n      // amap\n      h += u_raisingHeight;\n      // lineHeight \u9876\u70b9\u504f\u79fb\u9ad8\u5ea6\n      if(u_heightfixed < 1.0) {\n        lineHeight *= pow(2.0, 20.0 - u_Zoom);\n      }\n    }\n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',nl='varying vec4 v_color;\nvarying vec4 v_texture_data;\nuniform float u_linearDir: 1.0;\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_opacity: 1.0;\n\n#pragma include "picking"\n\n\nvoid main() {\n  float linearRadio = v_texture_data.r; // \u5f53\u524d\u70b9\u4f4d\u8ddd\u79bb\u5360\u7ebf\u603b\u957f\u7684\u6bd4\u4f8b\n  if(u_linearDir < 1.0) {\n    linearRadio = v_texture_data.a;\n  }\n\n  if(u_linearColor == 1.0) { // \u4f7f\u7528\u6e10\u53d8\u989c\u8272\n    gl_FragColor = mix(u_sourceColor, u_targetColor, linearRadio);\n    gl_FragColor.a *= v_color.a;\n  } else { // \u4f7f\u7528 color \u65b9\u6cd5\u4f20\u5165\u7684\u989c\u8272\n     gl_FragColor = v_color;\n  }\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',rl={solid:0,dash:1},il=function(e){Oi(n,e);var t=Xu(n);function n(){var e;Si(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Ri(Ti(e),"textureEventFlag",!1),Ri(Ti(e),"texture",e.createTexture2D({data:[0,0,0,0],mag:yt.gl.NEAREST,min:yt.gl.NEAREST,premultiplyAlpha:!1,width:1,height:1})),Ri(Ti(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:yt.gl.NEAREST,min:yt.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})})),e}return Ei(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor,r=e.textureBlend,i=void 0===r?"normal":r,a=e.lineType,o=void 0===a?"solid":a,s=e.dashArray,u=void 0===s?[10,5,0,0]:s,l=e.lineTexture,c=void 0!==l&&l,f=e.iconStep,h=void 0===f?100:f,p=e.vertexHeightScale,d=void 0===p?20:p,v=e.borderWidth,g=void 0===v?0:v,m=e.borderColor,y=void 0===m?"#ccc":m,_=e.raisingHeight,x=void 0===_?0:_,b=e.heightfixed,S=void 0!==b&&b,w=e.linearDir,C=void 0===w?Pa.VERTICAL:w,k=e.blur,A=void 0===k?[1,1,1]:k,E=e.arrow,T=void 0===E?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:E;2===u.length&&u.push(0,0),this.rendererService.getDirty()&&this.texture&&this.texture.bind();var M=0,O=[0,0,0,0],L=[0,0,0,0];return t&&n&&(O=(0,Ue.CI)(t),L=(0,Ue.CI)(n),M=1),Yi({u_textureBlend:i===Ra.NORMAL?0:1,u_line_type:rl[o],u_dash_array:u,u_blur:A,u_texture:this.texture,u_line_texture:c?1:0,u_icon_step:h,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:g,u_borderColor:(0,Ue.CI)(y),u_linearDir:C===Pa.VERTICAL?1:0,u_linearColor:M,u_sourceColor:O,u_targetColor:L,u_heightfixed:Number(S),u_vertexScale:d,u_raisingHeight:Number(x),u_arrow:Number(T.enable),u_arrowHeight:T.arrowHeight||3,u_arrowWidth:T.arrowWidth||2,u_tailWidth:void 0===T.tailWidth?1:T.tailWidth},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig(),t=e.animateOption;return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.textureEventFlag||(this.textureEventFlag=!0,this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture)),e.abrupt("return",this.buildModels());case 2:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t,n,r,i,a,o,s,u;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.depth,r=void 0!==n&&n,i=this.getShaders(),a=i.frag,o=i.vert,s=i.type,this.layer.triangulation=Ue.sN,e.next=5,this.layer.buildLayerModel({moduleName:"line"+s,vertexShader:o,fragmentShader:a,triangulation:Ue.sN,inject:this.getInject(),depth:{enable:r}});case 5:return u=e.sent,e.abrupt("return",[u]);case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor,r=e.lineType;return"dash"===r?{frag:Ju,vert:$u,type:"Dash"}:t&&n?{frag:nl,vert:tl,type:"Linear"}:{frag:el,vert:tl,type:""}}},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:yt.GC.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:yt.gl.STATIC_DRAW,data:[],type:yt.gl.FLOAT},size:2,update:function(e,t,n,r,i,a){return void 0===a?[n[3],10]:[n[3],a]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:yt.GC.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:yt.gl.STATIC_DRAW,data:[],type:yt.gl.FLOAT},size:1,update:function(e,t,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:yt.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:yt.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:yt.gl.STATIC_DRAW,data:[],type:yt.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:yt.GC.Attribute,descriptor:{name:"a_Miter",buffer:{usage:yt.gl.STATIC_DRAW,data:[],type:yt.gl.FLOAT},size:1,update:function(e,t,n){return[n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:yt.GC.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap(),r=t.texture,i=n[r]||{x:0,y:0},a=i.x,o=i.y;return[a,o]}}})}}]),n}(Oa);function al(e){var t=ol();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function ol(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var sl='\nvarying vec4 v_Color;\n#pragma include "picking"\nvoid main() {\n\n  gl_FragColor = v_Color; // \u5168\u5c40\u900f\u660e\u5ea6\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',ul='\nattribute float a_Miter;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\n\n// dash line\nattribute float a_Total_Distance;\nattribute vec2 a_DistanceAndIndex;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nuniform float u_heightfixed: 0.0;\nuniform float u_vertexScale: 1.0;\nuniform float u_raisingHeight: 0.0;\nuniform float u_opacity : 1.0;\nuniform sampler2D u_texture;\nuniform float u_linearDir: 1.0;\nvarying vec4 v_Color;\n\n\n#pragma include "projection"\n#pragma include "picking"\n\n\nvoid main() {\n\n\n  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\n  \n  vec2 offset = project_pixel(size.xy);\n\n  float lineDistance = a_DistanceAndIndex.x;\n  float currentLinePointRatio = lineDistance / a_Total_Distance;\n \n\n  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7ebf\u6a2a\u5411\u504f\u79fb\u7684\u8ddd\u79bb\uff08\u5411\u4e24\u4fa7\u504f\u79fb\u7684\u548c\uff09\n  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5b9a\u70b9\u4f4d\u7f6e\u504f\u79fb\uff0c\u6309\u5730\u56fe\u7b49\u7ea7\u7f29\u653e\u540e\u7684\u8ddd\u79bb \u5355\u4fa7 * 2\n  float texV = lineOffsetWidth/linePixelSize; // \u7ebf\u56fe\u5c42\u8d34\u56fe\u90e8\u5206\u7684 v \u5750\u6807\u503c\n\n  float linearRadio =currentLinePointRatio; // \u5f53\u524d\u70b9\u4f4d\u8ddd\u79bb\u5360\u7ebf\u603b\u957f\u7684\u6bd4\u4f8b\n  if(u_linearDir < 1.0) {\n    linearRadio = texV;\n  }\n\n  v_Color = texture2D(u_texture, vec2(linearRadio, 0.5));\n\n  v_Color.a *= u_opacity; // \u5168\u5c40\u900f\u660e\u5ea6\n\n\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));\n\n  float h = float(a_Position.z) * u_vertexScale; // \u7ebf\u9876\u70b9\u7684\u9ad8\u5ea6 - \u517c\u5bb9\u4e0d\u5b58\u5728\u7b2c\u4e09\u4e2a\u6570\u503c\u7684\u60c5\u51b5 vertex height\n  float lineHeight = a_Size.y; // size \u7b2c\u4e8c\u4e2a\u53c2\u6570\u4ee3\u8868\u7684\u9ad8\u5ea6 [linewidth, lineheight]\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    lineHeight *= 0.2; // \u4fdd\u6301\u548c amap/mapbox \u4e00\u81f4\u7684\u6548\u679c\n    h *= 0.2;\n    if(u_heightfixed < 1.0) {\n      lineHeight = project_pixel(a_Size.y);\n    }\n    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));\n  } else {\n    // mapbox -  amap\n    \n    // \u517c\u5bb9 mapbox \u5728\u7ebf\u9ad8\u5ea6\u4e0a\u7684\u6548\u679c\u8868\u73b0\u57fa\u672c\u4e00\u81f4\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      // mapbox\n      // \u4fdd\u6301\u9ad8\u5ea6\u76f8\u5bf9\u4e0d\u53d8\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      h *= mapboxZoomScale;\n      h += u_raisingHeight * mapboxZoomScale;\n      if(u_heightfixed > 0.0) {\n        lineHeight *= mapboxZoomScale;\n      }\n      \n    } else {\n      // amap\n      h += u_raisingHeight;\n      // lineHeight \u9876\u70b9\u504f\u79fb\u9ad8\u5ea6\n      if(u_heightfixed < 1.0) {\n        lineHeight *= pow(2.0, 20.0 - u_Zoom);\n      }\n    }\n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',ll=function(e){Oi(n,e);var t=al(n);function n(){var e;Si(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Ri(Ti(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;e.colorTexture&&e.colorTexture.destroy();var n=e.layer.getLayerConfig(),r=n.rampColors,i=(0,Ue.Cl)(r);e.colorTexture=t({data:new Uint8Array(i.data),width:i.width,height:i.height,wrapS:yt.gl.CLAMP_TO_EDGE,wrapT:yt.gl.CLAMP_TO_EDGE,min:yt.gl.NEAREST,mag:yt.gl.NEAREST,flipY:!1})})),e}return Ei(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.vertexHeightScale,i=void 0===r?20:r,a=e.raisingHeight,o=void 0===a?0:a,s=e.heightfixed,u=void 0!==s&&s,l=e.linearDir,c=void 0===l?Pa.VERTICAL:l;return this.rendererService.getDirty()&&this.colorTexture.bind(),{u_linearDir:c===Pa.VERTICAL?1:0,u_opacity:(0,Zt.isNumber)(n)?n:1,u_texture:this.colorTexture,u_heightfixed:Number(u),u_vertexScale:i,u_raisingHeight:Number(o)}}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.updateTexture(),e.abrupt("return",this.buildModels());case 2:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var e;null===(e=this.colorTexture)||void 0===e||e.destroy()}},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t,n,r,i;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.depth,r=void 0!==n&&n,this.layer.triangulation=Oo,e.next=4,this.layer.buildLayerModel({moduleName:"lineRampColors",vertexShader:ul,fragmentShader:sl,triangulation:Oo,depth:{enable:r}});case 4:return i=e.sent,e.abrupt("return",[i]);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:yt.GC.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:yt.gl.STATIC_DRAW,data:[],type:yt.gl.FLOAT},size:2,update:function(e,t,n,r,i,a){return void 0===a?[n[3],10]:[n[3],a]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:yt.GC.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:yt.gl.STATIC_DRAW,data:[],type:yt.gl.FLOAT},size:1,update:function(e,t,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:yt.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:yt.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:yt.gl.STATIC_DRAW,data:[],type:yt.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:yt.GC.Attribute,descriptor:{name:"a_Miter",buffer:{usage:yt.gl.STATIC_DRAW,data:[],type:yt.gl.FLOAT},size:1,update:function(e,t,n){return[n[4]]}}})}}]),n}(Oa);function cl(e){var t=fl();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function fl(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var hl="\nvarying vec4 v_color;\nvoid main() {\n  gl_FragColor = v_color;\n\n}\n",pl="uniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float opacity;\nvoid main() {\n  gl_FragColor = mix(u_sourceColor, u_targetColor, v_distanceScale);\n  gl_FragColor.a *= opacity; // \u5168\u5c40\u900f\u660e\u5ea6\n}\n",dl='attribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Position;\n\nattribute float a_Total_Distance;\nattribute float a_Distance;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nuniform float u_opacity: 1.0;\nuniform float u_vertexScale: 1.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\n\n\n#pragma include "projection"\n\nvarying vec4 v_color;\nvarying float v_distanceScale;\n\nvoid main() {\n\n  v_color = a_Color; \n  v_distanceScale = a_Distance / a_Total_Distance;\n  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity); \n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  float h = float(a_Position.z) * u_vertexScale; // \u7ebf\u9876\u70b9\u7684\u9ad8\u5ea6 - \u517c\u5bb9\u4e0d\u5b58\u5728\u7b2c\u4e09\u4e2a\u6570\u503c\u7684\u60c5\u51b5\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));\n  } else {\n    float lineHeight = a_Size.y;\n    // \u517c\u5bb9 mapbox \u5728\u7ebf\u9ad8\u5ea6\u4e0a\u7684\u6548\u679c\u8868\u73b0\u57fa\u672c\u4e00\u81f4\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      // \u4fdd\u6301\u9ad8\u5ea6\u76f8\u5bf9\u4e0d\u53d8\n      h *= 2.0/pow(2.0, 20.0 - u_Zoom);\n    }\n\n    // #define COORDINATE_SYSTEM_P20 5.0\n    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0\n    // amap1.x\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n      // \u4fdd\u6301\u9ad8\u5ea6\u76f8\u5bf9\u4e0d\u53d8\n      lineHeight *= pow(2.0, 20.0 - u_Zoom);\n    }\n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));\n    gl_PointSize = 10.0;\n  }\n}\n',vl=function(e){Oi(n,e);var t=cl(n);function n(){return Si(this,n),t.apply(this,arguments)}return Ei(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.sourceColor,i=e.targetColor,a=e.vertexHeightScale,o=void 0===a?20:a,s=0,u=[0,0,0,0],l=[0,0,0,0];return r&&i&&(u=(0,Ue.CI)(r),l=(0,Ue.CI)(i),s=1),{u_opacity:(0,Zt.isNumber)(n)?n:1,u_linearColor:s,u_sourceColor:u,u_targetColor:l,u_vertexScale:o}}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor;return t&&n?{frag:pl,vert:dl,type:"lineSimpleLinear"}:{frag:hl,vert:dl,type:"lineSimpleNormal"}}},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t,n,r,i,a;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.getShaders(),n=t.frag,r=t.vert,i=t.type,e.next=3,this.layer.buildLayerModel({moduleName:i,vertexShader:r,fragmentShader:n,triangulation:Po,primitive:yt.gl.LINES,depth:{enable:!1},pick:!1});case 3:return a=e.sent,e.abrupt("return",[a]);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:yt.GC.Attribute,descriptor:{name:"a_Distance",buffer:{usage:yt.gl.STATIC_DRAW,data:[],type:yt.gl.FLOAT},size:1,update:function(e,t,n){return[n[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:yt.GC.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:yt.gl.STATIC_DRAW,data:[],type:yt.gl.FLOAT},size:1,update:function(e,t,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:yt.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}})}}]),n}(Oa);function gl(e){var t=ml();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function ml(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var yl='#define Animate 0.0\n#define LineTexture 1.0\n\n// line texture\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_opacity : 1.0;\nuniform float u_textureBlend;\nuniform float u_iconStepCount;\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // \u63a7\u5236\u8fd0\u52a8\n\nvarying vec2 v_iconMapUV;\nvarying float v_blur;\nvarying float v_radio;\nvarying vec4 v_color;\nvarying vec4 v_dataset;\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = u_opacity;\n  float animateSpeed = 0.0; // \u8fd0\u52a8\u901f\u5ea6\n  float d_distance_ratio = v_dataset.r; // \u5f53\u524d\u70b9\u4f4d\u8ddd\u79bb\u5360\u7ebf\u603b\u957f\u7684\u6bd4\u4f8b\n  float v = v_dataset.a;\n\n  if(u_linearColor == 1.0) { // \u4f7f\u7528\u6e10\u53d8\u989c\u8272\n    gl_FragColor = mix(u_sourceColor, u_targetColor, v);\n  } else { // \u4f7f\u7528 color \u65b9\u6cd5\u4f20\u5165\u7684\u989c\u8272\n     gl_FragColor = v_color;\n  }\n\n  gl_FragColor.a *= opacity; // \u5168\u5c40\u900f\u660e\u5ea6\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      alpha = smoothstep(0., 1., alpha);\n      gl_FragColor.a *= alpha;\n  }\n\n  if(u_line_texture == LineTexture) { // while load texture\n    float aDistance = v_dataset.g;      // \u5f53\u524d\u9876\u70b9\u7684\u8ddd\u79bb\n    float d_texPixelLen = v_dataset.b;  // \u8d34\u56fe\u7684\u50cf\u7d20\u957f\u5ea6\uff0c\u6839\u636e\u5730\u56fe\u5c42\u7ea7\u7f29\u653e\n    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);\n    float v = v_dataset.a;  // \u7ebf\u56fe\u5c42\u8d34\u56fe\u90e8\u5206\u7684 v \u5750\u6807\u503c\n\n    // \u8ba1\u7b97\u7eb9\u7406\u95f4\u9694 start\n    float flag = 0.0;\n    if(u > 1.0/u_iconStepCount) {\n      flag = 1.0;\n    }\n    u = fract(u*u_iconStepCount);\n    // \u8ba1\u7b97\u7eb9\u7406\u95f4\u9694 end\n\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture2D(u_texture, uv);\n\n    // Tip: \u5224\u65ad\u7eb9\u7406\u95f4\u9694\n    if(flag > 0.0) {\n      pattern = vec4(0.0);\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        gl_FragColor = filterColor(pattern);\n    }\n  }\n  \n\n  // blur - AA\n  if(v < v_blur) {\n    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);\n  } else if(v > 1.0 - v_blur) {\n    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);\n  }\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',_l='#define Animate 0.0\n\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\nattribute vec2 a_iconMapUV;\nattribute float a_Total_Distance;\nattribute float a_Distance;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform float u_icon_step: 100;\nuniform float u_heightfixed;\nuniform float u_linearColor: 0;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\n// texV \u7ebf\u56fe\u5c42 - \u8d34\u56fe\u90e8\u5206\u7684 v \u5750\u6807\uff08\u7ebf\u7684\u5bbd\u5ea6\u65b9\u5411\uff09\nvarying vec2 v_iconMapUV;\nvarying vec4 v_color;\nvarying float v_blur;\nvarying float v_radio;\nvarying vec4 v_dataset;\n\nvoid main() {\n\n\n  float d_distance_ratio; // \u5f53\u524d\u70b9\u4f4d\u8ddd\u79bb\u5360\u7ebf\u603b\u957f\u7684\u6bd4\u4f8b\n  float d_texPixelLen;    // \u8d34\u56fe\u7684\u50cf\u7d20\u957f\u5ea6\uff0c\u6839\u636e\u5730\u56fe\u5c42\u7ea7\u7f29\u653e\n\n  v_iconMapUV = a_iconMapUV;\n  if(u_heightfixed < 1.0) {     // \u9ad8\u5ea6\u968f zoom \u8c03\u6574\n    d_texPixelLen = project_pixel(u_icon_step);\n  } else {\n    d_texPixelLen = u_icon_step;\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    d_texPixelLen *= 10.0;\n  }\n\n  if(u_animate.x == Animate || u_linearColor == 1.0) {\n      d_distance_ratio = a_Distance / a_Total_Distance;\n  }\n\n  float miter = (a_Miter + 1.0)/2.0;\n  // \u8bbe\u7f6e\u6570\u636e\u96c6\u7684\u53c2\u6570\n  v_dataset[0] = d_distance_ratio; // \u5f53\u524d\u70b9\u4f4d\u8ddd\u79bb\u5360\u7ebf\u603b\u957f\u7684\u6bd4\u4f8b\n  v_dataset[1] = a_Distance;       // \u5f53\u524d\u9876\u70b9\u7684\u8ddd\u79bb\n  v_dataset[2] = d_texPixelLen;    // \u8d34\u56fe\u7684\u50cf\u7d20\u957f\u5ea6\uff0c\u6839\u636e\u5730\u56fe\u5c42\u7ea7\u7f29\u653e\n  v_dataset[3] = miter;          // \u7ebf\u56fe\u5c42\u8d34\u56fe\u90e8\u5206\u7684 v \u5750\u6807\u503c 0 - 1\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  float originSize = a_Size.x;  // \u56fa\u5b9a\u9ad8\u5ea6\n  if(u_heightfixed < 1.0) {     // \u9ad8\u5ea6\u968f zoom \u8c03\u6574\n    originSize = project_float_pixel(a_Size.x);\n  }\n\n  float wallHeight = originSize * miter;\n  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));\n\n  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);\n  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',xl=function(e){Oi(n,e);var t=gl(n);function n(){var e;Si(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Ri(Ti(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:yt.gl.NEAREST,min:yt.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})})),e}return Ei(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.sourceColor,i=e.targetColor,a=e.textureBlend,o=void 0===a?"normal":a,s=e.heightfixed,u=void 0!==s&&s,l=e.lineTexture,c=void 0!==l&&l,f=e.iconStep,h=void 0===f?100:f,p=e.iconStepCount,d=void 0===p?1:p;this.rendererService.getDirty()&&this.texture.bind();var v=0,g=[0,0,0,0],m=[0,0,0,0];return r&&i&&(g=(0,Ue.CI)(r),m=(0,Ue.CI)(i),v=1),{u_heightfixed:Number(u),u_opacity:(0,Zt.isNumber)(n)?n:1,u_textureBlend:"normal"===o?0:1,u_texture:this.texture,u_line_texture:c?1:0,u_iconStepCount:d,u_icon_step:h,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:v,u_sourceColor:g,u_targetColor:m}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig(),t=e.animateOption;return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:_l,fragmentShader:yl,triangulation:Oo,depth:{enable:!1},blend:this.getBlend()});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:yt.GC.Attribute,descriptor:{name:"a_Distance",buffer:{usage:yt.gl.STATIC_DRAW,data:[],type:yt.gl.FLOAT},size:1,update:function(e,t,n){return[n[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:yt.GC.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:yt.gl.STATIC_DRAW,data:[],type:yt.gl.FLOAT},size:1,update:function(e,t,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:yt.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:yt.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:yt.gl.STATIC_DRAW,data:[],type:yt.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:yt.GC.Attribute,descriptor:{name:"a_Miter",buffer:{usage:yt.gl.STATIC_DRAW,data:[],type:yt.gl.FLOAT},size:1,update:function(e,t,n){return[n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:yt.GC.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap(),r=t.texture,i=n[r]||{x:0,y:0},a=i.x,o=i.y;return[a,o]}}})}}]),n}(Oa),bl={arc:Su,arc3d:Ou,greatcircle:Ku,wall:xl,line:il,simple:vl,linearline:ll,earthArc3d:Fu,flowline:Gu},Sl=bl;function wl(e){var t=Cl();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function Cl(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var kl=function(e){Oi(n,e);var t=wl(n);function n(){var e;Si(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Ri(Ti(e),"type","LineLayer"),Ri(Ti(e),"enableShaderEncodeStyles",["opacity","offsets","stroke"]),Ri(Ti(e),"arrowInsertCount",0),Ri(Ti(e),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),e}return Ei(n,[{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new Sl[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getDefaultConfig",value:function(){var e=this.getModelType(),t={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},earthArc3d:{},flowline:{}};return t[e]}},{key:"getModelType",value:function(){var e;if(this.layerType)return this.layerType;var t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=null===t||void 0===t||null===(e=t.scale)||void 0===e?void 0:e.field;return n||"line"}},{key:"processData",value:function(e){if("simple"!==this.getModelType())return e;var t=[];return e.map((function(e){if(Array.isArray(e.coordinates)&&Array.isArray(e.coordinates[0])&&Array.isArray(e.coordinates[0][0])){var n=Yi({},e);e.coordinates.map((function(e){t.push(Yi(Yi({},n),{},{coordinates:e}))}))}else t.push(e)})),t}}]),n}(Aa);function Al(e){var t=El();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function El(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Tl='varying vec4 v_color;\nuniform float u_opacity: 1.0;\n\nuniform float u_pickLight: 0.0;\n\n#pragma include "picking"\n\n\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\nuniform float u_opacitylinear: 0.0;\nuniform float u_opacitylinear_dir: 1.0;\nvarying float v_lightWeight;\nvarying float v_barLinearZ;\nvoid main() {\n\n   gl_FragColor = v_color;\n\n  // \u5f00\u542f\u900f\u660e\u5ea6\u6e10\u53d8\n  if(u_opacitylinear > 0.0) {\n    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_barLinearZ): v_barLinearZ;\n  }\n\n  // picking\n  if(u_pickLight > 0.0) {\n    gl_FragColor = filterColorAlpha(gl_FragColor, v_lightWeight);\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n',Ml='precision highp float;\n\n#define pi 3.1415926535\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\nattribute vec4 a_Color;\nattribute vec3 a_Size;\nattribute vec3 a_Normal;\n\nuniform float u_heightfixed: 0.0; // \u9ed8\u8ba4\u4e0d\u56fa\u5b9a\nuniform float u_globel;\nuniform float u_r;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\n\nuniform float u_opacity : 1;\nuniform float u_lightEnable: 1;\nvarying float v_lightWeight;\nvarying float v_barLinearZ;\n// \u7528\u4e8e\u5c06\u5728\u9876\u70b9\u7740\u8272\u5668\u4e2d\u8ba1\u7b97\u597d\u7684\u6837\u5f0f\u503c\u4f20\u9012\u7ed9\u7247\u5143\n\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nfloat getYRadian(float x, float z) {\n  if(x > 0.0 && z > 0.0) {\n    return atan(x/z);\n  } else if(x > 0.0 && z <= 0.0){\n    return atan(-z/x) + pi/2.0;\n  } else if(x <= 0.0 && z <= 0.0) {\n    return  pi + atan(x/z); //atan(x/z) + \n  } else {\n    return atan(z/-x) + pi*3.0/2.0;\n  }\n}\n\nfloat getXRadian(float y, float r) {\n  return atan(y/r);\n}\n\nvoid main() {\n\n  \n  float textureOffset = 0.0; // \u5728 cell \u4e2d\u53d6\u503c\u7684\u504f\u79fb\u91cf\n\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - \u6570\u636e\u7eb9\u7406\u6620\u5c04\u90e8\u5206\u7684\u8ba1\u7b97\n  vec3 size = a_Size * a_Position;\n\n  // a_Position.z \u662f\u5728\u6784\u5efa\u7f51\u683c\u7684\u65f6\u5019\u4f20\u5165\u7684\u6807\u51c6\u503c 0 - 1\uff0c\u5728\u63d2\u503c\u5668\u63d2\u503c\u53ef\u4ee5\u83b7\u53d6 0\uff5e1 \u7ebf\u6027\u6e10\u53d8\u7684\u503c\n  v_barLinearZ =  a_Position.z;\n\n  vec3 offset = size; // \u63a7\u5236\u5706\u67f1\u4f53\u7684\u5927\u5c0f - \u4ece\u6807\u51c6\u5355\u4f4d\u5706\u67f1\u4f53\u8fdb\u884c\u504f\u79fb\n  if(u_heightfixed < 1.0) { // \u5706\u67f1\u4f53\u4e0d\u56fa\u5b9a\u9ad8\u5ea6\n    \n    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n      // P20 \u5750\u6807\u7cfb\u4e0b\uff0c\u4e3a\u4e86\u548c Web \u58a8\u5361\u6258\u5750\u6807\u7cfb\u7edf\u4e00\uff0czoom \u9ed8\u8ba4\u51cf1\n      offset = offset * pow(2.0, (19.0 - u_Zoom));\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n      // P20_2 \u5750\u6807\u7cfb\u4e0b\uff0c\u4e3a\u4e86\u548c Web \u58a8\u5361\u6258\u5750\u6807\u7cfb\u7edf\u4e00\uff0czoom \u9ed8\u8ba4\u51cf3\n      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));\n    }\n  } else {// \u5706\u67f1\u4f53\u56fa\u5b9a\u9ad8\u5ea6 \uff08 \u5904\u7406 mapbox \uff09\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);\n    }\n  }\n\n\n  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));\n\n  // u_r \u63a7\u5236\u5706\u67f1\u7684\u751f\u957f\n  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);\n\n  // \u5706\u67f1\u5149\u7167\u6548\u679c\n  float lightWeight = 1.0;\n  if(u_lightEnable > 0.0) { // \u53d6\u6d88\u4e09\u5143\u8868\u8fbe\u5f0f\uff0c\u589e\u5f3a\u5065\u58ee\u6027\n    lightWeight = calc_lighting(pos);\n  }\n  v_lightWeight = lightWeight;\n  // \u8bbe\u7f6e\u5706\u67f1\u7684\u5e95\u8272\n  if(u_linearColor == 1.0) { // \u4f7f\u7528\u6e10\u53d8\u989c\u8272\n    v_color = mix(u_sourceColor, u_targetColor, barLinearZ);\n    v_color.rgb *= lightWeight;\n  } else { // \u4f7f\u7528 color \u65b9\u6cd5\u4f20\u5165\u7684\u989c\u8272\n     v_color = a_Color;\n  }\n  v_color.a *= u_opacity;\n\n    \n  // \u5728\u5730\u7403\u6a21\u5f0f\u4e0b\uff0c\u5c06\u539f\u672c\u5782\u76f4\u4e8e xy \u5e73\u9762\u7684\u5706\u67f1\u8c03\u6574\u59ff\u6001\u5230\u9002\u5e94\u5706\u7684\u89d2\u5ea6\n  //\u65cb\u8f6c\u77e9\u9635mx\uff0c\u521b\u5efa\u7ed5x\u8f74\u65cb\u8f6c\u77e9\u9635\n  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);\n  float xRadian = getXRadian(a_Pos.y, r);\n  float xcos = cos(xRadian);//\u6c42\u89e3\u65cb\u8f6c\u89d2\u5ea6\u4f59\u5f26\u503c\n  float xsin = sin(xRadian);//\u6c42\u89e3\u65cb\u8f6c\u89d2\u5ea6\u6b63\u5f26\u503c\n  mat4 mx = mat4(\n    1,0,0,0,  \n    0,xcos,-xsin,0,  \n    0,xsin,xcos,0,  \n    0,0,0,1);\n\n  //\u65cb\u8f6c\u77e9\u9635my\uff0c\u521b\u5efa\u7ed5y\u8f74\u65cb\u8f6c\u77e9\u9635\n  float yRadian = getYRadian(a_Pos.x, a_Pos.z);\n  float ycos = cos(yRadian);//\u6c42\u89e3\u65cb\u8f6c\u89d2\u5ea6\u4f59\u5f26\u503c\n  float ysin = sin(yRadian);//\u6c42\u89e3\u65cb\u8f6c\u89d2\u5ea6\u6b63\u5f26\u503c\n  mat4 my = mat4(\n    ycos,0,-ysin,0,  \n    0,1,0,0,  \n    ysin,0,ycos,0,  \n    0,0,0,1);\n\n  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);\n  \n\n  setPickingColor(a_PickingColor);\n}\n',Ol=function(e){Oi(n,e);var t=Al(n);function n(){var e;Si(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Ri(Ti(e),"raiseCount",0),Ri(Ti(e),"raiseRepeat",0),e}return Ei(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.animateOption,n=void 0===t?{enable:!1,speed:.01,repeat:!1}:t,r=e.opacity,i=void 0===r?1:r,a=e.sourceColor,o=e.targetColor,s=e.pickLight,u=void 0!==s&&s,l=e.heightfixed,c=void 0!==l&&l,f=e.opacityLinear,h=void 0===f?{enable:!1,dir:"up"}:f,p=e.lightEnable,d=void 0===p||p,v=0,g=[0,0,0,0],m=[0,0,0,0];if(a&&o&&(g=(0,Ue.CI)(a),m=(0,Ue.CI)(o),v=1),this.raiseCount<1&&this.raiseRepeat>0&&n.enable){var y=n.speed,_=void 0===y?.01:y;this.raiseCount+=_,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(u),u_heightfixed:Number(c),u_r:n.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:(0,Zt.isNumber)(i)?i:1,u_linearColor:v,u_sourceColor:g,u_targetColor:m,u_opacitylinear:Number(h.enable),u_opacitylinear_dir:"up"===h.dir?1:0,u_lightEnable:Number(d)}}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t,n,r,i;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.animateOption.repeat,r=void 0===n?1:n,this.raiseRepeat=r,e.next=4,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:Ml,fragmentShader:Tl,triangulation:To,depth:{enable:!0},cull:{enable:!0,face:(0,Ue.fj)(this.mapService.version)},blend:this.getBlend()});case 4:return i=e.sent,e.abrupt("return",[i]);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:yt.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:3,update:function(e){var t=e.size;if(t){var n=[];return Array.isArray(t)&&(n=2===t.length?[t[0],t[0],t[1]]:t),Array.isArray(t)||(n=[t,t,t]),n}return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:yt.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:yt.gl.STATIC_DRAW,data:[],type:yt.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:yt.GC.Attribute,descriptor:{name:"a_Pos",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:3,update:function(e){var t=(0,Ue.SI)(e.coordinates);return Ja([t[0],t[1]])}}})}}]),n}(Oa);function Ll(e){var t=Pl();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function Pl(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Rl="uniform float u_additive;\nuniform float u_opacity : 1;\nuniform float u_stroke_opacity : 1;\nuniform float u_stroke_width : 2;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\n\n#pragma include \"sdf_2d\"\n#pragma include \"picking\"\n\n\nvoid main() {\n  int shape = int(floor(v_data.w + 0.5));\n\n  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;\n\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius + strokeWidth);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n  if (shape == 0) {\n    outer_df = sdCircle(v_data.xy, 1.0);\n    inner_df = sdCircle(v_data.xy, r);\n  } else if (shape == 1) {\n    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);\n    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);\n  } else if (shape == 2) {\n    outer_df = sdBox(v_data.xy, vec2(1.));\n    inner_df = sdBox(v_data.xy, vec2(r));\n  } else if (shape == 3) {\n    outer_df = sdPentagon(v_data.xy, 0.8);\n    inner_df = sdPentagon(v_data.xy, r * 0.8);\n  } else if (shape == 4) {\n    outer_df = sdHexagon(v_data.xy, 0.8);\n    inner_df = sdHexagon(v_data.xy, r * 0.8);\n  } else if (shape == 5) {\n    outer_df = sdOctogon(v_data.xy, 1.0);\n    inner_df = sdOctogon(v_data.xy, r);\n  } else if (shape == 6) {\n    outer_df = sdHexagram(v_data.xy, 0.52);\n    inner_df = sdHexagram(v_data.xy, r * 0.52);\n  } else if (shape == 7) {\n    outer_df = sdRhombus(v_data.xy, vec2(1.0));\n    inner_df = sdRhombus(v_data.xy, vec2(r));\n  } else if (shape == 8) {\n    outer_df = sdVesica(v_data.xy, 1.1, 0.8);\n    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);\n  }\n\n  if(outer_df > antialiasblur + 0.018) discard;\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(\n    antialiasblur,\n    0.0,\n    inner_df\n  );\n\n  if(strokeWidth < 0.01) {\n    gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);\n  } else {\n    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), u_stroke_color * u_stroke_opacity, color_t);\n  }\n\n  if(u_additive > 0.0) {\n    gl_FragColor *= opacity_t;\n    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);\n  } else {\n    gl_FragColor.a *= opacity_t;\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n",Il='attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nattribute float a_Shape;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\n\nuniform float u_opacity : 1;\nuniform float u_stroke_opacity : 1;\nuniform float u_stroke_width : 2;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\nuniform vec2 u_offsets;\n\nuniform float u_blur : 0.0;\n\n#pragma include "projection"\n#pragma include "picking"\n\n\nvoid main() {\n  vec3 extrude = a_Extrude;\n  float shape_type = a_Shape;\n  /*\n  *  setPickingSize \u8bbe\u7f6e\u62fe\u53d6\u5927\u5c0f\n  */\n  float newSize = setPickingSize(a_Size);\n  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;\n\n  // unpack color(vec2)\n  v_color = a_Color;\n\n  // radius(16-bit)\n  v_radius = newSize;\n\n  // anti-alias\n  //  float antialiased_blur = -max(u_blur, antialiasblur);\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);\n\n  // TODP: /abs(extrude.x) \u662f\u4e3a\u4e86\u517c\u5bb9\u5730\u7403\u6a21\u5f0f\n  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);\n\n\n  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1 + u_offsets, 1.0);\n\n  setPickingColor(a_PickingColor);\n}\n',Dl=function(e){Oi(n,e);var t=Ll(n);function n(){return Si(this,n),t.apply(this,arguments)}return Ei(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.strokeOpacity,i=void 0===r?1:r,a=e.strokeWidth,o=void 0===a?0:a,s=e.stroke,u=void 0===s?"rgba(0,0,0,0)":s,l=e.blend,c=e.blur,f=void 0===c?0:c;return{u_blur:f,u_additive:"additive"===l?1:0,u_opacity:n,u_stroke_opacity:i,u_stroke_width:o,u_stroke_color:(0,Ue.CI)(u)}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig(),t=e.animateOption,n=void 0===t?{enable:!1}:t;return{u_animate:this.animateOption2Array(n),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.layer.triangulation=Eo,e.next=3,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:Il,fragmentShader:Rl,triangulation:Eo,depth:{enable:!0},blend:this.getBlend()});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:yt.GC.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:3,update:function(e,t,n,r){var i=sa(n,3),a=i[0],o=i[1],s=i[2],u=qa.fromValues(0,0,1),l=qa.fromValues(a,0,s),c=a>=0?qa.angle(u,l):2*Math.PI-qa.angle(u,l),f=2*Math.PI-Math.asin(o/100),h=Ya.create();Ya.rotateY(h,h,c),Ya.rotateX(h,h,f);var p=qa.fromValues(1,1,0);qa.transformMat4(p,p,h),qa.normalize(p,p);var d=qa.fromValues(-1,1,0);qa.transformMat4(d,d,h),qa.normalize(d,d);var v=qa.fromValues(-1,-1,0);qa.transformMat4(v,v,h),qa.normalize(v,v);var g=qa.fromValues(1,-1,0);qa.transformMat4(g,g,h),qa.normalize(g,g);var m=[].concat(Vi(p),Vi(d),Vi(v),Vi(g)),y=r%4*3;return[m[y],m[y+1],m[y+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:yt.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:yt.GC.Attribute,descriptor:{name:"a_Shape",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:1,update:function(t){var n=t.shape,r=void 0===n?2:n,i=e.layer.getLayerConfig().shape2d,a=i.indexOf(r);return[a]}}})}}]),n}(Oa);function zl(e){var t=Nl();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function Nl(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Fl='varying vec4 v_color;\nvarying float v_lightWeight;\nuniform float u_pickLight: 0.0;\n\n#pragma include "picking"\n\n\nvoid main() {\n\n  gl_FragColor = v_color;\n  // \u5f00\u542f\u900f\u660e\u5ea6\u6e10\u53d8\n  // picking\n  if(u_pickLight > 0.0) {\n    gl_FragColor = filterColorAlpha(gl_FragColor, v_lightWeight);\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n',jl='precision highp float;\n\n#define pi 3.1415926535\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\nattribute vec4 a_Color;\nattribute vec3 a_Size;\nattribute vec3 a_Normal;\n\nuniform float u_heightfixed: 0.0; // \u9ed8\u8ba4\u4e0d\u56fa\u5b9a\nuniform float u_r;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\nvarying float v_lightWeight;\nvarying float v_barLinearZ;\n\nuniform float u_opacity : 1;\nuniform float u_lightEnable: 1;\nuniform float u_opacitylinear: 0.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_opacitylinear_dir: 1.0;\nuniform float  u_linearColor: 0.0;\n\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nfloat getYRadian(float x, float z) {\n  if(x > 0.0 && z > 0.0) {\n    return atan(x/z);\n  } else if(x > 0.0 && z <= 0.0){\n    return atan(-z/x) + pi/2.0;\n  } else if(x <= 0.0 && z <= 0.0) {\n    return  pi + atan(x/z); //atan(x/z) + \n  } else {\n    return atan(z/-x) + pi*3.0/2.0;\n  }\n}\n\nfloat getXRadian(float y, float r) {\n  return atan(y/r);\n}\n\nvoid main() {\n\n\n  vec3 size = a_Size * a_Position;\n\n  vec3 offset = size; // \u63a7\u5236\u5706\u67f1\u4f53\u7684\u5927\u5c0f - \u4ece\u6807\u51c6\u5355\u4f4d\u5706\u67f1\u4f53\u8fdb\u884c\u504f\u79fb\n\n  if(u_heightfixed < 1.0) { // \u5706\u67f1\u4f53\u4e0d\u56fa\u5b9a\u9ad8\u5ea6\n    \n    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n      // P20 \u5750\u6807\u7cfb\u4e0b\uff0c\u4e3a\u4e86\u548c Web \u58a8\u5361\u6258\u5750\u6807\u7cfb\u7edf\u4e00\uff0czoom \u9ed8\u8ba4\u51cf1\n      offset = offset * pow(2.0, (19.0 - u_Zoom));\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n      // P20_2 \u5750\u6807\u7cfb\u4e0b\uff0c\u4e3a\u4e86\u548c Web \u58a8\u5361\u6258\u5750\u6807\u7cfb\u7edf\u4e00\uff0czoom \u9ed8\u8ba4\u51cf3\n      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));\n    }\n  } else {// \u5706\u67f1\u4f53\u56fa\u5b9a\u9ad8\u5ea6 \uff08 \u5904\u7406 mapbox \uff09\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);\n    }\n  }\n\n\n  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));\n\n  // u_r \u63a7\u5236\u5706\u67f1\u7684\u751f\u957f\n  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);\n\n  // // \u5706\u67f1\u5149\u7167\u6548\u679c\n  float lightWeight = 1.0;\n\n  if(u_lightEnable > 0.0) { // \u53d6\u6d88\u4e09\u5143\u8868\u8fbe\u5f0f\uff0c\u589e\u5f3a\u5065\u58ee\u6027\n    lightWeight = calc_lighting(pos);\n  }\n\n  v_lightWeight = lightWeight;\n\n  v_color = a_Color;\n\n    // \u8bbe\u7f6e\u5706\u67f1\u7684\u5e95\u8272\n  if(u_linearColor == 1.0) { // \u4f7f\u7528\u6e10\u53d8\u989c\u8272\n    v_color = mix(u_sourceColor, u_targetColor, a_Position.z);\n    v_color.a =  v_color.a * u_opacity;\n  } else {\n    v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * u_opacity);\n  }\n\n    if(u_opacitylinear > 0.0) {\n    v_color.a *= u_opacitylinear_dir > 0.0 ? (1.0 - a_Position.z): a_Position.z;\n  }\n\n\n  // gl_Position = project_common_position_to_clipspace(pos);\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * pos;\n  } else {\n    gl_Position = project_common_position_to_clipspace(pos);\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',Bl=function(e){Oi(n,e);var t=zl(n);function n(){var e;Si(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Ri(Ti(e),"raiseCount",0),Ri(Ti(e),"raiseRepeat",0),e}return Ei(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.animateOption,n=void 0===t?{enable:!1,speed:.01,repeat:!1}:t,r=e.opacity,i=void 0===r?1:r,a=e.sourceColor,o=e.targetColor,s=e.pickLight,u=void 0!==s&&s,l=e.heightfixed,c=void 0!==l&&l,f=e.opacityLinear,h=void 0===f?{enable:!1,dir:"up"}:f,p=e.lightEnable,d=void 0===p||p,v=0,g=[0,0,0,0],m=[0,0,0,0];if(a&&o&&(g=(0,Ue.CI)(a),m=(0,Ue.CI)(o),v=1),this.raiseCount<1&&this.raiseRepeat>0&&n.enable){var y=n.speed,_=void 0===y?.01:y;this.raiseCount+=_,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(u),u_heightfixed:Number(c),u_r:n.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:i,u_linearColor:v,u_sourceColor:g,u_targetColor:m,u_opacitylinear:Number(h.enable),u_opacitylinear_dir:"up"===h.dir?1:0,u_lightEnable:Number(d)}}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t,n,r,i,a,o;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.depth,r=void 0===n||n,i=t.animateOption.repeat,a=void 0===i?1:i,this.raiseRepeat=a,e.next=4,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:jl,fragmentShader:Fl,triangulation:To,cull:{enable:!0,face:(0,Ue.fj)(this.mapService.version)},depth:{enable:r}});case 4:return o=e.sent,e.abrupt("return",[o]);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:yt.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:3,update:function(e){var t=e.size;if(t){var n=[];return Array.isArray(t)&&(n=2===t.length?[t[0],t[0],t[1]]:t),Array.isArray(t)||(n=[t,t,t]),n}return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:yt.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:yt.gl.STATIC_DRAW,data:[],type:yt.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:yt.GC.Attribute,descriptor:{name:"a_Pos",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:3,update:function(e){var t=(0,Ue.SI)(e.coordinates);return[t[0],t[1],0]}}})}}]),n}(Oa);function Ul(e){var t=Vl();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function Vl(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Gl="\nuniform float u_additive;\n\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\n#pragma include \"sdf_2d\"\n#pragma include \"picking\"\n\nvoid main() {\n\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n  \n  outer_df = sdCircle(v_data.xy, 1.0);\n  inner_df = sdCircle(v_data.xy, r);\n\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  float color_t = smoothstep(\n    antialiasblur,\n    0.0,\n    inner_df\n  );\n  float PI = 3.14159;\n  float N_RINGS = 3.0;\n  float FREQ = 1.0;\n\n  gl_FragColor = v_color;\n\n  float d = length(v_data.xy);\n  if(d > 0.5) {\n    discard;\n  }\n  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);\n  \n  // \u6839\u636e\u53e0\u52a0\u6a21\u5f0f\u9009\u62e9\u6548\u679c\n  if(u_additive > 0.0) {\n    gl_FragColor *= intensity;\n    // \u4f18\u5316\u6c34\u6ce2\u70b9 blend additive \u6a21\u5f0f\u4e0b\u6709\u7684\u62fe\u53d6\u6548\u679c \n    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);\n  } else {\n    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n",Hl="uniform float u_additive;\nuniform float u_stroke_opacity : 1;\nuniform float u_stroke_width : 2;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nvarying vec4 v_stroke;\n\n\n#pragma include \"sdf_2d\"\n#pragma include \"picking\"\n\n\nvoid main() {\n  int shape = int(floor(v_data.w + 0.5));\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius + u_stroke_width);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n  if (shape == 0) {\n    outer_df = sdCircle(v_data.xy, 1.0);\n    inner_df = sdCircle(v_data.xy, r);\n  } else if (shape == 1) {\n    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);\n    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);\n  } else if (shape == 2) {\n    outer_df = sdBox(v_data.xy, vec2(1.));\n    inner_df = sdBox(v_data.xy, vec2(r));\n  } else if (shape == 3) {\n    outer_df = sdPentagon(v_data.xy, 0.8);\n    inner_df = sdPentagon(v_data.xy, r * 0.8);\n  } else if (shape == 4) {\n    outer_df = sdHexagon(v_data.xy, 0.8);\n    inner_df = sdHexagon(v_data.xy, r * 0.8);\n  } else if (shape == 5) {\n    outer_df = sdOctogon(v_data.xy, 1.0);\n    inner_df = sdOctogon(v_data.xy, r);\n  } else if (shape == 6) {\n    outer_df = sdHexagram(v_data.xy, 0.52);\n    inner_df = sdHexagram(v_data.xy, r * 0.52);\n  } else if (shape == 7) {\n    outer_df = sdRhombus(v_data.xy, vec2(1.0));\n    inner_df = sdRhombus(v_data.xy, vec2(r));\n  } else if (shape == 8) {\n    outer_df = sdVesica(v_data.xy, 1.1, 0.8);\n    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);\n  }\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(\n    antialiasblur,\n    0.0,\n    inner_df\n  );\n\n  if(u_stroke_width < 0.01) {\n    gl_FragColor = v_color;\n  } else {\n    gl_FragColor = mix(v_color, v_stroke * u_stroke_opacity, color_t);\n  }\n\n  if(u_additive > 0.0) {\n    gl_FragColor *= opacity_t;\n    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);\n  } else {\n    gl_FragColor.a *= opacity_t;\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n   // \u4f5c\u4e3a mask \u6a21\u677f\u65f6\u9700\u8981\u4e22\u5f03\u900f\u660e\u7684\u50cf\u7d20\n  if(gl_FragColor.a < 0.01) {\n    discard;\n  } \n}\n",Wl='attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nattribute float a_Shape;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform int u_size_unit;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nvarying vec4 v_stroke;\n\n// uniform float u_opacity : 1;\nuniform float u_stroke_width: 2;\nuniform vec3 u_blur_height_fixed: [0, 0, 0];\n\n\n#pragma include "projection"\n#pragma include "picking"\n\n\nvoid main() {\n  // \u900f\u660e\u5ea6\u8ba1\u7b97\n  v_stroke = stroke;  \n  vec3 extrude = a_Extrude;\n  float shape_type = a_Shape;\n  /*\n  *  setPickingSize \u8bbe\u7f6e\u62fe\u53d6\u5927\u5c0f\n  *  u_meter2coord \u5728\u7b49\u9762\u79ef\u5927\u5c0f\u7684\u65f6\u5019\u8bbe\u7f6e\u5355\u4f4d\n  */\n  float newSize = setPickingSize(a_Size);\n  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;\n\n\n\n  // unpack color(vec2)\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n\n  if(u_size_unit == 1) {\n    newSize = newSize  * u_PixelsPerMeter.z;\n  }\n\n   v_radius = newSize;\n\n  // anti-alias\n  //  float antialiased_blur = -max(u_blur, antialiasblur);\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur_height_fixed.x);\n\n  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + u_offsets);\n  vec3 aPosition = a_Position;\n\n  offset = project_pixel(offset);\n  \n  // TODP: /abs(extrude.x) \u662f\u4e3a\u4e86\u517c\u5bb9\u5730\u7403\u6a21\u5f0f\n  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);\n\n\n  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\n  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));\n\n  float raisingHeight = u_blur_height_fixed.y;\n\n  if(u_blur_height_fixed.z < 1.0) { // false\n    raisingHeight = project_pixel(u_blur_height_fixed.y);\n  } else {\n     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raisingHeight = u_blur_height_fixed.y * mapboxZoomScale;\n    }\n  }\n \n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position =  u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));\n  }\n \n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',Yl=function(e){Oi(n,e);var t=Ul(n);function n(){return Si(this,n),t.apply(this,arguments)}return Ei(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.strokeOpacity,n=void 0===t?1:t,r=e.strokeWidth,i=void 0===r?0:r,a=e.blend,o=e.blur,s=void 0===o?0:o,u=e.raisingHeight,l=void 0===u?0:u,c=e.heightfixed,f=void 0!==c&&c,h=e.unit,p=void 0===h?"pixel":h;return Yi({u_blur_height_fixed:[s,Number(l),Number(f)],u_additive:"additive"===a?1:0,u_stroke_opacity:n,u_stroke_width:i,u_size_unit:Ia[p]},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig(),t=e.animateOption,n=void 0===t?{enable:!1}:t;return{u_animate:this.animateOption2Array(n),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Ue.oX)}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t,n,r,i,a,o,s,u;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.animateOption,r=void 0===n?{enable:!1}:n,i=this.getShaders(r),a=i.frag,o=i.vert,s=i.type,this.layer.triangulation=Ue.oX,e.next=5,this.layer.buildLayerModel({moduleName:s,vertexShader:o,fragmentShader:a,inject:this.getInject(),triangulation:Ue.oX,depth:{enable:!1}});case 5:return u=e.sent,e.abrupt("return",[u]);case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getShaders",value:function(e){if(!e.enable)return{frag:Hl,vert:Wl,type:"pointFill"};switch(e.type){case"wave":return{frag:Gl,vert:Wl,type:"pointWave"};default:return{frag:Gl,vert:Wl,type:"pointWave"}}}},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:yt.GC.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:3,update:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],a=r%4*3;return[i[a],i[a+1],i[a+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:yt.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:yt.GC.Attribute,descriptor:{name:"a_Shape",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:1,update:function(t){var n=t.shape,r=void 0===n?2:n,i=e.indexOf(r);return[i]}}})}}]),n}(Oa);function ql(e){var t=Zl();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function Zl(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Kl='uniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float u_opacity : 1;\n\n#pragma include "sdf_2d"\n#pragma include "picking"\nvarying vec2 v_uv; // \u672c\u8eab\u7684 uv \u5750\u6807\nvarying vec2 v_Iconuv;\n\nvoid main() {\n\n  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;\n  gl_FragColor = texture2D(u_texture, pos);\n  gl_FragColor.a *= u_opacity;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',Xl='attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nattribute vec2 a_Uv;\nattribute float a_Rotate;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform mat2 u_RotateMatrix;\nuniform int u_size_unit;\n\nvarying vec2 v_uv; // \u672c\u8eab\u7684 uv \u5750\u6807\nvarying vec2 v_Iconuv; // icon \u8d34\u56fe\u7684 uv \u5750\u6807\n\nuniform float u_raisingHeight: 0.0;\nuniform float u_heightfixed: 0.0;\nuniform float u_opacity : 1;\nuniform vec2 u_offsets;\n\n\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  vec3 extrude = a_Extrude;\n  v_uv = (a_Extrude.xy + 1.0)/2.0;\n  v_uv.y = 1.0 - v_uv.y;\n  v_Iconuv = a_Uv;\n\n\n  highp float angle_sin = sin(a_Rotate);\n  highp float angle_cos = cos(a_Rotate);\n  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n  float newSize = a_Size;\n  if(u_size_unit == 1) {\n    newSize = newSize  * u_PixelsPerMeter.z;\n  }\n\n  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);\n  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (newSize) + u_offsets);\n  vec3 aPosition = a_Position;\n\n  offset = project_pixel(offset);\n\n  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\n  float raisingHeight = u_raisingHeight;\n  if(u_heightfixed < 1.0) { // height fixed\n    raisingHeight = project_pixel(u_raisingHeight);\n  } else {\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raisingHeight = u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp *vec4(project_pos.xy + offset, raisingHeight, 1.0);\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));\n  }\n \n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',Ql=function(e){Oi(n,e);var t=ql(n);function n(){var e;Si(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Ri(Ti(e),"meter2coord",1),Ri(Ti(e),"isMeter",!1),Ri(Ti(e),"radian",0),Ri(Ti(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),void e.layerService.throttleRenderLayers();e.texture=t({data:e.iconService.getCanvas(),mag:yt.gl.LINEAR,min:yt.gl.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128,mipmap:!0})})),e}return Ei(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.offsets,i=void 0===r?[0,0]:r,a=e.rotation,o=e.raisingHeight,s=void 0===o?0:o,u=e.heightfixed,l=void 0!==u&&u,c=e.unit,f=void 0===c?"pixel":c;this.rendererService.getDirty()&&this.texture.bind();var h=1;return"GAODE2.x"!==this.mapService.version&&"GAODE1.x"!==this.mapService.version||(h=-1),this.radian=void 0!==a?h*Math.PI*a/180:h*Math.PI*(this.mapService.getRotation()%360)/180,{u_raisingHeight:Number(s),u_heightfixed:Number(l),u_size_unit:Ia[f],u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:n,u_offsets:i}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Ao)}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:Xl,fragmentShader:Kl,triangulation:Ao,depth:{enable:!1},cull:{enable:!0,face:(0,Ue.fj)(this.mapService.version)}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var e;this.iconService.off("imageUpdate",this.updateTexture),null===(e=this.texture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:yt.GC.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:1,update:function(e){var t=e.rotate,n=void 0===t?0:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:yt.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap(),r=t.shape,i=n[r]||{x:-64,y:-64},a=i.x,o=i.y;return[a,o]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:yt.GC.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:3,update:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],a=r%4*3;return[i[a],i[a+1],i[a+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:yt.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}})}}]),n}(Oa);function Jl(e){var t=$l();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function $l(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var ec='\nuniform sampler2D u_texture;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nuniform vec2 u_textSize;\nuniform float u_opacity : 1;\n\n#pragma include "picking"\n\nvoid main(){\n      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;\n      vec4 textureColor;\n\n      // Y = 0.299R + 0.587G + 0.114B // \u4eae\u5ea6\u63d0\u53d6\n     \n      textureColor = texture2D(u_texture, pos);\n\n      // Tip: \u53bb\u9664\u8fb9\u7f18\u90e8\u5206 mipmap \u5bfc\u81f4\u7684\u6df7\u5408\u53d8\u6697\n      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);\n      if(fragmengTocenter >= 0.5) {\n            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;\n            textureColor.a *= luma;\n      }\n      \n      \n\n      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){\n            gl_FragColor= textureColor;\n      }else {\n            gl_FragColor= step(0.01, textureColor.z) * v_color;\n      }\n\n      gl_FragColor.a = gl_FragColor.a * u_opacity;\n      \n      if (gl_FragColor.a < 0.01) {\n         discard;\n      }\n      gl_FragColor = filterColor(gl_FragColor);\n}\n',tc='precision highp float;\nattribute vec3 a_Position;\nattribute vec4 a_Color;\nattribute vec2 a_Uv;\nattribute float a_Size;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec2 u_offsets;\n\nuniform float u_opacity : 1;\nuniform float u_raisingHeight: 0.0;\nuniform float u_heightfixed: 0.0;\n\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n\n  // cal style mapping - \u6570\u636e\u7eb9\u7406\u6620\u5c04\u90e8\u5206\u7684\u8ba1\u7b97\n  v_color = a_Color;\n  v_uv = a_Uv;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   \n  vec2 offset = project_pixel(u_offsets);\n\n  float raisingHeight = u_raisingHeight;\n  if(u_heightfixed < 1.0) { // false\n    raisingHeight = project_pixel(u_raisingHeight);\n  } else {\n     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raisingHeight = u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));\n  }\n\n  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n  setPickingColor(a_PickingColor);\n}\n',nc=function(e){Oi(n,e);var t=Jl(n);function n(){var e;Si(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Ri(Ti(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),void setTimeout((function(){e.layerService.throttleRenderLayers()}));e.texture=t({data:e.iconService.getCanvas(),mag:yt.gl.LINEAR,min:yt.gl.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128,mipmap:!0})})),e}return Ei(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.offsets,i=void 0===r?[0,0]:r,a=e.raisingHeight,o=void 0===a?0:a,s=e.heightfixed,u=void 0!==s&&s;return this.rendererService.getDirty()&&this.texture.bind(),{u_raisingHeight:Number(o),u_heightfixed:Number(u),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:n,u_offsets:i}}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:tc,fragmentShader:ec,triangulation:Mo,depth:{enable:!1},primitive:yt.gl.POINTS});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:yt.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:yt.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap(),r=t.shape,i=n[r]||{x:-64,y:-64},a=i.x,o=i.y;return[a,o]}}})}}]),n}(Oa);function rc(e){var t=ic();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function ic(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var ac="varying vec4 v_color;\nvoid main() {\n  gl_FragColor = v_color;\n}\n",oc='\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform float u_opacity : 1;\nuniform mat4 u_Mvp;\nattribute float a_Size;\nattribute vec4 a_Color;\n\nvarying vec4 v_color;\n\n#pragma include "projection"\n#pragma include "project"\n\nvoid main() {\n  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity);\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(a_Position.xy, a_Position.z, 1.0);\n  } else {\n    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);\n    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy),project_pos.z,project_pos.w));\n  }\n\n  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n}\n';function sc(e){var t=e.coordinates;return{vertices:Vi(t),indices:[0],size:t.length}}var uc=function(e){Oi(n,e);var t=rc(n);function n(){return Si(this,n),t.apply(this,arguments)}return Ei(n,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t;return{u_opacity:(0,Zt.isNumber)(n)?n:1}}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.layer.triangulation=sc,e.next=3,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:oc,fragmentShader:ac,triangulation:sc,depth:{enable:!1},primitive:yt.gl.POINTS,pick:!1});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:yt.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}})}}]),n}(Oa);function lc(e){var t=cc();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function cc(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var fc='\nuniform float u_additive;\nuniform float u_opacity: 1.0;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nvarying vec2 v_exteude;\n#pragma include "sdf_2d"\n#pragma include "picking"\n\nvoid main() {\n\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius);\n\n  float outer_df = sdCircle(v_data.xy, 1.0);\n  float inner_df = sdCircle(v_data.xy, r);\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);\n\n  if(u_additive > 0.0) {\n    gl_FragColor *= opacity_t;\n  } else {\n    gl_FragColor.a *= opacity_t;\n  }\n\n  if(gl_FragColor.a > 0.0) {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n\n  vec2 extrude =  v_exteude;\n  vec2 dir = normalize(extrude);\n  vec2 baseDir = vec2(1.0, 0.0);\n  float pi = 3.14159265359;\n  // full circle\n  // float rades = dot(dir, baseDir);\n  // float flag = sign(dir.y);\n  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;\n  \n  // half circle\n  float flag = sign(dir.y);\n  float rades = dot(dir, baseDir);\n  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;\n  // simple AA\n  if(radar_v > 0.99) {\n    radar_v = 1.0 - (radar_v - 0.99)/0.01;\n  }\n\n  gl_FragColor.a *= radar_v;\n}\n',hc='attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nuniform float u_speed: 1.0;\nuniform float u_time;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform int u_size_unit;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nvarying vec2 v_exteude;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  vec3 extrude = a_Extrude;\n  float newSize = setPickingSize(a_Size);\n\n  float time = u_time * u_speed;\n  mat2 rotateMatrix = mat2( \n    cos(time), sin(time), \n    -sin(time), cos(time)\n  );\n  v_exteude = rotateMatrix * a_Extrude.xy;\n\n  // unpack color(vec2)\n  v_color = a_Color;\n\n\n\n  // anti-alias\n  float blur = 0.0;\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);\n\n  if(u_size_unit == 1) {\n    newSize = newSize  * u_PixelsPerMeter.z;\n  }\n  // radius(16-bit)\n  v_radius = newSize;\n\n  vec2 offset = (extrude.xy * (newSize));\n  vec3 aPosition = a_Position;\n  \n    // \u4e0d\u4ee5\u7c73\u4e3a\u5b9e\u9645\u5355\u4f4d\n  offset = project_pixel(offset);\n  \n  v_data = vec4(extrude.x, extrude.y, antialiasblur, -1.0);\n\n  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp *vec4(project_pos.xy + offset, 0.0, 1.0);\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',pc=function(e){Oi(n,e);var t=lc(n);function n(){return Si(this,n),t.apply(this,arguments)}return Ei(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.blend,i=e.speed,a=void 0===i?1:i,o=e.unit,s=void 0===o?"pixel":o;return{u_size_unit:Ia[s],u_speed:a,u_additive:"additive"===r?1:0,u_opacity:n}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig(),t=e.animateOption,n=void 0===t?{enable:!1}:t;return{u_animate:this.animateOption2Array(n),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Ao)}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:hc,fragmentShader:fc,triangulation:Ao,depth:{enable:!1}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:yt.GC.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:3,update:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],a=r%4*3;return[i[a],i[a+1],i[a+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:yt.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}})}}]),n}(Oa);function dc(e){var t=vc();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function vc(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var gc='\nuniform float u_additive;\nuniform float u_stroke_opacity : 1;\n\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\n\nvarying vec4 v_color;\nvarying float v_blur;\nvarying float v_innerRadius;\n\n#pragma include "picking"\nvoid main() {\n  vec2 center = vec2(0.5);\n\n  // Tip: \u7247\u5143\u5230\u4e2d\u5fc3\u70b9\u7684\u8ddd\u79bb 0 - 1\n  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;\n  // Tip: \u7247\u5143\u7684\u526a\u5207\u6210\u5706\u5f62\n  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);\n\n\n  if(v_innerRadius < 0.99) {\n    // \u5f53\u5b58\u5728 stroke \u4e14 stroke > 0.01\n    float blurWidth = (1.0 - v_blur)/2.0;\n    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);\n    if(fragmengTocenter > v_innerRadius + blurWidth) {\n      gl_FragColor = stroke;\n    } else if(fragmengTocenter > v_innerRadius - blurWidth){\n      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);\n      gl_FragColor = mix(v_color, stroke, mixR);\n    } else {\n      gl_FragColor = v_color;\n    }\n  } else {\n    // \u5f53\u4e0d\u5b58\u5728 stroke \u6216 stroke <= 0.01\n    gl_FragColor = v_color;\n  }\n\n  gl_FragColor = filterColor(gl_FragColor);\n  \n  if(u_additive > 0.0) {\n    gl_FragColor *= circleClipOpacity;\n  } else {\n    gl_FragColor.a *= circleClipOpacity;\n  }\n\n}\n',mc='\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute float a_Size;\nattribute vec4 a_Color;\nvarying vec4 v_color;\n\nuniform float u_opacity : 1;\nuniform vec2 u_offsets;\nuniform float u_stroke_width;\n\nvarying float v_blur;\nvarying float v_innerRadius;\n\n\n\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "project"\nvoid main() {\n  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity);\n  v_blur = 1.0 - max(2.0/a_Size, 0.05);\n  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);\n  \n  vec2 offset = project_pixel(u_offsets);\n  \n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);\n  } else { // else\n    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);\n    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\n  }\n\n  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n  setPickingColor(a_PickingColor);\n}\n';function yc(e){var t=e.coordinates;return{vertices:Vi(t),indices:[0],size:t.length}}var _c=function(e){Oi(n,e);var t=dc(n);function n(){return Si(this,n),t.apply(this,arguments)}return Ei(n,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.offsets,i=void 0===r?[0,0]:r,a=e.blend,o=e.strokeOpacity,s=void 0===o?1:o,u=e.strokeWidth,l=void 0===u?0:u,c=e.stroke,f=void 0===c?"#fff":c;return{u_additive:"additive"===a?1:0,u_opacity:n,u_offsets:i,u_stroke_opacity:s,u_stroke_width:l,u_stroke_color:(0,Ue.CI)(f)}}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.layer.triangulation=yc,e.next=3,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:mc,fragmentShader:gc,triangulation:yc,depth:{enable:!1},primitive:yt.gl.POINTS});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:yt.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}})}}]),n}(Oa),xc=n(35963);function bc(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Sc(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Sc(e,t){if(e){if("string"===typeof e)return wc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?wc(e,t):void 0}}function wc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Cc=function(){function e(t,n,r){Si(this,e),Ri(this,"boxCells",[]);var i=this.boxCells;this.xCellCount=Math.ceil(t/r),this.yCellCount=Math.ceil(n/r);for(var a=0;a<this.xCellCount*this.yCellCount;a++)i.push([]);this.boxKeys=[],this.bboxes=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0}return Ei(e,[{key:"insert",value:function(e,t,n,r,i){this.forEachCell(t,n,r,i,this.insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)}},{key:"query",value:function(e,t,n,r,i){return this.queryHitTest(e,t,n,r,!1,i)}},{key:"hitTest",value:function(e,t,n,r,i){return this.queryHitTest(e,t,n,r,!0,i)}},{key:"insertBoxCell",value:function(e,t,n,r,i,a){this.boxCells[i].push(a)}},{key:"queryHitTest",value:function(e,t,n,r,i,a){if(n<0||e>this.width||r<0||t>this.height)return!i&&[];var o=[];if(e<=0&&t<=0&&this.width<=n&&this.height<=r){if(i)return!0;for(var s=0;s<this.boxKeys.length;s++)o.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});return a?o.filter(a):o}var u={hitTest:i,seenUids:{box:{},circle:{}}};return this.forEachCell(e,t,n,r,this.queryCell,o,u,a),i?o.length>0:o}},{key:"queryCell",value:function(e,t,n,r,i,a,o,s){var u=o.seenUids,l=this.boxCells[i];if(null!==l){var c,f=this.bboxes,h=bc(l);try{for(h.s();!(c=h.n()).done;){var p=c.value;if(!u.box[p]){u.box[p]=!0;var d=4*p;if(e<=f[d+2]&&t<=f[d+3]&&n>=f[d+0]&&r>=f[d+1]&&(!s||s(this.boxKeys[p]))){if(o.hitTest)return a.push(!0),!0;a.push({key:this.boxKeys[p],x1:f[d],y1:f[d+1],x2:f[d+2],y2:f[d+3]})}}}}catch(v){h.e(v)}finally{h.f()}}return!1}},{key:"forEachCell",value:function(e,t,n,r,i,a,o,s){for(var u=this.convertToXCellCoord(e),l=this.convertToYCellCoord(t),c=this.convertToXCellCoord(n),f=this.convertToYCellCoord(r),h=u;h<=c;h++)for(var p=l;p<=f;p++){var d=this.xCellCount*p+h;if(i.call(this,e,t,n,r,d,a,o,s))return}}},{key:"convertToXCellCoord",value:function(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}},{key:"convertToYCellCoord",value:function(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}}]),e}(),kc=Cc,Ac=function(){function e(t,n){Si(this,e),Ri(this,"viewportPadding",100),this.width=t,this.height=n,this.viewportPadding=Math.max(t,n),this.grid=new kc(t+this.viewportPadding,n+this.viewportPadding,25),this.screenRightBoundary=t+this.viewportPadding,this.screenBottomBoundary=n+this.viewportPadding,this.gridRightBoundary=t+2*this.viewportPadding,this.gridBottomBoundary=n+2*this.viewportPadding}return Ei(e,[{key:"placeCollisionBox",value:function(e){var t=e.x1+e.anchorPointX+this.viewportPadding,n=e.y1+e.anchorPointY+this.viewportPadding,r=e.x2+e.anchorPointX+this.viewportPadding,i=e.y2+e.anchorPointY+this.viewportPadding;return!this.isInsideGrid(t,n,r,i)||this.grid.hitTest(t,n,r,i)?{box:[]}:{box:[t,n,r,i]}}},{key:"insertCollisionBox",value:function(e,t){var n={featureIndex:t};this.grid.insert(n,e[0],e[1],e[2],e[3])}},{key:"project",value:function(e,t,n){var r=xc.al(t,n,0,1),i=xc.Ue(),a=Ya.fromValues.apply(Ya,Vi(e));return xc.fF(i,r,a),{x:(i[0]/i[3]+1)/2*this.width+this.viewportPadding,y:(-i[1]/i[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(e,t,n,r){return n>=0&&e<this.gridRightBoundary&&r>=0&&t<this.gridBottomBoundary}}]),e}();function Ec(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Tc(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Tc(e,t){if(e){if("string"===typeof e)return Mc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Mc(e,t):void 0}}function Mc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Oc(e){var t=.5,n=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0;break;default:t=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0;break;default:n=.5}return{horizontalAlign:t,verticalAlign:n}}function Lc(e,t,n,r,i){if(i){var a=e[r],o=a.glyph;if(o)for(var s=t[o].advance*a.scale,u=(e[r].x+s)*i,l=n;l<=r;l++)e[l].x-=u}}function Pc(e,t,n,r,i,a,o){var s,u=(t-n)*i,l=(-r*o+.5)*a,c=Ec(e);try{for(c.s();!(s=c.n()).done;){var f=s.value;f.x+=u,f.y+=l}}catch(h){c.e(h)}finally{c.f()}}function Rc(e,t,n,r,i,a,o){var s=-8,u=0,l=s,c=0,f=e.positionedGlyphs,h="right"===a?1:"left"===a?0:.5,p=f.length;n.forEach((function(e){if(e.split("").forEach((function(e){var n=t[e],r=0;n&&(f.push({glyph:e,x:u,y:l+r,vertical:!1,scale:1,metrics:n}),u+=n.advance+o)})),f.length!==p){var n=u-o;c=Math.max(n,c),Lc(f,t,p,f.length-1,h)}u=0,l-=r+5}));var d=Oc(i),v=d.horizontalAlign,g=d.verticalAlign;Pc(f,h,v,g,c,r,n.length);var m=l-s;e.top+=-g*m,e.bottom=e.top-m,e.left+=-v*c,e.right=e.left+c}function Ic(e,t,n,r,i,a,o){var s=-8,u=0,l=s,c=0,f=e.positionedGlyphs,h="right"===a?1:"left"===a?0:.5,p=f.length;n.forEach((function(e){var n=t[e],i=0;if(n&&(f.push({glyph:e,x:n.advance/2,y:l+i,vertical:!1,scale:1,metrics:n}),u+=n.advance+o),f.length!==p){var a=u-o;c=Math.max(a,c),Lc(f,t,p,f.length-1,h)}u=0,l-=r+5}));var d=Oc(i),v=d.horizontalAlign,g=d.verticalAlign;Pc(f,h,v,g,c,r,n.length);var m=l-s;e.top+=-g*m,e.bottom=e.top-m,e.left+=-v*c,e.right=e.left+c}function Dc(e,t,n,r,i,a){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[0,0],s=arguments.length>7?arguments[7]:void 0,u=e.split("\n"),l=[],c={positionedGlyphs:l,top:o[1],bottom:o[1],left:o[0],right:o[0],lineCount:u.length,text:e};return s?Ic(c,t,u,n,r,i,a):Rc(c,t,u,n,r,i,a),!!l.length&&c}function zc(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,i=e.positionedGlyphs,a=void 0===i?[]:i,o=[],s=Ec(a);try{for(s.s();!(t=s.n()).done;){var u=t.value,l=u.metrics,c=4,f=l.advance*u.scale/2,h=r?[u.x+f,u.y]:[0,0],p=r?[0,0]:[u.x+f+n[0],u.y+n[1]],d=(0-c)*u.scale-f+p[0],v=(0-c)*u.scale+p[1],g=d+l.width*u.scale,m=v+l.height*u.scale,y={x:d,y:v},_={x:g,y:v},x={x:d,y:m},b={x:g,y:m};o.push({tl:y,tr:_,bl:x,br:b,tex:l,glyphOffset:h})}}catch(S){s.e(S)}finally{s.f()}return o}function Nc(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Fc(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Fc(e,t){if(e){if("string"===typeof e)return jc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?jc(e,t):void 0}}function jc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Bc(e){var t=Uc();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function Uc(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Vc='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 48.0\nuniform sampler2D u_sdf_map;\nuniform float u_gamma_scale : 0.5;\nuniform float u_stroke_width : 2.0;\nuniform float u_halo_blur : 0.5;\nuniform float u_DevicePixelRatio;\n\nvarying vec4 v_color;\nvarying vec4 v_stroke_color;\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\nvarying float v_fontScale;\n\n\n#pragma include "picking"\nvoid main() {\n  // get style data mapping\n\n  // get sdf from atlas\n  float dist = texture2D(u_sdf_map, v_uv).a;\n\n  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;\n  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;\n\n  highp float gamma_scaled = gamma * v_gamma_scale;\n\n  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\n\n  gl_FragColor = mix(v_color, v_stroke_color, smoothstep(0., 0.5, 1.- dist));\n\n  gl_FragColor.a *= alpha;\n   // \u4f5c\u4e3a mask \u6a21\u677f\u65f6\u9700\u8981\u4e22\u5f03\u900f\u660e\u7684\u50cf\u7d20\n  if (gl_FragColor.a < 0.01) {\n    discard;\n  }\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',Gc='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 24.0\nattribute vec3 a_Position;\nattribute vec2 a_tex;\nattribute vec2 a_textOffsets;\nattribute vec4 a_Color;\nattribute float a_Size;\nattribute float a_Rotate;\n\nuniform vec2 u_sdf_map_size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_raisingHeight: 0.0;\n\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\nvarying vec4 v_color;\nvarying vec4 v_stroke_color;\nvarying float v_fontScale;\n// uniform float u_opacity : 1;\nuniform float u_stroke_width : 2;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\n\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  // cal style mapping - \u6570\u636e\u7eb9\u7406\u6620\u5c04\u90e8\u5206\u7684\u8ba1\u7b97\n  \n  v_uv = a_tex / u_sdf_map_size;\n\n\n\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n  v_stroke_color = vec4(u_stroke_color.xyz, u_stroke_color.w * opacity);\n\n  // \u6587\u672c\u7f29\u653e\u6bd4\u4f8b\n  float fontScale = a_Size / FONT_SIZE;\n  v_fontScale = fontScale;\n\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  highp float angle_sin = sin(a_Rotate);\n  highp float angle_cos = cos(a_Rotate);\n  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n  \n  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\n\n  float raiseHeight = u_raisingHeight;\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n    raiseHeight = u_raisingHeight * mapboxZoomScale;\n  }\n\n  vec4 projected_position;\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n   projected_position  = u_Mvp *(vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));\n  } else { // else\n   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));\n  }\n\n  gl_Position = vec4(\n    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\n  v_gamma_scale = gl_Position.w;\n  setPickingColor(a_PickingColor);\n\n}\n';function Hc(e){var t=this,n=e.id,r=[],i=[];if(!t.glyphInfoMap||!t.glyphInfoMap[n])return{vertices:[],indices:[],size:7};var a=t.glyphInfoMap[n].centroid,o=2===a.length?[a[0],a[1],0]:a;return t.glyphInfoMap[n].glyphQuads.forEach((function(e,t){r.push.apply(r,Vi(o).concat([e.tex.x,e.tex.y+e.tex.height,e.tl.x,e.tl.y],Vi(o),[e.tex.x+e.tex.width,e.tex.y+e.tex.height,e.tr.x,e.tr.y],Vi(o),[e.tex.x+e.tex.width,e.tex.y,e.br.x,e.br.y],Vi(o),[e.tex.x,e.tex.y,e.bl.x,e.bl.y])),i.push(0+4*t,1+4*t,2+4*t,2+4*t,3+4*t,0+4*t)})),{vertices:r,indices:i,size:7}}var Wc=function(e){Oi(n,e);var t=Bc(n);function n(){var e;Si(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Ri(Ti(e),"glyphInfoMap",{}),Ri(Ti(e),"currentZoom",-1),Ri(Ti(e),"textureHeight",0),Ri(Ti(e),"textCount",0),Ri(Ti(e),"preTextStyle",{}),Ri(Ti(e),"mapping",bi(zi().mark((function t(){return zi().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.initGlyph(),e.updateTexture(),t.next=4,e.reBuildModel();case 4:case"end":return t.stop()}}),t)})))),e}return Ei(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.stroke,n=void 0===t?"#fff":t,r=e.strokeWidth,i=void 0===r?0:r,a=e.halo,o=void 0===a?.5:a,s=e.gamma,u=void 0===s?2:s,l=e.raisingHeight,c=void 0===l?0:l,f=this.getFontServiceMapping(),h=this.getFontServiceCanvas();return f&&Object.keys(f).length!==this.textCount&&h&&(this.updateTexture(),this.textCount=Object.keys(f).length),this.preTextStyle=this.getTextStyle(),Yi({u_raisingHeight:Number(c),u_stroke_width:i,u_stroke_color:(0,Ue.CI)(n),u_sdf_map:this.texture,u_halo_blur:o,u_gamma_scale:u,u_sdf_map_size:[(null===h||void 0===h?void 0:h.width)||1,(null===h||void 0===h?void 0:h.height)||1]},this.getStyleAttribute())}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.bindEvent(),this.extent=this.textExtent(),this.rawEncodeData=this.layer.getEncodedData(),this.preTextStyle=this.getTextStyle(),e.abrupt("return",this.buildModels());case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t,n,r,i;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.textAllowOverlap,r=void 0!==n&&n,this.initGlyph(),this.updateTexture(),r||this.filterGlyphs(),e.next=6,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:Gc,fragmentShader:Vc,inject:this.getInject(),triangulation:Hc.bind(this),depth:{enable:!1}});case 6:return i=e.sent,e.abrupt("return",[i]);case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"needUpdate",value:function(){var e=bi(zi().mark((function e(){var t,n,r,i,a,o,s,u,l,c,f,h;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.getTextStyle(),n=t.textAllowOverlap,r=void 0!==n&&n,i=t.textAnchor,a=void 0===i?"center":i,o=t.textOffset,s=t.padding,u=t.fontFamily,l=t.fontWeight,(0,Zt.isEqual)(s,this.preTextStyle.padding)&&(0,Zt.isEqual)(o,this.preTextStyle.textOffset)&&(0,Zt.isEqual)(a,this.preTextStyle.textAnchor)&&(0,Zt.isEqual)(u,this.preTextStyle.fontFamily)&&(0,Zt.isEqual)(l,this.preTextStyle.fontWeight)){e.next=5;break}return e.next=4,this.mapping();case 4:return e.abrupt("return",!0);case 5:if(!r){e.next=7;break}return e.abrupt("return",!1);case 7:if(c=this.mapService.getZoom(),f=this.mapService.getBounds(),h=(0,Ue.oO)(this.extent,f),!(Math.abs(this.currentZoom-c)>.5)&&h&&r===this.preTextStyle.textAllowOverlap){e.next=14;break}return e.next=13,this.reBuildModel();case 13:return e.abrupt("return",!0);case 14:return e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:yt.GC.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:1,update:function(e){var t=e.rotate,n=void 0===t?0:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:yt.GC.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:yt.gl.STATIC_DRAW,data:[],type:yt.gl.FLOAT},size:2,update:function(e,t,n){return[n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:yt.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?12:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:yt.GC.Attribute,descriptor:{name:"a_tex",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}},{key:"bindEvent",value:function(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}},{key:"textExtent",value:function(){var e=this.mapService.getBounds();return(0,Ue.yA)(e,.5)}},{key:"initTextFont",value:function(){var e=this.getTextStyle(),t=e.fontWeight,n=e.fontFamily,r=this.rawEncodeData,i=[];r.forEach((function(e){var t=e.shape,n=void 0===t?"":t;n=n.toString();var r,a=Nc(n);try{for(a.s();!(r=a.n()).done;){var o=r.value;-1===i.indexOf(o)&&i.push(o)}}catch(s){a.e(s)}finally{a.f()}})),this.fontService.setFontOptions({characterSet:i,fontWeight:t,fontFamily:n,iconfont:!1})}},{key:"initIconFontTex",value:function(){var e=this.getTextStyle(),t=e.fontWeight,n=e.fontFamily,r=this.rawEncodeData,i=[];r.forEach((function(e){var t=e.shape,n=void 0===t?"":t;n="".concat(n),-1===i.indexOf(n)&&i.push(n)})),this.fontService.setFontOptions({characterSet:i,fontWeight:t,fontFamily:n,iconfont:!0})}},{key:"getTextStyle",value:function(){var e=this.layer.getLayerConfig(),t=e.fontWeight,n=void 0===t?"400":t,r=e.fontFamily,i=void 0===r?"sans-serif":r,a=e.textAllowOverlap,o=void 0!==a&&a,s=e.padding,u=void 0===s?[0,0]:s,l=e.textAnchor,c=void 0===l?"center":l,f=e.textOffset,h=void 0===f?[0,0]:f,p=e.opacity,d=void 0===p?1:p,v=e.strokeOpacity,g=void 0===v?1:v,m=e.strokeWidth,y=void 0===m?0:m,_=e.stroke,x=void 0===_?"#000":_;return{fontWeight:n,fontFamily:i,textAllowOverlap:o,padding:u,textAnchor:c,textOffset:h,opacity:d,strokeOpacity:g,strokeWidth:y,stroke:x}}},{key:"generateGlyphLayout",value:function(e){var t=this,n=this.getFontServiceMapping(),r=this.layer.getLayerConfig(),i=r.spacing,a=void 0===i?2:i,o=r.textAnchor,s=void 0===o?"center":o,u=r.textOffset,l=this.rawEncodeData;this.glyphInfo=l.map((function(r){var i=r.shape,o=void 0===i?"":i,l=r.id,c=r.size,f=void 0===c?1:c,h=r.textOffset?r.textOffset:u||[0,0],p=r.textAnchor?r.textAnchor:s||"center",d=Dc(o.toString(),n,f,p,"left",a,h,e),v=zc(d,h,!1);return r.shaping=d,r.glyphQuads=v,r.centroid=(0,Ue.SI)(r.coordinates),r.originCentroid="GAODE2.x"===r.version?(0,Ue.SI)(r.originCoordinates):r.originCentroid=r.centroid,t.glyphInfoMap[l]={shaping:d,glyphQuads:v,centroid:(0,Ue.SI)(r.coordinates)},r}))}},{key:"getFontServiceMapping",value:function(){var e=this.layer.getLayerConfig(),t=e.fontWeight,n=void 0===t?"400":t,r=e.fontFamily,i=void 0===r?"sans-serif":r;return this.fontService.getMappingByKey("".concat(i,"_").concat(n))}},{key:"getFontServiceCanvas",value:function(){var e=this.layer.getLayerConfig(),t=e.fontWeight,n=void 0===t?"400":t,r=e.fontFamily,i=void 0===r?"sans-serif":r;return this.fontService.getCanvasByKey("".concat(i,"_").concat(n))}},{key:"filterGlyphs",value:function(){var e=this,t=this.layer.getLayerConfig(),n=t.padding,r=void 0===n?[0,0]:n,i=t.textAllowOverlap,a=void 0!==i&&i;if(!a){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var o=this.rendererService.getViewportSize(),s=o.width,u=o.height,l=new Ac(s,u),c=this.glyphInfo.filter((function(t){var n=t.shaping,i=t.id,a=void 0===i?0:i,o="GAODE2.x"===t.version?t.originCentroid:t.centroid,s=t.size,u=s/16,c=e.mapService.lngLatToContainer(o),f=l.placeCollisionBox({x1:n.left*u-r[0],x2:n.right*u+r[0],y1:n.top*u-r[1],y2:n.bottom*u+r[1],anchorPointX:c.x,anchorPointY:c.y}),h=f.box;return!(!h||!h.length)&&(l.insertCollisionBox(h,a),!0)}));c.forEach((function(t){e.glyphInfoMap[t.id]=t}))}}},{key:"initGlyph",value:function(){var e=this.layer.getLayerConfig(),t=e.iconfont,n=void 0!==t&&t;n?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(n)}},{key:"updateTexture",value:function(){var e=this.rendererService.createTexture2D,t=this.getFontServiceCanvas();this.textureHeight=t.height,this.texture&&this.texture.destroy(),this.texture=e({data:t,mag:yt.gl.LINEAR,min:yt.gl.LINEAR,width:t.width,height:t.height})}},{key:"reBuildModel",value:function(){var e=bi(zi().mark((function e(){var t;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.filterGlyphs(),e.next=3,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:Gc,fragmentShader:Vc,triangulation:Hc.bind(this),inject:this.getInject(),depth:{enable:!1}});case 3:t=e.sent,this.layer.models=[t];case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),n}(Oa),Yc={fillImage:Ql,fill:Yl,radar:pc,image:nc,normal:uc,simplePoint:_c,extrude:Bl,text:Wc,earthFill:Dl,earthExtrude:Ol},qc=Yc;function Zc(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Kc(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Kc(e,t){if(e){if("string"===typeof e)return Xc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Xc(e,t):void 0}}function Xc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Qc(e){var t=Jc();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function Jc(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var $c=function(e){Oi(n,e);var t=Qc(n);function n(){var e;Si(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Ri(Ti(e),"type","PointLayer"),Ri(Ti(e),"enableShaderEncodeStyles",["opacity","offsets","stroke"]),Ri(Ti(e),"enableDataEncodeStyles",["textOffset","textAnchor"]),Ri(Ti(e),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),e}return Ei(n,[{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel&&this.layerModel.clearModels(),this.layerModel=new qc[t](this),e.next=5,this.initLayerModels();case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"rebuildModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.buildModels();case 2:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var e=this.shapeOption,t=e.field,n=e.values,r=this.getLayerConfig(),i=r.shape2d,a=this.iconService.getIconMap();if(t&&-1!==(null===i||void 0===i?void 0:i.indexOf(t)))return"fill";if("text"===n)return"text";if(n&&n instanceof Array){var o,s=Zc(n);try{for(s.s();!(o=s.n()).done;){var u=o.value;if("string"===typeof u&&a.hasOwnProperty(u))return"image"}}catch(l){s.e(l)}finally{s.f()}}}return"normal"}},{key:"getDefaultConfig",value:function(){var e=this.getModelType(),t={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}};return t[e]}},{key:"getModelType",value:function(){var e=this.getEncodedData(),t=this.getLayerConfig(),n=t.shape2d,r=t.shape3d,i=this.iconService.getIconMap(),a=e.find((function(e){return e.hasOwnProperty("shape")}));if(a){var o=a.shape;return"dot"===o?"normal":"simple"===o?"simplePoint":"radar"===o?"radar":"fillImage"===this.layerType?"fillImage":-1!==(null===n||void 0===n?void 0:n.indexOf(o))?"GLOBEL"===this.mapService.version?"earthFill":"fill":-1!==(null===r||void 0===r?void 0:r.indexOf(o))?"GLOBEL"===this.mapService.version?"earthExtrude":"extrude":i.hasOwnProperty(o)?"image":"text"}return this.getModelTypeWillEmptyData()}}]),n}(Aa);function ef(e){var t=tf();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function tf(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var nf='uniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\n\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\n\nvarying vec4 v_Color;\n\n#pragma include "picking"\n\nvoid main() {\n\n\n     // top face\n    if(u_topsurface < 1.0) {\n      discard;\n    }\n\n    gl_FragColor = v_Color;\n  \n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',rf='precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec3 a_uvs;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\n\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\n\nvarying vec4 v_Color;\nuniform float u_heightfixed: 0.0; // \u9ed8\u8ba4\u4e0d\u56fa\u5b9a\nuniform float u_raisingHeight: 0.0;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n \n  float isSide = a_Position.z;\n float topU = a_uvs[0];\n float topV = 1.0 - a_uvs[1];\n float sidey = a_uvs[2];\n\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  float lightWeight = calc_lighting(pos);\n\n  vec4 project_pos = project_position(pos);\n\n  if(u_heightfixed > 0.0) { // \u5224\u65ad\u51e0\u4f55\u4f53\u662f\u5426\u56fa\u5b9a\u9ad8\u5ea6\n    project_pos.z = a_Position.z * a_Size;\n    project_pos.z += u_raisingHeight;\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      project_pos.z *= mapboxZoomScale;\n      project_pos.z += u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  // Tip: \u90e8\u5206\u673a\u578b GPU \u8ba1\u7b97\u7cbe\u5ea6\u517c\u5bb9\n  if(isSide < 0.999) {\n    // side face\n    // if(u_sidesurface < 1.0) {\n    //   discard;\n    // }\n\n    if(u_linearColor == 1.0) {\n      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\n      linearColor.rgb *= lightWeight;\n      v_Color = linearColor;\n    } else {\n      v_Color = a_Color;\n    }\n\n  } else {\n    v_Color = a_Color;\n  }\n\n  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);\n\n\n  setPickingColor(a_PickingColor);\n}\n',af='uniform sampler2D u_texture;\nuniform float u_opacity: 1.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\n\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\n\nvarying vec4 v_Color;\nvarying vec3 v_uvs;\nvarying vec2 v_texture_data;\n\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = u_opacity;\n  float isSide = v_texture_data.x;\n  float lightWeight = v_texture_data.y;\n  float topU = v_uvs[0];\n  float topV = 1.0 - v_uvs[1];\n  float sidey = v_uvs[2];\n  // Tip: \u90e8\u5206\u673a\u578b GPU \u8ba1\u7b97\u7cbe\u5ea6\u517c\u5bb9\n  if(isSide < 0.999) {// \u662f\u5426\u662f\u8fb9\u7f18\n    // side face\n    if(u_sidesurface < 1.0) {\n      discard;\n    }\n\n    if(u_linearColor == 1.0) {\n      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\n      linearColor.rgb *= lightWeight;\n      gl_FragColor = linearColor;\n    } else {\n      gl_FragColor = v_Color;\n    }\n  } else {\n\n     // top face\n    if(u_topsurface < 1.0) {\n      discard;\n    }\n\n    gl_FragColor = texture2D(u_texture, vec2(topU, topV));\n    // gl_FragColor = vec4(1.0, 0., 0., 1.0);\n  }\n  \n\n  gl_FragColor.a *= opacity;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',of='precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec3 a_uvs;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform sampler2D u_texture;\n\n\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\nvarying vec4 v_Color;\nuniform float u_heightfixed: 0.0; // \u9ed8\u8ba4\u4e0d\u56fa\u5b9a\nuniform float u_raisingHeight: 0.0;\nuniform float u_linearColor: 0.0;\n\nvarying vec2 v_texture_data;\nvarying vec3 v_uvs;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n \n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  float lightWeight = calc_lighting(pos);\n  vec4 project_pos = project_position(pos);\n  v_uvs = a_uvs;\n\n  v_texture_data = vec2(a_Position.z, lightWeight);\n\n  if(u_heightfixed > 0.0) { // \u5224\u65ad\u51e0\u4f55\u4f53\u662f\u5426\u56fa\u5b9a\u9ad8\u5ea6\n    project_pos.z = a_Position.z * a_Size;\n    project_pos.z += u_raisingHeight;\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      project_pos.z *= mapboxZoomScale;\n      project_pos.z += u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n\n\n\n  setPickingColor(a_PickingColor);\n}\n',sf='uniform float u_opacity: 1.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\n\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\n\nvarying vec4 v_Color;\nvarying vec3 v_uvs;\nvarying vec2 v_texture_data;\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = u_opacity;\n  float isSide =  v_texture_data.x;\n  float sidey = v_uvs[2];\n  float lightWeight = v_texture_data.y;\n\n  // Tip: \u90e8\u5206\u673a\u578b GPU \u8ba1\u7b97\u7cbe\u5ea6\u517c\u5bb9\n  if(isSide < 0.999) {\n    // side face\n    if(u_sidesurface < 1.0) {\n      discard;\n    }\n    \n    if( u_linearColor == 1.0) {\n      // side use linear\n      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\n      linearColor.rgb *= lightWeight;\n      gl_FragColor = linearColor;\n    } else {\n      // side notuse linear\n       gl_FragColor = v_Color;\n    }\n  } else {\n    // top face\n    if(u_topsurface < 1.0) {\n      discard;\n    }\n    gl_FragColor = v_Color;\n  }\n\n  gl_FragColor.a *= opacity;\n  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);\n}\n',uf='precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec3 a_uvs;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nuniform float u_heightfixed: 0.0; // \u9ed8\u8ba4\u4e0d\u56fa\u5b9a\nuniform float u_raisingHeight: 0.0;\n\nvarying vec2 v_texture_data;\nvarying vec3 v_uvs;\nvarying vec4 v_Color;\n\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n\n\n  v_uvs = a_uvs;\n  // cal style mapping - \u6570\u636e\u7eb9\u7406\u6620\u5c04\u90e8\u5206\u7684\u8ba1\u7b97\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  vec4 project_pos = project_position(pos);\n\n  if(u_heightfixed > 0.0) { // \u5224\u65ad\u51e0\u4f55\u4f53\u662f\u5426\u56fa\u5b9a\u9ad8\u5ea6\n    project_pos.z = a_Position.z * a_Size;\n    project_pos.z += u_raisingHeight;\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      project_pos.z *= mapboxZoomScale;\n      project_pos.z += u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  float lightWeight = calc_lighting(pos);\n  v_texture_data = vec2(a_Position.z,lightWeight);\n\n  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);\n\n  setPickingColor(a_PickingColor);\n}\n',lf=function(e){Oi(n,e);var t=ef(n);function n(){return Si(this,n),t.apply(this,arguments)}return Ei(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.heightfixed,n=void 0!==t&&t,r=e.raisingHeight,i=void 0===r?0:r,a=e.topsurface,o=void 0===a||a,s=e.sidesurface,u=void 0===s||s,l=e.sourceColor,c=e.targetColor,f=0,h=[1,1,1,1],p=[1,1,1,1];return l&&c&&(h=(0,Ue.CI)(l),p=(0,Ue.CI)(c),f=1),Yi({u_topsurface:Number(o),u_sidesurface:Number(u),u_heightfixed:Number(n),u_raisingHeight:Number(i),u_linearColor:f,u_sourceColor:h,u_targetColor:p,u_texture:this.texture},this.getStyleAttribute())}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.loadTexture();case 2:return e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t,n,r,i,a;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.getShaders(),n=t.frag,r=t.vert,i=t.type,e.next=3,this.layer.buildLayerModel({moduleName:i,vertexShader:r,fragmentShader:n,inject:this.getInject(),triangulation:jo});case 3:return a=e.sent,e.abrupt("return",[a]);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.pickLight,n=e.mapTexture;return n?{frag:af,vert:of,type:"polygonExtrudeTexture"}:t?{frag:sf,vert:uf,type:"polygonExtrudePickLight"}:{frag:nf,vert:rf,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getSource().extent,t=e,n=this.layer.coordCenter||this.layer.getSource().center,r=t[2]-t[0],i=t[3]-t[1];if("GAODE2.x"===this.mapService.version){var a=this.mapService.coordToAMap2RelativeCoordinates([e[0],e[1]],n),o=sa(a,2),s=o[0],u=o[1],l=this.mapService.coordToAMap2RelativeCoordinates([e[2],e[3]],n),c=sa(l,2),f=c[0],h=c[1];r=f-s,i=h-u,t=[s,u,f,h]}this.styleAttributeService.registerStyleAttribute({name:"uvs",type:yt.GC.Attribute,descriptor:{name:"a_uvs",buffer:{usage:yt.gl.STATIC_DRAW,data:[],type:yt.gl.FLOAT},size:3,update:function(e,n,a){var o=a[0],s=a[1];return[(o-t[0])/r,(s-t[1])/i,a[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:yt.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:yt.gl.STATIC_DRAW,data:[],type:yt.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:yt.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?10:t;return Array.isArray(n)?[n[0]]:[n]}}})}},{key:"loadTexture",value:function(){var e=bi(zi().mark((function e(){var t,n,r,i=this;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.layer.getLayerConfig(),n=t.mapTexture,r=this.rendererService.createTexture2D,this.texture=r({height:0,width:0}),!n){e.next=5;break}return e.abrupt("return",new Promise((function(e,t){var a=new Image;a.crossOrigin="anonymous",a.src=n,a.onload=function(){return i.texture=r({data:a,width:a.width,height:a.height,wrapS:yt.gl.CLAMP_TO_EDGE,wrapT:yt.gl.CLAMP_TO_EDGE,min:yt.gl.LINEAR,mag:yt.gl.LINEAR}),e(null)},a.onerror=function(){t(new Error("image load error"))}})));case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),n}(Oa);function cf(e){var t=ff();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function ff(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var hf='varying vec4 v_color;\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',pf='#pragma include "picking"\nuniform float u_opacitylinear: 0.0;\nuniform float u_dir: 1.0;\nvarying vec3 v_linear;\nvarying vec2 v_pos;\nvarying vec4 v_Color;\n\n\nvoid main() {\n   gl_FragColor = v_Color;\n  if(u_opacitylinear > 0.0) {\n    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;\n  }\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',df='attribute vec4 a_Color;\nattribute vec3 a_Position;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_raisingHeight: 0.0;\n\nvarying vec4 v_Color;\n\n\n#pragma include "projection"\n#pragma include "picking"\n\nuniform float u_opacitylinear: 0.0;\n\nattribute vec3 a_linear;\nvarying vec3 v_linear;\nvarying vec2 v_pos;\n\nvoid main() {\n  if(u_opacitylinear > 0.0) {\n    v_linear = a_linear;\n    v_pos = a_Position.xy;\n  }\n  v_Color = vec4(a_Color.xyz, a_Color.w * opacity);\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  project_pos.z += u_raisingHeight;\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n    project_pos.z *= mapboxZoomScale;\n    project_pos.z += u_raisingHeight * mapboxZoomScale;\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}',vf='attribute vec4 a_Color;\nattribute vec3 a_Position;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nuniform float u_raisingHeight: 0.0;\n\nvarying vec4 v_color;\n\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  // cal style mapping - \u6570\u636e\u7eb9\u7406\u6620\u5c04\u90e8\u5206\u7684\u8ba1\u7b97\n\n  // cal style mapping - \u6570\u636e\u7eb9\u7406\u6620\u5c04\u90e8\u5206\u7684\u8ba1\u7b97\n\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  project_pos.z += u_raisingHeight;\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n    project_pos.z *= mapboxZoomScale;\n    project_pos.z += u_raisingHeight * mapboxZoomScale;\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n\n',gf=function(e){Oi(n,e);var t=cf(n);function n(){return Si(this,n),t.apply(this,arguments)}return Ei(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.raisingHeight,n=void 0===t?0:t,r=e.opacityLinear,i=void 0===r?{enable:!1,dir:"in"}:r;return Yi({u_raisingHeight:Number(n),u_opacitylinear:Number(i.enable),u_dir:"in"===i.dir?1:0},this.getStyleAttribute())}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t,n,r,i,a,o,s,u,l,c;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.getModelParams(),n=t.frag,r=t.vert,i=t.triangulation,a=t.type,o=this.layer.getLayerConfig(),s=o.workerEnabled,u=void 0!==s&&s,l=o.enablePicking,this.layer.triangulation=i,e.next=5,this.layer.buildLayerModel({moduleName:a,vertexShader:r,fragmentShader:n,inject:this.getInject(),triangulation:i,primitive:yt.gl.TRIANGLES,depth:{enable:!1},workerEnabled:u,workerOptions:{modelType:a,enablePicking:l}});case 5:return c=e.sent,e.abrupt("return",[c]);case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getLayerConfig(),t=e.opacityLinear,n=void 0===t?{enable:!1,dir:"in"}:t;n.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:yt.GC.Attribute,descriptor:{name:"a_linear",buffer:{usage:yt.gl.STATIC_DRAW,data:[],type:yt.gl.FLOAT},size:3,update:function(e,t,n){return[n[3],n[4],n[5]]}}})}},{key:"getModelParams",value:function(){var e=this.layer.getLayerConfig(),t=e.opacityLinear,n=void 0===t?{enable:!1}:t;return n.enable?{frag:pf,vert:df,type:"polygonLinear",triangulation:No}:{frag:hf,vert:vf,type:"polygonFill",triangulation:Ue.yR}}}]),n}(Oa);function mf(e){var t=yf();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function yf(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var _f="\nuniform float u_time: 0.0;\nuniform float u_opacity: 1.0;\n\nvarying vec2 v_uv;\n\nfloat coast2water_fadedepth = 0.10;\nfloat large_waveheight      = .750; // change to adjust the \"heavy\" waves\nfloat large_wavesize        = 3.4;  // factor to adjust the large wave size\nfloat small_waveheight      = 0.6;  // change to adjust the small random waves\nfloat small_wavesize        = 0.5;   // factor to ajust the small wave size\nfloat water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)\nfloat water_glossylight_fact= 120.; // range [1..200]\nfloat particle_amount       = 70.;\n// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)\n// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)\nuniform vec4 u_watercolor;\nuniform vec4 u_watercolor2;\nvec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights\n#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun\n\nuniform sampler2D u_texture1;\nuniform sampler2D u_texture2;\nuniform sampler2D u_texture3;\n\n  \n\nfloat hash( float n ) {\n    return fract(sin(n)*43758.5453123);\n}\n\n// 2d noise function\nfloat noise1( in vec2 x ) {\n  vec2 p  = floor(x);\n  vec2 f  = smoothstep(0.0, 1.0, fract(x));\n  float n = p.x + p.y*57.0;\n  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),\n    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);\n}\n\nfloat noise(vec2 p) {\n    return texture2D(u_texture2,p*vec2(1./256.)).x;\n}\n\nvec4 highness(vec2 p) {\n    vec4 t = texture2D(u_texture1,fract(p));\n    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;\n    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);\n}\n\nfloat height_map( vec2 p ) {\n    vec4 height=highness(p);\n    /*\n    height = -0.5+\n        0.5*smoothstep(-100.,0.,-height)+\n        2.75*smoothstep(0.,2.,height)+\n        1.75*smoothstep(2.,4.,height)+\n        2.75*smoothstep(4.,16.,height)+\n        1.5*smoothstep(16.,1000.,height);\n    */\n\n    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );\n    //p = p*6.;\n    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;\n    f += 0.2500*noise( p ); p = m*p*1.32;\n    f += 0.1666*noise( p ); p = m*p*1.11;\n    f += 0.0834*noise( p ); p = m*p*1.12;\n    f += 0.0634*noise( p ); p = m*p*1.13;\n    f += 0.0444*noise( p ); p = m*p*1.14;\n    f += 0.0274*noise( p ); p = m*p*1.15;\n    f += 0.0134*noise( p ); p = m*p*1.16;\n    f += 0.0104*noise( p ); p = m*p*1.17;\n    f += 0.0084*noise( p );\n    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;\n        const float FLAT_LEVEL = 0.92525;\n        //f = f*0.25+height*0.75;\n    if (f<FLAT_LEVEL)\n        f = f;\n    else\n        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase\n    return clamp(f, 0., 10.);\n}\n\nvec3 plasma_quintic( float x ) {\n    x = clamp( x, 0.0, 1.0);\n    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3\n    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7\n    return vec3(\n        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),\n        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),\n        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );\n}\n\nvec4 color(vec2 p){\n    vec4 c1 = vec4(1.7,1.6,.9,1);\n    vec4 c2 = vec4(.2,.94,.1,1);\n    vec4 c3 = vec4(.3,.2,.0,1);\n    vec4 c4 = vec4(.99,.99,1.6,1);\n    vec4 v = highness(p);\n    float los = smoothstep(0.1,1.1,v.b);\n    float his = smoothstep(3.5,6.5,v.b);\n    float ces = smoothstep(1.,5.,v.a);\n    vec4 lo = mix(c1,c2,los);\n    vec4 hi = mix(c3,c4,his);\n    vec4 ce = mix(lo,hi,ces);\n\n    return vec4(plasma_quintic(ces),1).ragb;\n}\n\nvec3 terrain_map( vec2 p )\n{\n  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'\n}\n\nconst mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );\n\nfloat water_map( vec2 p, float height ) {\n    vec2 p2 = p*large_wavesize;\n    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );\n    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );\n\n    // coarse crossing 'ocean' waves...\n    float f = 0.6000*noise( p );\n    f += 0.2500*noise( p*m );\n    f += 0.1666*noise( p*m*m );\n    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;\n\n    p *= small_wavesize;\n    f = 0.;\n    float amp = 1.0, s = .5;\n    for (int i=0; i<9; i++)\n    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }\n    \n    return wave+f*small_waveheight;\n}\n\nfloat nautic(vec2 p) {\n    p *= 18.;\n    float f = 0.;\n    float amp = 1.0, s = .5;\n    for (int i=0; i<3; i++)\n    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }\n    return pow(1.-f, 5.);\n}\n\nfloat particles(vec2 p) {\n    p *= 200.;\n    float f = 0.;\n    float amp = 1.0, s = 1.5;\n    for (int i=0; i<3; i++)\n    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }\n    return pow(f*.35, 7.)*particle_amount;\n}\n\nfloat test_shadow( vec2 xy, float height) {\n    vec3 r0 = vec3(xy, height);\n    vec3 rd = normalize( light - r0 );\n    \n    float hit = 1.0;\n    float t   = 0.001;\n    for (int j=1; j<25; j++)\n    {\n        vec3 p = r0 + t*rd;\n        float h = height_map( p.xy );\n        float height_diff = p.z - h;\n        if (height_diff<0.0)\n        {\n            return 0.0;\n        }\n        t += 0.01+height_diff*.02;\n        hit = min(hit, 2.*height_diff/t); // soft shaddow   \n    }\n    return hit;\n}\n\nvec3 CalcTerrain(vec2 uv, float height) {\n    vec3 col = terrain_map( uv );\n    vec2 iResolution = vec2(512.);\n    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);\n    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);\n    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);\n    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);\n    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));\n    vec3 r0 = vec3(uv, height);\n    vec3 rd = normalize( light - r0 );\n    float grad = dot(norm, rd);\n    col *= grad+pow(grad, 8.);\n    float terrainshade = test_shadow( uv, height );\n    col = mix(col*.25, col, terrainshade);\n    return col;\n}\n\n\nvoid main() {\n  vec3 watercolor = u_watercolor.rgb;\n  vec3 watercolor2 = u_watercolor2.rgb;\n  vec2 uv = v_uv;\n  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)\n  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;\n  float height = height_map( uv );\n  vec3 col;\n\n    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);\n    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);\n    if (height > level)\n    {\n        col = CalcTerrain(uv, height);\n    }\n    if (height <= level)\n    {\n        vec2 dif = vec2(.0, .01);\n        vec2 pos = uv*15. + vec2(u_time*.01);\n        float h1 = water_map(pos-dif,waveheight);\n        float h2 = water_map(pos+dif,waveheight);\n        float h3 = water_map(pos-dif.yx,waveheight);\n        float h4 = water_map(pos+dif.yx,waveheight);\n        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane\n        uv += normwater.xy*.002*(level-height);\n        \n        col = CalcTerrain(uv, height);\n\n        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);\n        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);\n        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;\n        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));\n\n        vec3 r0 = vec3(uv, WATER_LEVEL);\n        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position\n        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction\n        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          \n        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights\n        float gradpos  = dot(vec3(0., 0., 1.), rd);\n        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          \n        float watershade  = test_shadow( uv, level );\n        watercolor *= 2.2+watershade;\n        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;\n        watercolor /= (1.+specular1*1.25);\n        watercolor += watershade*specular2*water_specularcolor;\n        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));\n        \n        col = mix(col, watercolor, coastfade);\n    }\n    \n\n  float opacity = u_opacity;\n  gl_FragColor = vec4(col, opacity);  \n}\n",xf='attribute vec2 a_uv;\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nvarying vec2 v_uv;\n\n#pragma include "projection"\n\nvoid main() {\n  v_uv = a_uv;\n\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n}\n\n',bf=function(e){Oi(n,e);var t=mf(n);function n(){return Si(this,n),t.apply(this,arguments)}return Ei(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.watercolor,i=void 0===r?"#6D99A8":r,a=e.watercolor2,o=void 0===a?"#0F121C":a;return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:(0,Ue.CI)(i),u_watercolor2:(0,Ue.CI)(o),u_opacity:(0,Zt.isNumber)(n)?n:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.loadTexture(),e.abrupt("return",this.buildModels());case 2:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:xf,fragmentShader:_f,triangulation:zo,primitive:yt.gl.TRIANGLES,depth:{enable:!1}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var e,t,n;null===(e=this.texture1)||void 0===e||e.destroy(),null===(t=this.texture2)||void 0===t||t.destroy(),null===(n=this.texture3)||void 0===n||n.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getSource().extent,t=sa(e,4),n=t[0],r=t[1],i=t[2],a=t[3],o=i-n,s=a-r;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:yt.GC.Attribute,descriptor:{name:"a_uv",buffer:{usage:yt.gl.STATIC_DRAW,data:[],type:yt.gl.FLOAT},size:2,update:function(e,t,i,a){var u=e.version===Xi.G["GAODE2.x"]?e.originCoordinates[0][a]:i,l=sa(u,2),c=l[0],f=l[1];return[(c-n)/o,(f-r)/s]}}})}},{key:"loadTexture",value:function(){var e=this,t=this.rendererService.createTexture2D,n={height:0,width:0};function r(e){var t=0,n=[],r=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];r.map((function(r){var i=new Image;i.crossOrigin="",i.src=r,n.push(i),i.onload=function(){t++,3===t&&e(n)}}))}function i(e){return t({data:e,width:e.width,height:e.height,wrapS:yt.gl.MIRRORED_REPEAT,wrapT:yt.gl.MIRRORED_REPEAT,min:yt.gl.LINEAR,mag:yt.gl.LINEAR})}this.texture1=t(n),this.texture2=t(n),this.texture3=t(n),r((function(t){e.texture1=i(t[0]),e.texture2=i(t[1]),e.texture3=i(t[2]),e.layerService.reRender()}))}}]),n}(Oa);function Sf(e){var t=wf();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function wf(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Cf="uniform sampler2D u_texture;\nuniform float u_time: 0.0;\nuniform float u_speed: 1.0;\nuniform float u_opacity: 1.0;\n\nvarying vec4 v_Color;\nvarying vec2 v_uv;\n\nfloat rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }\n\nfloat water(vec3 p) {\n  float t = u_time * u_speed;\n  p.z += t * 2.; p.x += t * 2.;\n  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;\n  p.z += t * 3.; p.x += t * 0.52;\n  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;\n  p.z += t * 4.; p.x += t * 0.8;\n  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;\n  c1 += c2 - c3;\n  float z = (c1.x + c1.y + c1.z) / 3.;\n  return p.y + z / 4.;\n}\n\nfloat map(vec3 p) {\n  float d = 100.0;\n  d = water(p);\n  return d;\n}\n\nfloat intersect(vec3 ro, vec3 rd) {\n  float d = 0.0;\n  for (int i = 0; i <= 100; i++) {\n    float h = map(ro + rd * d);\n    if (h < 0.1) return  d;\n    d += h;\n  }\n  return 0.0;\n}\n\nvec3 norm(vec3 p) {\n  float eps = .1;\n  return normalize(vec3(\n    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),\n    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),\n    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))\n  ));\n} \n\nfloat calSpc() {\n  vec3 l1 = normalize(vec3(1, 1, 1));\n  vec3 ro = vec3(-3, 20, -8);\n  vec3 rc = vec3(0, 0, 0);\n  vec3 ww = normalize(rc - ro);\n  vec3 uu = normalize(cross(vec3(0,1,0), ww));\n  vec3 vv = normalize(cross(rc - ro, uu));\n  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);\n  float d = intersect(ro, rd);\n  vec3 p = ro + rd * d;\n  vec3 n = norm(p);\n  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);\n  return spc;\n}\n\nvoid main() {\n  float opacity = u_opacity;\n  gl_FragColor = v_Color;\n  gl_FragColor.a *= opacity;\n\n  float spc = calSpc();\n  gl_FragColor += spc * 0.4;\n}\n",kf='attribute vec4 a_Color;\nattribute vec2 a_uv;\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nvarying vec4 v_Color;\nvarying vec2 v_uv;\nuniform float u_opacity: 1.0;\n\n\n#pragma include "projection"\n\nvoid main() {\n  v_uv = a_uv;\n\n  v_Color = a_Color;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n}\n\n',Af=function(e){Oi(n,e);var t=Sf(n);function n(){return Si(this,n),t.apply(this,arguments)}return Ei(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.speed,i=void 0===r?.5:r;return{u_texture:this.texture,u_speed:i,u_opacity:(0,Zt.isNumber)(n)?n:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.loadTexture(),e.abrupt("return",this.buildModels());case 2:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:kf,fragmentShader:Cf,triangulation:zo,primitive:yt.gl.TRIANGLES,depth:{enable:!1}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getSource().extent,t=sa(e,4),n=t[0],r=t[1],i=t[2],a=t[3],o=i-n,s=a-r;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:yt.GC.Attribute,descriptor:{name:"a_uv",buffer:{usage:yt.gl.STATIC_DRAW,data:[],type:yt.gl.FLOAT},size:2,update:function(e,t,i,a){var u=e.version===Xi.G["GAODE2.x"]?e.originCoordinates[0][a]:i,l=sa(u,2),c=l[0],f=l[1];return[(c-n)/o,(f-r)/s]}}})}},{key:"loadTexture",value:function(){var e=this,t=this.layer.getLayerConfig(),n=t.waterTexture,r=this.rendererService.createTexture2D;this.texture=r({height:0,width:0});var i=new Image;i.crossOrigin="",n?(console.warn("L7 recommend\uff1ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),i.src=n):i.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",i.onload=function(){e.texture=r({data:i,width:i.width,height:i.height,wrapS:yt.gl.MIRRORED_REPEAT,wrapT:yt.gl.MIRRORED_REPEAT,min:yt.gl.LINEAR,mag:yt.gl.LINEAR}),e.layerService.reRender()}}}]),n}(Oa),Ef={fill:gf,line:il,extrude:lf,text:Wc,point_fill:Yl,point_image:nc,point_normal:uc,point_extrude:Bl,water:Af,ocean:bf},Tf=Ef;function Mf(e){var t=Of();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function Of(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Lf=function(e){Oi(n,e);var t=Mf(n);function n(){var e;Si(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Ri(Ti(e),"type","PolygonLayer"),Ri(Ti(e),"enableShaderEncodeStyles",["opacity"]),e}return Ei(n,[{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new Tf[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=null===t||void 0===t||null===(e=t.scale)||void 0===e?void 0:e.field;return"fill"!==n&&n?"extrude"===n?"extrude":"water"===n?"water":"ocean"===n?"ocean":"line"===n?"line":this.getPointModelType():"fill"}},{key:"getPointModelType",value:function(){var e=this.getEncodedData(),t=this.getLayerConfig(),n=t.shape2d,r=t.shape3d,i=this.iconService.getIconMap(),a=e.find((function(e){return e.hasOwnProperty("shape")}));if(a){var o=a.shape;return"dot"===o?"point_normal":-1!==(null===n||void 0===n?void 0:n.indexOf(o))?"point_fill":-1!==(null===r||void 0===r?void 0:r.indexOf(o))?"point_extrude":i.hasOwnProperty(o)?"point_image":"text"}return"fill"}}]),n}(Aa);function Pf(e){var t=Rf();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function Rf(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var If="precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nuniform float u_min;\nuniform float u_max;\nuniform vec2 u_domain;\nuniform float u_noDataValue;\nuniform bool u_clampLow: true;\nuniform bool u_clampHigh: true;\nvarying vec2 v_texCoord;\nbool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }\n\n\nvoid main() {\n\n  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;\n  if (value == u_noDataValue || isnan_emu(value))\n      discard;\n  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))\n     discard;\n  else {\n    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);\n    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));\n    \n    gl_FragColor = color;\n    gl_FragColor.a =  gl_FragColor.a * u_opacity ;\n    if(gl_FragColor.a < 0.01)\n      discard;\n   \n  }\n}\n",Df='precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',zf=function(e){Oi(n,e);var t=Pf(n);function n(){return Si(this,n),t.apply(this,arguments)}return Ei(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.clampLow,i=void 0===r||r,a=e.clampHigh,o=void 0===a||a,s=e.noDataValue,u=void 0===s?-9999999:s,l=e.domain,c=e.rampColors,f=l||(0,Ue.ZB)(c);return this.colorTexture=this.layer.textureService.getColorTexture(c,f),{u_opacity:n||1,u_texture:this.texture,u_domain:f,u_clampLow:i,u_clampHigh:"undefined"!==typeof o?o:i,u_noDataValue:u,u_colorTexture:this.colorTexture}}},{key:"getRasterData",value:function(){var e=bi(zi().mark((function e(t){var n,r,i,a;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!Array.isArray(t.data)){e.next=4;break}return e.abrupt("return",{data:t.data,width:t.width,height:t.height});case 4:return e.next=6,t.data;case 6:return n=e.sent,r=n.rasterData,i=n.width,a=n.height,e.abrupt("return",{data:Array.from(r),width:i,height:a});case 11:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){var t,n,r,i,a,o,s,u;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.layer.getSource(),n=this.rendererService.createTexture2D,r=t.data.dataArray[0],e.next=5,this.getRasterData(r);case 5:return i=e.sent,a=i.data,o=i.width,s=i.height,this.texture=n({data:a,width:o,height:s,format:yt.gl.LUMINANCE,type:yt.gl.FLOAT}),e.next=12,this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:Df,fragmentShader:If,triangulation:Uo,primitive:yt.gl.TRIANGLES,depth:{enable:!1}});case 12:return u=e.sent,e.abrupt("return",[u]);case 14:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var e,t;null===(e=this.texture)||void 0===e||e.destroy(),null===(t=this.colorTexture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:yt.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),n}(Oa),Nf=["data"],Ff=["rasterData"];function jf(e){var t=Bf();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function Bf(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Uf='precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',Vf="precision mediump float;\nuniform vec2 u_rminmax: vec2(0,255); \nuniform vec2 u_gminmax: vec2(0,255);\nuniform vec2 u_bminmax: vec2(0,255);\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nuniform float u_noDataValue : 0.0;\nvarying vec2 v_texCoord;\n\nvoid main() {\n  vec3 rgb = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).rgb;\n  if(rgb == vec3(u_noDataValue)) {\n    gl_FragColor = vec4(0.0, 0, 0, 0.0);\n  } else {\n    gl_FragColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);\n  }\n  if(gl_FragColor.a < 0.01)\n    discard;\n \n}",Gf=function(e){Oi(n,e);var t=jf(n);function n(){var e;Si(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Ri(Ti(e),"dataOption",{}),e}return Ei(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.noDataValue,i=void 0===r?0:r,a=this.dataOption,o=a.rMinMax,s=a.gMinMax,u=a.bMinMax;return{u_opacity:n||1,u_texture:this.texture,u_noDataValue:i,u_rminmax:o,u_gminmax:s,u_bminmax:u}}},{key:"getRasterData",value:function(){var e=bi(zi().mark((function e(t){var n,r,i,a,o;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!Array.isArray(t.data)){e.next=4;break}return n=t.data,r=Hi(t,Nf),this.dataOption=r,e.abrupt("return",Yi({data:n},r));case 4:return e.next=6,t.data;case 6:if(i=e.sent,a=i.rasterData,o=Hi(i,Ff),this.dataOption=o,!Array.isArray(a)){e.next=14;break}return e.abrupt("return",Yi({data:a},o));case 14:return e.abrupt("return",Yi({data:Array.from(a)},o));case 15:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){var t,n,r,i,a,o,s,u;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.layer.getSource(),n=this.rendererService.createTexture2D,r=t.data.dataArray[0],e.next=5,this.getRasterData(r);case 5:return i=e.sent,a=i.data,o=i.width,s=i.height,this.texture=n({data:a,width:o,height:s,format:yt.gl.RGB,type:yt.gl.FLOAT}),e.next=12,this.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:Uf,fragmentShader:Vf,triangulation:Uo,primitive:yt.gl.TRIANGLES,depth:{enable:!1}});case 12:return u=e.sent,e.abrupt("return",[u]);case 14:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:yt.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),n}(Oa);function Hf(e){var t=Wf();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function Wf(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Yf="precision mediump float;\nuniform float u_opacity: 1.0;\n\nuniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\n\nvarying vec2 v_texCoord;\n\nuniform vec2 u_domain;\nuniform float u_noDataValue;\nuniform bool u_clampLow: true;\nuniform bool u_clampHigh: true;\nuniform vec4 u_unpack;\n\nfloat getElevation(vec2 coord, float bias) {\n    // Convert encoded elevation value to meters\n    vec4 data = texture2D(u_texture, coord,bias) * 255.0;\n    data.a = -1.0;\n    return dot(data, u_unpack);\n}\n\nvec4 getColor(float value) {\n   float normalisedValue =(value- u_domain[0]) / (u_domain[1] - u_domain[0]);\n    vec2 coord = vec2(normalisedValue, 0);\n    return texture2D(u_colorTexture, coord);\n}\n\nvoid main() {\n  float value = getElevation(v_texCoord,0.0);\n  if (value == u_noDataValue) {\n    gl_FragColor = vec4(0.0, 0, 0, 0.0);\n  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {\n     gl_FragColor = vec4(0.0, 0, 0, 0.0);\n  } else {\n   \n    gl_FragColor = getColor(value);\n    gl_FragColor.a =  gl_FragColor.a * u_opacity ;\n      if(gl_FragColor.a < 0.01)\n      discard;\n  }\n}\n",qf='precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',Zf=function(e){Oi(n,e);var t=Hf(n);function n(){return Si(this,n),t.apply(this,arguments)}return Ei(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=e.clampLow,r=void 0===n||n,i=e.clampHigh,a=void 0===i||i,o=e.noDataValue,s=void 0===o?-9999999:o,u=e.domain,l=e.rampColors,c=e.colorTexture,f=e.rScaler,h=void 0===f?6553.6:f,p=e.gScaler,d=void 0===p?25.6:p,v=e.bScaler,g=void 0===v?.1:v,m=e.offset,y=void 0===m?1e4:m,_=u||(0,Ue.ZB)(l),x=c;return c?this.layer.textureService.setColorTexture(c,l,_):x=this.layer.textureService.getColorTexture(l,_),{u_opacity:t||1,u_texture:this.texture,u_domain:_,u_clampLow:r,u_clampHigh:"undefined"!==typeof a?a:r,u_noDataValue:s,u_unpack:[h,d,g,y],u_colorTexture:x}}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){var t,n,r,i;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.layer.getSource(),n=this.rendererService.createTexture2D,e.next=4,t.data.images;case 4:return r=e.sent,this.texture=n({data:r[0],width:r[0].width,height:r[0].height,min:yt.gl.LINEAR,mag:yt.gl.LINEAR}),e.next=8,this.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:qf,fragmentShader:Yf,triangulation:Uo,primitive:yt.gl.TRIANGLES,depth:{enable:!1}});case 8:return i=e.sent,e.abrupt("return",[i]);case 10:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:yt.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),n}(Oa),Kf={raster:zf,rasterRgb:Gf,raster3d:zf,rasterTerrainRgb:Zf},Xf=Kf;function Qf(e){var t=Jf();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function Jf(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var $f=function(e){Oi(n,e);var t=Qf(n);function n(){var e;Si(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Ri(Ti(e),"type","RasterLayer"),e}return Ei(n,[{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new Xf[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getDefaultConfig",value:function(){var e=this.getModelType(),t={raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}};return t[e]}},{key:"getModelType",value:function(){var e=this.layerSource.getParserType();switch(e){case"raster":return"raster";case"rasterRgb":return"rasterRgb";case"image":return"rasterTerrainRgb";default:return"raster"}}}]),n}(Aa);function eh(e){var t=th();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function th(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var nh=function(e){Oi(n,e);var t=eh(n);function n(){var e;Si(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Ri(Ti(e),"type","TileDebugLayer"),Ri(Ti(e),"zIndex",1e4),Ri(Ti(e),"defaultSourceConfig",{data:[],options:{parser:{type:"testTile"}}}),e}return Ei(n,[{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()}]),n}(Aa);function rh(e){var t=ih();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function ih(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var ah="\nuniform float u_opacity;\nuniform vec3 u_CameraPosition;\n\nvarying vec3 vVertexNormal;\nvarying float v_offset;\nvarying vec4 v_Color;\nvoid main() {\n    \n    \n    // float intensity = pow(0.5 + dot(normalize(vVertexNormal), normalize(u_CameraPosition)), 3.0);\n    float intensity = pow(v_offset + dot(normalize(vVertexNormal), normalize(u_CameraPosition)), 3.0);\n    // \u53bb\u9664\u80cc\u9762\n    if(intensity > 1.0) intensity = 0.0;\n\n    gl_FragColor = vec4(v_Color.rgb, v_Color.a * intensity * u_opacity);\n}\n",oh="\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute vec2 a_Uv;\nattribute vec4 a_Color;\nuniform vec3 u_CameraPosition;\nvarying float v_CamreaDistance;\n\nuniform mat4 u_ViewProjectionMatrix;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_ViewMatrix;\n\nvarying vec3 vVertexNormal;\nvarying vec4 v_Color;\nvarying float v_offset;\n\nvoid main() {\n    float EARTH_RADIUS = 100.0;\n    \n    v_Color = a_Color;\n\n    v_offset = min(((length(u_CameraPosition) - EARTH_RADIUS)/600.0) * 0.5 + 0.4, 1.0);\n    vVertexNormal = a_Normal;\n\n    gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}\n",sh=function(e){Oi(n,e);var t=rh(n);function n(){return Si(this,n),t.apply(this,arguments)}return Ei(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t;return{u_opacity:(0,Zt.isNumber)(n)?n:1}}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.layer.zIndex=-997,e.next=3,this.layer.buildLayerModel({moduleName:"earthAtmoSphere",vertexShader:oh,fragmentShader:ah,triangulation:qo,depth:{enable:!1},blend:this.getBlend()});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:yt.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:yt.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:yt.gl.STATIC_DRAW,data:[],type:yt.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:yt.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),n}(Oa);function uh(e){var t=lh();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function lh(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var ch="\nuniform sampler2D u_texture;\n\nvarying vec2 v_texCoord;\nvarying float v_lightWeight;\n\n\nvoid main() {\n\n    vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\n    color.xyz = color.xyz * v_lightWeight;\n    gl_FragColor = color;\n}\n",fh="// attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n\n// attribute vec2 a_Extrude;\n// attribute float a_Size;\n// attribute float a_Shape;\n\nuniform vec3 u_CameraPosition;\nuniform mat4 u_ViewProjectionMatrix;\nuniform mat4 u_ModelMatrix;\nuniform float u_ambientRatio : 0.5;\nuniform float u_diffuseRatio : 0.3;\nuniform float u_specularRatio : 0.2;\nuniform vec3 u_sunLight: [1.0, -10.5, 12.0];\n\n\n\nfloat calc_lighting(vec4 pos) {\n\n    vec3 worldPos = vec3(pos * u_ModelMatrix);\n\n    vec3 worldNormal = a_Normal;\n\n    // cal light weight\n    vec3 viewDir = normalize(u_CameraPosition - worldPos);\n\n    vec3 lightDir = normalize(u_sunLight);\n\n    vec3 halfDir = normalize(viewDir+lightDir);\n    // lambert\n    float lambert = dot(worldNormal, lightDir);\n    // specular\n    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);\n    //sum to light weight\n    float lightWeight = u_ambientRatio + u_diffuseRatio * lambert + u_specularRatio * specular;\n\n    return lightWeight;\n}\n\nvarying float v_lightWeight;\nvoid main() {\n\n    v_texCoord = a_Uv;\n\n    float lightWeight = calc_lighting(vec4(a_Position, 1.0));\n    v_lightWeight = lightWeight;\n\n    gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}\n",hh=function(e){Oi(n,e);var t=uh(n);function n(){var e;Si(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Ri(Ti(e),"earthTime",3.4),Ri(Ti(e),"sunX",1e3),Ri(Ti(e),"sunY",1e3),Ri(Ti(e),"sunZ",1e3),Ri(Ti(e),"sunRadius",Math.sqrt(e.sunX*e.sunX+e.sunY*e.sunY+e.sunZ*e.sunZ)),e}return Ei(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.animateOption,n=e.globalOptions;return null!==t&&void 0!==t&&t.enable&&(this.mapService.rotateY({reg:.002}),this.earthTime+=.02,this.sunY=10,this.sunX=Math.cos(this.earthTime)*(this.sunRadius-this.sunY),this.sunZ=Math.sin(this.earthTime)*(this.sunRadius-this.sunY)),{u_ambientRatio:(null===n||void 0===n?void 0:n.ambientRatio)||.6,u_diffuseRatio:(null===n||void 0===n?void 0:n.diffuseRatio)||.4,u_specularRatio:(null===n||void 0===n?void 0:n.specularRatio)||.1,u_sunLight:[this.sunX,this.sunY,this.sunZ],u_texture:this.texture}}},{key:"setEarthTime",value:function(e){this.earthTime=e,this.sunY=10,this.sunX=Math.cos(this.earthTime)*(this.sunRadius-this.sunY),this.sunZ=Math.sin(this.earthTime)*(this.sunRadius-this.sunY),this.layerService.throttleRenderLayers()}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){var t,n,r,i,a=this;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.globalOptions,void 0!==(null===n||void 0===n?void 0:n.earthTime)&&this.setEarthTime(n.earthTime),r=this.layer.getSource(),i=this.rendererService.createTexture2D,this.texture=i({height:0,width:0}),r.data.images.then((function(e){a.texture=i({data:e[0],width:e[0].width,height:e[0].height}),a.layerService.reRender()})),e.abrupt("return",this.buildModels());case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.layer.zIndex=-998,e.next=3,this.layer.buildLayerModel({moduleName:"earthBase",vertexShader:fh,fragmentShader:ch,triangulation:qo,depth:{enable:!0},blend:this.getBlend()});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:yt.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:yt.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:yt.gl.STATIC_DRAW,data:[],type:yt.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:yt.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),n}(Oa);function ph(e){var t=dh();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function dh(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var vh="\nuniform float u_opacity;\nuniform vec3 u_CameraPosition;\nvarying vec3 vVertexNormal;\n\nvarying vec4 v_Color;\nvoid main() {\n\n\n    float intensity =  - dot(normalize(vVertexNormal), normalize(u_CameraPosition));\n    // \u53bb\u9664\u80cc\u9762\n    if(intensity > 1.0) intensity = 0.0;\n\n    gl_FragColor = vec4(v_Color.rgb, v_Color.a * intensity * u_opacity);\n}\n",gh="\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute vec2 a_Uv;\nattribute vec4 a_Color;\nuniform vec3 u_CameraPosition;\nuniform mat4 u_ViewProjectionMatrix;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_ViewMatrix;\n\nvarying vec3 vVertexNormal;\nvarying vec4 v_Color;\n\nvoid main() {\n    v_Color = a_Color;\n\n    vVertexNormal = a_Normal;\n\n    gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}\n",mh=function(e){Oi(n,e);var t=ph(n);function n(){return Si(this,n),t.apply(this,arguments)}return Ei(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t;return{u_opacity:(0,Zt.isNumber)(n)?n:1}}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.layer.zIndex=-999,e.next=3,this.layer.buildLayerModel({moduleName:"earthBloom",vertexShader:gh,fragmentShader:vh,triangulation:Zo,depth:{enable:!1},blend:this.getBlend()});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:yt.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:yt.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:yt.gl.STATIC_DRAW,data:[],type:yt.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:yt.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),n}(Oa);function yh(e){var t=_h();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function _h(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var xh={base:hh,atomSphere:sh,bloomSphere:mh},bh=["base","atomSphere","bloomSphere"],Sh=function(e){Oi(n,e);var t=yh(n);function n(){var e;Si(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Ri(Ti(e),"type","EarthLayer"),Ri(Ti(e),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),e}return Ei(n,[{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new xh[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"setEarthTime",value:function(e){this.layerModel&&this.layerModel.setEarthTime?this.layerModel.setEarthTime(e):console.warn("\u8bf7\u5728 scene loaded \u4e4b\u540e\u6267\u884c\u8be5\u65b9\u6cd5\uff01")}},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=(null===t||void 0===t||null===(e=t.scale)||void 0===e?void 0:e.field)||"base";return bh.indexOf(n)<0&&(n="base"),n}}]),n}(Aa);function wh(e){var t=Ch();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function Ch(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var kh="uniform float u_opacity : 1.0;\nuniform vec4 u_color;\n\nvoid main() {\n  gl_FragColor = u_color;\n  gl_FragColor.a *= u_opacity;\n}\n",Ah='attribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\n#pragma include "projection"\n\nvoid main() {\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n}\n\n',Eh=function(e){Oi(n,e);var t=wh(n);function n(){return Si(this,n),t.apply(this,arguments)}return Ei(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.color,i=void 0===r?"#000":r;return{u_opacity:(0,Zt.isNumber)(n)?n:0,u_color:(0,Ue.CI)(i)}}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"mask",vertexShader:Ah,fragmentShader:kh,triangulation:zo,depth:{enable:!1},pick:!1});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e&&this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),n}(Oa),Th={fill:Eh},Mh=Th;function Oh(e){var t=Lh();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function Lh(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Ph=function(e){Oi(n,e);var t=Oh(n);function n(){var e;Si(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Ri(Ti(e),"type","MaskLayer"),e}return Ei(n,[{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new Mh[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getModelType",value:function(){return"fill"}}]),n}(Aa);function Rh(e,t,n){var r=Ih(e,e.VERTEX_SHADER,t),i=Ih(e,e.FRAGMENT_SHADER,n);if(!r||!i)return null;var a=e.createProgram();if(!a)return null;e.attachShader(a,r),e.attachShader(a,i),e.linkProgram(a);var o=e.getProgramParameter(a,e.LINK_STATUS);if(!o){var s=e.getProgramInfoLog(a);return console.warn("Failed to link program: "+s),e.deleteProgram(a),e.deleteShader(i),e.deleteShader(r),null}for(var u=e.getProgramParameter(a,e.ACTIVE_ATTRIBUTES),l=0;l<u;l++){var c=e.getActiveAttrib(a,l);a[c.name]=e.getAttribLocation(a,c.name)}for(var f=e.getProgramParameter(a,e.ACTIVE_UNIFORMS),h=0;h<f;h++){var p=e.getActiveUniform(a,h);a[p.name]=e.getUniformLocation(a,p.name)}return a.vertexShader=r,a.fragmentShader=i,a}function Ih(e,t,n){var r=e.createShader(t);if(null==r)return console.warn("unable to create shader"),null;e.shaderSource(r,n),e.compileShader(r);var i=e.getShaderParameter(r,e.COMPILE_STATUS);if(!i){var a=e.getShaderInfoLog(r);return console.warn("Failed to compile shader: "+a),e.deleteShader(r),null}return r}function Dh(e,t,n,r,i){var a=e.createTexture();return e.bindTexture(e.TEXTURE_2D,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r,i,0,e.RGBA,e.UNSIGNED_BYTE,n),e.bindTexture(e.TEXTURE_2D,null),a}function zh(e,t,n){var r=e.createTexture();return e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),e.bindTexture(e.TEXTURE_2D,null),r}function Nh(e,t,n){e.activeTexture(e.TEXTURE0+n),e.bindTexture(e.TEXTURE_2D,t)}function Fh(e,t){var n=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),n}var jh="\n precision mediump float;\n\n attribute float a_index;\n\n uniform sampler2D u_particles;\n uniform float u_particles_res;\n\n varying vec2 v_particle_pos;\n\n void main() {\n     vec4 color = texture2D(u_particles, vec2(\n         fract(a_index / u_particles_res),\n         floor(a_index / u_particles_res) / u_particles_res)\n     );\n\n     // decode current particle position from the pixel's RGBA value\n     v_particle_pos = vec2( color.r / 255.0 + color.b, color.g / 255.0 + color.a);\n\n     gl_PointSize = 1.0;\n     gl_Position = vec4(2.0 * v_particle_pos.x - 1.0, 1.0 - 2.0 * v_particle_pos.y, 0, 1);\n }",Bh="\n precision mediump float;\n\n uniform sampler2D u_wind;\n uniform vec2 u_wind_min;\n uniform vec2 u_wind_max;\n uniform sampler2D u_color_ramp;\n\n varying vec2 v_particle_pos;\n\n void main() {\n     vec2 velocity = mix(u_wind_min, u_wind_max, texture2D(u_wind, v_particle_pos).rg);\n     float speed_t = length(velocity) / length(u_wind_max);\n\n     // color ramp is encoded in a 16x16 texture\n     vec2 ramp_pos = vec2( fract(16.0 * speed_t), floor(16.0 * speed_t) / 16.0);\n\n     gl_FragColor = texture2D(u_color_ramp, ramp_pos);\n }",Uh="\n precision mediump float;\n\n attribute vec2 a_pos;\n\n varying vec2 v_tex_pos;\n\n void main() {\n     v_tex_pos = a_pos;\n     gl_Position = vec4(1.0 - 2.0 * a_pos, 0, 1);\n     // framebuffer \u59cb\u7ec8\u7528\u94fa\u6ee1\u5c4f\u5e55\u7684 texture\n }",Vh="\n precision highp float;\n\n uniform sampler2D u_particles;\n uniform sampler2D u_wind;\n uniform vec2 u_wind_res;\n uniform vec2 u_wind_min;\n uniform vec2 u_wind_max;\n uniform float u_rand_seed;\n uniform float u_speed_factor;\n uniform float u_drop_rate;\n uniform float u_drop_rate_bump;\n\n varying vec2 v_tex_pos;\n\n // pseudo-random generator\n const vec3 rand_constants = vec3(12.9898, 78.233, 4375.85453);\n float rand(const vec2 co) {\n float t = dot(rand_constants.xy, co);\n     return fract(sin(t) * (rand_constants.z + t));\n }\n\n // wind speed lookup; use manual bilinear filtering based on 4 adjacent pixels for smooth interpolation\n vec2 lookup_wind(const vec2 uv) {\n     // return texture2D(u_wind, uv).rg; // lower-res hardware filtering\n     vec2 px = 1.0 / u_wind_res;\n     vec2 vc = (floor(uv * u_wind_res)) * px;\n     vec2 f = fract(uv * u_wind_res);\n     vec2 tl = texture2D(u_wind, vc).rg;\n     vec2 tr = texture2D(u_wind, vc + vec2(px.x, 0)).rg;\n     vec2 bl = texture2D(u_wind, vc + vec2(0, px.y)).rg;\n     vec2 br = texture2D(u_wind, vc + px).rg;\n     return mix(mix(tl, tr, f.x), mix(bl, br, f.x), f.y);\n }\n\n void main() {\n     vec4 color = texture2D(u_particles, v_tex_pos);\n     vec2 pos = vec2(\n         color.r / 255.0 + color.b,\n         color.g / 255.0 + color.a); // decode particle position from pixel RGBA\n     vec2 velocity = mix(u_wind_min, u_wind_max, lookup_wind(pos));\n     float speed_t = length(velocity) / length(u_wind_max);\n\n     // take EPSG:4236 distortion into account for calculating where the particle moved\n     float distortion = cos(radians(pos.y * 180.0 - 90.0));\n     vec2 offset = vec2(velocity.x / distortion, -velocity.y) * 0.0001 * u_speed_factor;\n\n     // update particle position, wrapping around the date line\n     pos = fract(1.0 + pos + offset);\n\n     // a random seed to use for the particle drop\n     vec2 seed = (pos + v_tex_pos) * u_rand_seed;\n\n     // drop rate is a chance a particle will restart at random position, to avoid degeneration\n     float drop_rate = u_drop_rate + speed_t * u_drop_rate_bump;\n     float drop = step(1.0 - drop_rate, rand(seed));\n\n     vec2 random_pos = vec2(\n         rand(seed + 1.3),\n         rand(seed + 2.1));\n         pos = mix(pos, random_pos, drop);\n\n     // encode the new particle position back into RGBA\n     gl_FragColor = vec4(\n         fract(pos * 255.0),\n         floor(pos * 255.0) / 255.0);\n }",Gh="\n     precision mediump float;\n\n     attribute vec2 a_pos;\n\n     varying vec2 v_tex_pos;\n\n     void main() {\n         v_tex_pos = a_pos;\n         gl_Position = vec4(1.0 - 2.0 * a_pos, 0.0, 1.0);\n         gl_PointSize = 100.0;\n }",Hh="\n precision mediump float;\n\n uniform sampler2D u_screen;\n uniform float u_opacity;\n varying vec2 v_tex_pos;\n\n void main() {\n     vec4 color = texture2D(u_screen, 1.0 - v_tex_pos);\n\n     // a hack to guarantee opacity fade out even with a value close to 1.0\n     gl_FragColor = vec4(floor(255.0 * color * u_opacity) / 255.0);\n }";function Wh(e){var t=document.createElement("canvas"),n=t.getContext("2d");t.width=256,t.height=1;for(var r=n.createLinearGradient(0,0,256,0),i=0,a=Object.keys(e);i<a.length;i++){var o=a[i];r.addColorStop(+o,e[+o])}return n.fillStyle=r,n.fillRect(0,0,256,1),t=null,new Uint8Array(n.getImageData(0,0,256,1).data)}function Yh(e,t,n,r){e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(n),e.vertexAttribPointer(n,r,e.FLOAT,!1,0,0)}function qh(e,t,n){e.bindFramebuffer(e.FRAMEBUFFER,t),n&&e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)}var Zh=function(){function e(t){Si(this,e),Ri(this,"width",512),Ri(this,"height",512),Ri(this,"numParticles",65536),this.gl=t.glContext,this.width=t.imageWidth,this.height=t.imageHeight,this.fadeOpacity=t.fadeOpacity,this.speedFactor=t.speedFactor,this.dropRate=t.dropRate,this.dropRateBump=t.dropRateBump,this.rampColors=t.rampColors,this.init()}return Ei(e,[{key:"init",value:function(){var e=this.gl;this.fadeOpacity=.996,this.speedFactor=.25,this.dropRate=.003,this.dropRateBump=.01,this.drawProgram=Rh(e,jh,Bh),this.fullScreenProgram=Rh(e,Gh,Hh),this.updateProgram=Rh(e,Uh,Vh),this.quadBuffer=Fh(e,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1])),this.framebuffer=e.createFramebuffer(),this.colorRampTexture=Dh(this.gl,this.gl.LINEAR,Wh(this.rampColors),16,16);var t=new Uint8Array(this.width*this.height*4);this.backgroundTexture=Dh(e,e.NEAREST,t,this.width,this.height),this.screenTexture=Dh(e,e.NEAREST,t,this.width,this.height);var n=this.particleStateResolution=Math.ceil(Math.sqrt(this.numParticles));this.numParticlesSize=n*n;for(var r=new Uint8Array(4*this.numParticlesSize),i=0;i<r.length;i++)r[i]=Math.floor(256*Math.random());this.particleStateTexture0=Dh(e,e.NEAREST,r,n,n),this.particleStateTexture1=Dh(e,e.NEAREST,r,n,n);for(var a=new Float32Array(this.numParticlesSize),o=0;o<this.numParticlesSize;o++)a[o]=o;this.particleIndexBuffer=Fh(e,a)}},{key:"setWind",value:function(e){this.windData=e,this.windTexture=zh(this.gl,this.gl.LINEAR,e.image)}},{key:"updateParticelNum",value:function(e){var t=this.gl;if(e!==this.numParticles){this.numParticles=e;var n=this.particleStateResolution=Math.ceil(Math.sqrt(this.numParticles));this.numParticlesSize=n*n;for(var r=new Uint8Array(4*this.numParticlesSize),i=0;i<r.length;i++)r[i]=Math.floor(256*Math.random());this.particleStateTexture0=Dh(t,t.NEAREST,r,n,n),this.particleStateTexture1=Dh(t,t.NEAREST,r,n,n);for(var a=new Float32Array(this.numParticlesSize),o=0;o<this.numParticlesSize;o++)a[o]=o;this.particleIndexBuffer=Fh(t,a)}}},{key:"updateWindDir",value:function(e,t,n,r){this.windData.uMin=e,this.windData.uMax=t,this.windData.vMin=n,this.windData.vMax=r}},{key:"updateColorRampTexture",value:function(e){if(this.isColorChanged(e)){this.rampColors=e;var t=this.gl;t.deleteTexture(this.colorRampTexture),this.colorRampTexture=Dh(t,t.LINEAR,Wh(e),16,16)}}},{key:"isColorChanged",value:function(e){for(var t=Object.keys(e),n=0,r=t;n<r.length;n++){var i=r[n],a=Number(i);if(!this.rampColors[a])return!0;if(this.rampColors[a]&&this.rampColors[a]!==e[a])return!0}return!1}},{key:"reSize",value:function(e,t){if(e!==this.width||t!==this.height){var n=this.gl;n.deleteTexture(this.backgroundTexture),n.deleteTexture(this.screenTexture),this.width=e,this.height=t;var r=new Uint8Array(e*t*4);this.backgroundTexture=Dh(n,n.NEAREST,r,e,t),this.screenTexture=Dh(n,n.NEAREST,r,e,t)}}},{key:"draw",value:function(){var e;if(null!==(e=this.windData)&&void 0!==e&&e.image){var t=this.gl;return Nh(t,this.windTexture,0),Nh(t,this.particleStateTexture0,1),this.drawScreen(),this.updateParticles(),{d:this.pixels,w:this.width,h:this.height}}return{d:new Uint8Array([0,0,0,0]),w:1,h:1}}},{key:"drawScreen",value:function(){var e=this.gl;qh(e,this.framebuffer,this.screenTexture),e.viewport(0,0,this.width,this.height),e.disable(e.BLEND),this.drawFullTexture(this.backgroundTexture,this.fadeOpacity),this.drawParticles(),this.pixels=new Uint8Array(4*this.width*this.height),e.readPixels(0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,this.pixels),qh(e,null,null),e.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height);var t=this.backgroundTexture;this.backgroundTexture=this.screenTexture,this.screenTexture=t}},{key:"drawFullTexture",value:function(e,t){var n=this.gl,r=this.fullScreenProgram;n.useProgram(r),n.bindBuffer(n.ARRAY_BUFFER,this.quadBuffer),n.vertexAttribPointer(r.a_pos,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(r.a_pos),n.bindBuffer(n.ARRAY_BUFFER,null),Nh(n,e,2),n.uniform1i(r.u_screen,2),n.uniform1f(r.u_opacity,t),n.drawArrays(n.TRIANGLES,0,6)}},{key:"drawParticles",value:function(){var e=this.gl,t=this.drawProgram;e.useProgram(t),Yh(e,this.particleIndexBuffer,t.a_index,1),Nh(e,this.colorRampTexture,2),e.uniform1i(t.u_wind,0),e.uniform1i(t.u_particles,1),e.uniform1i(t.u_color_ramp,2),e.uniform1f(t.u_particles_res,this.particleStateResolution),e.uniform2f(t.u_wind_min,this.windData.uMin,this.windData.vMin),e.uniform2f(t.u_wind_max,this.windData.uMax,this.windData.vMax),e.drawArrays(e.POINTS,0,this.numParticlesSize)}},{key:"updateParticles",value:function(){var e=this.gl;qh(e,this.framebuffer,this.particleStateTexture1),e.viewport(0,0,this.particleStateResolution,this.particleStateResolution);var t=this.updateProgram;e.useProgram(t),Yh(e,this.quadBuffer,t.a_pos,2),e.uniform1i(t.u_wind,0),e.uniform1i(t.u_particles,1),e.uniform1f(t.u_rand_seed,Math.random()),e.uniform2f(t.u_wind_res,2*this.windData.image.width,2*this.windData.image.height),e.uniform2f(t.u_wind_min,this.windData.uMin,this.windData.vMin),e.uniform2f(t.u_wind_max,this.windData.uMax,this.windData.vMax),e.uniform1f(t.u_speed_factor,this.speedFactor),e.uniform1f(t.u_drop_rate,this.dropRate),e.uniform1f(t.u_drop_rate_bump,this.dropRateBump),e.drawArrays(e.TRIANGLES,0,6);var n=this.particleStateTexture0;this.particleStateTexture0=this.particleStateTexture1,this.particleStateTexture1=n,qh(e,null,null)}},{key:"destroy",value:function(){this.gl.deleteBuffer(this.quadBuffer),this.gl.deleteBuffer(this.particleIndexBuffer),this.gl.deleteFramebuffer(this.framebuffer),this.gl.deleteShader(this.drawProgram.vertexShader),this.gl.deleteShader(this.drawProgram.fragmentShader),this.gl.deleteProgram(this.drawProgram),this.gl.deleteShader(this.fullScreenProgram.vertexShader),this.gl.deleteShader(this.fullScreenProgram.fragmentShader),this.gl.deleteProgram(this.fullScreenProgram),this.gl.deleteShader(this.updateProgram.vertexShader),this.gl.deleteShader(this.updateProgram.fragmentShader),this.gl.deleteProgram(this.updateProgram),this.gl.deleteTexture(this.colorRampTexture),this.gl.deleteTexture(this.backgroundTexture),this.gl.deleteTexture(this.screenTexture),this.gl.deleteTexture(this.particleStateTexture0),this.gl.deleteTexture(this.particleStateTexture1),this.gl.deleteTexture(this.windTexture)}}]),e}();function Kh(e){var t=Xh();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function Xh(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Qh="precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nvoid main() {\n  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\n  gl_FragColor = color;\n  gl_FragColor.a *= u_opacity;\n}\n",Jh='precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   \n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',$h={0:"#3288bd",.1:"#66c2a5",.2:"#abdda4",.3:"#e6f598",.4:"#fee08b",.5:"#fdae61",.6:"#f46d43",1:"#d53e4f"},ep=function(e){Oi(n,e);var t=Kh(n);function n(){var e;Si(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Ri(Ti(e),"sizeScale",.5),Ri(Ti(e),"frequency",new Ue.iH(7.2)),e}return Ei(n,[{key:"render",value:function(e){var t=this;this.drawColorMode(e),this.frequency.run((function(){t.drawWind()}))}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var e=bi(zi().mark((function e(){var t,n,r,i,a,o,s,u,l,c,f,h,p,d,v,g,m,y,_,x,b,S,w,C,k,A,E,T,M=this;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=this.layer.getLayerConfig(),a=i.uMin,o=void 0===a?-21.32:a,s=i.uMax,u=void 0===s?26.8:s,l=i.vMin,c=void 0===l?-21.57:l,f=i.vMax,h=void 0===f?21.42:f,p=i.fadeOpacity,d=void 0===p?.996:p,v=i.speedFactor,g=void 0===v?.25:v,m=i.dropRate,y=void 0===m?.003:m,_=i.dropRateBump,x=void 0===_?.01:_,b=i.rampColors,S=void 0===b?$h:b,w=i.sizeScale,C=void 0===w?.5:w,k=this.rendererService.createTexture2D,A=this.layer.getSource(),this.texture=k({height:0,width:0}),this.cacheZoom=Math.floor(this.mapService.getZoom()),E=this.rendererService.getGLContext(),this.imageCoords=null===(t=A.data)||void 0===t?void 0:t.dataArray[0].coordinates,null===(n=A.data)||void 0===n||null===(r=n.images)||void 0===r||r.then((function(e){var t;M.sizeScale=C*M.getZoomScale();var n=M.getWindSize(),r=n.imageWidth,i=n.imageHeight,a={glContext:E,imageWidth:r,imageHeight:i,fadeOpacity:d,speedFactor:g,dropRate:y,dropRateBump:x,rampColors:S};M.wind=new Zh(a),M.wind.setWind({uMin:o,uMax:u,vMin:c,vMax:h,image:e[0]}),null===(t=M.texture)||void 0===t||t.destroy(),M.texture=k({width:r,height:i}),M.layerService.reRender()})),e.next=10,this.layer.buildLayerModel({moduleName:"wind",vertexShader:Jh,fragmentShader:Qh,triangulation:Uo,primitive:yt.gl.TRIANGLES,depth:{enable:!1}});case 10:return T=e.sent,this.colorModel=T,e.abrupt("return",[T]);case 13:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getWindSize",value:function(){var e=this.mapService.lngLatToPixel(this.imageCoords[0]),t=this.mapService.lngLatToPixel(this.imageCoords[1]),n=Math.min(Math.floor((t.x-e.x)*this.sizeScale),2048),r=Math.min(Math.floor((e.y-t.y)*this.sizeScale),2048);return{imageWidth:n,imageHeight:r}}},{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var e,t;null===(e=this.texture)||void 0===e||e.destroy(),null===(t=this.wind)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:yt.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}},{key:"getZoomScale",value:function(){return Math.min((this.cacheZoom+4)/30*2,2)}},{key:"drawWind",value:function(){if(this.wind){var e=this.layer.getLayerConfig(),t=e.uMin,n=void 0===t?-21.32:t,r=e.uMax,i=void 0===r?26.8:r,a=e.vMin,o=void 0===a?-21.57:a,s=e.vMax,u=void 0===s?21.42:s,l=e.numParticles,c=void 0===l?65535:l,f=e.fadeOpacity,h=void 0===f?.996:f,p=e.speedFactor,d=void 0===p?.25:p,v=e.dropRate,g=void 0===v?.003:v,m=e.dropRateBump,y=void 0===m?.01:m,_=e.rampColors,x=void 0===_?$h:_,b=e.sizeScale,S=void 0===b?.5:b,w=c,C=Math.floor(this.mapService.getZoom());if("number"===typeof S&&S!==this.sizeScale||C!==this.cacheZoom){var k=this.getZoomScale();this.sizeScale=S,w*=k;var A=this.getWindSize(),E=A.imageWidth,T=A.imageHeight;this.wind.reSize(E,T),this.cacheZoom=C}this.wind.updateWindDir(n,i,o,u),this.wind.updateParticelNum(w),this.wind.updateColorRampTexture(x),this.wind.fadeOpacity=h,this.wind.speedFactor=d,this.wind.dropRate=g,this.wind.dropRateBump=y;var M=this.wind.draw(),O=M.d,L=M.w,P=M.h;this.rendererService.setBaseState(),this.texture.update({data:O,width:L,height:P})}}},{key:"drawColorMode",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.layer.getLayerConfig(),r=n.opacity;this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),this.layerService.renderMask(this.layer.masks),null===(e=this.colorModel)||void 0===e||e.draw({uniforms:{u_opacity:r||1,u_texture:this.texture},blend:this.getBlend(),stencil:this.getStencil(t)}),this.layer.hooks.afterRender.call()}}]),n}(Oa),tp={wind:ep},np=tp;function rp(e){var t=ip();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function ip(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var ap,op,sp,up,lp,cp,fp,hp,pp,dp=function(e){Oi(n,e);var t=rp(n);function n(){var e;Si(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Ri(Ti(e),"type","WindLayer"),e}return Ei(n,[{key:"buildModels",value:function(){var e=bi(zi().mark((function e(){var t;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new np[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"renderModels",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.layerModel&&this.layerModel.render(e),this}},{key:"getDefaultConfig",value:function(){var e=this.getModelType(),t={wind:{}};return t[e]}},{key:"getModelType",value:function(){return"wind"}}]),n}(Aa),vp=(ap=(0,zs.b2)(),op=(0,zs.f3)(yt.vK.IMapService),sp=(0,zs.f3)(yt.vK.IFontService),ap((lp=function(){function e(){Si(this,e),qi(this,"mapService",cp,this),qi(this,"fontService",fp,this)}return Ei(e,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tapPromise("DataMappingPlugin",bi(zi().mark((function t(){return zi().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.log(yt.Or.MappingStart,yt.KD.INIT),n.generateMaping(e,{styleAttributeService:r}),e.log(yt.Or.MappingEnd,yt.KD.INIT);case 3:case"end":return t.stop()}}),t)})))),e.hooks.beforeRenderData.tapPromise("DataMappingPlugin",function(){var t=bi(zi().mark((function t(i){var a;return zi().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(i){t.next=2;break}return t.abrupt("return",i);case 2:return e.dataState.dataMappingNeedUpdate=!1,e.log(yt.Or.MappingStart,yt.KD.UPDATE),a=n.generateMaping(e,{styleAttributeService:r}),e.log(yt.Or.MappingEnd,yt.KD.UPDATE),t.abrupt("return",a);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),e.hooks.beforeRender.tap("DataMappingPlugin",(function(){var t=e.getSource();if(!e.layerModelNeedUpdate&&t&&t.inited){var i=r.getLayerStyleAttributes()||[],a=r.getLayerStyleAttribute("filter"),o=t.data.dataArray;if(!Array.isArray(o)||0!==o.length){var s=i.filter((function(e){return e.needRemapping})),u=o;if(null!==a&&void 0!==a&&a.needRemapping&&null!==a&&void 0!==a&&a.scale&&(u=o.filter((function(e){return n.applyAttributeMapping(a,e)[0]}))),s.length){var l=n.mapping(e,s,u,e.getEncodedData());e.setEncodedData(l)}}}}))}},{key:"generateMaping",value:function(e,t){var n=this,r=t.styleAttributeService,i=r.getLayerStyleAttributes()||[],a=r.getLayerStyleAttribute("filter"),o=e.getSource().data.dataArray,s=o;null!==a&&void 0!==a&&a.scale&&(s=o.filter((function(e){return n.applyAttributeMapping(a,e)[0]}))),s=e.processData(s);var u=this.mapping(e,i,s,void 0);return e.setEncodedData(u),(0!==o.length||0!==e.encodeDataLength)&&(e.emit("dataUpdate",null),!0)}},{key:"mapping",value:function(e,t,n,r){var i=this,a=e.getLayerConfig(),o=a.arrow,s=void 0===o?{enable:!1}:o,u=t.filter((function(e){return void 0!==e.scale})).filter((function(e){return"filter"!==e.name})),l=n.map((function(t,n){var a=r?r[n]:{},o=Yi({id:t._id,coordinates:t.coordinates},a);if(u.forEach((function(e){var n=i.applyAttributeMapping(e,t);"color"!==e.name&&"stroke"!==e.name||(n=n.map((function(e){return(0,Ue.CI)(e)}))),o[e.name]=Array.isArray(n)&&1===n.length?n[0]:n,"shape"===e.name&&(o.shape=i.fontService.getIconFontKey(o[e.name]))})),s.enable&&"line"===o.shape){var l=o.coordinates;if(e.arrowInsertCount<e.encodeDataLength){var c=i.getArrowPoints(l[0],l[1]);o.coordinates.splice(1,0,c,c),e.arrowInsertCount++}}return o}));return t.forEach((function(e){e.needRemapping=!1})),this.adjustData2Amap2Coordinates(l,e),this.adjustData2SimpleCoordinates(l),l}},{key:"adjustData2Amap2Coordinates",value:function(e,t){var n=this;if(e.length>0&&this.mapService.version===Xi.G["GAODE2.x"]){var r=t.coordCenter||t.getSource().center;e.filter((function(e){return!e.originCoordinates})).map((function(e){e.version=Xi.G["GAODE2.x"],e.originCoordinates=(0,Zt.cloneDeep)(e.coordinates),e.coordinates=n.mapService.coordToAMap2RelativeCoordinates(e.coordinates,r)}))}}},{key:"adjustData2SimpleCoordinates",value:function(e){var t=this;e.length>0&&this.mapService.version===Xi.G.SIMPLE&&e.map((function(e){e.simpleCoordinate||(e.coordinates=t.unProjectCoordinates(e.coordinates),e.simpleCoordinate=!0)}))}},{key:"unProjectCoordinates",value:function(e){var t=this;if("number"===typeof e[0])return this.mapService.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var n=[];return e.map((function(e){var r=[];e.map((function(e){r.push(t.mapService.simpleMapCoord.unproject(e))})),n.push(r)})),n}var r=[];return e.map((function(e){r.push(t.mapService.simpleMapCoord.unproject(e))})),r}},{key:"applyAttributeMapping",value:function(e,t){var n;if(!e.scale)return[];var r=(null===e||void 0===e||null===(n=e.scale)||void 0===n?void 0:n.scalers)||[],i=[];r.forEach((function(n){var r,a=n.field;(t.hasOwnProperty(a)||"variable"===(null===(r=e.scale)||void 0===r?void 0:r.type))&&i.push(t[a])}));var a=e.mapping?e.mapping(i):[];return a}},{key:"getArrowPoints",value:function(e,t){var n=[t[0]-e[0],t[1]-e[1]],r=(0,Ue.Fv)(n),i=[e[0]+1e-4*r[0],e[1]+1e-4*r[1]];return i}}]),e}(),cp=Zi(lp.prototype,"mapService",[op],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fp=Zi(lp.prototype,"fontService",[sp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),up=lp))||up),gp=(hp=(0,zs.b2)(),hp(pp=function(){function e(){Si(this,e)}return Ei(e,[{key:"apply",value:function(e){var t=this;this.mapService=e.getContainer().get(yt.vK.IMapService),e.hooks.init.tapPromise("DataSourcePlugin",bi(zi().mark((function n(){var r,i,a,o;return zi().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.log(yt.Or.SourceInitStart,yt.KD.INIT),r=e.getSource(),r||(i=e.sourceOption||e.defaultSourceConfig,a=i.data,o=i.options,r=new Mn(a,o),e.setSource(r)),!r.inited){n.next=8;break}t.updateClusterData(e),e.log(yt.Or.SourceInitEnd,yt.KD.INIT),n.next=10;break;case 8:return n.next=10,new Promise((function(n){r.on("update",(function(r){"inited"===r.type&&(t.updateClusterData(e),e.log(yt.Or.SourceInitEnd,yt.KD.INIT)),n(null)}))}));case 10:case"end":return n.stop()}}),n)})))),e.hooks.beforeRenderData.tapPromise("DataSourcePlugin",bi(zi().mark((function n(){var r,i,a;return zi().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=t.updateClusterData(e),i=e.dataState.dataSourceNeedUpdate,e.dataState.dataSourceNeedUpdate=!1,a=r||i,n.abrupt("return",a);case 5:case"end":return n.stop()}}),n)}))))}},{key:"updateClusterData",value:function(e){if(e.isTileLayer||e.tileLayer||!e.getSource())return!1;var t=e.getSource(),n=t.cluster,r=t.clusterOptions.zoom,i=void 0===r?0:r,a=this.mapService.getZoom()-1,o=e.dataState.dataSourceNeedUpdate;return n&&o&&t.updateClusterData(Math.floor(a)),!!(n&&Math.abs(e.clusterZoom-a)>=1)&&(i!==Math.floor(a)&&t.updateClusterData(Math.floor(a)),e.clusterZoom=a,!0)}}]),e}())||pp);function mp(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function yp(e){return 1===e.length&&(e=_p(e)),{left:function(t,n,r,i){null==r&&(r=0),null==i&&(i=t.length);while(r<i){var a=r+i>>>1;e(t[a],n)<0?r=a+1:i=a}return r},right:function(t,n,r,i){null==r&&(r=0),null==i&&(i=t.length);while(r<i){var a=r+i>>>1;e(t[a],n)>0?i=a:r=a+1}return r}}}function _p(e){return function(t,n){return mp(e(t),n)}}var xp=yp(mp),bp=xp.right,Sp=(xp.left,bp);function wp(e,t){var n,r,i,a=e.length,o=-1;if(null==t){while(++o<a)if(null!=(n=e[o])&&n>=n){r=i=n;while(++o<a)null!=(n=e[o])&&(r>n&&(r=n),i<n&&(i=n))}}else while(++o<a)if(null!=(n=t(e[o],o,e))&&n>=n){r=i=n;while(++o<a)null!=(n=t(e[o],o,e))&&(r>n&&(r=n),i<n&&(i=n))}return[r,i]}var Cp=Array.prototype,kp=(Cp.slice,Cp.map,Math.sqrt(50)),Ap=Math.sqrt(10),Ep=Math.sqrt(2);function Tp(e,t,n){var r,i,a,o,s=-1;if(t=+t,e=+e,n=+n,e===t&&n>0)return[e];if((r=t<e)&&(i=e,e=t,t=i),0===(o=Mp(e,t,n))||!isFinite(o))return[];if(o>0){e=Math.ceil(e/o),t=Math.floor(t/o),a=new Array(i=Math.ceil(t-e+1));while(++s<i)a[s]=(e+s)*o}else{e=Math.floor(e*o),t=Math.ceil(t*o),a=new Array(i=Math.ceil(e-t+1));while(++s<i)a[s]=(e-s)/o}return r&&a.reverse(),a}function Mp(e,t,n){var r=(t-e)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),a=r/Math.pow(10,i);return i>=0?(a>=kp?10:a>=Ap?5:a>=Ep?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=kp?10:a>=Ap?5:a>=Ep?2:1)}function Op(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),a=r/i;return a>=kp?i*=10:a>=Ap?i*=5:a>=Ep&&(i*=2),t<e?-i:i}function Lp(e){return null===e?NaN:+e}function Pp(e,t,n){if(null==n&&(n=Lp),r=e.length){if((t=+t)<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,a=Math.floor(i),o=+n(e[a],a,e),s=+n(e[a+1],a+1,e);return o+(s-o)*(i-a)}}function Rp(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Ip(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Dp(){}var zp=.7,Np=1/zp,Fp="\\s*([+-]?\\d+)\\s*",jp="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Bp="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Up=/^#([0-9a-f]{3,8})$/,Vp=new RegExp("^rgb\\("+[Fp,Fp,Fp]+"\\)$"),Gp=new RegExp("^rgb\\("+[Bp,Bp,Bp]+"\\)$"),Hp=new RegExp("^rgba\\("+[Fp,Fp,Fp,jp]+"\\)$"),Wp=new RegExp("^rgba\\("+[Bp,Bp,Bp,jp]+"\\)$"),Yp=new RegExp("^hsl\\("+[jp,Bp,Bp]+"\\)$"),qp=new RegExp("^hsla\\("+[jp,Bp,Bp,jp]+"\\)$"),Zp={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Kp(){return this.rgb().formatHex()}function Xp(){return ud(this).formatHsl()}function Qp(){return this.rgb().formatRgb()}function Jp(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Up.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?$p(t):3===n?new rd(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?ed(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?ed(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=Vp.exec(e))?new rd(t[1],t[2],t[3],1):(t=Gp.exec(e))?new rd(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Hp.exec(e))?ed(t[1],t[2],t[3],t[4]):(t=Wp.exec(e))?ed(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=Yp.exec(e))?sd(t[1],t[2]/100,t[3]/100,1):(t=qp.exec(e))?sd(t[1],t[2]/100,t[3]/100,t[4]):Zp.hasOwnProperty(e)?$p(Zp[e]):"transparent"===e?new rd(NaN,NaN,NaN,0):null}function $p(e){return new rd(e>>16&255,e>>8&255,255&e,1)}function ed(e,t,n,r){return r<=0&&(e=t=n=NaN),new rd(e,t,n,r)}function td(e){return e instanceof Dp||(e=Jp(e)),e?(e=e.rgb(),new rd(e.r,e.g,e.b,e.opacity)):new rd}function nd(e,t,n,r){return 1===arguments.length?td(e):new rd(e,t,n,null==r?1:r)}function rd(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function id(){return"#"+od(this.r)+od(this.g)+od(this.b)}function ad(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(1===e?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function od(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function sd(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new cd(e,t,n,r)}function ud(e){if(e instanceof cd)return new cd(e.h,e.s,e.l,e.opacity);if(e instanceof Dp||(e=Jp(e)),!e)return new cd;if(e instanceof cd)return e;e=e.rgb();var t=e.r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=NaN,s=a-i,u=(a+i)/2;return s?(o=t===a?(n-r)/s+6*(n<r):n===a?(r-t)/s+2:(t-n)/s+4,s/=u<.5?a+i:2-a-i,o*=60):s=u>0&&u<1?0:o,new cd(o,s,u,e.opacity)}function ld(e,t,n,r){return 1===arguments.length?ud(e):new cd(e,t,n,null==r?1:r)}function cd(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function fd(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function hd(e,t,n,r,i){var a=e*e,o=a*e;return((1-3*e+3*a-o)*t+(4-6*a+3*o)*n+(1+3*e+3*a-3*o)*r+o*i)/6}function pd(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],a=e[r+1],o=r>0?e[r-1]:2*i-a,s=r<t-1?e[r+2]:2*a-i;return hd((n-r/t)*t,o,i,a,s)}}function dd(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],a=e[r%t],o=e[(r+1)%t],s=e[(r+2)%t];return hd((n-r/t)*t,i,a,o,s)}}function vd(e){return function(){return e}}function gd(e,t){return function(n){return e+n*t}}function md(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}function yd(e){return 1===(e=+e)?_d:function(t,n){return n-t?md(t,n,e):vd(isNaN(t)?n:t)}}function _d(e,t){var n=t-e;return n?gd(e,n):vd(isNaN(e)?t:e)}Rp(Dp,Jp,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:Kp,formatHex:Kp,formatHsl:Xp,formatRgb:Qp,toString:Qp}),Rp(rd,nd,Ip(Dp,{brighter:function(e){return e=null==e?Np:Math.pow(Np,e),new rd(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?zp:Math.pow(zp,e),new rd(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:id,formatHex:id,formatRgb:ad,toString:ad})),Rp(cd,ld,Ip(Dp,{brighter:function(e){return e=null==e?Np:Math.pow(Np,e),new cd(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?zp:Math.pow(zp,e),new cd(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new rd(fd(e>=240?e-240:e+120,i,r),fd(e,i,r),fd(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(1===e?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}}));var xd=function e(t){var n=yd(t);function r(e,t){var r=n((e=nd(e)).r,(t=nd(t)).r),i=n(e.g,t.g),a=n(e.b,t.b),o=_d(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=a(t),e.opacity=o(t),e+""}}return r.gamma=e,r}(1);function bd(e){return function(t){var n,r,i=t.length,a=new Array(i),o=new Array(i),s=new Array(i);for(n=0;n<i;++n)r=nd(t[n]),a[n]=r.r||0,o[n]=r.g||0,s[n]=r.b||0;return a=e(a),o=e(o),s=e(s),r.opacity=1,function(e){return r.r=a(e),r.g=o(e),r.b=s(e),r+""}}}var Sd=bd(pd),wd=(bd(dd),"$");function Cd(){}function kd(e,t){var n=new Cd;if(e instanceof Cd)e.each((function(e,t){n.set(t,e)}));else if(Array.isArray(e)){var r,i=-1,a=e.length;if(null==t)while(++i<a)n.set(i,e[i]);else while(++i<a)n.set(t(r=e[i],i,e),r)}else if(e)for(var o in e)n.set(o,e[o]);return n}Cd.prototype=kd.prototype={constructor:Cd,has:function(e){return wd+e in this},get:function(e){return this[wd+e]},set:function(e,t){return this[wd+e]=t,this},remove:function(e){var t=wd+e;return t in this&&delete this[t]},clear:function(){for(var e in this)e[0]===wd&&delete this[e]},keys:function(){var e=[];for(var t in this)t[0]===wd&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)t[0]===wd&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)t[0]===wd&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)t[0]===wd&&++e;return e},empty:function(){for(var e in this)if(e[0]===wd)return!1;return!0},each:function(e){for(var t in this)t[0]===wd&&e(this[t],t.slice(1),this)}};var Ad=kd;function Ed(){}var Td=Ad.prototype;function Md(e,t){var n=new Ed;if(e instanceof Ed)e.each((function(e){n.add(e)}));else if(e){var r=-1,i=e.length;if(null==t)while(++r<i)n.add(e[r]);else while(++r<i)n.add(t(e[r],r,e))}return n}Ed.prototype=Md.prototype={constructor:Ed,has:Td.has,add:function(e){return e+="",this[wd+e]=e,this},remove:Td.remove,clear:Td.clear,values:Td.keys,size:Td.size,empty:Td.empty,each:Td.each};var Od=Array.prototype,Ld=Od.map,Pd=Od.slice;function Rd(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Id(e,t){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(t).domain(e);break}return this}var Dd={name:"implicit"};function zd(){var e=Ad(),t=[],n=[],r=Dd;function i(i){var a=i+"",o=e.get(a);if(!o){if(r!==Dd)return r;e.set(a,o=t.push(i))}return n[(o-1)%n.length]}return i.domain=function(n){if(!arguments.length)return t.slice();t=[],e=Ad();var r,a,o=-1,s=n.length;while(++o<s)e.has(a=(r=n[o])+"")||e.set(a,t.push(r));return i},i.range=function(e){return arguments.length?(n=Pd.call(e),i):n.slice()},i.unknown=function(e){return arguments.length?(r=e,i):r},i.copy=function(){return zd(t,n).unknown(r)},Rd.apply(i,arguments),i}function Nd(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,a=new Array(i),o=new Array(r);for(n=0;n<i;++n)a[n]=Zd(e[n],t[n]);for(;n<r;++n)o[n]=t[n];return function(e){for(n=0;n<i;++n)o[n]=a[n](e);return o}}function Fd(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function jd(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function Bd(e,t){var n,r={},i={};for(n in null!==e&&"object"===typeof e||(e={}),null!==t&&"object"===typeof t||(t={}),t)n in e?r[n]=Zd(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}}var Ud=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Vd=new RegExp(Ud.source,"g");function Gd(e){return function(){return e}}function Hd(e){return function(t){return e(t)+""}}function Wd(e,t){var n,r,i,a=Ud.lastIndex=Vd.lastIndex=0,o=-1,s=[],u=[];e+="",t+="";while((n=Ud.exec(e))&&(r=Vd.exec(t)))(i=r.index)>a&&(i=t.slice(a,i),s[o]?s[o]+=i:s[++o]=i),(n=n[0])===(r=r[0])?s[o]?s[o]+=r:s[++o]=r:(s[++o]=null,u.push({i:o,x:jd(n,r)})),a=Vd.lastIndex;return a<t.length&&(i=t.slice(a),s[o]?s[o]+=i:s[++o]=i),s.length<2?u[0]?Hd(u[0].x):Gd(t):(t=u.length,function(e){for(var n,r=0;r<t;++r)s[(n=u[r]).i]=n.x(e);return s.join("")})}function Yd(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(a){for(n=0;n<r;++n)i[n]=e[n]*(1-a)+t[n]*a;return i}}function qd(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Zd(e,t){var n,r=typeof t;return null==t||"boolean"===r?vd(t):("number"===r?jd:"string"===r?(n=Jp(t))?(t=n,xd):Wd:t instanceof Jp?xd:t instanceof Date?Fd:qd(t)?Yd:Array.isArray(t)?Nd:"function"!==typeof t.valueOf&&"function"!==typeof t.toString||isNaN(t)?Bd:jd)(e,t)}function Kd(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function Xd(e){return function(){return e}}function Qd(e){return+e}var Jd=[0,1];function $d(e){return e}function ev(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:Xd(isNaN(t)?NaN:.5)}function tv(e){var t,n=e[0],r=e[e.length-1];return n>r&&(t=n,n=r,r=t),function(e){return Math.max(n,Math.min(r,e))}}function nv(e,t,n){var r=e[0],i=e[1],a=t[0],o=t[1];return i<r?(r=ev(i,r),a=n(o,a)):(r=ev(r,i),a=n(a,o)),function(e){return a(r(e))}}function rv(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),a=new Array(r),o=-1;e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());while(++o<r)i[o]=ev(e[o],e[o+1]),a[o]=n(t[o],t[o+1]);return function(t){var n=Sp(e,t,1,r)-1;return a[n](i[n](t))}}function iv(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function av(){var e,t,n,r,i,a,o=Jd,s=Jd,u=Zd,l=$d;function c(){return r=Math.min(o.length,s.length)>2?rv:nv,i=a=null,f}function f(t){return isNaN(t=+t)?n:(i||(i=r(o.map(e),s,u)))(e(l(t)))}return f.invert=function(n){return l(t((a||(a=r(s,o.map(e),jd)))(n)))},f.domain=function(e){return arguments.length?(o=Ld.call(e,Qd),l===$d||(l=tv(o)),c()):o.slice()},f.range=function(e){return arguments.length?(s=Pd.call(e),c()):s.slice()},f.rangeRound=function(e){return s=Pd.call(e),u=Kd,c()},f.clamp=function(e){return arguments.length?(l=e?tv(o):$d,f):l!==$d},f.interpolate=function(e){return arguments.length?(u=e,c()):u},f.unknown=function(e){return arguments.length?(n=e,f):n},function(n,r){return e=n,t=r,c()}}function ov(e,t){return av()(e,t)}var sv,uv=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function lv(e){if(!(t=uv.exec(e)))throw new Error("invalid format: "+e);var t;return new cv({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function cv(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function fv(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function hv(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function pv(e){return e=hv(Math.abs(e)),e?e[1]:NaN}function dv(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(pv(t)/3)))-pv(Math.abs(e)))}function vv(e,t){return function(n,r){var i=n.length,a=[],o=0,s=e[0],u=0;while(i>0&&s>0){if(u+s+1>r&&(s=Math.max(1,r-u)),a.push(n.substring(i-=s,i+s)),(u+=s+1)>r)break;s=e[o=(o+1)%e.length]}return a.reverse().join(t)}}function gv(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}function mv(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(!+e[r])break e;i>0&&(i=0);break}return i>0?e.slice(0,i)+e.slice(t+1):e}function yv(e,t){var n=hv(e,t);if(!n)return e+"";var r=n[0],i=n[1],a=i-(sv=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,o=r.length;return a===o?r:a>o?r+new Array(a-o+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+hv(e,Math.max(0,t+a-1))[0]}function _v(e,t){var n=hv(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}lv.prototype=cv.prototype,cv.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var xv={"%":function(e,t){return(100*e).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:fv,e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return _v(100*e,t)},r:_v,s:yv,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function bv(e){return e}var Sv,wv,Cv,kv=Array.prototype.map,Av=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"];function Ev(e){var t=void 0===e.grouping||void 0===e.thousands?bv:vv(kv.call(e.grouping,Number),e.thousands+""),n=void 0===e.currency?"":e.currency[0]+"",r=void 0===e.currency?"":e.currency[1]+"",i=void 0===e.decimal?".":e.decimal+"",a=void 0===e.numerals?bv:gv(kv.call(e.numerals,String)),o=void 0===e.percent?"%":e.percent+"",s=void 0===e.minus?"-":e.minus+"",u=void 0===e.nan?"NaN":e.nan+"";function l(e){e=lv(e);var l=e.fill,c=e.align,f=e.sign,h=e.symbol,p=e.zero,d=e.width,v=e.comma,g=e.precision,m=e.trim,y=e.type;"n"===y?(v=!0,y="g"):xv[y]||(void 0===g&&(g=12),m=!0,y="g"),(p||"0"===l&&"="===c)&&(p=!0,l="0",c="=");var _="$"===h?n:"#"===h&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",x="$"===h?r:/[%p]/.test(y)?o:"",b=xv[y],S=/[defgprs%]/.test(y);function w(e){var n,r,o,h=_,w=x;if("c"===y)w=b(e)+w,e="";else{e=+e;var C=e<0||1/e<0;if(e=isNaN(e)?u:b(Math.abs(e),g),m&&(e=mv(e)),C&&0===+e&&"+"!==f&&(C=!1),h=(C?"("===f?f:s:"-"===f||"("===f?"":f)+h,w=("s"===y?Av[8+sv/3]:"")+w+(C&&"("===f?")":""),S){n=-1,r=e.length;while(++n<r)if(o=e.charCodeAt(n),48>o||o>57){w=(46===o?i+e.slice(n+1):e.slice(n))+w,e=e.slice(0,n);break}}}v&&!p&&(e=t(e,1/0));var k=h.length+e.length+w.length,A=k<d?new Array(d-k+1).join(l):"";switch(v&&p&&(e=t(A+e,A.length?d-w.length:1/0),A=""),c){case"<":e=h+e+w+A;break;case"=":e=h+A+e+w;break;case"^":e=A.slice(0,k=A.length>>1)+h+e+w+A.slice(k);break;default:e=A+h+e+w;break}return a(e)}return g=void 0===g?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),w.toString=function(){return e+""},w}function c(e,t){var n=l((e=lv(e),e.type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(pv(t)/3))),i=Math.pow(10,-r),a=Av[8+r/3];return function(e){return n(i*e)+a}}return{format:l,formatPrefix:c}}function Tv(e){return Sv=Ev(e),wv=Sv.format,Cv=Sv.formatPrefix,Sv}function Mv(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,pv(t)-pv(e))+1}function Ov(e){return Math.max(0,-pv(Math.abs(e)))}function Lv(e,t,n,r){var i,a=Op(e,t,n);switch(r=lv(null==r?",f":r),r.type){case"s":var o=Math.max(Math.abs(e),Math.abs(t));return null!=r.precision||isNaN(i=dv(a,o))||(r.precision=i),Cv(r,o);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=Mv(a,Math.max(Math.abs(e),Math.abs(t))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=Ov(a))||(r.precision=i-2*("%"===r.type));break}return wv(r)}function Pv(e){var t=e.domain;return e.ticks=function(e){var n=t();return Tp(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var r=t();return Lv(r[0],r[r.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var r,i=t(),a=0,o=i.length-1,s=i[a],u=i[o];return u<s&&(r=s,s=u,u=r,r=a,a=o,o=r),r=Mp(s,u,n),r>0?(s=Math.floor(s/r)*r,u=Math.ceil(u/r)*r,r=Mp(s,u,n)):r<0&&(s=Math.ceil(s*r)/r,u=Math.floor(u*r)/r,r=Mp(s,u,n)),r>0?(i[a]=Math.floor(s/r)*r,i[o]=Math.ceil(u/r)*r,t(i)):r<0&&(i[a]=Math.ceil(s*r)/r,i[o]=Math.floor(u*r)/r,t(i)),e},e}function Rv(){var e=ov($d,$d);return e.copy=function(){return iv(e,Rv())},Rd.apply(e,arguments),Pv(e)}function Iv(e,t){e=e.slice();var n,r=0,i=e.length-1,a=e[r],o=e[i];return o<a&&(n=r,r=i,i=n,n=a,a=o,o=n),e[r]=t.floor(a),e[i]=t.ceil(o),e}function Dv(e){return Math.log(e)}function zv(e){return Math.exp(e)}function Nv(e){return-Math.log(-e)}function Fv(e){return-Math.exp(-e)}function jv(e){return isFinite(e)?+("1e"+e):e<0?0:e}function Bv(e){return 10===e?jv:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}function Uv(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}function Vv(e){return function(t){return-e(-t)}}function Gv(e){var t,n,r=e(Dv,zv),i=r.domain,a=10;function o(){return t=Uv(a),n=Bv(a),i()[0]<0?(t=Vv(t),n=Vv(n),e(Nv,Fv)):e(Dv,zv),r}return r.base=function(e){return arguments.length?(a=+e,o()):a},r.domain=function(e){return arguments.length?(i(e),o()):i()},r.ticks=function(e){var r,o=i(),s=o[0],u=o[o.length-1];(r=u<s)&&(h=s,s=u,u=h);var l,c,f,h=t(s),p=t(u),d=null==e?10:+e,v=[];if(!(a%1)&&p-h<d){if(h=Math.round(h)-1,p=Math.round(p)+1,s>0){for(;h<p;++h)for(c=1,l=n(h);c<a;++c)if(f=l*c,!(f<s)){if(f>u)break;v.push(f)}}else for(;h<p;++h)for(c=a-1,l=n(h);c>=1;--c)if(f=l*c,!(f<s)){if(f>u)break;v.push(f)}}else v=Tp(h,p,Math.min(p-h,d)).map(n);return r?v.reverse():v},r.tickFormat=function(e,i){if(null==i&&(i=10===a?".0e":","),"function"!==typeof i&&(i=wv(i)),e===1/0)return i;null==e&&(e=10);var o=Math.max(1,a*e/r.ticks().length);return function(e){var r=e/n(Math.round(t(e)));return r*a<a-.5&&(r*=a),r<=o?i(e):""}},r.nice=function(){return i(Iv(i(),{floor:function(e){return n(Math.floor(t(e)))},ceil:function(e){return n(Math.ceil(t(e)))}}))},r}function Hv(){var e=Gv(av()).domain([1,10]);return e.copy=function(){return iv(e,Hv()).base(e.base())},Rd.apply(e,arguments),e}function Wv(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function Yv(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function qv(e){return e<0?-e*e:e*e}function Zv(e){var t=e($d,$d),n=1;function r(){return 1===n?e($d,$d):.5===n?e(Yv,qv):e(Wv(n),Wv(1/n))}return t.exponent=function(e){return arguments.length?(n=+e,r()):n},Pv(t)}function Kv(){var e=Zv(av());return e.copy=function(){return iv(e,Kv()).exponent(e.exponent())},Rd.apply(e,arguments),e}function Xv(){var e,t=[],n=[],r=[];function i(){var e=0,i=Math.max(1,n.length);r=new Array(i-1);while(++e<i)r[e-1]=Pp(t,e/i);return a}function a(t){return isNaN(t=+t)?e:n[Sp(r,t)]}return a.invertExtent=function(e){var i=n.indexOf(e);return i<0?[NaN,NaN]:[i>0?r[i-1]:t[0],i<r.length?r[i]:t[t.length-1]]},a.domain=function(e){if(!arguments.length)return t.slice();t=[];for(var n,r=0,a=e.length;r<a;++r)n=e[r],null==n||isNaN(n=+n)||t.push(n);return t.sort(mp),i()},a.range=function(e){return arguments.length?(n=Pd.call(e),i()):n.slice()},a.unknown=function(t){return arguments.length?(e=t,a):e},a.quantiles=function(){return r.slice()},a.copy=function(){return Xv().domain(t).range(n).unknown(e)},Rd.apply(a,arguments)}function Qv(){var e,t=0,n=1,r=1,i=[.5],a=[0,1];function o(t){return t<=t?a[Sp(i,t,0,r)]:e}function s(){var e=-1;i=new Array(r);while(++e<r)i[e]=((e+1)*n-(e-r)*t)/(r+1);return o}return o.domain=function(e){return arguments.length?(t=+e[0],n=+e[1],s()):[t,n]},o.range=function(e){return arguments.length?(r=(a=Pd.call(e)).length-1,s()):a.slice()},o.invertExtent=function(e){var o=a.indexOf(e);return o<0?[NaN,NaN]:o<1?[t,i[0]]:o>=r?[i[r-1],n]:[i[o-1],i[o]]},o.unknown=function(t){return arguments.length?(e=t,o):o},o.thresholds=function(){return i.slice()},o.copy=function(){return Qv().domain([t,n]).range(a).unknown(e)},Rd.apply(Pv(o),arguments)}function Jv(){var e,t=[.5],n=[0,1],r=1;function i(i){return i<=i?n[Sp(t,i,0,r)]:e}return i.domain=function(e){return arguments.length?(t=Pd.call(e),r=Math.min(t.length,n.length-1),i):t.slice()},i.range=function(e){return arguments.length?(n=Pd.call(e),r=Math.min(t.length,n.length-1),i):n.slice()},i.invertExtent=function(e){var r=n.indexOf(e);return[t[r-1],t[r]]},i.unknown=function(t){return arguments.length?(e=t,i):e},i.copy=function(){return Jv().domain(t).range(n).unknown(e)},Rd.apply(i,arguments)}Tv({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});var $v=new Date,eg=new Date;function tg(e,t,n,r){function i(t){return e(t=0===arguments.length?new Date:new Date(+t)),t}return i.floor=function(t){return e(t=new Date(+t)),t},i.ceil=function(n){return e(n=new Date(n-1)),t(n,1),e(n),n},i.round=function(e){var t=i(e),n=i.ceil(e);return e-t<n-e?t:n},i.offset=function(e,n){return t(e=new Date(+e),null==n?1:Math.floor(n)),e},i.range=function(n,r,a){var o,s=[];if(n=i.ceil(n),a=null==a?1:Math.floor(a),!(n<r)||!(a>0))return s;do{s.push(o=new Date(+n)),t(n,a),e(n)}while(o<n&&n<r);return s},i.filter=function(n){return tg((function(t){if(t>=t)while(e(t),!n(t))t.setTime(t-1)}),(function(e,r){if(e>=e)if(r<0)while(++r<=0)while(t(e,-1),!n(e));else while(--r>=0)while(t(e,1),!n(e));}))},n&&(i.count=function(t,r){return $v.setTime(+t),eg.setTime(+r),e($v),e(eg),Math.floor(n($v,eg))},i.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?i.filter(r?function(t){return r(t)%e===0}:function(t){return i.count(0,t)%e===0}):i:null}),i}var ng=tg((function(e){e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,t){e.setFullYear(e.getFullYear()+t)}),(function(e,t){return t.getFullYear()-e.getFullYear()}),(function(e){return e.getFullYear()}));ng.every=function(e){return isFinite(e=Math.floor(e))&&e>0?tg((function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,n){t.setFullYear(t.getFullYear()+n*e)})):null};var rg=ng,ig=(ng.range,tg((function(e){e.setDate(1),e.setHours(0,0,0,0)}),(function(e,t){e.setMonth(e.getMonth()+t)}),(function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())}),(function(e){return e.getMonth()}))),ag=ig,og=(ig.range,1e3),sg=6e4,ug=36e5,lg=864e5,cg=6048e5;function fg(e){return tg((function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+7*t)}),(function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*sg)/cg}))}var hg=fg(0),pg=fg(1),dg=fg(2),vg=fg(3),gg=fg(4),mg=fg(5),yg=fg(6),_g=(hg.range,pg.range,dg.range,vg.range,gg.range,mg.range,yg.range,tg((function(e){e.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+t)}),(function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*sg)/lg}),(function(e){return e.getDate()-1}))),xg=_g,bg=(_g.range,tg((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*og-e.getMinutes()*sg)}),(function(e,t){e.setTime(+e+t*ug)}),(function(e,t){return(t-e)/ug}),(function(e){return e.getHours()}))),Sg=bg,wg=(bg.range,tg((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*og)}),(function(e,t){e.setTime(+e+t*sg)}),(function(e,t){return(t-e)/sg}),(function(e){return e.getMinutes()}))),Cg=wg,kg=(wg.range,tg((function(e){e.setTime(e-e.getMilliseconds())}),(function(e,t){e.setTime(+e+t*og)}),(function(e,t){return(t-e)/og}),(function(e){return e.getUTCSeconds()}))),Ag=kg,Eg=(kg.range,tg((function(){}),(function(e,t){e.setTime(+e+t)}),(function(e,t){return t-e})));Eg.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?tg((function(t){t.setTime(Math.floor(t/e)*e)}),(function(t,n){t.setTime(+t+n*e)}),(function(t,n){return(n-t)/e})):Eg:null};var Tg=Eg;Eg.range;function Mg(e){return tg((function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+7*t)}),(function(e,t){return(t-e)/cg}))}var Og=Mg(0),Lg=Mg(1),Pg=Mg(2),Rg=Mg(3),Ig=Mg(4),Dg=Mg(5),zg=Mg(6),Ng=(Og.range,Lg.range,Pg.range,Rg.range,Ig.range,Dg.range,zg.range,tg((function(e){e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+t)}),(function(e,t){return(t-e)/lg}),(function(e){return e.getUTCDate()-1}))),Fg=Ng,jg=(Ng.range,tg((function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)}),(function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()}),(function(e){return e.getUTCFullYear()})));jg.every=function(e){return isFinite(e=Math.floor(e))&&e>0?tg((function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})):null};var Bg=jg;jg.range;function Ug(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Vg(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Gg(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function Hg(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,a=e.days,o=e.shortDays,s=e.months,u=e.shortMonths,l=$g(i),c=em(i),f=$g(a),h=em(a),p=$g(o),d=em(o),v=$g(s),g=em(s),m=$g(u),y=em(u),_={a:R,A:I,b:D,B:z,c:null,d:bm,e:bm,f:Am,g:Nm,G:jm,H:Sm,I:wm,j:Cm,L:km,m:Em,M:Tm,p:N,q:F,Q:uy,s:ly,S:Mm,u:Om,U:Lm,V:Rm,w:Im,W:Dm,x:null,X:null,y:zm,Y:Fm,Z:Bm,"%":sy},x={a:j,A:B,b:U,B:V,c:null,d:Um,e:Um,f:Ym,g:ry,G:ay,H:Vm,I:Gm,j:Hm,L:Wm,m:qm,M:Zm,p:G,q:H,Q:uy,s:ly,S:Km,u:Xm,U:Qm,V:$m,w:ey,W:ty,x:null,X:null,y:ny,Y:iy,Z:oy,"%":sy},b={a:A,A:E,b:T,B:M,c:O,d:fm,e:fm,f:mm,g:sm,G:om,H:pm,I:pm,j:hm,L:gm,m:cm,M:dm,p:k,q:lm,Q:_m,s:xm,S:vm,u:nm,U:rm,V:im,w:tm,W:am,x:L,X:P,y:sm,Y:om,Z:um,"%":ym};function S(e,t){return function(n){var r,i,a,o=[],s=-1,u=0,l=e.length;n instanceof Date||(n=new Date(+n));while(++s<l)37===e.charCodeAt(s)&&(o.push(e.slice(u,s)),null!=(i=qg[r=e.charAt(++s)])?r=e.charAt(++s):i="e"===r?" ":"0",(a=t[r])&&(r=a(n,i)),o.push(r),u=s+1);return o.push(e.slice(u,s)),o.join("")}}function w(e,t){return function(n){var r,i,a=Gg(1900,void 0,1),o=C(a,e,n+="",0);if(o!=n.length)return null;if("Q"in a)return new Date(a.Q);if("s"in a)return new Date(1e3*a.s+("L"in a?a.L:0));if(t&&!("Z"in a)&&(a.Z=0),"p"in a&&(a.H=a.H%12+12*a.p),void 0===a.m&&(a.m="q"in a?a.q:0),"V"in a){if(a.V<1||a.V>53)return null;"w"in a||(a.w=1),"Z"in a?(r=Vg(Gg(a.y,0,1)),i=r.getUTCDay(),r=i>4||0===i?Lg.ceil(r):Lg(r),r=Fg.offset(r,7*(a.V-1)),a.y=r.getUTCFullYear(),a.m=r.getUTCMonth(),a.d=r.getUTCDate()+(a.w+6)%7):(r=Ug(Gg(a.y,0,1)),i=r.getDay(),r=i>4||0===i?pg.ceil(r):pg(r),r=xg.offset(r,7*(a.V-1)),a.y=r.getFullYear(),a.m=r.getMonth(),a.d=r.getDate()+(a.w+6)%7)}else("W"in a||"U"in a)&&("w"in a||(a.w="u"in a?a.u%7:"W"in a?1:0),i="Z"in a?Vg(Gg(a.y,0,1)).getUTCDay():Ug(Gg(a.y,0,1)).getDay(),a.m=0,a.d="W"in a?(a.w+6)%7+7*a.W-(i+5)%7:a.w+7*a.U-(i+6)%7);return"Z"in a?(a.H+=a.Z/100|0,a.M+=a.Z%100,Vg(a)):Ug(a)}}function C(e,t,n,r){var i,a,o=0,s=t.length,u=n.length;while(o<s){if(r>=u)return-1;if(i=t.charCodeAt(o++),37===i){if(i=t.charAt(o++),a=b[i in qg?t.charAt(o++):i],!a||(r=a(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}function k(e,t,n){var r=l.exec(t.slice(n));return r?(e.p=c[r[0].toLowerCase()],n+r[0].length):-1}function A(e,t,n){var r=p.exec(t.slice(n));return r?(e.w=d[r[0].toLowerCase()],n+r[0].length):-1}function E(e,t,n){var r=f.exec(t.slice(n));return r?(e.w=h[r[0].toLowerCase()],n+r[0].length):-1}function T(e,t,n){var r=m.exec(t.slice(n));return r?(e.m=y[r[0].toLowerCase()],n+r[0].length):-1}function M(e,t,n){var r=v.exec(t.slice(n));return r?(e.m=g[r[0].toLowerCase()],n+r[0].length):-1}function O(e,n,r){return C(e,t,n,r)}function L(e,t,r){return C(e,n,t,r)}function P(e,t,n){return C(e,r,t,n)}function R(e){return o[e.getDay()]}function I(e){return a[e.getDay()]}function D(e){return u[e.getMonth()]}function z(e){return s[e.getMonth()]}function N(e){return i[+(e.getHours()>=12)]}function F(e){return 1+~~(e.getMonth()/3)}function j(e){return o[e.getUTCDay()]}function B(e){return a[e.getUTCDay()]}function U(e){return u[e.getUTCMonth()]}function V(e){return s[e.getUTCMonth()]}function G(e){return i[+(e.getUTCHours()>=12)]}function H(e){return 1+~~(e.getUTCMonth()/3)}return _.x=S(n,_),_.X=S(r,_),_.c=S(t,_),x.x=S(n,x),x.X=S(r,x),x.c=S(t,x),{format:function(e){var t=S(e+="",_);return t.toString=function(){return e},t},parse:function(e){var t=w(e+="",!1);return t.toString=function(){return e},t},utcFormat:function(e){var t=S(e+="",x);return t.toString=function(){return e},t},utcParse:function(e){var t=w(e+="",!0);return t.toString=function(){return e},t}}}var Wg,Yg,qg={"-":"",_:" ",0:"0"},Zg=/^\s*\d+/,Kg=/^%/,Xg=/[\\^$*+?|[\]().{}]/g;function Qg(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",a=i.length;return r+(a<n?new Array(n-a+1).join(t)+i:i)}function Jg(e){return e.replace(Xg,"\\$&")}function $g(e){return new RegExp("^(?:"+e.map(Jg).join("|")+")","i")}function em(e){var t={},n=-1,r=e.length;while(++n<r)t[e[n].toLowerCase()]=n;return t}function tm(e,t,n){var r=Zg.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function nm(e,t,n){var r=Zg.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function rm(e,t,n){var r=Zg.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function im(e,t,n){var r=Zg.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function am(e,t,n){var r=Zg.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function om(e,t,n){var r=Zg.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function sm(e,t,n){var r=Zg.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function um(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function lm(e,t,n){var r=Zg.exec(t.slice(n,n+1));return r?(e.q=3*r[0]-3,n+r[0].length):-1}function cm(e,t,n){var r=Zg.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function fm(e,t,n){var r=Zg.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function hm(e,t,n){var r=Zg.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function pm(e,t,n){var r=Zg.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function dm(e,t,n){var r=Zg.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function vm(e,t,n){var r=Zg.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function gm(e,t,n){var r=Zg.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function mm(e,t,n){var r=Zg.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function ym(e,t,n){var r=Kg.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function _m(e,t,n){var r=Zg.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function xm(e,t,n){var r=Zg.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function bm(e,t){return Qg(e.getDate(),t,2)}function Sm(e,t){return Qg(e.getHours(),t,2)}function wm(e,t){return Qg(e.getHours()%12||12,t,2)}function Cm(e,t){return Qg(1+xg.count(rg(e),e),t,3)}function km(e,t){return Qg(e.getMilliseconds(),t,3)}function Am(e,t){return km(e,t)+"000"}function Em(e,t){return Qg(e.getMonth()+1,t,2)}function Tm(e,t){return Qg(e.getMinutes(),t,2)}function Mm(e,t){return Qg(e.getSeconds(),t,2)}function Om(e){var t=e.getDay();return 0===t?7:t}function Lm(e,t){return Qg(hg.count(rg(e)-1,e),t,2)}function Pm(e){var t=e.getDay();return t>=4||0===t?gg(e):gg.ceil(e)}function Rm(e,t){return e=Pm(e),Qg(gg.count(rg(e),e)+(4===rg(e).getDay()),t,2)}function Im(e){return e.getDay()}function Dm(e,t){return Qg(pg.count(rg(e)-1,e),t,2)}function zm(e,t){return Qg(e.getFullYear()%100,t,2)}function Nm(e,t){return e=Pm(e),Qg(e.getFullYear()%100,t,2)}function Fm(e,t){return Qg(e.getFullYear()%1e4,t,4)}function jm(e,t){var n=e.getDay();return e=n>=4||0===n?gg(e):gg.ceil(e),Qg(e.getFullYear()%1e4,t,4)}function Bm(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Qg(t/60|0,"0",2)+Qg(t%60,"0",2)}function Um(e,t){return Qg(e.getUTCDate(),t,2)}function Vm(e,t){return Qg(e.getUTCHours(),t,2)}function Gm(e,t){return Qg(e.getUTCHours()%12||12,t,2)}function Hm(e,t){return Qg(1+Fg.count(Bg(e),e),t,3)}function Wm(e,t){return Qg(e.getUTCMilliseconds(),t,3)}function Ym(e,t){return Wm(e,t)+"000"}function qm(e,t){return Qg(e.getUTCMonth()+1,t,2)}function Zm(e,t){return Qg(e.getUTCMinutes(),t,2)}function Km(e,t){return Qg(e.getUTCSeconds(),t,2)}function Xm(e){var t=e.getUTCDay();return 0===t?7:t}function Qm(e,t){return Qg(Og.count(Bg(e)-1,e),t,2)}function Jm(e){var t=e.getUTCDay();return t>=4||0===t?Ig(e):Ig.ceil(e)}function $m(e,t){return e=Jm(e),Qg(Ig.count(Bg(e),e)+(4===Bg(e).getUTCDay()),t,2)}function ey(e){return e.getUTCDay()}function ty(e,t){return Qg(Lg.count(Bg(e)-1,e),t,2)}function ny(e,t){return Qg(e.getUTCFullYear()%100,t,2)}function ry(e,t){return e=Jm(e),Qg(e.getUTCFullYear()%100,t,2)}function iy(e,t){return Qg(e.getUTCFullYear()%1e4,t,4)}function ay(e,t){var n=e.getUTCDay();return e=n>=4||0===n?Ig(e):Ig.ceil(e),Qg(e.getUTCFullYear()%1e4,t,4)}function oy(){return"+0000"}function sy(){return"%"}function uy(e){return+e}function ly(e){return Math.floor(+e/1e3)}function cy(e){return Wg=Hg(e),Yg=Wg.format,Wg.parse,Wg.utcFormat,Wg.utcParse,Wg}cy({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var fy,hy,py,dy=1e3,vy=60*dy,gy=60*vy,yy=24*gy,_y=7*yy,xy=30*yy,by=365*yy;function Sy(e){return new Date(e)}function wy(e){return e instanceof Date?+e:+new Date(+e)}function Cy(e,t,n,r,i,a,o,s,u){var l=ov($d,$d),c=l.invert,f=l.domain,h=u(".%L"),p=u(":%S"),d=u("%I:%M"),v=u("%I %p"),g=u("%a %d"),m=u("%b %d"),y=u("%B"),_=u("%Y"),x=[[o,1,dy],[o,5,5*dy],[o,15,15*dy],[o,30,30*dy],[a,1,vy],[a,5,5*vy],[a,15,15*vy],[a,30,30*vy],[i,1,gy],[i,3,3*gy],[i,6,6*gy],[i,12,12*gy],[r,1,yy],[r,2,2*yy],[n,1,_y],[t,1,xy],[t,3,3*xy],[e,1,by]];function b(s){return(o(s)<s?h:a(s)<s?p:i(s)<s?d:r(s)<s?v:t(s)<s?n(s)<s?g:m:e(s)<s?y:_)(s)}function S(t,n,r,i){if(null==t&&(t=10),"number"===typeof t){var a=Math.abs(r-n)/t,o=yp((function(e){return e[2]})).right(x,a);o===x.length?(i=Op(n/by,r/by,t),t=e):o?(o=x[a/x[o-1][2]<x[o][2]/a?o-1:o],i=o[1],t=o[0]):(i=Math.max(Op(n,r,t),1),t=s)}return null==i?t:t.every(i)}return l.invert=function(e){return new Date(c(e))},l.domain=function(e){return arguments.length?f(Ld.call(e,wy)):f().map(Sy)},l.ticks=function(e,t){var n,r=f(),i=r[0],a=r[r.length-1],o=a<i;return o&&(n=i,i=a,a=n),n=S(e,i,a,t),n=n?n.range(i,a+1):[],o?n.reverse():n},l.tickFormat=function(e,t){return null==t?b:u(t)},l.nice=function(e,t){var n=f();return(e=S(e,n[0],n[n.length-1],t))?f(Iv(n,e)):l},l.copy=function(){return iv(l,Cy(e,t,n,r,i,a,o,s,u))},l}function ky(){return Rd.apply(Cy(rg,ag,hg,xg,Sg,Cg,Ag,Tg,Yg).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function Ay(){var e,t,n,r,i,a=0,o=1,s=$d,u=!1;function l(t){return isNaN(t=+t)?i:s(0===n?.5:(t=(r(t)-e)*n,u?Math.max(0,Math.min(1,t)):t))}return l.domain=function(i){return arguments.length?(e=r(a=+i[0]),t=r(o=+i[1]),n=e===t?0:1/(t-e),l):[a,o]},l.clamp=function(e){return arguments.length?(u=!!e,l):u},l.interpolator=function(e){return arguments.length?(s=e,l):s},l.unknown=function(e){return arguments.length?(i=e,l):i},function(i){return r=i,e=i(a),t=i(o),n=e===t?0:1/(t-e),l}}function Ey(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function Ty(){var e=Pv(Ay()($d));return e.copy=function(){return Ey(e,Ty())},Id.apply(e,arguments)}function My(){var e,t,n,r,i,a,o,s=0,u=.5,l=1,c=$d,f=!1;function h(e){return isNaN(e=+e)?o:(e=.5+((e=+a(e))-t)*(e<t?r:i),c(f?Math.max(0,Math.min(1,e)):e))}return h.domain=function(o){return arguments.length?(e=a(s=+o[0]),t=a(u=+o[1]),n=a(l=+o[2]),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),h):[s,u,l]},h.clamp=function(e){return arguments.length?(f=!!e,h):f},h.interpolator=function(e){return arguments.length?(c=e,h):c},h.unknown=function(e){return arguments.length?(o=e,h):o},function(o){return a=o,e=o(s),t=o(u),n=o(l),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),h}}function Oy(){var e=Pv(My()($d));return e.copy=function(){return Ey(e,Oy())},Id.apply(e,arguments)}function Ly(e){var t,n=[];function r(e){return null==e?t:e}return r.invert=r,r.domain=r.range=function(e){return e?(n=e,e):n},r.unknown=function(e){return e?(t=e,e):t},r.copy=function(){return Ly(e).unknown(t)},r}var Py,Ry,Iy,Dy,zy=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,Ny=(fy={},Ri(fy,yt.vY.LINEAR,Rv),Ri(fy,yt.vY.POWER,Kv),Ri(fy,yt.vY.LOG,Hv),Ri(fy,yt.vY.IDENTITY,Ly),Ri(fy,yt.vY.SEQUENTIAL,Ty),Ri(fy,yt.vY.TIME,ky),Ri(fy,yt.vY.QUANTILE,Xv),Ri(fy,yt.vY.QUANTIZE,Qv),Ri(fy,yt.vY.THRESHOLD,Jv),Ri(fy,yt.vY.CAT,zd),Ri(fy,yt.vY.DIVERGING,Oy),fy),Fy=(hy=(0,zs.b2)(),hy(py=function(){function e(){Si(this,e),Ri(this,"scaleOptions",{})}return Ei(e,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tapPromise("FeatureScalePlugin",bi(zi().mark((function t(){var i,a,o;return zi().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.log(yt.Or.ScaleInitStart,yt.KD.INIT),n.scaleOptions=e.getScaleOptions(),a=r.getLayerStyleAttributes(),o=null===(i=e.getSource())||void 0===i?void 0:i.data.dataArray,!Array.isArray(o)||0!==o.length){t.next=8;break}return t.abrupt("return");case 8:n.caculateScalesForAttributes(a||[],o);case 9:e.log(yt.Or.ScaleInitEnd,yt.KD.INIT);case 10:case"end":return t.stop()}}),t)})))),e.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",function(){var t=bi(zi().mark((function t(i){var a,o;return zi().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(i){t.next=2;break}return t.abrupt("return",i);case 2:if(e.log(yt.Or.ScaleInitStart,yt.KD.UPDATE),n.scaleOptions=e.getScaleOptions(),a=r.getLayerStyleAttributes(),o=e.getSource().data.dataArray,!Array.isArray(o)||0!==o.length){t.next=8;break}return t.abrupt("return",!0);case 8:return n.caculateScalesForAttributes(a||[],o),e.log(yt.Or.ScaleInitEnd,yt.KD.UPDATE),e.layerModelNeedUpdate=!0,t.abrupt("return",!0);case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),e.hooks.beforeRender.tap("FeatureScalePlugin",(function(){if(!e.layerModelNeedUpdate){n.scaleOptions=e.getScaleOptions();var t=r.getLayerStyleAttributes(),i=e.getSource().data.dataArray;if((!Array.isArray(i)||0!==i.length)&&t){var a=t.filter((function(e){return e.needRescale}));a.length&&n.caculateScalesForAttributes(a,i)}}}))}},{key:"isNumber",value:function(e){return!isNaN(parseFloat(e))&&isFinite(e)}},{key:"caculateScalesForAttributes",value:function(e,t){var n=this;e.forEach((function(e){if(e.scale){var r=e.scale;r.names=n.parseFields(e.scale.field||[]);var i=[];r.names.forEach((function(r){var a;i.push(n.createScale(r,e.name,null===(a=e.scale)||void 0===a?void 0:a.values,t))})),i.some((function(e){return e.type===yt.ee.VARIABLE}))?(r.type=yt.ee.VARIABLE,i.forEach((function(e){var t,n;if(!r.callback&&"text"!==r.values)switch(null===(t=e.option)||void 0===t?void 0:t.type){case yt.vY.LOG:case yt.vY.LINEAR:case yt.vY.POWER:if(r.values&&r.values.length>2){var i=e.scale.ticks(r.values.length);e.scale.domain(i)}r.values?e.scale.range(r.values):e.scale.range(e.option.domain);break;case yt.vY.QUANTILE:case yt.vY.QUANTIZE:case yt.vY.THRESHOLD:e.scale.range(r.values);break;case yt.vY.IDENTITY:break;case yt.vY.CAT:r.values?e.scale.range(r.values):e.scale.range(e.option.domain);break;case yt.vY.DIVERGING:case yt.vY.SEQUENTIAL:e.scale.interpolator(Sd(r.values));break}"text"===r.values&&e.scale.range(null===(n=e.option)||void 0===n?void 0:n.domain)}))):(r.type=yt.ee.CONSTANT,r.defaultValues=i.map((function(e,t){return e.scale(r.names[t])}))),r.scalers=i.map((function(e){return{field:e.field,func:e.scale,option:e.option}})),e.needRescale=!1}}))}},{key:"parseFields",value:function(e){return Array.isArray(e)?e:(0,Zt.isString)(e)?e.split("*"):[e]}},{key:"createScale",value:function(e,t,n,r){var i,a,o=this.scaleOptions[t]&&(null===(i=this.scaleOptions[t])||void 0===i?void 0:i.field)===e?this.scaleOptions[t]:this.scaleOptions[e],s={field:e,scale:void 0,type:yt.ee.VARIABLE,option:o};if(!r||!r.length)return o&&o.type?s.scale=this.createDefaultScale(o):(s.scale=zd([e]),s.type=yt.ee.CONSTANT),s;var u=null===(a=r.find((function(t){return!(0,Zt.isNil)(t[e])})))||void 0===a?void 0:a[e];if(this.isNumber(e)||(0,Zt.isNil)(u)&&!o)s.scale=zd([e]),s.type=yt.ee.CONSTANT;else{var l=o&&o.type||this.getDefaultType(u);"text"===n&&(l=yt.vY.CAT);var c=this.createScaleConfig(l,e,o,r);s.scale=this.createDefaultScale(c),s.option=c}return s}},{key:"getDefaultType",value:function(e){var t=yt.vY.LINEAR;return"string"===typeof e&&(t=zy.test(e)?yt.vY.TIME:yt.vY.CAT),t}},{key:"createScaleConfig",value:function(e,t,n,r){var i={type:e},a=(null===r||void 0===r?void 0:r.map((function(e){return e[t]})))||[];if(null!==n&&void 0!==n&&n.domain)i.domain=null===n||void 0===n?void 0:n.domain;else if(e===yt.vY.CAT||e===yt.vY.IDENTITY)i.domain=(0,Zt.uniq)(a);else if(e===yt.vY.QUANTILE)i.domain=a;else if(e===yt.vY.DIVERGING){var o=wp(a),s=void 0!==(null===n||void 0===n?void 0:n.neutral)?null===n||void 0===n?void 0:n.neutral:(o[0]+o[1])/2;i.domain=[o[0],s,o[1]]}else i.domain=wp(a);return Yi(Yi({},i),n)}},{key:"createDefaultScale",value:function(e){var t=e.type,n=e.domain,r=e.unknown,i=e.clamp,a=e.nice,o=Ny[t]();return n&&o.domain&&o.domain(n),r&&o.unknown(r),void 0!==i&&o.clamp&&o.clamp(i),void 0!==a&&o.nice&&o.nice(a),o}}]),e}())||py),jy=(Py=(0,zs.b2)(),Py(Ry=function(){function e(){Si(this,e)}return Ei(e,[{key:"apply",value:function(e){e.hooks.beforeRender.tap("LayerAnimateStylePlugin",(function(){var t=e.animateStatus;t&&e.models.forEach((function(t){t.addUniforms(Yi({},e.layerModel.getAnimateUniforms()))}))}))}}]),e}())||Ry),By=(Iy=(0,zs.b2)(),Iy(Dy=function(){function e(){Si(this,e)}return Ei(e,[{key:"apply",value:function(e){e.hooks.afterInit.tap("LayerMaskPlugin",(function(){var t,n=e.getLayerConfig(),r=n.maskLayers,i=n.enableMask;!e.tileLayer&&r&&r.length>0&&((t=e.masks).push.apply(t,Vi(r)),e.updateLayerConfig({mask:i}))}))}}]),e}())||Dy),Uy=function(){function e(t){var n=t.rendererService,r=t.layerService,i=t.parent;Si(this,e),Ri(this,"tileResource",new Map),Ri(this,"layerTiles",[]),this.rendererService=n,this.layerService=r,this.parent=i}return Ei(e,[{key:"tiles",get:function(){return this.layerTiles}},{key:"hasTile",value:function(e){return this.layerTiles.some((function(t){return t.key===e}))}},{key:"addTile",value:function(e){this.layerTiles.push(e)}},{key:"getTile",value:function(e){return this.layerTiles.find((function(t){return t.key===e}))}},{key:"getVisibleTileBylngLat",value:function(e){return this.layerTiles.find((function(t){return t.isLoaded&&t.visible&&t.lnglatInBounds(e)}))}},{key:"removeTile",value:function(e){var t=this.layerTiles.findIndex((function(t){return t.key===e})),n=this.layerTiles.splice(t,1);n[0]&&n[0].destroy()}},{key:"updateTileVisible",value:function(e){var t=this.getTile(e.key);null===t||void 0===t||t.updateVisible(e.isVisible)}},{key:"isParentLoaded",value:function(e){var t=e.parent;if(!t)return!0;var n=this.getTile(null===t||void 0===t?void 0:t.key);return!(null===n||void 0===n||!n.isLoaded)}},{key:"isChildrenLoaded",value:function(e){var t=this,n=null===e||void 0===e?void 0:e.children;return 0===n.length||n.some((function(e){var n=t.getTile(null===e||void 0===e?void 0:e.key);return!1===(null===n||void 0===n?void 0:n.isLoaded)}))}},{key:"render",value:function(){var e=bi(zi().mark((function e(){var t,n,r=this;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.getRenderLayers(),n=t.map(function(){var e=bi(zi().mark((function e(t){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,r.layerService.renderTileLayer(t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=4,Promise.all(n);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getRenderLayers",value:function(){var e=this.layerTiles.filter((function(e){return e.visible&&e.isLoaded})),t=[];return e.map((function(e){return t.push.apply(t,Vi(e.getLayers()))})),t}},{key:"getLayers",value:function(){var e=this.layerTiles.filter((function(e){return e.isLoaded})),t=[];return e.map((function(e){return t.push.apply(t,Vi(e.getLayers()))})),t}},{key:"getTiles",value:function(){return this.layerTiles}},{key:"destroy",value:function(){this.layerTiles.forEach((function(e){return e.destroy()})),this.tileResource.clear()}}]),e}(),Vy=n(12888);function Gy(e,t,n){void 0===n&&(n={});var r=j(e),i=j(t),a=Vy.union(r.coordinates,i.coordinates);return 0===a.length?null:1===a.length?(0,N.yu)(a[0],n.properties):(0,N.tw)(a,n.properties)}var Hy=Gy,Wy=function(){function e(){Si(this,e)}return Ei(e,[{key:"getCombineFeature",value:function(e){var t=null,n=e[0];return e.map((function(e){var n=N.yu(e.coordinates);t=null===t?n:Hy(t,n)})),n&&(t.properties=Yi({},n)),t}}]),e}(),Yy="select",qy="active",Zy=function(){function e(t){var n=t.layerService,r=t.tileLayerService,i=t.parent;Si(this,e),Ri(this,"tilePickID",new Map),this.layerService=n,this.tileLayerService=r,this.parent=i,this.tileSourceService=new Wy}return Ei(e,[{key:"pickRender",value:function(e){var t=this.tileLayerService.getVisibleTileBylngLat(e.lngLat);if(t){var n=t.getMainLayer();null===n||void 0===n||n.layerPickService.pickRender(e)}}},{key:"pick",value:function(e,t){var n=this.parent.getContainer(),r=n.get(yt.vK.IPickingService);if("RasterLayer"===e.type){var i=this.tileLayerService.getVisibleTileBylngLat(t.lngLat);if(i&&void 0!==i.getMainLayer()){var a=i.getMainLayer();return a.layerPickService.pickRasterLayer(a,t,this.parent)}return!1}return this.pickRender(t),r.pickFromPickingFBO(e,t)}},{key:"selectFeature",value:function(e){var t=sa(e,3),n=t[0],r=t[1],i=t[2],a=this.color2PickId(n,r,i);this.tilePickID.set(Yy,a),this.updateHighLight(n,r,i,Yy)}},{key:"highlightPickedFeature",value:function(e){var t=sa(e,3),n=t[0],r=t[1],i=t[2],a=this.color2PickId(n,r,i);this.tilePickID.set(qy,a),this.updateHighLight(n,r,i,qy)}},{key:"updateHighLight",value:function(e,t,n,r){this.tileLayerService.tiles.map((function(i){var a=i.getMainLayer();switch(r){case Yy:null===a||void 0===a||a.hooks.beforeSelect.call([e,t,n]);break;case qy:null===a||void 0===a||a.hooks.beforeHighlight.call([e,t,n]);break}}))}},{key:"setPickState",value:function(){var e=this.tilePickID.get(Yy),t=this.tilePickID.get(qy);if(e){var n=this.pickId2Color(e),r=sa(n,3),i=r[0],a=r[1],o=r[2];this.updateHighLight(i,a,o,Yy)}else if(t){var s=this.pickId2Color(t),u=sa(s,3),l=u[0],c=u[1],f=u[2];this.updateHighLight(l,c,f,qy)}else;}},{key:"color2PickId",value:function(e,t,n){return(0,Ue.W0)(new Uint8Array([e,t,n]))}},{key:"pickId2Color",value:function(e){return(0,Ue.Z6)(e)}},{key:"getFeatureById",value:function(e){var t=this.tileLayerService.getTiles().filter((function(e){return e.visible})),n=[];return t.forEach((function(t){n.push.apply(n,Vi(t.getFeatureById(e)))})),n}},{key:"pickRasterLayer",value:function(e,t,n){return!1}}]),e}(),Ky=["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive","disableMask","enableMask"];function Xy(e){return"PolygonLayer"===e?Lf:"LineLayer"===e?kl:$c}function Qy(e){return-1!==["PolygonLayer","LineLayer"].indexOf(e)}var Jy=function(){function e(t,n){Si(this,e),Ri(this,"visible",!0),Ri(this,"layers",[]),Ri(this,"isLoaded",!1),Ri(this,"tileMaskLayers",[]),this.parent=n,this.sourceTile=t,this.x=t.x,this.y=t.y,this.z=t.z,this.key="".concat(this.x,"_").concat(this.y,"_").concat(this.z)}return Ei(e,[{key:"getLayers",value:function(){return this.layers}},{key:"styleUpdate",value:function(){}},{key:"lnglatInBounds",value:function(e){var t=sa(this.sourceTile.bounds,4),n=t[0],r=t[1],i=t[2],a=t[3],o=e.lng,s=e.lat;return o>=n&&o<=i&&s>=r&&s<=a}},{key:"getLayerOptions",value:function(){var e,t=this.parent.getLayerConfig();return Yi(Yi({},t),{},{textAllowOverlap:!0,autoFit:!1,maskLayers:this.getMaskLayer(),tileMask:Qy(this.parent.type),mask:t.mask||0!==(null===(e=t.maskLayers)||void 0===e?void 0:e.length)&&t.enableMask})}},{key:"getMaskLayer",value:function(){var e=this,t=this.parent.getLayerConfig(),n=t.maskLayers,r=[];return null===n||void 0===n||n.forEach((function(t){if(!t.tileLayer)return r.push(t),t;var n=t.tileLayer,i=n.getTile(e.sourceTile.key),a=null===i||void 0===i?void 0:i.getLayers()[0];a&&r.push(a)})),r}},{key:"addTileMask",value:function(){var e=bi(zi().mark((function e(){var t,n,r;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=new Lf({visible:!1,enablePicking:!1}).source({type:"FeatureCollection",features:[this.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}).shape("fill"),n=(0,yt.e7)(this.parent.sceneContainer),t.setContainer(n,this.parent.sceneContainer),e.next=5,t.init();case 5:return this.tileMask=t,r=this.getMainLayer(),void 0!==r&&(r.tileMask=t),e.abrupt("return",t);case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"addMask",value:function(){var e=bi(zi().mark((function e(t,n){var r;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=(0,yt.e7)(this.parent.sceneContainer),n.setContainer(r,this.parent.sceneContainer),e.next=4,n.init();case 4:t.addMask(n),this.tileMaskLayers.push(n);case 6:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"addLayer",value:function(){var e=bi(zi().mark((function e(t){var n;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.isTileLayer=!0,n=(0,yt.e7)(this.parent.sceneContainer),t.setContainer(n,this.parent.sceneContainer),this.layers.push(t),e.next=6,t.init();case 6:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"updateVisible",value:function(e){this.visible=e,this.updateOptions("visible",e)}},{key:"updateOptions",value:function(e,t){this.layers.forEach((function(n){n.updateLayerConfig(Ri({},e,t))}))}},{key:"getMainLayer",value:function(){return this.layers[0]}},{key:"getFeatures",value:function(e){return[]}},{key:"getFeatureById",value:function(e){return[]}},{key:"destroy",value:function(){var e;null===(e=this.tileMask)||void 0===e||e.destroy(),this.layers.forEach((function(e){return e.destroy()}))}}]),e}();function $y(e){var t=e_();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function e_(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var t_=function(e){Oi(n,e);var t=$y(n);function n(){return Si(this,n),t.apply(this,arguments)}return Ei(n,[{key:"initTileLayer",value:function(){var e=bi(zi().mark((function e(){var t,n,r,i;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.getSourceOption(),n=t.data.features[0].properties,r=(new kl).source(t.data,t.options).size(1).shape("line").color("red"),i=new $c({minZoom:this.z-1,maxZoom:this.z+1,textAllowOverlap:!0}).source([n],{parser:{type:"json",x:"x",y:"y"}}).size(20).color("red").shape(this.key).style({stroke:"#fff",strokeWidth:2}),e.next=6,this.addLayer(r);case 6:return e.next=8,this.addLayer(i);case 8:this.isLoaded=!0;case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var e=this.parent.getSource(),t=this.sourceTile.data.layers.testTile.features;return{data:{type:"FeatureCollection",features:t},options:{parser:{type:"geojson"},transforms:e.transforms}}}}]),n}(Jy);function n_(e){var t=r_();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function r_(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var i_=function(e){Oi(n,e);var t=n_(n);function n(){return Si(this,n),t.apply(this,arguments)}return Ei(n,[{key:"initTileLayer",value:function(){var e=bi(zi().mark((function e(){var t,n,r,i;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=new hu(Yi({},n)).source(r.data,r.options),t&&Object.keys(t).forEach((function(e){var n,r,a=e;i[a](null===(n=t[a])||void 0===n?void 0:n.field,null===(r=t[a])||void 0===r?void 0:r.values)})),e.next=7,this.addLayer(i);case 7:this.isLoaded=!0;case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var e=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:e.transforms}}}}]),n}(Jy);function a_(e){var t=o_();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function o_(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var s_=function(e){Oi(n,e);var t=a_(n);function n(){return Si(this,n),t.apply(this,arguments)}return Ei(n,[{key:"initTileLayer",value:function(){var e=bi(zi().mark((function e(){var t,n,r,i;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=new Ph(Yi({},n)).source(r.data,r.options),t&&Object.keys(t).forEach((function(e){var n,r,a=e;i[a](null===(n=t[a])||void 0===n?void 0:n.field,null===(r=t[a])||void 0===r?void 0:r.values)})),e.next=7,this.addLayer(i);case 7:this.isLoaded=!0;case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getFeatures",value:function(e){if(!e)return[];var t=this.sourceTile.data;return t.getTileData(e)}},{key:"getSourceOption",value:function(){var e=this.parent.getSource(),t=this.parent.getLayerConfig(),n=t.sourceLayer,r=t.featureId,i=this.getFeatures(n);return{data:{type:"FeatureCollection",features:i},options:{parser:{type:"geojson",featureId:r},transforms:e.transforms}}}}]),n}(Jy),u_=["rasterData"];function l_(e){var t=c_();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function c_(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var f_=function(e){Oi(n,e);var t=l_(n);function n(){return Si(this,n),t.apply(this,arguments)}return Ei(n,[{key:"initTileLayer",value:function(){var e=bi(zi().mark((function e(){var t,n,r,i;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=new $f(Yi({},n)).source(r.data,r.options),t&&Object.keys(t).forEach((function(e){var n,r,a=e;i[a](null===(n=t[a])||void 0===n?void 0:n.field,null===(r=t[a])||void 0===r?void 0:r.values)})),e.next=7,this.addLayer(i);case 7:this.isLoaded=!0;case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var e=this.parent.getSource(),t=this.sourceTile.data.data,n=t.rasterData,r=Hi(t,u_);return{data:n,options:{parser:Yi({type:"rasterRgb",extent:this.sourceTile.bounds},r),transforms:e.transforms}}}}]),n}(Jy);function h_(e){var t=p_();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function p_(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var d_=function(e){Oi(n,e);var t=h_(n);function n(){return Si(this,n),t.apply(this,arguments)}return Ei(n,[{key:"initTileLayer",value:function(){var e=bi(zi().mark((function e(){var t,n,r,i;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=new $f(Yi({},n)).source(r.data,r.options),t&&Object.keys(t).forEach((function(e){var n,r,a=e;i[a](null===(n=t[a])||void 0===n?void 0:n.field,null===(r=t[a])||void 0===r?void 0:r.values)})),e.next=7,this.addLayer(i);case 7:this.isLoaded=!0;case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var e=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:e.transforms}}}}]),n}(Jy),v_=["rasterData"];function g_(e){var t=m_();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function m_(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var y_={positions:[0,1],colors:["#000","#fff"]},__=function(e){Oi(n,e);var t=g_(n);function n(){return Si(this,n),t.apply(this,arguments)}return Ei(n,[{key:"initTileLayer",value:function(){var e=bi(zi().mark((function e(){var t,n,r,i,a,o,s;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=this.getLayerOptions(),a=i.rampColors,o=i.domain,this.colorTexture=this.parent.textureService.getColorTexture(a,o),s=new $f(Yi(Yi({},n),{},{colorTexture:this.colorTexture})).source(r.data,r.options),t&&Object.keys(t).forEach((function(e){var n,r,i=e;s[i](null===(n=t[i])||void 0===n?void 0:n.field,null===(r=t[i])||void 0===r?void 0:r.values)})),e.next=9,this.addLayer(s);case 9:this.isLoaded=!0;case 10:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var e=this.parent.getSource(),t=this.sourceTile.data.data,n=t.rasterData,r=Hi(t,v_);return{data:n,options:{parser:Yi({type:"raster",extent:this.sourceTile.bounds},r),transforms:e.transforms}}}},{key:"styleUpdate",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=n,a=i.rampColors,o=void 0===a?y_:a,s=i.domain;this.colorTexture=this.parent.textureService.getColorTexture(o,s||(0,Ue.ZB)(o)),this.layers.forEach((function(t){return t.style({colorTexture:e.colorTexture})}))}},{key:"destroy",value:function(){this.layers.forEach((function(e){return e.destroy()}))}}]),n}(Jy);function x_(e){var t=b_();return function(){var n,r=Pi(e);if(t){var i=Pi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function b_(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var S_=function(e){Oi(n,e);var t=x_(n);function n(){return Si(this,n),t.apply(this,arguments)}return Ei(n,[{key:"initTileLayer",value:function(){var e=bi(zi().mark((function e(){var t,n,r,i,a;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=Xy(this.parent.type),i=this.getSourceOption(),i){e.next=7;break}return this.isLoaded=!0,e.abrupt("return");case 7:return a=new r(Yi({},n)).source(i.data,i.options),Object.keys(t).forEach((function(e){var n,r,i=e;a[i](null===(n=t[i])||void 0===n?void 0:n.field,null===(r=t[i])||void 0===r?void 0:r.values)})),e.next=11,this.addLayer(a);case 11:if(!n.tileMask){e.next=14;break}return e.next=14,this.addTileMask();case 14:this.setLayerMinMaxZoom(a),this.isLoaded=!0;case 16:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var e=this.parent.getSource(),t=this.parent.getLayerConfig(),n=t.sourceLayer,r=void 0===n?"defaultLayer":n,i=t.featureId,a=void 0===i?"id":i,o=this.getFeatures(r);return{data:{type:"FeatureCollection",features:o},options:{parser:{type:"geojson",featureId:a},transforms:e.transforms}}}},{key:"setLayerMinMaxZoom",value:function(e){"text"===e.getModelType()&&e.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}},{key:"getFeatures",value:function(e){var t=this.sourceTile.data;return t.getTileData(e)}},{key:"getFeatureById",value:function(e){var t=this.getMainLayer();if(!t)return[];var n=t.getSource().data.dataArray.filter((function(t){return t._id===e}));return n}}]),n}(Jy);function w_(e){var t=e.type;switch(t){case"PolygonLayer":return S_;case"LineLayer":return S_;case"PointLayer":return S_;case"TileDebugLayer":return t_;case"MaskLayer":return s_;case"RasterLayer":var n=e.getSource().parser.dataType;switch(n){case yt.n3.RGB:case yt.n3.CUSTOMRGB:return f_;case yt.n3.ARRAYBUFFER:case yt.n3.CUSTOMARRAYBUFFER:return __;case yt.n3.TERRAINRGB:case yt.n3.CUSTOMTERRAINRGB:return d_;default:return i_}default:return S_}}var C_,k_,A_,E_,T_,M_,O_=function(){function e(t){var n=this;Si(this,e),Ri(this,"initedTileset",!1),Ri(this,"mapchange",(function(){var e,t=n.getCurrentView(),r=t.latLonBounds,i=t.zoom;if("GAODE1.x"===n.mapService.version){var a=n.parent.getLayerConfig(),o=a.visible;i<2&&o?(n.parent.updateLayerConfig({visible:!1}),n.layerService.reRender()):i>=2&&!o&&(n.parent.updateLayerConfig({visible:!0}),n.layerService.reRender())}n.lastViewStates&&n.lastViewStates.zoom===i&&n.lastViewStates.latLonBounds.toString()===r.toString()||(n.lastViewStates={zoom:i,latLonBounds:r},null===(e=n.tilesetManager)||void 0===e||e.throttleUpdate(i,r))})),Ri(this,"viewchange",(0,Zt.debounce)(this.mapchange,24)),this.parent=t;var r=this.parent.getContainer();this.rendererService=r.get(yt.vK.IRendererService),this.layerService=r.get(yt.vK.ILayerService),this.mapService=r.get(yt.vK.IMapService),this.pickingService=r.get(yt.vK.IPickingService),this.tileLayerService=new Uy({rendererService:this.rendererService,layerService:this.layerService,parent:t}),this.tilePickService=new Zy({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:t}),this.parent.setLayerPickService(this.tilePickService),this.proxy(t),this.initTileSetManager()}return Ei(e,[{key:"initTileSetManager",value:function(){var e,t=this.parent.getSource();this.tilesetManager=t.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0);var n=this.getCurrentView(),r=n.latLonBounds,i=n.zoom;null===(e=this.tilesetManager)||void 0===e||e.update(i,r)}},{key:"getCurrentView",value:function(){var e=this.mapService.getBounds(),t=[e[0][0],e[0][1],e[1][0],e[1][1]],n=this.mapService.getZoom();return{latLonBounds:t,zoom:n}}},{key:"bindTilesetEvent",value:function(){var e=this;this.tilesetManager.on("tile-loaded",(function(e){})),this.tilesetManager.on("tile-unload",(function(t){e.tileUnLoad(t)})),this.tilesetManager.on("tile-error",(function(t,n){e.tileError(t)})),this.tilesetManager.on("tile-update",(function(){e.tileUpdate()})),this.mapService.on("zoomend",this.mapchange),this.mapService.on("moveend",this.viewchange)}},{key:"render",value:function(){this.tileLayerService.render()}},{key:"getLayers",value:function(){return this.tileLayerService.getLayers()}},{key:"getTiles",value:function(){return this.tileLayerService.getTiles()}},{key:"getTile",value:function(e){return this.tileLayerService.getTile(e)}},{key:"tileLoaded",value:function(e){}},{key:"tileError",value:function(e){console.warn("error:",e)}},{key:"destroy",value:function(){var e;this.mapService.off("zoomend",this.mapchange),this.mapService.off("moveend",this.viewchange),null===(e=this.tilesetManager)||void 0===e||e.destroy(),this.tileLayerService.destroy()}},{key:"reload",value:function(){var e;this.tilesetManager.clear();var t=this.getCurrentView(),n=t.latLonBounds,r=t.zoom;null===(e=this.tilesetManager)||void 0===e||e.update(r,n)}},{key:"tileUnLoad",value:function(e){this.tileLayerService.removeTile(e.key)}},{key:"tileUpdate",value:function(){var e=bi(zi().mark((function e(){var t,n,r=this;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.tilesetManager){e.next=2;break}return e.abrupt("return");case 2:return t=this.parent.getMinZoom(),n=this.parent.getMaxZoom(),e.next=6,Promise.all(this.tilesetManager.tiles.filter((function(e){return e.isLoaded})).filter((function(e){return e.isVisibleChange})).filter((function(e){return e.data})).filter((function(e){return e.z>=t&&e.z<n})).map(function(){var e=bi(zi().mark((function e(t){var n,i;return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r.tileLayerService.hasTile(t.key)){e.next=9;break}return n=w_(r.parent),i=new n(t,r.parent),e.next=5,i.initTileLayer();case 5:r.tilePickService.setPickState(),0!==i.getLayers().length&&(r.tileLayerService.addTile(i),r.tileLayerService.updateTileVisible(t),r.layerService.reRender()),e.next=12;break;case 9:r.tileLayerService.updateTileVisible(t),r.tilePickService.setPickState(),r.layerService.reRender();case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 6:this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles);case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"setPickState",value:function(e){}},{key:"pickRender",value:function(e){this.tilePickService.pickRender(e)}},{key:"selectFeature",value:function(e){this.tilePickService.selectFeature(e)}},{key:"highlightPickedFeature",value:function(e){this.tilePickService.highlightPickedFeature(e)}},{key:"proxy",value:function(e){var t=this;Ky.forEach((function(n){var r=e[n].bind(e);e[n]=function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return r.apply(void 0,a),t.getLayers().map((function(e){e[n].apply(e,a)})),"style"===n&&t.getTiles().forEach((function(e){return e.styleUpdate.apply(e,a)})),e}}))}}]),e}(),L_=(C_=(0,zs.b2)(),C_(k_=function(){function e(){Si(this,e)}return Ei(e,[{key:"build",value:function(){var e=bi(zi().mark((function e(t){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.prepareBuildModel(),e.next=3,t.buildModels();case 3:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"initLayerModel",value:function(){var e=bi(zi().mark((function e(t){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.build(t);case 2:t.styleNeedUpdate=!1;case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"prepareLayerModel",value:function(){var e=bi(zi().mark((function e(t){return zi().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.build(t);case 2:t.styleNeedUpdate=!1;case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"apply",value:function(e){var t=this;e.hooks.init.tapPromise("LayerModelPlugin",bi(zi().mark((function n(){return zi().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!e.getSource().isTile){n.next=4;break}return e.prepareBuildModel(),e.tileLayer=new O_(e),n.abrupt("return");case 4:return e.log(yt.Or.BuildModelStart,yt.KD.INIT),n.next=7,t.initLayerModel(e);case 7:e.log(yt.Or.BuildModelEnd,yt.KD.INIT);case 8:case"end":return n.stop()}}),n)})))),e.hooks.beforeRenderData.tapPromise("LayerModelPlugin",function(){var n=bi(zi().mark((function n(r){return zi().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r){n.next=2;break}return n.abrupt("return",!1);case 2:if(!e.getSource().isTile){n.next=5;break}return e.tileLayer=new O_(e),n.abrupt("return",!1);case 5:return e.log(yt.Or.BuildModelStart,yt.KD.UPDATE),n.next=8,t.prepareLayerModel(e);case 8:return e.log(yt.Or.BuildModelEnd,yt.KD.UPDATE),n.abrupt("return",!0);case 10:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}}]),e}())||k_),P_=(A_=(0,zs.b2)(),A_(E_=function(){function e(){Si(this,e)}return Ei(e,[{key:"apply",value:function(e){e.hooks.afterInit.tap("LayerStylePlugin",(function(){var t=e.getLayerConfig(),n=t.autoFit,r=t.fitBoundsOptions;n&&e.fitBounds(r),e.styleNeedUpdate=!1}))}}]),e}())||E_),R_=["type"],I_={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},D_={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},z_={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},N_={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};function F_(e){var t={u_DirectionalLights:new Array(3).fill(Yi({},z_)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(Yi({},N_)),u_NumOfSpotLights:0};return e&&e.length||(e=[D_]),e.forEach((function(e){var n=e.type,r=void 0===n?"directional":n,i=Hi(e,R_),a=I_[r].lights,o=I_[r].num,s=t[o];t[a][s]=Yi(Yi({},t[a][s]),i),t[o]++})),t}var j_,B_,U_,V_,G_,H_,W_=(T_=(0,zs.b2)(),T_(M_=function(){function e(){Si(this,e)}return Ei(e,[{key:"apply",value:function(e){e.hooks.beforeRender.tap("LightingPlugin",(function(){var t=e.getLayerConfig(),n=t.enableLighting;n&&e.models.forEach((function(e){return e.addUniforms(Yi({},F_()))}))}))}}]),e}())||M_),Y_=(j_=(0,zs.b2)(),j_(B_=function(){function e(){Si(this,e)}return Ei(e,[{key:"apply",value:function(e,t){var n=this,r=t.rendererService,i=t.postProcessingPassFactory,a=t.normalPassFactory;e.hooks.init.tapPromise("MultiPassRendererPlugin",(function(){var t=e.getLayerConfig(),r=t.enableMultiPassRenderer,o=t.passes,s=void 0===o?[]:o;n.enabled=!!r&&!1!==e.getLayerConfig().enableMultiPassRenderer,n.enabled&&(e.multiPassRenderer=la(e,s,i,a),e.multiPassRenderer.setRenderFlag(!0))})),e.hooks.beforeRender.tap("MultiPassRendererPlugin",(function(){if(n.enabled){var t=r.getViewportSize(),i=t.width,a=t.height;e.multiPassRenderer.resize(i,a)}}))}}]),e}())||B_),q_={NONE:0,ENCODE:1,HIGHLIGHT:2},Z_=(U_=(0,zs.b2)(),U_(V_=function(){function e(){Si(this,e)}return Ei(e,[{key:"apply",value:function(e,t){var n=t.styleAttributeService;e.hooks.init.tapPromise("PixelPickingPlugin",(function(){var t=e.getLayerConfig(),r=t.enablePicking;n.registerStyleAttribute({name:"pickingColor",type:yt.GC.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:yt.gl.FLOAT},size:3,update:function(e){var t=e.id;return r?(0,Ue.Z6)(t):[0,0,0]}}})})),e.hooks.beforePickingEncode.tap("PixelPickingPlugin",(function(){var t=e.getLayerConfig(),n=t.enablePicking;n&&e.isVisible()&&e.models.forEach((function(e){return e.addUniforms({u_PickingStage:q_.ENCODE})}))})),e.hooks.afterPickingEncode.tap("PixelPickingPlugin",(function(){var t=e.getLayerConfig(),n=t.enablePicking;n&&e.isVisible()&&e.models.forEach((function(e){return e.addUniforms({u_PickingStage:q_.HIGHLIGHT})}))})),e.hooks.beforeHighlight.tap("PixelPickingPlugin",(function(t){var n=e.getLayerConfig(),r=n.highlightColor,i=n.activeMix,a=void 0===i?0:i,o="string"===typeof r?(0,Ue.CI)(r):r||[1,0,0,1];e.updateLayerConfig({pickedFeatureID:(0,Ue.W0)(new Uint8Array(t))}),e.models.forEach((function(e){return e.addUniforms({u_PickingStage:q_.HIGHLIGHT,u_PickingColor:t,u_HighlightColor:o.map((function(e){return 255*e})),u_activeMix:a})}))})),e.hooks.beforeSelect.tap("PixelPickingPlugin",(function(t){var n=e.getLayerConfig(),r=n.selectColor,i=n.selectMix,a=void 0===i?0:i,o="string"===typeof r?(0,Ue.CI)(r):r||[1,0,0,1];e.updateLayerConfig({pickedFeatureID:(0,Ue.W0)(new Uint8Array(t))}),e.models.forEach((function(e){return e.addUniforms({u_PickingStage:q_.HIGHLIGHT,u_PickingColor:t,u_HighlightColor:o.map((function(e){return 255*e})),u_activeMix:a,u_CurrentSelectedId:t,u_SelectColor:o.map((function(e){return 255*e})),u_EnableSelect:1})}))}))}}]),e}())||V_),K_=["mvt","geojsonvt","testTile"];function X_(e){var t=e.getSource();return K_.includes(t.parser.type)}var Q_,J_,$_,ex,tx,nx,rx,ix,ax,ox,sx,ux,lx,cx,fx,hx=(G_=(0,zs.b2)(),G_(H_=function(){function e(){Si(this,e)}return Ei(e,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tapPromise("RegisterStyleAttributePlugin",(function(){X_(e)||n.registerBuiltinAttributes(r,e)}))}},{key:"registerBuiltinAttributes",value:function(e,t){"MaskLayer"!==t.type?(this.registerPositionAttribute(e),this.registerColorAttribute(e),this.registerVertexIdAttribute(e)):this.registerPositionAttribute(e)}},{key:"registerPositionAttribute",value:function(e){e.registerStyleAttribute({name:"position",type:yt.GC.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:yt.gl.FLOAT},size:3,update:function(e,t,n){return 2===n.length?[n[0],n[1],0]:[n[0],n[1],n[2]]}}})}},{key:"registerFilterAttribute",value:function(e){e.registerStyleAttribute({name:"filter",type:yt.GC.Attribute,descriptor:{name:"filter",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:1,update:function(e){var t=e.filter;return t?[1]:[0]}}})}},{key:"registerColorAttribute",value:function(e){e.registerStyleAttribute({name:"color",type:yt.GC.Attribute,descriptor:{name:"a_Color",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:4,update:function(e){var t=e.color;return t&&t.length?t:[1,1,1,1]}}})}},{key:"registerVertexIdAttribute",value:function(e){e.registerStyleAttribute({name:"vertexId",type:yt.GC.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:yt.gl.DYNAMIC_DRAW,data:[],type:yt.gl.FLOAT},size:1,update:function(e,t){return[t]}}})}}]),e}())||H_),px=(Q_=(0,zs.b2)(),J_=(0,zs.f3)(yt.vK.ICameraService),$_=(0,zs.f3)(yt.vK.ICoordinateSystemService),ex=(0,zs.f3)(yt.vK.IRendererService),tx=(0,zs.f3)(yt.vK.IMapService),Q_((rx=function(){function e(){Si(this,e),qi(this,"cameraService",ix,this),qi(this,"coordinateSystemService",ax,this),qi(this,"rendererService",ox,this),qi(this,"mapService",sx,this)}return Ei(e,[{key:"apply",value:function(e){var t=this,n=this.mapService.version,r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],i=[0,0];e.hooks.beforeRender.tap("ShaderUniformPlugin",(function(){var a=e.getLayerConfig().tileOrigin;t.coordinateSystemService.refresh(a),"GAODE2.x"===n&&(t.setLayerCenter(e),r=t.mapService.map.customCoords.getMVPMatrix(),i=t.mapService.getCustomCoordCenter());var o=t.rendererService.getViewportSize(),s=o.width,u=o.height;e.models.forEach((function(n){var a;n.addUniforms((a={},Ri(a,yt.lv.ProjectionMatrix,t.cameraService.getProjectionMatrix()),Ri(a,yt.lv.ViewMatrix,t.cameraService.getViewMatrix()),Ri(a,yt.lv.ViewProjectionMatrix,t.cameraService.getViewProjectionMatrix()),Ri(a,yt.lv.Zoom,t.cameraService.getZoom()),Ri(a,yt.lv.ZoomScale,t.cameraService.getZoomScale()),Ri(a,yt.lv.FocalDistance,t.cameraService.getFocalDistance()),Ri(a,yt.lv.CameraPosition,t.cameraService.getCameraPosition()),Ri(a,yt.kw.CoordinateSystem,t.coordinateSystemService.getCoordinateSystem()),Ri(a,yt.kw.ViewportCenter,t.coordinateSystemService.getViewportCenter()),Ri(a,yt.kw.ViewportCenterProjection,t.coordinateSystemService.getViewportCenterProjection()),Ri(a,yt.kw.PixelsPerDegree,t.coordinateSystemService.getPixelsPerDegree()),Ri(a,yt.kw.PixelsPerDegree2,t.coordinateSystemService.getPixelsPerDegree2()),Ri(a,yt.kw.PixelsPerMeter,t.coordinateSystemService.getPixelsPerMeter()),Ri(a,yt.kw.Mvp,r),Ri(a,"u_sceneCenterMercator",i),Ri(a,"u_ViewportSize",[s,u]),Ri(a,"u_ModelMatrix",t.cameraService.getModelMatrix()),Ri(a,"u_DevicePixelRatio",Ue.vO.devicePixelRatio),Ri(a,"u_PickingBuffer",e.getLayerConfig().pickingBuffer||0),Ri(a,"u_shaderPick",Number(e.getShaderPickStat())),a))}))}))}},{key:"setLayerCenter",value:function(e){void 0===e.coordCenter&&(e.coordCenter=e.getSource().center),this.mapService.setCoordCenter&&this.mapService.setCoordCenter(e.coordCenter)}}]),e}(),ix=Zi(rx.prototype,"cameraService",[J_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ax=Zi(rx.prototype,"coordinateSystemService",[$_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ox=Zi(rx.prototype,"rendererService",[ex],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sx=Zi(rx.prototype,"mapService",[tx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nx=rx))||nx),dx=(ux=(0,zs.b2)(),ux(lx=function(){function e(){Si(this,e)}return Ei(e,[{key:"apply",value:function(e){e.hooks.beforeRender.tap("UpdateModelPlugin",(function(){e.layerModel&&e.layerModel.needUpdate().then((function(t){t&&e.renderLayers()}))})),e.hooks.afterRender.tap("UpdateModelPlugin",(function(){e.layerModelNeedUpdate=!1}))}}]),e}())||lx),vx=(cx=(0,zs.b2)(),cx(fx=function(){function e(){Si(this,e)}return Ei(e,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tapPromise("UpdateStyleAttributePlugin",(function(){n.initStyleAttribute(e,{styleAttributeService:r})})),e.hooks.beforeRender.tap("UpdateStyleAttributePlugin",(function(){e.layerModelNeedUpdate||e.inited&&n.updateStyleAttribute(e,{styleAttributeService:r})}))}},{key:"updateStyleAttribute",value:function(e,t){var n=t.styleAttributeService,r=n.getLayerStyleAttributes()||[],i=n.getLayerStyleAttribute("filter");if(i&&i.needRegenerateVertices)return e.layerModelNeedUpdate=!0,void r.forEach((function(e){return e.needRegenerateVertices=!1}));r.filter((function(e){return e.needRegenerateVertices})).forEach((function(t){n.updateAttributeByFeatureRange(t.name,e.getEncodedData(),t.featureRange.startIndex,t.featureRange.endIndex,e),t.needRegenerateVertices=!1}))}},{key:"initStyleAttribute",value:function(e,t){var n=t.styleAttributeService,r=n.getLayerStyleAttributes()||[];r.filter((function(e){return e.needRegenerateVertices})).forEach((function(t){n.updateAttributeByFeatureRange(t.name,e.getEncodedData(),t.featureRange.startIndex,t.featureRange.endIndex),t.needRegenerateVertices=!1}))}}]),e}())||fx);yt.nC.bind(yt.vK.ILayerPlugin).to(gp).inRequestScope(),yt.nC.bind(yt.vK.ILayerPlugin).to(hx).inRequestScope(),yt.nC.bind(yt.vK.ILayerPlugin).to(Fy).inRequestScope(),yt.nC.bind(yt.vK.ILayerPlugin).to(vp).inRequestScope(),yt.nC.bind(yt.vK.ILayerPlugin).to(P_).inRequestScope(),yt.nC.bind(yt.vK.ILayerPlugin).to(By).inRequestScope(),yt.nC.bind(yt.vK.ILayerPlugin).to(vx).inRequestScope(),yt.nC.bind(yt.vK.ILayerPlugin).to(dx).inRequestScope(),yt.nC.bind(yt.vK.ILayerPlugin).to(Y_).inRequestScope(),yt.nC.bind(yt.vK.ILayerPlugin).to(px).inRequestScope(),yt.nC.bind(yt.vK.ILayerPlugin).to(jy).inRequestScope(),yt.nC.bind(yt.vK.ILayerPlugin).to(W_).inRequestScope(),yt.nC.bind(yt.vK.ILayerPlugin).to(Z_).inRequestScope(),yt.nC.bind(yt.vK.ILayerPlugin).to(L_).inRequestScope();var gx=n(67281);function mx(e){return mx="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},mx(e)}function yx(e,t){if("object"!==mx(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==mx(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _x(e){var t=yx(e,"string");return"symbol"===mx(t)?t:String(t)}function xx(e,t,n){return t=_x(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function bx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Sx(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bx(Object(n),!0).forEach((function(t){xx(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bx(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Cx(e){if(Array.isArray(e))return e}function kx(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(c){l=!0,i=c}finally{try{if(!u&&null!=n["return"]&&(o=n["return"](),Object(o)!==o))return}finally{if(l)throw i}}return s}}function Ax(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ex(e,t){if(e){if("string"===typeof e)return Ax(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ax(e,t):void 0}}function Tx(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Mx(e,t){return Cx(e)||kx(e,t)||Ex(e,t)||Tx()}function Ox(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(l){return void n(l)}s.done?t(u):Promise.resolve(u).then(r,i)}function Lx(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){Ox(a,r,i,o,s,"next",e)}function s(e){Ox(a,r,i,o,s,"throw",e)}o(void 0)}))}}function Px(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Rx(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_x(r.key),r)}}function Ix(e,t,n){return t&&Rx(e.prototype,t),n&&Rx(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var Dx=n(68959),zx=n.n(Dx);function Nx(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(l){return void n(l)}s.done?t(u):Promise.resolve(u).then(r,i)}function Fx(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){Nx(a,r,i,o,s,"next",e)}function s(e){Nx(a,r,i,o,s,"throw",e)}o(void 0)}))}}function jx(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Bx(e){return Bx="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Bx(e)}function Ux(e,t){if("object"!==Bx(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==Bx(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function Vx(e){var t=Ux(e,"string");return"symbol"===Bx(t)?t:String(t)}function Gx(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Vx(r.key),r)}}function Hx(e,t,n){return t&&Gx(e.prototype,t),n&&Gx(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Wx(e,t,n){return t=Vx(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Yx,qx,Zx,Kx,Xx,Qx,Jx,$x,eb,tb,nb,rb,ib,ab,ob=n(76172),sb=n.n(ob),ub=n(60996),lb=n.n(ub),cb=function(){function e(t,n){jx(this,e);var r=n.buffer,i=n.offset,a=n.stride,o=n.normalized,s=n.size,u=n.divisor;this.buffer=r,this.attribute={buffer:r.get(),offset:i||0,stride:a||0,normalized:o||!1,divisor:u||0},s&&(this.attribute.size=s)}return Hx(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(e){this.buffer.subData(e)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),fb=(Yx={},Wx(Yx,yt.gl.POINTS,"points"),Wx(Yx,yt.gl.LINES,"lines"),Wx(Yx,yt.gl.LINE_LOOP,"line loop"),Wx(Yx,yt.gl.LINE_STRIP,"line strip"),Wx(Yx,yt.gl.TRIANGLES,"triangles"),Wx(Yx,yt.gl.TRIANGLE_FAN,"triangle fan"),Wx(Yx,yt.gl.TRIANGLE_STRIP,"triangle strip"),Yx),hb=(qx={},Wx(qx,yt.gl.STATIC_DRAW,"static"),Wx(qx,yt.gl.DYNAMIC_DRAW,"dynamic"),Wx(qx,yt.gl.STREAM_DRAW,"stream"),qx),pb=(Zx={},Wx(Zx,yt.gl.BYTE,"int8"),Wx(Zx,yt.gl.UNSIGNED_INT,"int16"),Wx(Zx,yt.gl.INT,"int32"),Wx(Zx,yt.gl.UNSIGNED_BYTE,"uint8"),Wx(Zx,yt.gl.UNSIGNED_SHORT,"uint16"),Wx(Zx,yt.gl.UNSIGNED_INT,"uint32"),Wx(Zx,yt.gl.FLOAT,"float"),Zx),db=(Kx={},Wx(Kx,yt.gl.ALPHA,"alpha"),Wx(Kx,yt.gl.LUMINANCE,"luminance"),Wx(Kx,yt.gl.LUMINANCE_ALPHA,"luminance alpha"),Wx(Kx,yt.gl.RGB,"rgb"),Wx(Kx,yt.gl.RGBA,"rgba"),Wx(Kx,yt.gl.RGBA4,"rgba4"),Wx(Kx,yt.gl.RGB5_A1,"rgb5 a1"),Wx(Kx,yt.gl.RGB565,"rgb565"),Wx(Kx,yt.gl.DEPTH_COMPONENT,"depth"),Wx(Kx,yt.gl.DEPTH_STENCIL,"depth stencil"),Kx),vb=(Xx={},Wx(Xx,yt.gl.DONT_CARE,"dont care"),Wx(Xx,yt.gl.NICEST,"nice"),Wx(Xx,yt.gl.FASTEST,"fast"),Xx),gb=(Qx={},Wx(Qx,yt.gl.NEAREST,"nearest"),Wx(Qx,yt.gl.LINEAR,"linear"),Wx(Qx,yt.gl.LINEAR_MIPMAP_LINEAR,"mipmap"),Wx(Qx,yt.gl.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),Wx(Qx,yt.gl.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),Wx(Qx,yt.gl.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),Qx),mb=(Jx={},Wx(Jx,yt.gl.REPEAT,"repeat"),Wx(Jx,yt.gl.CLAMP_TO_EDGE,"clamp"),Wx(Jx,yt.gl.MIRRORED_REPEAT,"mirror"),Jx),yb=($x={},Wx($x,yt.gl.NONE,"none"),Wx($x,yt.gl.BROWSER_DEFAULT_WEBGL,"browser"),$x),_b=(eb={},Wx(eb,yt.gl.NEVER,"never"),Wx(eb,yt.gl.ALWAYS,"always"),Wx(eb,yt.gl.LESS,"less"),Wx(eb,yt.gl.LEQUAL,"lequal"),Wx(eb,yt.gl.GREATER,"greater"),Wx(eb,yt.gl.GEQUAL,"gequal"),Wx(eb,yt.gl.EQUAL,"equal"),Wx(eb,yt.gl.NOTEQUAL,"notequal"),eb),xb=(tb={},Wx(tb,yt.gl.FUNC_ADD,"add"),Wx(tb,yt.gl.MIN_EXT,"min"),Wx(tb,yt.gl.MAX_EXT,"max"),Wx(tb,yt.gl.FUNC_SUBTRACT,"subtract"),Wx(tb,yt.gl.FUNC_REVERSE_SUBTRACT,"reverse subtract"),tb),bb=(nb={},Wx(nb,yt.gl.ZERO,"zero"),Wx(nb,yt.gl.ONE,"one"),Wx(nb,yt.gl.SRC_COLOR,"src color"),Wx(nb,yt.gl.ONE_MINUS_SRC_COLOR,"one minus src color"),Wx(nb,yt.gl.SRC_ALPHA,"src alpha"),Wx(nb,yt.gl.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),Wx(nb,yt.gl.DST_COLOR,"dst color"),Wx(nb,yt.gl.ONE_MINUS_DST_COLOR,"one minus dst color"),Wx(nb,yt.gl.DST_ALPHA,"dst alpha"),Wx(nb,yt.gl.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),Wx(nb,yt.gl.CONSTANT_COLOR,"constant color"),Wx(nb,yt.gl.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),Wx(nb,yt.gl.CONSTANT_ALPHA,"constant alpha"),Wx(nb,yt.gl.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),Wx(nb,yt.gl.SRC_ALPHA_SATURATE,"src alpha saturate"),nb),Sb=(rb={},Wx(rb,yt.gl.NEVER,"never"),Wx(rb,yt.gl.ALWAYS,"always"),Wx(rb,yt.gl.LESS,"less"),Wx(rb,yt.gl.LEQUAL,"lequal"),Wx(rb,yt.gl.GREATER,"greater"),Wx(rb,yt.gl.GEQUAL,"gequal"),Wx(rb,yt.gl.EQUAL,"equal"),Wx(rb,yt.gl.NOTEQUAL,"notequal"),rb),wb=(ib={},Wx(ib,yt.gl.ZERO,"zero"),Wx(ib,yt.gl.KEEP,"keep"),Wx(ib,yt.gl.REPLACE,"replace"),Wx(ib,yt.gl.INVERT,"invert"),Wx(ib,yt.gl.INCR,"increment"),Wx(ib,yt.gl.DECR,"decrement"),Wx(ib,yt.gl.INCR_WRAP,"increment wrap"),Wx(ib,yt.gl.DECR_WRAP,"decrement wrap"),ib),Cb=(ab={},Wx(ab,yt.gl.FRONT,"front"),Wx(ab,yt.gl.BACK,"back"),ab),kb=function(){function e(t,n){jx(this,e),Wx(this,"isDestroyed",!1);var r=n.data,i=n.usage,a=n.type;this.buffer=t.buffer({data:r,usage:hb[i||yt.gl.STATIC_DRAW],type:pb[a||yt.gl.UNSIGNED_BYTE]})}return Hx(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}},{key:"subData",value:function(e){var t=e.data,n=e.offset;this.buffer.subdata(t,n)}}]),e}(),Ab=function(){function e(t,n){jx(this,e);var r=n.data,i=n.usage,a=n.type,o=n.count;this.elements=t.elements({data:r,usage:hb[i||yt.gl.STATIC_DRAW],type:pb[a||yt.gl.UNSIGNED_BYTE],count:o})}return Hx(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(e){var t=e.data;this.elements.subdata(t)}},{key:"destroy",value:function(){}}]),e}(),Eb=function(){function e(t,n){jx(this,e);var r=n.width,i=n.height,a=n.color,o=n.colors,s={width:r,height:i};Array.isArray(o)&&(s.colors=o.map((function(e){return e.get()}))),a&&"boolean"!==typeof a&&(s.color=a.get()),this.framebuffer=t.framebuffer(s)}return Hx(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(e){var t=e.width,n=e.height;this.framebuffer.resize(t,n)}}]),e}();function Tb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Mb(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Tb(Object(n),!0).forEach((function(t){Wx(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Tb(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ob,Lb,Pb=function(){function e(t,n){jx(this,e),Wx(this,"destroyed",!1),Wx(this,"uniforms",{}),this.reGl=t;var r=n.vs,i=n.fs,a=n.attributes,o=n.uniforms,s=n.primitive,u=n.count,l=n.elements,c=n.depth,f=n.cull,h=n.instances,p={};this.options=n,o&&(this.uniforms=this.extractUniforms(o),Object.keys(o).forEach((function(e){p[e]=t.prop(e)})));var d={};Object.keys(a).forEach((function(e){d[e]=a[e].get()}));var v={attributes:d,frag:i,uniforms:p,vert:r,colorMask:t.prop("colorMask"),lineWidth:1,blend:{enable:t.prop("blend.enable"),func:t.prop("blend.func"),equation:t.prop("blend.equation"),color:t.prop("blend.color")},stencil:{enable:t.prop("stencil.enable"),mask:t.prop("stencil.mask"),func:t.prop("stencil.func"),opFront:t.prop("stencil.opFront"),opBack:t.prop("stencil.opBack")},primitive:fb[void 0===s?yt.gl.TRIANGLES:s]};h&&(v.instances=h),u?v.count=u:l&&(v.elements=l.get()),this.initDepthDrawParams({depth:c},v),this.initCullDrawParams({cull:f},v),this.drawCommand=t(v),this.drawParams=v}return Hx(e,[{key:"updateAttributesAndElements",value:function(e,t){var n={};Object.keys(e).forEach((function(t){n[t]=e[t].get()})),this.drawParams.attributes=n,this.drawParams.elements=t.get(),this.drawCommand=this.reGl(this.drawParams)}},{key:"updateAttributes",value:function(e){var t={};Object.keys(e).forEach((function(n){t[n]=e[n].get()})),this.drawParams.attributes=t,this.drawCommand=this.reGl(this.drawParams)}},{key:"addUniforms",value:function(e){this.uniforms=Mb(Mb({},this.uniforms),this.extractUniforms(e))}},{key:"draw",value:function(e,t){if(!this.drawParams.attributes||0!==Object.keys(this.drawParams.attributes).length){var n=Mb(Mb({},this.uniforms),this.extractUniforms(e.uniforms||{})),r={};Object.keys(n).forEach((function(e){var t=Bx(n[e]);"boolean"===t||"number"===t||Array.isArray(n[e])||n[e].BYTES_PER_ELEMENT?r[e]=n[e]:r[e]=n[e].get()})),r.blend=t?this.getBlendDrawParams({blend:{enable:!1}}):this.getBlendDrawParams(e),r.stencil=this.getStencilDrawParams(e),r.colorMask=this.getColorMaskDrawParams(e,t),this.drawCommand(r)}}},{key:"destroy",value:function(){var e,t;null===(e=this.drawParams)||void 0===e||null===(t=e.elements)||void 0===t||t.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach((function(e){null===e||void 0===e||e.destroy()})),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(e,t){var n=e.depth;n&&(t.depth={enable:void 0===n.enable||!!n.enable,mask:void 0===n.mask||!!n.mask,func:_b[n.func||yt.gl.LESS],range:n.range||[0,1]})}},{key:"getBlendDrawParams",value:function(e){var t=e.blend,n=t||{},r=n.enable,i=n.func,a=n.equation,o=n.color,s=void 0===o?[0,0,0,0]:o;return{enable:!!r,func:{srcRGB:bb[i&&i.srcRGB||yt.gl.SRC_ALPHA],srcAlpha:bb[i&&i.srcAlpha||yt.gl.SRC_ALPHA],dstRGB:bb[i&&i.dstRGB||yt.gl.ONE_MINUS_SRC_ALPHA],dstAlpha:bb[i&&i.dstAlpha||yt.gl.ONE_MINUS_SRC_ALPHA]},equation:{rgb:xb[a&&a.rgb||yt.gl.FUNC_ADD],alpha:xb[a&&a.alpha||yt.gl.FUNC_ADD]},color:s}}},{key:"getStencilDrawParams",value:function(e){var t=e.stencil,n=t||{},r=n.enable,i=n.mask,a=void 0===i?-1:i,o=n.func,s=void 0===o?{cmp:yt.gl.ALWAYS,ref:0,mask:-1}:o,u=n.opFront,l=void 0===u?{fail:yt.gl.KEEP,zfail:yt.gl.KEEP,zpass:yt.gl.KEEP}:u,c=n.opBack,f=void 0===c?{fail:yt.gl.KEEP,zfail:yt.gl.KEEP,zpass:yt.gl.KEEP}:c;return{enable:!!r,mask:a,func:Mb(Mb({},s),{},{cmp:Sb[s.cmp]}),opFront:{fail:wb[l.fail],zfail:wb[l.zfail],zpass:wb[l.zpass]},opBack:{fail:wb[f.fail],zfail:wb[f.zfail],zpass:wb[f.zpass]}}}},{key:"getColorMaskDrawParams",value:function(e,t){var n=e.stencil,r=null!==n&&void 0!==n&&n.enable&&n.opFront&&!t?[!1,!1,!1,!1]:[!0,!0,!0,!0];return r}},{key:"initCullDrawParams",value:function(e,t){var n=e.cull;if(n){var r=n.enable,i=n.face,a=void 0===i?yt.gl.BACK:i;t.cull={enable:!!r,face:Cb[a]}}}},{key:"extractUniforms",value:function(e){var t=this,n={};return Object.keys(e).forEach((function(r){t.extractUniformsRecursively(r,e[r],n,"")})),n}},{key:"extractUniformsRecursively",value:function(e,t,n,r){var i=this;null===t||"number"===typeof t||"boolean"===typeof t||Array.isArray(t)&&"number"===typeof t[0]||(0,Zt.isTypedArray)(t)||""===t||"resize"in t?n["".concat(r&&r+".").concat(e)]=t:((0,Zt.isPlainObject)(t)&&Object.keys(t).forEach((function(a){i.extractUniformsRecursively(a,t[a],n,"".concat(r&&r+".").concat(e))})),Array.isArray(t)&&t.forEach((function(t,a){Object.keys(t).forEach((function(o){i.extractUniformsRecursively(o,t[o],n,"".concat(r&&r+".").concat(e,"[").concat(a,"]"))}))})))}}]),e}(),Rb=function(){function e(t,n){jx(this,e),Wx(this,"isDestroy",!1);var r=n.data,i=n.type,a=void 0===i?yt.gl.UNSIGNED_BYTE:i,o=n.width,s=n.height,u=n.flipY,l=void 0!==u&&u,c=n.format,f=void 0===c?yt.gl.RGBA:c,h=n.mipmap,p=void 0!==h&&h,d=n.wrapS,v=void 0===d?yt.gl.CLAMP_TO_EDGE:d,g=n.wrapT,m=void 0===g?yt.gl.CLAMP_TO_EDGE:g,y=n.aniso,_=void 0===y?0:y,x=n.alignment,b=void 0===x?1:x,S=n.premultiplyAlpha,w=void 0!==S&&S,C=n.mag,k=void 0===C?yt.gl.NEAREST:C,A=n.min,E=void 0===A?yt.gl.NEAREST:A,T=n.colorSpace,M=void 0===T?yt.gl.BROWSER_DEFAULT_WEBGL:T,O=n.x,L=void 0===O?0:O,P=n.y,R=void 0===P?0:P,I=n.copy,D=void 0!==I&&I;this.width=o,this.height=s;var z={width:o,height:s,type:pb[a],format:db[f],wrapS:mb[v],wrapT:mb[m],mag:gb[k],min:gb[E],alignment:b,flipY:l,colorSpace:yb[M],premultiplyAlpha:w,aniso:_,x:L,y:R,copy:D};r&&(z.data=r),"number"===typeof p?z.mipmap=vb[p]:"boolean"===typeof p&&(z.mipmap=p),this.texture=t.texture(z)}return Hx(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.texture(e)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(e){var t=e.width,n=e.height;this.texture.resize(t,n),this.width=t,this.height=n}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){var e;this.isDestroy||(null===(e=this.texture)||void 0===e||e.destroy());this.isDestroy=!0}}]),e}(),Ib=(Ob=(0,zs.b2)(),Ob(Lb=function(){function e(){var t=this;jx(this,e),Wx(this,"createModel",(function(e){return new Pb(t.gl,e)})),Wx(this,"createAttribute",(function(e){return new cb(t.gl,e)})),Wx(this,"createBuffer",(function(e){return new kb(t.gl,e)})),Wx(this,"createElements",(function(e){return new Ab(t.gl,e)})),Wx(this,"createTexture2D",(function(e){return new Rb(t.gl,e)})),Wx(this,"createFramebuffer",(function(e){return new Eb(t.gl,e)})),Wx(this,"useFramebuffer",(function(e,n){t.gl({framebuffer:e?e.get():null})(n)})),Wx(this,"clear",(function(e){var n,r=e.color,i=e.depth,a=e.stencil,o=e.framebuffer,s=void 0===o?null:o,u={color:r,depth:i,stencil:a};u.framebuffer=null===s?s:s.get(),null===(n=t.gl)||void 0===n||n.clear(u)})),Wx(this,"viewport",(function(e){var n=e.x,r=e.y,i=e.width,a=e.height;t.gl._gl.viewport(n,r,i,a),t.width=i,t.height=a,t.gl._refresh()})),Wx(this,"readPixels",(function(e){var n=e.framebuffer,r=e.x,i=e.y,a=e.width,o=e.height,s={x:r,y:i,width:a,height:o};return n&&(s.framebuffer=n.get()),t.gl.read(s)})),Wx(this,"getViewportSize",(function(){return{width:t.gl._gl.drawingBufferWidth,height:t.gl._gl.drawingBufferHeight}})),Wx(this,"getContainer",(function(){return Ue.eW?t.canvas:null===(e=t.canvas)||void 0===e?void 0:e.parentElement;var e})),Wx(this,"getCanvas",(function(){return t.canvas})),Wx(this,"getGLContext",(function(){return t.gl._gl})),Wx(this,"destroy",(function(){var e,n,r;t.canvas=null,null===(e=t.gl)||void 0===e||null===(n=e._gl)||void 0===n||null===(r=n.getExtension("WEBGL_lose_context"))||void 0===r||r.loseContext(),t.gl.destroy(),t.gl=null}))}return Hx(e,[{key:"init",value:function(){var e=Fx(sb().mark((function e(t,n,r){var i=this;return sb().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.canvas=t,!r){e.next=5;break}this.gl=r,e.next=8;break;case 5:return e.next=7,new Promise((function(e,t){lb()({canvas:i.canvas,attributes:{alpha:!0,antialias:n.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:n.preserveDrawingBuffer,stencil:n.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture","WEBGL_lose_context"],profile:!0,onDone:function(n,r){!n&&r||t(n),e(r)}})}));case 7:this.gl=e.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return e.stop()}}),e,this)})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(e){return!!this.getGLContext().getExtension(e)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var e=this.getGLContext();e.disable(e.CULL_FACE)}},{key:"setDirty",value:function(e){this.isDirty=e}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||Lb);function Db(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function zb(e,t){return zb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},zb(e,t)}function Nb(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&zb(e,t)}function Fb(e,t){if(t&&("object"===mx(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Db(e)}function jb(e){return jb=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},jb(e)}function Bb(e){var t=Ub();return function(){var n,r=jb(e);if(t){var i=jb(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Fb(this,n)}}function Ub(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Vb=["selectstart","selecting","selectend"],Gb=function(e){Nb(n,e);var t=Bb(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Px(this,n),r=t.call(this),xx(Db(r),"isEnable",!1),xx(Db(r),"onDragStart",(function(e){r.box.style.display="block",r.startEvent=r.endEvent=e,r.syncBoxBound(),r.emit("selectstart",r.getLngLatBox(),r.startEvent,r.endEvent)})),xx(Db(r),"onDragging",(function(e){r.endEvent=e,r.syncBoxBound(),r.emit("selecting",r.getLngLatBox(),r.startEvent,r.endEvent)})),xx(Db(r),"onDragEnd",(function(e){r.endEvent=e,r.box.style.display="none",r.emit("selectend",r.getLngLatBox(),r.startEvent,r.endEvent)})),r.scene=e,r.options=i,r}return Ix(n,[{key:"container",get:function(){return this.scene.getMapService().getMarkerContainer()}},{key:"enable",value:function(){if(!this.isEnable){var e=this.options.className;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){var t=Ue.SO.create("div",void 0,this.container);t.classList.add("l7-select-box"),e&&t.classList.add(e),t.style.display="none",this.box=t}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}}},{key:"disable",value:function(){this.isEnable&&(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}},{key:"syncBoxBound",value:function(){var e=this.startEvent,t=e.x,n=e.y,r=this.endEvent,i=r.x,a=r.y,o=Math.min(t,i),s=Math.min(n,a),u=Math.abs(t-i),l=Math.abs(n-a);this.box.style.top="".concat(s,"px"),this.box.style.left="".concat(o,"px"),this.box.style.width="".concat(u,"px"),this.box.style.height="".concat(l,"px")}},{key:"getLngLatBox",value:function(){var e=this.startEvent.lngLat,t=e.lng,n=e.lat,r=this.endEvent.lngLat,i=r.lng,a=r.lat;return(0,Ue.Ol)([[t,n],[i,a]])}}]),n}(Yt.EventEmitter),Hb=function(){function e(t){Px(this,e);var n=t.id,r=t.map,i=t.canvas,a=t.hasBaseMap,o=(0,yt.Hp)();this.container=o,r.setContainer(o,n,i,a),o.bind(yt.vK.IRendererService).to(Ib).inSingletonScope(),this.sceneService=o.get(yt.vK.ISceneService),this.mapService=o.get(yt.vK.IMapService),this.iconService=o.get(yt.vK.IIconService),this.fontService=o.get(yt.vK.IFontService),this.controlService=o.get(yt.vK.IControlService),this.layerService=o.get(yt.vK.ILayerService),this.debugService=o.get(yt.vK.IDebugService),this.debugService.setEnable(t.debug),this.markerService=o.get(yt.vK.IMarkerService),this.interactionService=o.get(yt.vK.IInteractionService),this.popupService=o.get(yt.vK.IPopupService),this.boxSelect=new Gb(this,{}),(0,Ue.a)((null===t||void 0===t?void 0:t.isMini)||!1),Ue.eW?this.sceneService.initMiniScene(t):(this.initComponent(n),this.sceneService.init(t),this.initControl())}return Ix(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"getDebugService",value:function(){return this.debugService}},{key:"exportPng",value:function(){var e=Lx(zx().mark((function e(t){return zx().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.sceneService.exportPng(t));case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"exportMap",value:function(){var e=Lx(zx().mark((function e(t){return zx().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.sceneService.exportPng(t));case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"registerRenderService",value:function(e){var t=this;if(this.sceneService.loaded){var n=new e(this);n.init()}else this.on("loaded",(function(){var n=new e(t);n.init()}))}},{key:"setBgColor",value:function(e){this.mapService.setBgColor(e)}},{key:"addLayer",value:function(e){var t=this,n=(0,yt.e7)(this.container);if(e.setContainer(n,this.container),this.sceneService.addLayer(e),e.inited){var r=this.initMask(e);this.addMask(r,e.id)}else e.on("inited",(function(){var n=t.initMask(e);t.addMask(n,e.id)}))}},{key:"initMask",value:function(e){var t=e.getLayerConfig(),n=t.mask,r=t.maskfence,i=t.maskColor,a=void 0===i?"#000":i,o=t.maskOpacity,s=void 0===o?0:o;if(n&&r){var u=(new Ph).source(r).shape("fill").style({color:a,opacity:s});return u}}},{key:"addMask",value:function(e,t){if(e){var n=this.getLayer(t);if(n){var r=(0,yt.e7)(this.container);e.setContainer(r,this.container),n.addMaskLayer(e),this.sceneService.addMask(e)}else console.warn("parent layer not find!")}}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(e){return this.layerService.getLayer(e)}},{key:"getLayerByName",value:function(e){return this.layerService.getLayerByName(e)}},{key:"removeLayer",value:function(){var e=Lx(zx().mark((function e(t,n){return zx().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.layerService.remove(t,n);case 2:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"removeAllLayer",value:function(){var e=Lx(zx().mark((function e(){return zx().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.layerService.removeAllLayers();case 2:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(e){this.layerService.setEnableRender(e)}},{key:"addIconFont",value:function(e,t){this.fontService.addIconFont(e,t)}},{key:"addIconFonts",value:function(e){var t=this;e.forEach((function(e){var n=Mx(e,2),r=n[0],i=n[1];t.fontService.addIconFont(r,i)}))}},{key:"addFontFace",value:function(e,t){var n=this;this.fontService.once("fontloaded",(function(e){n.emit("fontloaded",e)})),this.fontService.addFontFace(e,t)}},{key:"addImage",value:function(){var e=Lx(zx().mark((function e(t,n){return zx().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(Ue.eW){e.next=5;break}return e.next=3,this.iconService.addImage(t,n);case 3:e.next=6;break;case 5:this.iconService.addImageMini(t,n,this.sceneService);case 6:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"hasImage",value:function(e){return this.iconService.hasImage(e)}},{key:"removeImage",value:function(e){this.iconService.removeImage(e)}},{key:"addIconFontGlyphs",value:function(e,t){this.fontService.addIconGlyphs(t)}},{key:"addControl",value:function(e){this.controlService.addControl(e,this.container)}},{key:"removeControl",value:function(e){this.controlService.removeControl(e)}},{key:"getControlByName",value:function(e){return this.controlService.getControlByName(e)}},{key:"addMarker",value:function(e){this.markerService.addMarker(e)}},{key:"addMarkerLayer",value:function(e){this.markerService.addMarkerLayer(e)}},{key:"removeMarkerLayer",value:function(e){this.markerService.removeMarkerLayer(e)}},{key:"removeAllMarkers",value:function(){this.markerService.removeAllMarkers()}},{key:"removeAllMakers",value:function(){console.warn("removeAllMakers \u5df2\u5e9f\u5f03\uff0c\u8bf7\u4f7f\u7528 removeAllMarkers"),this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(e){this.popupService.addPopup(e)}},{key:"removePopup",value:function(e){this.popupService.removePopup(e)}},{key:"on",value:function(e,t){var n;Vb.includes(e)?null===(n=this.boxSelect)||void 0===n||n.on(e,t):yt.P7.includes(e)?this.sceneService.on(e,t):this.mapService.on(e,t)}},{key:"once",value:function(e,t){var n;Vb.includes(e)?null===(n=this.boxSelect)||void 0===n||n.once(e,t):yt.P7.includes(e)?this.sceneService.once(e,t):this.mapService.once(e,t)}},{key:"emit",value:function(e,t){-1===yt.P7.indexOf(e)?this.mapService.on(e,t):this.sceneService.emit(e,t)}},{key:"off",value:function(e,t){var n;Vb.includes(e)?null===(n=this.boxSelect)||void 0===n||n.off(e,t):yt.P7.includes(e)?this.sceneService.off(e,t):this.mapService.off(e,t)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(e){return this.mapService.getCenter(e)}},{key:"setCenter",value:function(e,t){return this.mapService.setCenter(e,t)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(e){return this.mapService.setPitch(e)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(e){this.mapService.setRotation(e)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(e){this.mapService.panTo(e)}},{key:"panBy",value:function(e,t){this.mapService.panBy(e,t)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(e){this.mapService.setZoom(e)}},{key:"fitBounds",value:function(e,t){var n=this.sceneService.getSceneConfig(),r=n.fitBoundsOptions,i=n.animate;this.mapService.fitBounds(e,t||Sx(Sx({},r),{},{animate:i}))}},{key:"setZoomAndCenter",value:function(e,t){this.mapService.setZoomAndCenter(e,t)}},{key:"setMapStyle",value:function(e){this.mapService.setMapStyle(e)}},{key:"setMapStatus",value:function(e){this.mapService.setMapStatus(e)}},{key:"pixelToLngLat",value:function(e){return this.mapService.pixelToLngLat(e)}},{key:"lngLatToPixel",value:function(e){return this.mapService.lngLatToPixel(e)}},{key:"containerToLngLat",value:function(e){return this.mapService.containerToLngLat(e)}},{key:"lngLatToContainer",value:function(e){return this.mapService.lngLatToContainer(e)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(e,t){this.container.bind(yt.vK.IPostProcessingPass).to(e).whenTargetNamed(t)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"enableBoxSelect",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.boxSelect.enable(),t&&this.boxSelect.once("selectend",(function(){e.disableBoxSelect()}))}},{key:"disableBoxSelect",value:function(){this.boxSelect.disable()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(e){this.controlService.init({container:Ue.SO.getContainer(e)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var e=this.sceneService.getSceneConfig(),t=e.logoVisible,n=e.logoPosition;t&&this.addControl(new Jr({position:n}))}}]),e}(),Wb="2.17.7"},28422:function(e){function t(e,r){var i,a=e&&e.type;if("FeatureCollection"===a)for(i=0;i<e.features.length;i++)t(e.features[i],r);else if("GeometryCollection"===a)for(i=0;i<e.geometries.length;i++)t(e.geometries[i],r);else if("Feature"===a)t(e.geometry,r);else if("Polygon"===a)n(e.coordinates,r);else if("MultiPolygon"===a)for(i=0;i<e.coordinates.length;i++)n(e.coordinates[i],r);return e}function n(e,t){if(0!==e.length){r(e[0],t);for(var n=1;n<e.length;n++)r(e[n],!t)}}function r(e,t){for(var n=0,r=0,i=0,a=e.length,o=a-1;i<a;o=i++){var s=(e[i][0]-e[o][0])*(e[o][1]+e[i][1]),u=n+s;r+=Math.abs(n)>=Math.abs(s)?n-u+s:s-u+n,n=u}n+r>=0!==!!t&&e.reverse()}e.exports=t},4280:function(e){"use strict";function t(e,t){this.x=e,this.y=t}e.exports=t,t.prototype={clone:function(){return new t(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[0]*this.x+e[1]*this.y,n=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=n,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),n=Math.sin(e),r=t*this.x-n*this.y,i=n*this.x+t*this.y;return this.x=r,this.y=i,this},_rotateAround:function(e,t){var n=Math.cos(e),r=Math.sin(e),i=t.x+n*(this.x-t.x)-r*(this.y-t.y),a=t.y+r*(this.x-t.x)+n*(this.y-t.y);return this.x=i,this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},t.convert=function(e){return e instanceof t?e:Array.isArray(e)?new t(e[0],e[1]):e}},48816:function(e,t,n){e.exports.VectorTile=n(87634),n(70310),n(62102)},87634:function(e,t,n){"use strict";var r=n(62102);function i(e,t){this.layers=e.readFields(a,{},t)}function a(e,t,n){if(3===e){var i=new r(n,n.readVarint()+n.pos);i.length&&(t[i.name]=i)}}e.exports=i},70310:function(e,t,n){"use strict";var r=n(4280);function i(e,t,n,r,i){this.properties={},this.extent=n,this.type=0,this._pbf=e,this._geometry=-1,this._keys=r,this._values=i,e.readFields(a,this,t)}function a(e,t,n){1==e?t.id=n.readVarint():2==e?o(n,t):3==e?t.type=n.readVarint():4==e&&(t._geometry=n.pos)}function o(e,t){var n=e.readVarint()+e.pos;while(e.pos<n){var r=t._keys[e.readVarint()],i=t._values[e.readVarint()];t.properties[r]=i}}function s(e){var t=e.length;if(t<=1)return[e];for(var n,r,i=[],a=0;a<t;a++){var o=u(e[a]);0!==o&&(void 0===r&&(r=o<0),r===o<0?(n&&i.push(n),n=[e[a]]):n.push(e[a]))}return n&&i.push(n),i}function u(e){for(var t,n,r=0,i=0,a=e.length,o=a-1;i<a;o=i++)t=e[i],n=e[o],r+=(n.x-t.x)*(t.y+n.y);return r}e.exports=i,i.types=["Unknown","Point","LineString","Polygon"],i.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;var t,n=e.readVarint()+e.pos,i=1,a=0,o=0,s=0,u=[];while(e.pos<n){if(a<=0){var l=e.readVarint();i=7&l,a=l>>3}if(a--,1===i||2===i)o+=e.readSVarint(),s+=e.readSVarint(),1===i&&(t&&u.push(t),t=[]),t.push(new r(o,s));else{if(7!==i)throw new Error("unknown command "+i);t&&t.push(t[0].clone())}}return t&&u.push(t),u},i.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;var t=e.readVarint()+e.pos,n=1,r=0,i=0,a=0,o=1/0,s=-1/0,u=1/0,l=-1/0;while(e.pos<t){if(r<=0){var c=e.readVarint();n=7&c,r=c>>3}if(r--,1===n||2===n)i+=e.readSVarint(),a+=e.readSVarint(),i<o&&(o=i),i>s&&(s=i),a<u&&(u=a),a>l&&(l=a);else if(7!==n)throw new Error("unknown command "+n)}return[o,u,s,l]},i.prototype.toGeoJSON=function(e,t,n){var r,a,o=this.extent*Math.pow(2,n),u=this.extent*e,l=this.extent*t,c=this.loadGeometry(),f=i.types[this.type];function h(e){for(var t=0;t<e.length;t++){var n=e[t],r=180-360*(n.y+l)/o;e[t]=[360*(n.x+u)/o-180,360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90]}}switch(this.type){case 1:var p=[];for(r=0;r<c.length;r++)p[r]=c[r][0];c=p,h(c);break;case 2:for(r=0;r<c.length;r++)h(c[r]);break;case 3:for(c=s(c),r=0;r<c.length;r++)for(a=0;a<c[r].length;a++)h(c[r][a]);break}1===c.length?c=c[0]:f="Multi"+f;var d={type:"Feature",geometry:{type:f,coordinates:c},properties:this.properties};return"id"in this&&(d.id=this.id),d}},62102:function(e,t,n){"use strict";var r=n(70310);function i(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(a,this,t),this.length=this._features.length}function a(e,t,n){15===e?t.version=n.readVarint():1===e?t.name=n.readString():5===e?t.extent=n.readVarint():2===e?t._features.push(n.pos):3===e?t._keys.push(n.readString()):4===e&&t._values.push(o(n))}function o(e){var t=null,n=e.readVarint()+e.pos;while(e.pos<n){var r=e.readVarint()>>3;t=1===r?e.readString():2===r?e.readFloat():3===r?e.readDouble():4===r?e.readVarint64():5===r?e.readVarint():6===r?e.readSVarint():7===r?e.readBoolean():null}return t}e.exports=i,i.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new r(this._pbf,t,this.extent,this._keys,this._values)}},4465:function(e,t,n){"use strict";n.r(t),n.d(t,{Function:function(){return tn},Interpreter:function(){return Zt},default:function(){return nn},evaluate:function(){return en},vm:function(){return r}});var r={};n.r(r),n.d(r,{Script:function(){return $t},compileFunction:function(){return Xt},createContext:function(){return Kt},runInContext:function(){return Qt},runInNewContext:function(){return Jt}});var i={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},a="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",o={5:a,"5module":a+" export import",6:a+" const class extends export import super"},s=/^in(stanceof)?$/,u="\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u037f\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u052f\u0531-\u0556\u0559\u0560-\u0588\u05d0-\u05ea\u05ef-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u0860-\u086a\u08a0-\u08b4\u08b6-\u08c7\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u09fc\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0af9\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c39\u0c3d\u0c58-\u0c5a\u0c60\u0c61\u0c80\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d04-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d54-\u0d56\u0d5f-\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e86-\u0e8a\u0e8c-\u0ea3\u0ea5\u0ea7-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f5\u13f8-\u13fd\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f8\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1878\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191e\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19b0-\u19c9\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1c80-\u1c88\u1c90-\u1cba\u1cbd-\u1cbf\u1ce9-\u1cec\u1cee-\u1cf3\u1cf5\u1cf6\u1cfa\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2118-\u211d\u2124\u2126\u2128\u212a-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309b-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312f\u3131-\u318e\u31a0-\u31bf\u31f0-\u31ff\u3400-\u4dbf\u4e00-\u9ffc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua69d\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua7bf\ua7c2-\ua7ca\ua7f5-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua8fd\ua8fe\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\ua9e0-\ua9e4\ua9e6-\ua9ef\ua9fa-\ua9fe\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa7e-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uab30-\uab5a\uab5c-\uab69\uab70-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc",l="\u200c\u200d\xb7\u0300-\u036f\u0387\u0483-\u0487\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u0669\u0670\u06d6-\u06dc\u06df-\u06e4\u06e7\u06e8\u06ea-\u06ed\u06f0-\u06f9\u0711\u0730-\u074a\u07a6-\u07b0\u07c0-\u07c9\u07eb-\u07f3\u07fd\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0859-\u085b\u08d3-\u08e1\u08e3-\u0903\u093a-\u093c\u093e-\u094f\u0951-\u0957\u0962\u0963\u0966-\u096f\u0981-\u0983\u09bc\u09be-\u09c4\u09c7\u09c8\u09cb-\u09cd\u09d7\u09e2\u09e3\u09e6-\u09ef\u09fe\u0a01-\u0a03\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a66-\u0a71\u0a75\u0a81-\u0a83\u0abc\u0abe-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ae2\u0ae3\u0ae6-\u0aef\u0afa-\u0aff\u0b01-\u0b03\u0b3c\u0b3e-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b55-\u0b57\u0b62\u0b63\u0b66-\u0b6f\u0b82\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd7\u0be6-\u0bef\u0c00-\u0c04\u0c3e-\u0c44\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0c66-\u0c6f\u0c81-\u0c83\u0cbc\u0cbe-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0ce6-\u0cef\u0d00-\u0d03\u0d3b\u0d3c\u0d3e-\u0d44\u0d46-\u0d48\u0d4a-\u0d4d\u0d57\u0d62\u0d63\u0d66-\u0d6f\u0d81-\u0d83\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0de6-\u0def\u0df2\u0df3\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0e50-\u0e59\u0eb1\u0eb4-\u0ebc\u0ec8-\u0ecd\u0ed0-\u0ed9\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f3e\u0f3f\u0f71-\u0f84\u0f86\u0f87\u0f8d-\u0f97\u0f99-\u0fbc\u0fc6\u102b-\u103e\u1040-\u1049\u1056-\u1059\u105e-\u1060\u1062-\u1064\u1067-\u106d\u1071-\u1074\u1082-\u108d\u108f-\u109d\u135d-\u135f\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b4-\u17d3\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u18a9\u1920-\u192b\u1930-\u193b\u1946-\u194f\u19d0-\u19da\u1a17-\u1a1b\u1a55-\u1a5e\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1ab0-\u1abd\u1abf\u1ac0\u1b00-\u1b04\u1b34-\u1b44\u1b50-\u1b59\u1b6b-\u1b73\u1b80-\u1b82\u1ba1-\u1bad\u1bb0-\u1bb9\u1be6-\u1bf3\u1c24-\u1c37\u1c40-\u1c49\u1c50-\u1c59\u1cd0-\u1cd2\u1cd4-\u1ce8\u1ced\u1cf4\u1cf7-\u1cf9\u1dc0-\u1df9\u1dfb-\u1dff\u203f\u2040\u2054\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2cef-\u2cf1\u2d7f\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua620-\ua629\ua66f\ua674-\ua67d\ua69e\ua69f\ua6f0\ua6f1\ua802\ua806\ua80b\ua823-\ua827\ua82c\ua880\ua881\ua8b4-\ua8c5\ua8d0-\ua8d9\ua8e0-\ua8f1\ua8ff-\ua909\ua926-\ua92d\ua947-\ua953\ua980-\ua983\ua9b3-\ua9c0\ua9d0-\ua9d9\ua9e5\ua9f0-\ua9f9\uaa29-\uaa36\uaa43\uaa4c\uaa4d\uaa50-\uaa59\uaa7b-\uaa7d\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uaaeb-\uaaef\uaaf5\uaaf6\uabe3-\uabea\uabec\uabed\uabf0-\uabf9\ufb1e\ufe00-\ufe0f\ufe20-\ufe2f\ufe33\ufe34\ufe4d-\ufe4f\uff10-\uff19\uff3f",c=new RegExp("["+u+"]"),f=new RegExp("["+u+l+"]");u=l=null;var h=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],p=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function d(e,t){for(var n=65536,r=0;r<t.length;r+=2){if(n+=t[r],n>e)return!1;if(n+=t[r+1],n>=e)return!0}}function v(e,t){return e<65?36===e:e<91||(e<97?95===e:e<123||(e<=65535?e>=170&&c.test(String.fromCharCode(e)):!1!==t&&d(e,h)))}function g(e,t){return e<48?36===e:e<58||!(e<65)&&(e<91||(e<97?95===e:e<123||(e<=65535?e>=170&&f.test(String.fromCharCode(e)):!1!==t&&(d(e,h)||d(e,p)))))}var m=function(e,t){void 0===t&&(t={}),this.label=e,this.keyword=t.keyword,this.beforeExpr=!!t.beforeExpr,this.startsExpr=!!t.startsExpr,this.isLoop=!!t.isLoop,this.isAssign=!!t.isAssign,this.prefix=!!t.prefix,this.postfix=!!t.postfix,this.binop=t.binop||null,this.updateContext=null};function y(e,t){return new m(e,{beforeExpr:!0,binop:t})}var _={beforeExpr:!0},x={startsExpr:!0},b={};function S(e,t){return void 0===t&&(t={}),t.keyword=e,b[e]=new m(e,t)}var w={num:new m("num",x),regexp:new m("regexp",x),string:new m("string",x),name:new m("name",x),eof:new m("eof"),bracketL:new m("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new m("]"),braceL:new m("{",{beforeExpr:!0,startsExpr:!0}),braceR:new m("}"),parenL:new m("(",{beforeExpr:!0,startsExpr:!0}),parenR:new m(")"),comma:new m(",",_),semi:new m(";",_),colon:new m(":",_),dot:new m("."),question:new m("?",_),questionDot:new m("?."),arrow:new m("=>",_),template:new m("template"),invalidTemplate:new m("invalidTemplate"),ellipsis:new m("...",_),backQuote:new m("`",x),dollarBraceL:new m("${",{beforeExpr:!0,startsExpr:!0}),eq:new m("=",{beforeExpr:!0,isAssign:!0}),assign:new m("_=",{beforeExpr:!0,isAssign:!0}),incDec:new m("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new m("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:y("||",1),logicalAND:y("&&",2),bitwiseOR:y("|",3),bitwiseXOR:y("^",4),bitwiseAND:y("&",5),equality:y("==/!=/===/!==",6),relational:y("</>/<=/>=",7),bitShift:y("<</>>/>>>",8),plusMin:new m("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:y("%",10),star:y("*",10),slash:y("/",10),starstar:new m("**",{beforeExpr:!0}),coalesce:y("??",1),_break:S("break"),_case:S("case",_),_catch:S("catch"),_continue:S("continue"),_debugger:S("debugger"),_default:S("default",_),_do:S("do",{isLoop:!0,beforeExpr:!0}),_else:S("else",_),_finally:S("finally"),_for:S("for",{isLoop:!0}),_function:S("function",x),_if:S("if"),_return:S("return",_),_switch:S("switch"),_throw:S("throw",_),_try:S("try"),_var:S("var"),_const:S("const"),_while:S("while",{isLoop:!0}),_with:S("with"),_new:S("new",{beforeExpr:!0,startsExpr:!0}),_this:S("this",x),_super:S("super",x),_class:S("class",x),_extends:S("extends",_),_export:S("export"),_import:S("import",x),_null:S("null",x),_true:S("true",x),_false:S("false",x),_in:S("in",{beforeExpr:!0,binop:7}),_instanceof:S("instanceof",{beforeExpr:!0,binop:7}),_typeof:S("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:S("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:S("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},C=/\r\n?|\n|\u2028|\u2029/,k=new RegExp(C.source,"g");function A(e,t){return 10===e||13===e||!t&&(8232===e||8233===e)}var E=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,T=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,M=Object.prototype,O=M.hasOwnProperty,L=M.toString;function P(e,t){return O.call(e,t)}var R=Array.isArray||function(e){return"[object Array]"===L.call(e)};function I(e){return new RegExp("^(?:"+e.replace(/ /g,"|")+")$")}var D=function(e,t){this.line=e,this.column=t};D.prototype.offset=function(e){return new D(this.line,this.column+e)};var z=function(e,t,n){this.start=t,this.end=n,null!==e.sourceFile&&(this.source=e.sourceFile)};function N(e,t){for(var n=1,r=0;;){k.lastIndex=r;var i=k.exec(e);if(!(i&&i.index<t))return new D(n,t-r);++n,r=i.index+i[0].length}}var F={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function j(e){var t={};for(var n in F)t[n]=e&&P(e,n)?e[n]:F[n];if(t.ecmaVersion>=2015&&(t.ecmaVersion-=2009),null==t.allowReserved&&(t.allowReserved=t.ecmaVersion<5),R(t.onToken)){var r=t.onToken;t.onToken=function(e){return r.push(e)}}return R(t.onComment)&&(t.onComment=B(t,t.onComment)),t}function B(e,t){return function(n,r,i,a,o,s){var u={type:n?"Block":"Line",value:r,start:i,end:a};e.locations&&(u.loc=new z(this,o,s)),e.ranges&&(u.range=[i,a]),t.push(u)}}var U=1,V=2,G=U|V,H=4,W=8,Y=16,q=32,Z=64,K=128;function X(e,t){return V|(e?H:0)|(t?W:0)}var Q=0,J=1,$=2,ee=3,te=4,ne=5,re=function(e,t,n){this.options=e=j(e),this.sourceFile=e.sourceFile,this.keywords=I(o[e.ecmaVersion>=6?6:"module"===e.sourceType?"5module":5]);var r="";if(!0!==e.allowReserved){for(var a=e.ecmaVersion;;a--)if(r=i[a])break;"module"===e.sourceType&&(r+=" await")}this.reservedWords=I(r);var s=(r?r+" ":"")+i.strict;this.reservedWordsStrict=I(s),this.reservedWordsStrictBind=I(s+" "+i.strictBind),this.input=String(t),this.containsEsc=!1,n?(this.pos=n,this.lineStart=this.input.lastIndexOf("\n",n-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(C).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=w.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule="module"===e.sourceType,this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},0===this.pos&&e.allowHashBang&&"#!"===this.input.slice(0,2)&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(U),this.regexpState=null},ie={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};re.prototype.parse=function(){var e=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(e)},ie.inFunction.get=function(){return(this.currentVarScope().flags&V)>0},ie.inGenerator.get=function(){return(this.currentVarScope().flags&W)>0},ie.inAsync.get=function(){return(this.currentVarScope().flags&H)>0},ie.allowSuper.get=function(){return(this.currentThisScope().flags&Z)>0},ie.allowDirectSuper.get=function(){return(this.currentThisScope().flags&K)>0},ie.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},re.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&V)>0},re.extend=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];for(var n=this,r=0;r<e.length;r++)n=e[r](n);return n},re.parse=function(e,t){return new this(t,e).parse()},re.parseExpressionAt=function(e,t,n){var r=new this(n,e,t);return r.nextToken(),r.parseExpression()},re.tokenizer=function(e,t){return new this(t,e)},Object.defineProperties(re.prototype,ie);var ae=re.prototype,oe=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;function se(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}ae.strictDirective=function(e){for(;;){T.lastIndex=e,e+=T.exec(this.input)[0].length;var t=oe.exec(this.input.slice(e));if(!t)return!1;if("use strict"===(t[1]||t[2])){T.lastIndex=e+t[0].length;var n=T.exec(this.input),r=n.index+n[0].length,i=this.input.charAt(r);return";"===i||"}"===i||C.test(n[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(i)||"!"===i&&"="===this.input.charAt(r+1))}e+=t[0].length,T.lastIndex=e,e+=T.exec(this.input)[0].length,";"===this.input[e]&&e++}},ae.eat=function(e){return this.type===e&&(this.next(),!0)},ae.isContextual=function(e){return this.type===w.name&&this.value===e&&!this.containsEsc},ae.eatContextual=function(e){return!!this.isContextual(e)&&(this.next(),!0)},ae.expectContextual=function(e){this.eatContextual(e)||this.unexpected()},ae.canInsertSemicolon=function(){return this.type===w.eof||this.type===w.braceR||C.test(this.input.slice(this.lastTokEnd,this.start))},ae.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},ae.semicolon=function(){this.eat(w.semi)||this.insertSemicolon()||this.unexpected()},ae.afterTrailingComma=function(e,t){if(this.type===e)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),t||this.next(),!0},ae.expect=function(e){this.eat(e)||this.unexpected()},ae.unexpected=function(e){this.raise(null!=e?e:this.start,"Unexpected token")},ae.checkPatternErrors=function(e,t){if(e){e.trailingComma>-1&&this.raiseRecoverable(e.trailingComma,"Comma is not permitted after the rest element");var n=t?e.parenthesizedAssign:e.parenthesizedBind;n>-1&&this.raiseRecoverable(n,"Parenthesized pattern")}},ae.checkExpressionErrors=function(e,t){if(!e)return!1;var n=e.shorthandAssign,r=e.doubleProto;if(!t)return n>=0||r>=0;n>=0&&this.raise(n,"Shorthand property assignments are valid only in destructuring patterns"),r>=0&&this.raiseRecoverable(r,"Redefinition of __proto__ property")},ae.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},ae.isSimpleAssignTarget=function(e){return"ParenthesizedExpression"===e.type?this.isSimpleAssignTarget(e.expression):"Identifier"===e.type||"MemberExpression"===e.type};var ue=re.prototype;ue.parseTopLevel=function(e){var t={};e.body||(e.body=[]);while(this.type!==w.eof){var n=this.parseStatement(null,!0,t);e.body.push(n)}if(this.inModule)for(var r=0,i=Object.keys(this.undefinedExports);r<i.length;r+=1){var a=i[r];this.raiseRecoverable(this.undefinedExports[a].start,"Export '"+a+"' is not defined")}return this.adaptDirectivePrologue(e.body),this.next(),e.sourceType=this.options.sourceType,this.finishNode(e,"Program")};var le={kind:"loop"},ce={kind:"switch"};ue.isLet=function(e){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;T.lastIndex=this.pos;var t=T.exec(this.input),n=this.pos+t[0].length,r=this.input.charCodeAt(n);if(91===r)return!0;if(e)return!1;if(123===r)return!0;if(v(r,!0)){var i=n+1;while(g(this.input.charCodeAt(i),!0))++i;var a=this.input.slice(n,i);if(!s.test(a))return!0}return!1},ue.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;T.lastIndex=this.pos;var e=T.exec(this.input),t=this.pos+e[0].length;return!C.test(this.input.slice(this.pos,t))&&"function"===this.input.slice(t,t+8)&&(t+8===this.input.length||!g(this.input.charAt(t+8)))},ue.parseStatement=function(e,t,n){var r,i=this.type,a=this.startNode();switch(this.isLet(e)&&(i=w._var,r="let"),i){case w._break:case w._continue:return this.parseBreakContinueStatement(a,i.keyword);case w._debugger:return this.parseDebuggerStatement(a);case w._do:return this.parseDoStatement(a);case w._for:return this.parseForStatement(a);case w._function:return e&&(this.strict||"if"!==e&&"label"!==e)&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(a,!1,!e);case w._class:return e&&this.unexpected(),this.parseClass(a,!0);case w._if:return this.parseIfStatement(a);case w._return:return this.parseReturnStatement(a);case w._switch:return this.parseSwitchStatement(a);case w._throw:return this.parseThrowStatement(a);case w._try:return this.parseTryStatement(a);case w._const:case w._var:return r=r||this.value,e&&"var"!==r&&this.unexpected(),this.parseVarStatement(a,r);case w._while:return this.parseWhileStatement(a);case w._with:return this.parseWithStatement(a);case w.braceL:return this.parseBlock(!0,a);case w.semi:return this.parseEmptyStatement(a);case w._export:case w._import:if(this.options.ecmaVersion>10&&i===w._import){T.lastIndex=this.pos;var o=T.exec(this.input),s=this.pos+o[0].length,u=this.input.charCodeAt(s);if(40===u||46===u)return this.parseExpressionStatement(a,this.parseExpression())}return this.options.allowImportExportEverywhere||(t||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),i===w._import?this.parseImport(a):this.parseExport(a,n);default:if(this.isAsyncFunction())return e&&this.unexpected(),this.next(),this.parseFunctionStatement(a,!0,!e);var l=this.value,c=this.parseExpression();return i===w.name&&"Identifier"===c.type&&this.eat(w.colon)?this.parseLabeledStatement(a,l,c,e):this.parseExpressionStatement(a,c)}},ue.parseBreakContinueStatement=function(e,t){var n="break"===t;this.next(),this.eat(w.semi)||this.insertSemicolon()?e.label=null:this.type!==w.name?this.unexpected():(e.label=this.parseIdent(),this.semicolon());for(var r=0;r<this.labels.length;++r){var i=this.labels[r];if(null==e.label||i.name===e.label.name){if(null!=i.kind&&(n||"loop"===i.kind))break;if(e.label&&n)break}}return r===this.labels.length&&this.raise(e.start,"Unsyntactic "+t),this.finishNode(e,n?"BreakStatement":"ContinueStatement")},ue.parseDebuggerStatement=function(e){return this.next(),this.semicolon(),this.finishNode(e,"DebuggerStatement")},ue.parseDoStatement=function(e){return this.next(),this.labels.push(le),e.body=this.parseStatement("do"),this.labels.pop(),this.expect(w._while),e.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(w.semi):this.semicolon(),this.finishNode(e,"DoWhileStatement")},ue.parseForStatement=function(e){this.next();var t=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(le),this.enterScope(0),this.expect(w.parenL),this.type===w.semi)return t>-1&&this.unexpected(t),this.parseFor(e,null);var n=this.isLet();if(this.type===w._var||this.type===w._const||n){var r=this.startNode(),i=n?"let":this.value;return this.next(),this.parseVar(r,!0,i),this.finishNode(r,"VariableDeclaration"),(this.type===w._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&1===r.declarations.length?(this.options.ecmaVersion>=9&&(this.type===w._in?t>-1&&this.unexpected(t):e.await=t>-1),this.parseForIn(e,r)):(t>-1&&this.unexpected(t),this.parseFor(e,r))}var a=new se,o=this.parseExpression(!0,a);return this.type===w._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===w._in?t>-1&&this.unexpected(t):e.await=t>-1),this.toAssignable(o,!1,a),this.checkLVal(o),this.parseForIn(e,o)):(this.checkExpressionErrors(a,!0),t>-1&&this.unexpected(t),this.parseFor(e,o))},ue.parseFunctionStatement=function(e,t,n){return this.next(),this.parseFunction(e,he|(n?0:pe),!1,t)},ue.parseIfStatement=function(e){return this.next(),e.test=this.parseParenExpression(),e.consequent=this.parseStatement("if"),e.alternate=this.eat(w._else)?this.parseStatement("if"):null,this.finishNode(e,"IfStatement")},ue.parseReturnStatement=function(e){return this.inFunction||this.options.allowReturnOutsideFunction||this.raise(this.start,"'return' outside of function"),this.next(),this.eat(w.semi)||this.insertSemicolon()?e.argument=null:(e.argument=this.parseExpression(),this.semicolon()),this.finishNode(e,"ReturnStatement")},ue.parseSwitchStatement=function(e){var t;this.next(),e.discriminant=this.parseParenExpression(),e.cases=[],this.expect(w.braceL),this.labels.push(ce),this.enterScope(0);for(var n=!1;this.type!==w.braceR;)if(this.type===w._case||this.type===w._default){var r=this.type===w._case;t&&this.finishNode(t,"SwitchCase"),e.cases.push(t=this.startNode()),t.consequent=[],this.next(),r?t.test=this.parseExpression():(n&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),n=!0,t.test=null),this.expect(w.colon)}else t||this.unexpected(),t.consequent.push(this.parseStatement(null));return this.exitScope(),t&&this.finishNode(t,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(e,"SwitchStatement")},ue.parseThrowStatement=function(e){return this.next(),C.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),e.argument=this.parseExpression(),this.semicolon(),this.finishNode(e,"ThrowStatement")};var fe=[];ue.parseTryStatement=function(e){if(this.next(),e.block=this.parseBlock(),e.handler=null,this.type===w._catch){var t=this.startNode();if(this.next(),this.eat(w.parenL)){t.param=this.parseBindingAtom();var n="Identifier"===t.param.type;this.enterScope(n?q:0),this.checkLVal(t.param,n?te:$),this.expect(w.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),t.param=null,this.enterScope(0);t.body=this.parseBlock(!1),this.exitScope(),e.handler=this.finishNode(t,"CatchClause")}return e.finalizer=this.eat(w._finally)?this.parseBlock():null,e.handler||e.finalizer||this.raise(e.start,"Missing catch or finally clause"),this.finishNode(e,"TryStatement")},ue.parseVarStatement=function(e,t){return this.next(),this.parseVar(e,!1,t),this.semicolon(),this.finishNode(e,"VariableDeclaration")},ue.parseWhileStatement=function(e){return this.next(),e.test=this.parseParenExpression(),this.labels.push(le),e.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(e,"WhileStatement")},ue.parseWithStatement=function(e){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),e.object=this.parseParenExpression(),e.body=this.parseStatement("with"),this.finishNode(e,"WithStatement")},ue.parseEmptyStatement=function(e){return this.next(),this.finishNode(e,"EmptyStatement")},ue.parseLabeledStatement=function(e,t,n,r){for(var i=0,a=this.labels;i<a.length;i+=1){var o=a[i];o.name===t&&this.raise(n.start,"Label '"+t+"' is already declared")}for(var s=this.type.isLoop?"loop":this.type===w._switch?"switch":null,u=this.labels.length-1;u>=0;u--){var l=this.labels[u];if(l.statementStart!==e.start)break;l.statementStart=this.start,l.kind=s}return this.labels.push({name:t,kind:s,statementStart:this.start}),e.body=this.parseStatement(r?-1===r.indexOf("label")?r+"label":r:"label"),this.labels.pop(),e.label=n,this.finishNode(e,"LabeledStatement")},ue.parseExpressionStatement=function(e,t){return e.expression=t,this.semicolon(),this.finishNode(e,"ExpressionStatement")},ue.parseBlock=function(e,t,n){void 0===e&&(e=!0),void 0===t&&(t=this.startNode()),t.body=[],this.expect(w.braceL),e&&this.enterScope(0);while(this.type!==w.braceR){var r=this.parseStatement(null);t.body.push(r)}return n&&(this.strict=!1),this.next(),e&&this.exitScope(),this.finishNode(t,"BlockStatement")},ue.parseFor=function(e,t){return e.init=t,this.expect(w.semi),e.test=this.type===w.semi?null:this.parseExpression(),this.expect(w.semi),e.update=this.type===w.parenR?null:this.parseExpression(),this.expect(w.parenR),e.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(e,"ForStatement")},ue.parseForIn=function(e,t){var n=this.type===w._in;return this.next(),"VariableDeclaration"===t.type&&null!=t.declarations[0].init&&(!n||this.options.ecmaVersion<8||this.strict||"var"!==t.kind||"Identifier"!==t.declarations[0].id.type)?this.raise(t.start,(n?"for-in":"for-of")+" loop variable declaration may not have an initializer"):"AssignmentPattern"===t.type&&this.raise(t.start,"Invalid left-hand side in for-loop"),e.left=t,e.right=n?this.parseExpression():this.parseMaybeAssign(),this.expect(w.parenR),e.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(e,n?"ForInStatement":"ForOfStatement")},ue.parseVar=function(e,t,n){for(e.declarations=[],e.kind=n;;){var r=this.startNode();if(this.parseVarId(r,n),this.eat(w.eq)?r.init=this.parseMaybeAssign(t):"const"!==n||this.type===w._in||this.options.ecmaVersion>=6&&this.isContextual("of")?"Identifier"===r.id.type||t&&(this.type===w._in||this.isContextual("of"))?r.init=null:this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):this.unexpected(),e.declarations.push(this.finishNode(r,"VariableDeclarator")),!this.eat(w.comma))break}return e},ue.parseVarId=function(e,t){e.id=this.parseBindingAtom(),this.checkLVal(e.id,"var"===t?J:$,!1)};var he=1,pe=2,de=4;ue.parseFunction=function(e,t,n,r){this.initFunction(e),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!r)&&(this.type===w.star&&t&pe&&this.unexpected(),e.generator=this.eat(w.star)),this.options.ecmaVersion>=8&&(e.async=!!r),t&he&&(e.id=t&de&&this.type!==w.name?null:this.parseIdent(),!e.id||t&pe||this.checkLVal(e.id,this.strict||e.generator||e.async?this.treatFunctionsAsVar?J:$:ee));var i=this.yieldPos,a=this.awaitPos,o=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(X(e.async,e.generator)),t&he||(e.id=this.type===w.name?this.parseIdent():null),this.parseFunctionParams(e),this.parseFunctionBody(e,n,!1),this.yieldPos=i,this.awaitPos=a,this.awaitIdentPos=o,this.finishNode(e,t&he?"FunctionDeclaration":"FunctionExpression")},ue.parseFunctionParams=function(e){this.expect(w.parenL),e.params=this.parseBindingList(w.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},ue.parseClass=function(e,t){this.next();var n=this.strict;this.strict=!0,this.parseClassId(e,t),this.parseClassSuper(e);var r=this.startNode(),i=!1;r.body=[],this.expect(w.braceL);while(this.type!==w.braceR){var a=this.parseClassElement(null!==e.superClass);a&&(r.body.push(a),"MethodDefinition"===a.type&&"constructor"===a.kind&&(i&&this.raise(a.start,"Duplicate constructor in the same class"),i=!0))}return this.strict=n,this.next(),e.body=this.finishNode(r,"ClassBody"),this.finishNode(e,t?"ClassDeclaration":"ClassExpression")},ue.parseClassElement=function(e){var t=this;if(this.eat(w.semi))return null;var n=this.startNode(),r=function(e,r){void 0===r&&(r=!1);var i=t.start,a=t.startLoc;return!!t.eatContextual(e)&&(!(t.type===w.parenL||r&&t.canInsertSemicolon())||(n.key&&t.unexpected(),n.computed=!1,n.key=t.startNodeAt(i,a),n.key.name=e,t.finishNode(n.key,"Identifier"),!1))};n.kind="method",n.static=r("static");var i=this.eat(w.star),a=!1;i||(this.options.ecmaVersion>=8&&r("async",!0)?(a=!0,i=this.options.ecmaVersion>=9&&this.eat(w.star)):r("get")?n.kind="get":r("set")&&(n.kind="set")),n.key||this.parsePropertyName(n);var o=n.key,s=!1;return n.computed||n.static||!("Identifier"===o.type&&"constructor"===o.name||"Literal"===o.type&&"constructor"===o.value)?n.static&&"Identifier"===o.type&&"prototype"===o.name&&this.raise(o.start,"Classes may not have a static property named prototype"):("method"!==n.kind&&this.raise(o.start,"Constructor can't have get/set modifier"),i&&this.raise(o.start,"Constructor can't be a generator"),a&&this.raise(o.start,"Constructor can't be an async method"),n.kind="constructor",s=e),this.parseClassMethod(n,i,a,s),"get"===n.kind&&0!==n.value.params.length&&this.raiseRecoverable(n.value.start,"getter should have no params"),"set"===n.kind&&1!==n.value.params.length&&this.raiseRecoverable(n.value.start,"setter should have exactly one param"),"set"===n.kind&&"RestElement"===n.value.params[0].type&&this.raiseRecoverable(n.value.params[0].start,"Setter cannot use rest params"),n},ue.parseClassMethod=function(e,t,n,r){return e.value=this.parseMethod(t,n,r),this.finishNode(e,"MethodDefinition")},ue.parseClassId=function(e,t){this.type===w.name?(e.id=this.parseIdent(),t&&this.checkLVal(e.id,$,!1)):(!0===t&&this.unexpected(),e.id=null)},ue.parseClassSuper=function(e){e.superClass=this.eat(w._extends)?this.parseExprSubscripts():null},ue.parseExport=function(e,t){if(this.next(),this.eat(w.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(e.exported=this.parseIdent(!0),this.checkExport(t,e.exported.name,this.lastTokStart)):e.exported=null),this.expectContextual("from"),this.type!==w.string&&this.unexpected(),e.source=this.parseExprAtom(),this.semicolon(),this.finishNode(e,"ExportAllDeclaration");if(this.eat(w._default)){var n;if(this.checkExport(t,"default",this.lastTokStart),this.type===w._function||(n=this.isAsyncFunction())){var r=this.startNode();this.next(),n&&this.next(),e.declaration=this.parseFunction(r,he|de,!1,n)}else if(this.type===w._class){var i=this.startNode();e.declaration=this.parseClass(i,"nullableID")}else e.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(e,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())e.declaration=this.parseStatement(null),"VariableDeclaration"===e.declaration.type?this.checkVariableExport(t,e.declaration.declarations):this.checkExport(t,e.declaration.id.name,e.declaration.id.start),e.specifiers=[],e.source=null;else{if(e.declaration=null,e.specifiers=this.parseExportSpecifiers(t),this.eatContextual("from"))this.type!==w.string&&this.unexpected(),e.source=this.parseExprAtom();else{for(var a=0,o=e.specifiers;a<o.length;a+=1){var s=o[a];this.checkUnreserved(s.local),this.checkLocalExport(s.local)}e.source=null}this.semicolon()}return this.finishNode(e,"ExportNamedDeclaration")},ue.checkExport=function(e,t,n){e&&(P(e,t)&&this.raiseRecoverable(n,"Duplicate export '"+t+"'"),e[t]=!0)},ue.checkPatternExport=function(e,t){var n=t.type;if("Identifier"===n)this.checkExport(e,t.name,t.start);else if("ObjectPattern"===n)for(var r=0,i=t.properties;r<i.length;r+=1){var a=i[r];this.checkPatternExport(e,a)}else if("ArrayPattern"===n)for(var o=0,s=t.elements;o<s.length;o+=1){var u=s[o];u&&this.checkPatternExport(e,u)}else"Property"===n?this.checkPatternExport(e,t.value):"AssignmentPattern"===n?this.checkPatternExport(e,t.left):"RestElement"===n?this.checkPatternExport(e,t.argument):"ParenthesizedExpression"===n&&this.checkPatternExport(e,t.expression)},ue.checkVariableExport=function(e,t){if(e)for(var n=0,r=t;n<r.length;n+=1){var i=r[n];this.checkPatternExport(e,i.id)}},ue.shouldParseExportStatement=function(){return"var"===this.type.keyword||"const"===this.type.keyword||"class"===this.type.keyword||"function"===this.type.keyword||this.isLet()||this.isAsyncFunction()},ue.parseExportSpecifiers=function(e){var t=[],n=!0;this.expect(w.braceL);while(!this.eat(w.braceR)){if(n)n=!1;else if(this.expect(w.comma),this.afterTrailingComma(w.braceR))break;var r=this.startNode();r.local=this.parseIdent(!0),r.exported=this.eatContextual("as")?this.parseIdent(!0):r.local,this.checkExport(e,r.exported.name,r.exported.start),t.push(this.finishNode(r,"ExportSpecifier"))}return t},ue.parseImport=function(e){return this.next(),this.type===w.string?(e.specifiers=fe,e.source=this.parseExprAtom()):(e.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),e.source=this.type===w.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(e,"ImportDeclaration")},ue.parseImportSpecifiers=function(){var e=[],t=!0;if(this.type===w.name){var n=this.startNode();if(n.local=this.parseIdent(),this.checkLVal(n.local,$),e.push(this.finishNode(n,"ImportDefaultSpecifier")),!this.eat(w.comma))return e}if(this.type===w.star){var r=this.startNode();return this.next(),this.expectContextual("as"),r.local=this.parseIdent(),this.checkLVal(r.local,$),e.push(this.finishNode(r,"ImportNamespaceSpecifier")),e}this.expect(w.braceL);while(!this.eat(w.braceR)){if(t)t=!1;else if(this.expect(w.comma),this.afterTrailingComma(w.braceR))break;var i=this.startNode();i.imported=this.parseIdent(!0),this.eatContextual("as")?i.local=this.parseIdent():(this.checkUnreserved(i.imported),i.local=i.imported),this.checkLVal(i.local,$),e.push(this.finishNode(i,"ImportSpecifier"))}return e},ue.adaptDirectivePrologue=function(e){for(var t=0;t<e.length&&this.isDirectiveCandidate(e[t]);++t)e[t].directive=e[t].expression.raw.slice(1,-1)},ue.isDirectiveCandidate=function(e){return"ExpressionStatement"===e.type&&"Literal"===e.expression.type&&"string"===typeof e.expression.value&&('"'===this.input[e.start]||"'"===this.input[e.start])};var ve=re.prototype;ve.toAssignable=function(e,t,n){if(this.options.ecmaVersion>=6&&e)switch(e.type){case"Identifier":this.inAsync&&"await"===e.name&&this.raise(e.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":e.type="ObjectPattern",n&&this.checkPatternErrors(n,!0);for(var r=0,i=e.properties;r<i.length;r+=1){var a=i[r];this.toAssignable(a,t),"RestElement"!==a.type||"ArrayPattern"!==a.argument.type&&"ObjectPattern"!==a.argument.type||this.raise(a.argument.start,"Unexpected token")}break;case"Property":"init"!==e.kind&&this.raise(e.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(e.value,t);break;case"ArrayExpression":e.type="ArrayPattern",n&&this.checkPatternErrors(n,!0),this.toAssignableList(e.elements,t);break;case"SpreadElement":e.type="RestElement",this.toAssignable(e.argument,t),"AssignmentPattern"===e.argument.type&&this.raise(e.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":"="!==e.operator&&this.raise(e.left.end,"Only '=' operator can be used for specifying default value."),e.type="AssignmentPattern",delete e.operator,this.toAssignable(e.left,t);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(e.expression,t,n);break;case"ChainExpression":this.raiseRecoverable(e.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!t)break;default:this.raise(e.start,"Assigning to rvalue")}else n&&this.checkPatternErrors(n,!0);return e},ve.toAssignableList=function(e,t){for(var n=e.length,r=0;r<n;r++){var i=e[r];i&&this.toAssignable(i,t)}if(n){var a=e[n-1];6===this.options.ecmaVersion&&t&&a&&"RestElement"===a.type&&"Identifier"!==a.argument.type&&this.unexpected(a.argument.start)}return e},ve.parseSpread=function(e){var t=this.startNode();return this.next(),t.argument=this.parseMaybeAssign(!1,e),this.finishNode(t,"SpreadElement")},ve.parseRestBinding=function(){var e=this.startNode();return this.next(),6===this.options.ecmaVersion&&this.type!==w.name&&this.unexpected(),e.argument=this.parseBindingAtom(),this.finishNode(e,"RestElement")},ve.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case w.bracketL:var e=this.startNode();return this.next(),e.elements=this.parseBindingList(w.bracketR,!0,!0),this.finishNode(e,"ArrayPattern");case w.braceL:return this.parseObj(!0)}return this.parseIdent()},ve.parseBindingList=function(e,t,n){var r=[],i=!0;while(!this.eat(e))if(i?i=!1:this.expect(w.comma),t&&this.type===w.comma)r.push(null);else{if(n&&this.afterTrailingComma(e))break;if(this.type===w.ellipsis){var a=this.parseRestBinding();this.parseBindingListItem(a),r.push(a),this.type===w.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(e);break}var o=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(o),r.push(o)}return r},ve.parseBindingListItem=function(e){return e},ve.parseMaybeDefault=function(e,t,n){if(n=n||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(w.eq))return n;var r=this.startNodeAt(e,t);return r.left=n,r.right=this.parseMaybeAssign(),this.finishNode(r,"AssignmentPattern")},ve.checkLVal=function(e,t,n){switch(void 0===t&&(t=Q),e.type){case"Identifier":t===$&&"let"===e.name&&this.raiseRecoverable(e.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(e.name)&&this.raiseRecoverable(e.start,(t?"Binding ":"Assigning to ")+e.name+" in strict mode"),n&&(P(n,e.name)&&this.raiseRecoverable(e.start,"Argument name clash"),n[e.name]=!0),t!==Q&&t!==ne&&this.declareName(e.name,t,e.start);break;case"ChainExpression":this.raiseRecoverable(e.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":t&&this.raiseRecoverable(e.start,"Binding member expression");break;case"ObjectPattern":for(var r=0,i=e.properties;r<i.length;r+=1){var a=i[r];this.checkLVal(a,t,n)}break;case"Property":this.checkLVal(e.value,t,n);break;case"ArrayPattern":for(var o=0,s=e.elements;o<s.length;o+=1){var u=s[o];u&&this.checkLVal(u,t,n)}break;case"AssignmentPattern":this.checkLVal(e.left,t,n);break;case"RestElement":this.checkLVal(e.argument,t,n);break;case"ParenthesizedExpression":this.checkLVal(e.expression,t,n);break;default:this.raise(e.start,(t?"Binding":"Assigning to")+" rvalue")}};var ge=re.prototype;ge.checkPropClash=function(e,t,n){if(!(this.options.ecmaVersion>=9&&"SpreadElement"===e.type)&&!(this.options.ecmaVersion>=6&&(e.computed||e.method||e.shorthand))){var r,i=e.key;switch(i.type){case"Identifier":r=i.name;break;case"Literal":r=String(i.value);break;default:return}var a=e.kind;if(this.options.ecmaVersion>=6)"__proto__"===r&&"init"===a&&(t.proto&&(n?n.doubleProto<0&&(n.doubleProto=i.start):this.raiseRecoverable(i.start,"Redefinition of __proto__ property")),t.proto=!0);else{r="$"+r;var o,s=t[r];if(s)o="init"===a?this.strict&&s.init||s.get||s.set:s.init||s[a],o&&this.raiseRecoverable(i.start,"Redefinition of property");else s=t[r]={init:!1,get:!1,set:!1};s[a]=!0}}},ge.parseExpression=function(e,t){var n=this.start,r=this.startLoc,i=this.parseMaybeAssign(e,t);if(this.type===w.comma){var a=this.startNodeAt(n,r);a.expressions=[i];while(this.eat(w.comma))a.expressions.push(this.parseMaybeAssign(e,t));return this.finishNode(a,"SequenceExpression")}return i},ge.parseMaybeAssign=function(e,t,n){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(e);this.exprAllowed=!1}var r=!1,i=-1,a=-1;t?(i=t.parenthesizedAssign,a=t.trailingComma,t.parenthesizedAssign=t.trailingComma=-1):(t=new se,r=!0);var o=this.start,s=this.startLoc;this.type!==w.parenL&&this.type!==w.name||(this.potentialArrowAt=this.start);var u=this.parseMaybeConditional(e,t);if(n&&(u=n.call(this,u,o,s)),this.type.isAssign){var l=this.startNodeAt(o,s);return l.operator=this.value,l.left=this.type===w.eq?this.toAssignable(u,!1,t):u,r||(t.parenthesizedAssign=t.trailingComma=t.doubleProto=-1),t.shorthandAssign>=l.left.start&&(t.shorthandAssign=-1),this.checkLVal(u),this.next(),l.right=this.parseMaybeAssign(e),this.finishNode(l,"AssignmentExpression")}return r&&this.checkExpressionErrors(t,!0),i>-1&&(t.parenthesizedAssign=i),a>-1&&(t.trailingComma=a),u},ge.parseMaybeConditional=function(e,t){var n=this.start,r=this.startLoc,i=this.parseExprOps(e,t);if(this.checkExpressionErrors(t))return i;if(this.eat(w.question)){var a=this.startNodeAt(n,r);return a.test=i,a.consequent=this.parseMaybeAssign(),this.expect(w.colon),a.alternate=this.parseMaybeAssign(e),this.finishNode(a,"ConditionalExpression")}return i},ge.parseExprOps=function(e,t){var n=this.start,r=this.startLoc,i=this.parseMaybeUnary(t,!1);return this.checkExpressionErrors(t)||i.start===n&&"ArrowFunctionExpression"===i.type?i:this.parseExprOp(i,n,r,-1,e)},ge.parseExprOp=function(e,t,n,r,i){var a=this.type.binop;if(null!=a&&(!i||this.type!==w._in)&&a>r){var o=this.type===w.logicalOR||this.type===w.logicalAND,s=this.type===w.coalesce;s&&(a=w.logicalAND.binop);var u=this.value;this.next();var l=this.start,c=this.startLoc,f=this.parseExprOp(this.parseMaybeUnary(null,!1),l,c,a,i),h=this.buildBinary(t,n,e,f,u,o||s);return(o&&this.type===w.coalesce||s&&(this.type===w.logicalOR||this.type===w.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(h,t,n,r,i)}return e},ge.buildBinary=function(e,t,n,r,i,a){var o=this.startNodeAt(e,t);return o.left=n,o.operator=i,o.right=r,this.finishNode(o,a?"LogicalExpression":"BinaryExpression")},ge.parseMaybeUnary=function(e,t){var n,r=this.start,i=this.startLoc;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))n=this.parseAwait(),t=!0;else if(this.type.prefix){var a=this.startNode(),o=this.type===w.incDec;a.operator=this.value,a.prefix=!0,this.next(),a.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(e,!0),o?this.checkLVal(a.argument):this.strict&&"delete"===a.operator&&"Identifier"===a.argument.type?this.raiseRecoverable(a.start,"Deleting local variable in strict mode"):t=!0,n=this.finishNode(a,o?"UpdateExpression":"UnaryExpression")}else{if(n=this.parseExprSubscripts(e),this.checkExpressionErrors(e))return n;while(this.type.postfix&&!this.canInsertSemicolon()){var s=this.startNodeAt(r,i);s.operator=this.value,s.prefix=!1,s.argument=n,this.checkLVal(n),this.next(),n=this.finishNode(s,"UpdateExpression")}}return!t&&this.eat(w.starstar)?this.buildBinary(r,i,n,this.parseMaybeUnary(null,!1),"**",!1):n},ge.parseExprSubscripts=function(e){var t=this.start,n=this.startLoc,r=this.parseExprAtom(e);if("ArrowFunctionExpression"===r.type&&")"!==this.input.slice(this.lastTokStart,this.lastTokEnd))return r;var i=this.parseSubscripts(r,t,n);return e&&"MemberExpression"===i.type&&(e.parenthesizedAssign>=i.start&&(e.parenthesizedAssign=-1),e.parenthesizedBind>=i.start&&(e.parenthesizedBind=-1)),i},ge.parseSubscripts=function(e,t,n,r){var i=this.options.ecmaVersion>=8&&"Identifier"===e.type&&"async"===e.name&&this.lastTokEnd===e.end&&!this.canInsertSemicolon()&&e.end-e.start===5&&this.potentialArrowAt===e.start,a=!1;while(1){var o=this.parseSubscript(e,t,n,r,i,a);if(o.optional&&(a=!0),o===e||"ArrowFunctionExpression"===o.type){if(a){var s=this.startNodeAt(t,n);s.expression=o,o=this.finishNode(s,"ChainExpression")}return o}e=o}},ge.parseSubscript=function(e,t,n,r,i,a){var o=this.options.ecmaVersion>=11,s=o&&this.eat(w.questionDot);r&&s&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var u=this.eat(w.bracketL);if(u||s&&this.type!==w.parenL&&this.type!==w.backQuote||this.eat(w.dot)){var l=this.startNodeAt(t,n);l.object=e,l.property=u?this.parseExpression():this.parseIdent("never"!==this.options.allowReserved),l.computed=!!u,u&&this.expect(w.bracketR),o&&(l.optional=s),e=this.finishNode(l,"MemberExpression")}else if(!r&&this.eat(w.parenL)){var c=new se,f=this.yieldPos,h=this.awaitPos,p=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var d=this.parseExprList(w.parenR,this.options.ecmaVersion>=8,!1,c);if(i&&!s&&!this.canInsertSemicolon()&&this.eat(w.arrow))return this.checkPatternErrors(c,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=f,this.awaitPos=h,this.awaitIdentPos=p,this.parseArrowExpression(this.startNodeAt(t,n),d,!0);this.checkExpressionErrors(c,!0),this.yieldPos=f||this.yieldPos,this.awaitPos=h||this.awaitPos,this.awaitIdentPos=p||this.awaitIdentPos;var v=this.startNodeAt(t,n);v.callee=e,v.arguments=d,o&&(v.optional=s),e=this.finishNode(v,"CallExpression")}else if(this.type===w.backQuote){(s||a)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var g=this.startNodeAt(t,n);g.tag=e,g.quasi=this.parseTemplate({isTagged:!0}),e=this.finishNode(g,"TaggedTemplateExpression")}return e},ge.parseExprAtom=function(e){this.type===w.slash&&this.readRegexp();var t,n=this.potentialArrowAt===this.start;switch(this.type){case w._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),t=this.startNode(),this.next(),this.type!==w.parenL||this.allowDirectSuper||this.raise(t.start,"super() call outside constructor of a subclass"),this.type!==w.dot&&this.type!==w.bracketL&&this.type!==w.parenL&&this.unexpected(),this.finishNode(t,"Super");case w._this:return t=this.startNode(),this.next(),this.finishNode(t,"ThisExpression");case w.name:var r=this.start,i=this.startLoc,a=this.containsEsc,o=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!a&&"async"===o.name&&!this.canInsertSemicolon()&&this.eat(w._function))return this.parseFunction(this.startNodeAt(r,i),0,!1,!0);if(n&&!this.canInsertSemicolon()){if(this.eat(w.arrow))return this.parseArrowExpression(this.startNodeAt(r,i),[o],!1);if(this.options.ecmaVersion>=8&&"async"===o.name&&this.type===w.name&&!a)return o=this.parseIdent(!1),!this.canInsertSemicolon()&&this.eat(w.arrow)||this.unexpected(),this.parseArrowExpression(this.startNodeAt(r,i),[o],!0)}return o;case w.regexp:var s=this.value;return t=this.parseLiteral(s.value),t.regex={pattern:s.pattern,flags:s.flags},t;case w.num:case w.string:return this.parseLiteral(this.value);case w._null:case w._true:case w._false:return t=this.startNode(),t.value=this.type===w._null?null:this.type===w._true,t.raw=this.type.keyword,this.next(),this.finishNode(t,"Literal");case w.parenL:var u=this.start,l=this.parseParenAndDistinguishExpression(n);return e&&(e.parenthesizedAssign<0&&!this.isSimpleAssignTarget(l)&&(e.parenthesizedAssign=u),e.parenthesizedBind<0&&(e.parenthesizedBind=u)),l;case w.bracketL:return t=this.startNode(),this.next(),t.elements=this.parseExprList(w.bracketR,!0,!0,e),this.finishNode(t,"ArrayExpression");case w.braceL:return this.parseObj(!1,e);case w._function:return t=this.startNode(),this.next(),this.parseFunction(t,0);case w._class:return this.parseClass(this.startNode(),!1);case w._new:return this.parseNew();case w.backQuote:return this.parseTemplate();case w._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},ge.parseExprImport=function(){var e=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var t=this.parseIdent(!0);switch(this.type){case w.parenL:return this.parseDynamicImport(e);case w.dot:return e.meta=t,this.parseImportMeta(e);default:this.unexpected()}},ge.parseDynamicImport=function(e){if(this.next(),e.source=this.parseMaybeAssign(),!this.eat(w.parenR)){var t=this.start;this.eat(w.comma)&&this.eat(w.parenR)?this.raiseRecoverable(t,"Trailing comma is not allowed in import()"):this.unexpected(t)}return this.finishNode(e,"ImportExpression")},ge.parseImportMeta=function(e){this.next();var t=this.containsEsc;return e.property=this.parseIdent(!0),"meta"!==e.property.name&&this.raiseRecoverable(e.property.start,"The only valid meta property for import is 'import.meta'"),t&&this.raiseRecoverable(e.start,"'import.meta' must not contain escaped characters"),"module"!==this.options.sourceType&&this.raiseRecoverable(e.start,"Cannot use 'import.meta' outside a module"),this.finishNode(e,"MetaProperty")},ge.parseLiteral=function(e){var t=this.startNode();return t.value=e,t.raw=this.input.slice(this.start,this.end),110===t.raw.charCodeAt(t.raw.length-1)&&(t.bigint=t.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(t,"Literal")},ge.parseParenExpression=function(){this.expect(w.parenL);var e=this.parseExpression();return this.expect(w.parenR),e},ge.parseParenAndDistinguishExpression=function(e){var t,n=this.start,r=this.startLoc,i=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var a,o=this.start,s=this.startLoc,u=[],l=!0,c=!1,f=new se,h=this.yieldPos,p=this.awaitPos;this.yieldPos=0,this.awaitPos=0;while(this.type!==w.parenR){if(l?l=!1:this.expect(w.comma),i&&this.afterTrailingComma(w.parenR,!0)){c=!0;break}if(this.type===w.ellipsis){a=this.start,u.push(this.parseParenItem(this.parseRestBinding())),this.type===w.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}u.push(this.parseMaybeAssign(!1,f,this.parseParenItem))}var d=this.start,v=this.startLoc;if(this.expect(w.parenR),e&&!this.canInsertSemicolon()&&this.eat(w.arrow))return this.checkPatternErrors(f,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=h,this.awaitPos=p,this.parseParenArrowList(n,r,u);u.length&&!c||this.unexpected(this.lastTokStart),a&&this.unexpected(a),this.checkExpressionErrors(f,!0),this.yieldPos=h||this.yieldPos,this.awaitPos=p||this.awaitPos,u.length>1?(t=this.startNodeAt(o,s),t.expressions=u,this.finishNodeAt(t,"SequenceExpression",d,v)):t=u[0]}else t=this.parseParenExpression();if(this.options.preserveParens){var g=this.startNodeAt(n,r);return g.expression=t,this.finishNode(g,"ParenthesizedExpression")}return t},ge.parseParenItem=function(e){return e},ge.parseParenArrowList=function(e,t,n){return this.parseArrowExpression(this.startNodeAt(e,t),n)};var me=[];ge.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var e=this.startNode(),t=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(w.dot)){e.meta=t;var n=this.containsEsc;return e.property=this.parseIdent(!0),"target"!==e.property.name&&this.raiseRecoverable(e.property.start,"The only valid meta property for new is 'new.target'"),n&&this.raiseRecoverable(e.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(e.start,"'new.target' can only be used in functions"),this.finishNode(e,"MetaProperty")}var r=this.start,i=this.startLoc,a=this.type===w._import;return e.callee=this.parseSubscripts(this.parseExprAtom(),r,i,!0),a&&"ImportExpression"===e.callee.type&&this.raise(r,"Cannot use new with import()"),this.eat(w.parenL)?e.arguments=this.parseExprList(w.parenR,this.options.ecmaVersion>=8,!1):e.arguments=me,this.finishNode(e,"NewExpression")},ge.parseTemplateElement=function(e){var t=e.isTagged,n=this.startNode();return this.type===w.invalidTemplate?(t||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),n.value={raw:this.value,cooked:null}):n.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,"\n"),cooked:this.value},this.next(),n.tail=this.type===w.backQuote,this.finishNode(n,"TemplateElement")},ge.parseTemplate=function(e){void 0===e&&(e={});var t=e.isTagged;void 0===t&&(t=!1);var n=this.startNode();this.next(),n.expressions=[];var r=this.parseTemplateElement({isTagged:t});n.quasis=[r];while(!r.tail)this.type===w.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(w.dollarBraceL),n.expressions.push(this.parseExpression()),this.expect(w.braceR),n.quasis.push(r=this.parseTemplateElement({isTagged:t}));return this.next(),this.finishNode(n,"TemplateLiteral")},ge.isAsyncProp=function(e){return!e.computed&&"Identifier"===e.key.type&&"async"===e.key.name&&(this.type===w.name||this.type===w.num||this.type===w.string||this.type===w.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===w.star)&&!C.test(this.input.slice(this.lastTokEnd,this.start))},ge.parseObj=function(e,t){var n=this.startNode(),r=!0,i={};n.properties=[],this.next();while(!this.eat(w.braceR)){if(r)r=!1;else if(this.expect(w.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(w.braceR))break;var a=this.parseProperty(e,t);e||this.checkPropClash(a,i,t),n.properties.push(a)}return this.finishNode(n,e?"ObjectPattern":"ObjectExpression")},ge.parseProperty=function(e,t){var n,r,i,a,o=this.startNode();if(this.options.ecmaVersion>=9&&this.eat(w.ellipsis))return e?(o.argument=this.parseIdent(!1),this.type===w.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(o,"RestElement")):(this.type===w.parenL&&t&&(t.parenthesizedAssign<0&&(t.parenthesizedAssign=this.start),t.parenthesizedBind<0&&(t.parenthesizedBind=this.start)),o.argument=this.parseMaybeAssign(!1,t),this.type===w.comma&&t&&t.trailingComma<0&&(t.trailingComma=this.start),this.finishNode(o,"SpreadElement"));this.options.ecmaVersion>=6&&(o.method=!1,o.shorthand=!1,(e||t)&&(i=this.start,a=this.startLoc),e||(n=this.eat(w.star)));var s=this.containsEsc;return this.parsePropertyName(o),!e&&!s&&this.options.ecmaVersion>=8&&!n&&this.isAsyncProp(o)?(r=!0,n=this.options.ecmaVersion>=9&&this.eat(w.star),this.parsePropertyName(o,t)):r=!1,this.parsePropertyValue(o,e,n,r,i,a,t,s),this.finishNode(o,"Property")},ge.parsePropertyValue=function(e,t,n,r,i,a,o,s){if((n||r)&&this.type===w.colon&&this.unexpected(),this.eat(w.colon))e.value=t?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,o),e.kind="init";else if(this.options.ecmaVersion>=6&&this.type===w.parenL)t&&this.unexpected(),e.kind="init",e.method=!0,e.value=this.parseMethod(n,r);else if(t||s||!(this.options.ecmaVersion>=5)||e.computed||"Identifier"!==e.key.type||"get"!==e.key.name&&"set"!==e.key.name||this.type===w.comma||this.type===w.braceR||this.type===w.eq)this.options.ecmaVersion>=6&&!e.computed&&"Identifier"===e.key.type?((n||r)&&this.unexpected(),this.checkUnreserved(e.key),"await"!==e.key.name||this.awaitIdentPos||(this.awaitIdentPos=i),e.kind="init",t?e.value=this.parseMaybeDefault(i,a,e.key):this.type===w.eq&&o?(o.shorthandAssign<0&&(o.shorthandAssign=this.start),e.value=this.parseMaybeDefault(i,a,e.key)):e.value=e.key,e.shorthand=!0):this.unexpected();else{(n||r)&&this.unexpected(),e.kind=e.key.name,this.parsePropertyName(e),e.value=this.parseMethod(!1);var u="get"===e.kind?0:1;if(e.value.params.length!==u){var l=e.value.start;"get"===e.kind?this.raiseRecoverable(l,"getter should have no params"):this.raiseRecoverable(l,"setter should have exactly one param")}else"set"===e.kind&&"RestElement"===e.value.params[0].type&&this.raiseRecoverable(e.value.params[0].start,"Setter cannot use rest params")}},ge.parsePropertyName=function(e){if(this.options.ecmaVersion>=6){if(this.eat(w.bracketL))return e.computed=!0,e.key=this.parseMaybeAssign(),this.expect(w.bracketR),e.key;e.computed=!1}return e.key=this.type===w.num||this.type===w.string?this.parseExprAtom():this.parseIdent("never"!==this.options.allowReserved)},ge.initFunction=function(e){e.id=null,this.options.ecmaVersion>=6&&(e.generator=e.expression=!1),this.options.ecmaVersion>=8&&(e.async=!1)},ge.parseMethod=function(e,t,n){var r=this.startNode(),i=this.yieldPos,a=this.awaitPos,o=this.awaitIdentPos;return this.initFunction(r),this.options.ecmaVersion>=6&&(r.generator=e),this.options.ecmaVersion>=8&&(r.async=!!t),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(X(t,r.generator)|Z|(n?K:0)),this.expect(w.parenL),r.params=this.parseBindingList(w.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(r,!1,!0),this.yieldPos=i,this.awaitPos=a,this.awaitIdentPos=o,this.finishNode(r,"FunctionExpression")},ge.parseArrowExpression=function(e,t,n){var r=this.yieldPos,i=this.awaitPos,a=this.awaitIdentPos;return this.enterScope(X(n,!1)|Y),this.initFunction(e),this.options.ecmaVersion>=8&&(e.async=!!n),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,e.params=this.toAssignableList(t,!0),this.parseFunctionBody(e,!0,!1),this.yieldPos=r,this.awaitPos=i,this.awaitIdentPos=a,this.finishNode(e,"ArrowFunctionExpression")},ge.parseFunctionBody=function(e,t,n){var r=t&&this.type!==w.braceL,i=this.strict,a=!1;if(r)e.body=this.parseMaybeAssign(),e.expression=!0,this.checkParams(e,!1);else{var o=this.options.ecmaVersion>=7&&!this.isSimpleParamList(e.params);i&&!o||(a=this.strictDirective(this.end),a&&o&&this.raiseRecoverable(e.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var s=this.labels;this.labels=[],a&&(this.strict=!0),this.checkParams(e,!i&&!a&&!t&&!n&&this.isSimpleParamList(e.params)),this.strict&&e.id&&this.checkLVal(e.id,ne),e.body=this.parseBlock(!1,void 0,a&&!i),e.expression=!1,this.adaptDirectivePrologue(e.body.body),this.labels=s}this.exitScope()},ge.isSimpleParamList=function(e){for(var t=0,n=e;t<n.length;t+=1){var r=n[t];if("Identifier"!==r.type)return!1}return!0},ge.checkParams=function(e,t){for(var n={},r=0,i=e.params;r<i.length;r+=1){var a=i[r];this.checkLVal(a,J,t?null:n)}},ge.parseExprList=function(e,t,n,r){var i=[],a=!0;while(!this.eat(e)){if(a)a=!1;else if(this.expect(w.comma),t&&this.afterTrailingComma(e))break;var o=void 0;n&&this.type===w.comma?o=null:this.type===w.ellipsis?(o=this.parseSpread(r),r&&this.type===w.comma&&r.trailingComma<0&&(r.trailingComma=this.start)):o=this.parseMaybeAssign(!1,r),i.push(o)}return i},ge.checkUnreserved=function(e){var t=e.start,n=e.end,r=e.name;if(this.inGenerator&&"yield"===r&&this.raiseRecoverable(t,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&"await"===r&&this.raiseRecoverable(t,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(r)&&this.raise(t,"Unexpected keyword '"+r+"'"),!(this.options.ecmaVersion<6&&-1!==this.input.slice(t,n).indexOf("\\"))){var i=this.strict?this.reservedWordsStrict:this.reservedWords;i.test(r)&&(this.inAsync||"await"!==r||this.raiseRecoverable(t,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(t,"The keyword '"+r+"' is reserved"))}},ge.parseIdent=function(e,t){var n=this.startNode();return this.type===w.name?n.name=this.value:this.type.keyword?(n.name=this.type.keyword,"class"!==n.name&&"function"!==n.name||this.lastTokEnd===this.lastTokStart+1&&46===this.input.charCodeAt(this.lastTokStart)||this.context.pop()):this.unexpected(),this.next(!!e),this.finishNode(n,"Identifier"),e||(this.checkUnreserved(n),"await"!==n.name||this.awaitIdentPos||(this.awaitIdentPos=n.start)),n},ge.parseYield=function(e){this.yieldPos||(this.yieldPos=this.start);var t=this.startNode();return this.next(),this.type===w.semi||this.canInsertSemicolon()||this.type!==w.star&&!this.type.startsExpr?(t.delegate=!1,t.argument=null):(t.delegate=this.eat(w.star),t.argument=this.parseMaybeAssign(e)),this.finishNode(t,"YieldExpression")},ge.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var e=this.startNode();return this.next(),e.argument=this.parseMaybeUnary(null,!1),this.finishNode(e,"AwaitExpression")};var ye=re.prototype;ye.raise=function(e,t){var n=N(this.input,e);t+=" ("+n.line+":"+n.column+")";var r=new SyntaxError(t);throw r.pos=e,r.loc=n,r.raisedAt=this.pos,r},ye.raiseRecoverable=ye.raise,ye.curPosition=function(){if(this.options.locations)return new D(this.curLine,this.pos-this.lineStart)};var _e=re.prototype,xe=function(e){this.flags=e,this.var=[],this.lexical=[],this.functions=[]};_e.enterScope=function(e){this.scopeStack.push(new xe(e))},_e.exitScope=function(){this.scopeStack.pop()},_e.treatFunctionsAsVarInScope=function(e){return e.flags&V||!this.inModule&&e.flags&U},_e.declareName=function(e,t,n){var r=!1;if(t===$){var i=this.currentScope();r=i.lexical.indexOf(e)>-1||i.functions.indexOf(e)>-1||i.var.indexOf(e)>-1,i.lexical.push(e),this.inModule&&i.flags&U&&delete this.undefinedExports[e]}else if(t===te){var a=this.currentScope();a.lexical.push(e)}else if(t===ee){var o=this.currentScope();r=this.treatFunctionsAsVar?o.lexical.indexOf(e)>-1:o.lexical.indexOf(e)>-1||o.var.indexOf(e)>-1,o.functions.push(e)}else for(var s=this.scopeStack.length-1;s>=0;--s){var u=this.scopeStack[s];if(u.lexical.indexOf(e)>-1&&!(u.flags&q&&u.lexical[0]===e)||!this.treatFunctionsAsVarInScope(u)&&u.functions.indexOf(e)>-1){r=!0;break}if(u.var.push(e),this.inModule&&u.flags&U&&delete this.undefinedExports[e],u.flags&G)break}r&&this.raiseRecoverable(n,"Identifier '"+e+"' has already been declared")},_e.checkLocalExport=function(e){-1===this.scopeStack[0].lexical.indexOf(e.name)&&-1===this.scopeStack[0].var.indexOf(e.name)&&(this.undefinedExports[e.name]=e)},_e.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},_e.currentVarScope=function(){for(var e=this.scopeStack.length-1;;e--){var t=this.scopeStack[e];if(t.flags&G)return t}},_e.currentThisScope=function(){for(var e=this.scopeStack.length-1;;e--){var t=this.scopeStack[e];if(t.flags&G&&!(t.flags&Y))return t}};var be=function(e,t,n){this.type="",this.start=t,this.end=0,e.options.locations&&(this.loc=new z(e,n)),e.options.directSourceFile&&(this.sourceFile=e.options.directSourceFile),e.options.ranges&&(this.range=[t,0])},Se=re.prototype;function we(e,t,n,r){return e.type=t,e.end=n,this.options.locations&&(e.loc.end=r),this.options.ranges&&(e.range[1]=n),e}Se.startNode=function(){return new be(this,this.start,this.startLoc)},Se.startNodeAt=function(e,t){return new be(this,e,t)},Se.finishNode=function(e,t){return we.call(this,e,t,this.lastTokEnd,this.lastTokEndLoc)},Se.finishNodeAt=function(e,t,n,r){return we.call(this,e,t,n,r)};var Ce=function(e,t,n,r,i){this.token=e,this.isExpr=!!t,this.preserveSpace=!!n,this.override=r,this.generator=!!i},ke={b_stat:new Ce("{",!1),b_expr:new Ce("{",!0),b_tmpl:new Ce("${",!1),p_stat:new Ce("(",!1),p_expr:new Ce("(",!0),q_tmpl:new Ce("`",!0,!0,(function(e){return e.tryReadTemplateToken()})),f_stat:new Ce("function",!1),f_expr:new Ce("function",!0),f_expr_gen:new Ce("function",!0,!1,null,!0),f_gen:new Ce("function",!1,!1,null,!0)},Ae=re.prototype;Ae.initialContext=function(){return[ke.b_stat]},Ae.braceIsBlock=function(e){var t=this.curContext();return t===ke.f_expr||t===ke.f_stat||(e!==w.colon||t!==ke.b_stat&&t!==ke.b_expr?e===w._return||e===w.name&&this.exprAllowed?C.test(this.input.slice(this.lastTokEnd,this.start)):e===w._else||e===w.semi||e===w.eof||e===w.parenR||e===w.arrow||(e===w.braceL?t===ke.b_stat:e!==w._var&&e!==w._const&&e!==w.name&&!this.exprAllowed):!t.isExpr)},Ae.inGeneratorContext=function(){for(var e=this.context.length-1;e>=1;e--){var t=this.context[e];if("function"===t.token)return t.generator}return!1},Ae.updateContext=function(e){var t,n=this.type;n.keyword&&e===w.dot?this.exprAllowed=!1:(t=n.updateContext)?t.call(this,e):this.exprAllowed=n.beforeExpr},w.parenR.updateContext=w.braceR.updateContext=function(){if(1!==this.context.length){var e=this.context.pop();e===ke.b_stat&&"function"===this.curContext().token&&(e=this.context.pop()),this.exprAllowed=!e.isExpr}else this.exprAllowed=!0},w.braceL.updateContext=function(e){this.context.push(this.braceIsBlock(e)?ke.b_stat:ke.b_expr),this.exprAllowed=!0},w.dollarBraceL.updateContext=function(){this.context.push(ke.b_tmpl),this.exprAllowed=!0},w.parenL.updateContext=function(e){var t=e===w._if||e===w._for||e===w._with||e===w._while;this.context.push(t?ke.p_stat:ke.p_expr),this.exprAllowed=!0},w.incDec.updateContext=function(){},w._function.updateContext=w._class.updateContext=function(e){!e.beforeExpr||e===w.semi||e===w._else||e===w._return&&C.test(this.input.slice(this.lastTokEnd,this.start))||(e===w.colon||e===w.braceL)&&this.curContext()===ke.b_stat?this.context.push(ke.f_stat):this.context.push(ke.f_expr),this.exprAllowed=!1},w.backQuote.updateContext=function(){this.curContext()===ke.q_tmpl?this.context.pop():this.context.push(ke.q_tmpl),this.exprAllowed=!1},w.star.updateContext=function(e){if(e===w._function){var t=this.context.length-1;this.context[t]===ke.f_expr?this.context[t]=ke.f_expr_gen:this.context[t]=ke.f_gen}this.exprAllowed=!0},w.name.updateContext=function(e){var t=!1;this.options.ecmaVersion>=6&&e!==w.dot&&("of"===this.value&&!this.exprAllowed||"yield"===this.value&&this.inGeneratorContext())&&(t=!0),this.exprAllowed=t};var Ee="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",Te=Ee+" Extended_Pictographic",Me=Te,Oe={9:Ee,10:Te,11:Me},Le="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",Pe="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",Re=Pe+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",Ie=Re+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",De={9:Pe,10:Re,11:Ie},ze={};function Ne(e){var t=ze[e]={binary:I(Oe[e]+" "+Le),nonBinary:{General_Category:I(Le),Script:I(De[e])}};t.nonBinary.Script_Extensions=t.nonBinary.Script,t.nonBinary.gc=t.nonBinary.General_Category,t.nonBinary.sc=t.nonBinary.Script,t.nonBinary.scx=t.nonBinary.Script_Extensions}Ne(9),Ne(10),Ne(11);var Fe=re.prototype,je=function(e){this.parser=e,this.validFlags="gim"+(e.options.ecmaVersion>=6?"uy":"")+(e.options.ecmaVersion>=9?"s":""),this.unicodeProperties=ze[e.options.ecmaVersion>=11?11:e.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};function Be(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e)))}function Ue(e){return 36===e||e>=40&&e<=43||46===e||63===e||e>=91&&e<=94||e>=123&&e<=125}function Ve(e){return v(e,!0)||36===e||95===e}function Ge(e){return g(e,!0)||36===e||95===e||8204===e||8205===e}function He(e){return e>=65&&e<=90||e>=97&&e<=122}function We(e){return e>=0&&e<=1114111}function Ye(e){return 100===e||68===e||115===e||83===e||119===e||87===e}function qe(e){return He(e)||95===e}function Ze(e){return qe(e)||Ke(e)}function Ke(e){return e>=48&&e<=57}function Xe(e){return e>=48&&e<=57||e>=65&&e<=70||e>=97&&e<=102}function Qe(e){return e>=65&&e<=70?e-65+10:e>=97&&e<=102?e-97+10:e-48}function Je(e){return e>=48&&e<=55}je.prototype.reset=function(e,t,n){var r=-1!==n.indexOf("u");this.start=0|e,this.source=t+"",this.flags=n,this.switchU=r&&this.parser.options.ecmaVersion>=6,this.switchN=r&&this.parser.options.ecmaVersion>=9},je.prototype.raise=function(e){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+e)},je.prototype.at=function(e,t){void 0===t&&(t=!1);var n=this.source,r=n.length;if(e>=r)return-1;var i=n.charCodeAt(e);if(!t&&!this.switchU||i<=55295||i>=57344||e+1>=r)return i;var a=n.charCodeAt(e+1);return a>=56320&&a<=57343?(i<<10)+a-56613888:i},je.prototype.nextIndex=function(e,t){void 0===t&&(t=!1);var n=this.source,r=n.length;if(e>=r)return r;var i,a=n.charCodeAt(e);return!t&&!this.switchU||a<=55295||a>=57344||e+1>=r||(i=n.charCodeAt(e+1))<56320||i>57343?e+1:e+2},je.prototype.current=function(e){return void 0===e&&(e=!1),this.at(this.pos,e)},je.prototype.lookahead=function(e){return void 0===e&&(e=!1),this.at(this.nextIndex(this.pos,e),e)},je.prototype.advance=function(e){void 0===e&&(e=!1),this.pos=this.nextIndex(this.pos,e)},je.prototype.eat=function(e,t){return void 0===t&&(t=!1),this.current(t)===e&&(this.advance(t),!0)},Fe.validateRegExpFlags=function(e){for(var t=e.validFlags,n=e.flags,r=0;r<n.length;r++){var i=n.charAt(r);-1===t.indexOf(i)&&this.raise(e.start,"Invalid regular expression flag"),n.indexOf(i,r+1)>-1&&this.raise(e.start,"Duplicate regular expression flag")}},Fe.validateRegExpPattern=function(e){this.regexp_pattern(e),!e.switchN&&this.options.ecmaVersion>=9&&e.groupNames.length>0&&(e.switchN=!0,this.regexp_pattern(e))},Fe.regexp_pattern=function(e){e.pos=0,e.lastIntValue=0,e.lastStringValue="",e.lastAssertionIsQuantifiable=!1,e.numCapturingParens=0,e.maxBackReference=0,e.groupNames.length=0,e.backReferenceNames.length=0,this.regexp_disjunction(e),e.pos!==e.source.length&&(e.eat(41)&&e.raise("Unmatched ')'"),(e.eat(93)||e.eat(125))&&e.raise("Lone quantifier brackets")),e.maxBackReference>e.numCapturingParens&&e.raise("Invalid escape");for(var t=0,n=e.backReferenceNames;t<n.length;t+=1){var r=n[t];-1===e.groupNames.indexOf(r)&&e.raise("Invalid named capture referenced")}},Fe.regexp_disjunction=function(e){this.regexp_alternative(e);while(e.eat(124))this.regexp_alternative(e);this.regexp_eatQuantifier(e,!0)&&e.raise("Nothing to repeat"),e.eat(123)&&e.raise("Lone quantifier brackets")},Fe.regexp_alternative=function(e){while(e.pos<e.source.length&&this.regexp_eatTerm(e));},Fe.regexp_eatTerm=function(e){return this.regexp_eatAssertion(e)?(e.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(e)&&e.switchU&&e.raise("Invalid quantifier"),!0):!!(e.switchU?this.regexp_eatAtom(e):this.regexp_eatExtendedAtom(e))&&(this.regexp_eatQuantifier(e),!0)},Fe.regexp_eatAssertion=function(e){var t=e.pos;if(e.lastAssertionIsQuantifiable=!1,e.eat(94)||e.eat(36))return!0;if(e.eat(92)){if(e.eat(66)||e.eat(98))return!0;e.pos=t}if(e.eat(40)&&e.eat(63)){var n=!1;if(this.options.ecmaVersion>=9&&(n=e.eat(60)),e.eat(61)||e.eat(33))return this.regexp_disjunction(e),e.eat(41)||e.raise("Unterminated group"),e.lastAssertionIsQuantifiable=!n,!0}return e.pos=t,!1},Fe.regexp_eatQuantifier=function(e,t){return void 0===t&&(t=!1),!!this.regexp_eatQuantifierPrefix(e,t)&&(e.eat(63),!0)},Fe.regexp_eatQuantifierPrefix=function(e,t){return e.eat(42)||e.eat(43)||e.eat(63)||this.regexp_eatBracedQuantifier(e,t)},Fe.regexp_eatBracedQuantifier=function(e,t){var n=e.pos;if(e.eat(123)){var r=0,i=-1;if(this.regexp_eatDecimalDigits(e)&&(r=e.lastIntValue,e.eat(44)&&this.regexp_eatDecimalDigits(e)&&(i=e.lastIntValue),e.eat(125)))return-1!==i&&i<r&&!t&&e.raise("numbers out of order in {} quantifier"),!0;e.switchU&&!t&&e.raise("Incomplete quantifier"),e.pos=n}return!1},Fe.regexp_eatAtom=function(e){return this.regexp_eatPatternCharacters(e)||e.eat(46)||this.regexp_eatReverseSolidusAtomEscape(e)||this.regexp_eatCharacterClass(e)||this.regexp_eatUncapturingGroup(e)||this.regexp_eatCapturingGroup(e)},Fe.regexp_eatReverseSolidusAtomEscape=function(e){var t=e.pos;if(e.eat(92)){if(this.regexp_eatAtomEscape(e))return!0;e.pos=t}return!1},Fe.regexp_eatUncapturingGroup=function(e){var t=e.pos;if(e.eat(40)){if(e.eat(63)&&e.eat(58)){if(this.regexp_disjunction(e),e.eat(41))return!0;e.raise("Unterminated group")}e.pos=t}return!1},Fe.regexp_eatCapturingGroup=function(e){if(e.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(e):63===e.current()&&e.raise("Invalid group"),this.regexp_disjunction(e),e.eat(41))return e.numCapturingParens+=1,!0;e.raise("Unterminated group")}return!1},Fe.regexp_eatExtendedAtom=function(e){return e.eat(46)||this.regexp_eatReverseSolidusAtomEscape(e)||this.regexp_eatCharacterClass(e)||this.regexp_eatUncapturingGroup(e)||this.regexp_eatCapturingGroup(e)||this.regexp_eatInvalidBracedQuantifier(e)||this.regexp_eatExtendedPatternCharacter(e)},Fe.regexp_eatInvalidBracedQuantifier=function(e){return this.regexp_eatBracedQuantifier(e,!0)&&e.raise("Nothing to repeat"),!1},Fe.regexp_eatSyntaxCharacter=function(e){var t=e.current();return!!Ue(t)&&(e.lastIntValue=t,e.advance(),!0)},Fe.regexp_eatPatternCharacters=function(e){var t=e.pos,n=0;while(-1!==(n=e.current())&&!Ue(n))e.advance();return e.pos!==t},Fe.regexp_eatExtendedPatternCharacter=function(e){var t=e.current();return!(-1===t||36===t||t>=40&&t<=43||46===t||63===t||91===t||94===t||124===t)&&(e.advance(),!0)},Fe.regexp_groupSpecifier=function(e){if(e.eat(63)){if(this.regexp_eatGroupName(e))return-1!==e.groupNames.indexOf(e.lastStringValue)&&e.raise("Duplicate capture group name"),void e.groupNames.push(e.lastStringValue);e.raise("Invalid group")}},Fe.regexp_eatGroupName=function(e){if(e.lastStringValue="",e.eat(60)){if(this.regexp_eatRegExpIdentifierName(e)&&e.eat(62))return!0;e.raise("Invalid capture group name")}return!1},Fe.regexp_eatRegExpIdentifierName=function(e){if(e.lastStringValue="",this.regexp_eatRegExpIdentifierStart(e)){e.lastStringValue+=Be(e.lastIntValue);while(this.regexp_eatRegExpIdentifierPart(e))e.lastStringValue+=Be(e.lastIntValue);return!0}return!1},Fe.regexp_eatRegExpIdentifierStart=function(e){var t=e.pos,n=this.options.ecmaVersion>=11,r=e.current(n);return e.advance(n),92===r&&this.regexp_eatRegExpUnicodeEscapeSequence(e,n)&&(r=e.lastIntValue),Ve(r)?(e.lastIntValue=r,!0):(e.pos=t,!1)},Fe.regexp_eatRegExpIdentifierPart=function(e){var t=e.pos,n=this.options.ecmaVersion>=11,r=e.current(n);return e.advance(n),92===r&&this.regexp_eatRegExpUnicodeEscapeSequence(e,n)&&(r=e.lastIntValue),Ge(r)?(e.lastIntValue=r,!0):(e.pos=t,!1)},Fe.regexp_eatAtomEscape=function(e){return!!(this.regexp_eatBackReference(e)||this.regexp_eatCharacterClassEscape(e)||this.regexp_eatCharacterEscape(e)||e.switchN&&this.regexp_eatKGroupName(e))||(e.switchU&&(99===e.current()&&e.raise("Invalid unicode escape"),e.raise("Invalid escape")),!1)},Fe.regexp_eatBackReference=function(e){var t=e.pos;if(this.regexp_eatDecimalEscape(e)){var n=e.lastIntValue;if(e.switchU)return n>e.maxBackReference&&(e.maxBackReference=n),!0;if(n<=e.numCapturingParens)return!0;e.pos=t}return!1},Fe.regexp_eatKGroupName=function(e){if(e.eat(107)){if(this.regexp_eatGroupName(e))return e.backReferenceNames.push(e.lastStringValue),!0;e.raise("Invalid named reference")}return!1},Fe.regexp_eatCharacterEscape=function(e){return this.regexp_eatControlEscape(e)||this.regexp_eatCControlLetter(e)||this.regexp_eatZero(e)||this.regexp_eatHexEscapeSequence(e)||this.regexp_eatRegExpUnicodeEscapeSequence(e,!1)||!e.switchU&&this.regexp_eatLegacyOctalEscapeSequence(e)||this.regexp_eatIdentityEscape(e)},Fe.regexp_eatCControlLetter=function(e){var t=e.pos;if(e.eat(99)){if(this.regexp_eatControlLetter(e))return!0;e.pos=t}return!1},Fe.regexp_eatZero=function(e){return 48===e.current()&&!Ke(e.lookahead())&&(e.lastIntValue=0,e.advance(),!0)},Fe.regexp_eatControlEscape=function(e){var t=e.current();return 116===t?(e.lastIntValue=9,e.advance(),!0):110===t?(e.lastIntValue=10,e.advance(),!0):118===t?(e.lastIntValue=11,e.advance(),!0):102===t?(e.lastIntValue=12,e.advance(),!0):114===t&&(e.lastIntValue=13,e.advance(),!0)},Fe.regexp_eatControlLetter=function(e){var t=e.current();return!!He(t)&&(e.lastIntValue=t%32,e.advance(),!0)},Fe.regexp_eatRegExpUnicodeEscapeSequence=function(e,t){void 0===t&&(t=!1);var n=e.pos,r=t||e.switchU;if(e.eat(117)){if(this.regexp_eatFixedHexDigits(e,4)){var i=e.lastIntValue;if(r&&i>=55296&&i<=56319){var a=e.pos;if(e.eat(92)&&e.eat(117)&&this.regexp_eatFixedHexDigits(e,4)){var o=e.lastIntValue;if(o>=56320&&o<=57343)return e.lastIntValue=1024*(i-55296)+(o-56320)+65536,!0}e.pos=a,e.lastIntValue=i}return!0}if(r&&e.eat(123)&&this.regexp_eatHexDigits(e)&&e.eat(125)&&We(e.lastIntValue))return!0;r&&e.raise("Invalid unicode escape"),e.pos=n}return!1},Fe.regexp_eatIdentityEscape=function(e){if(e.switchU)return!!this.regexp_eatSyntaxCharacter(e)||!!e.eat(47)&&(e.lastIntValue=47,!0);var t=e.current();return!(99===t||e.switchN&&107===t)&&(e.lastIntValue=t,e.advance(),!0)},Fe.regexp_eatDecimalEscape=function(e){e.lastIntValue=0;var t=e.current();if(t>=49&&t<=57){do{e.lastIntValue=10*e.lastIntValue+(t-48),e.advance()}while((t=e.current())>=48&&t<=57);return!0}return!1},Fe.regexp_eatCharacterClassEscape=function(e){var t=e.current();if(Ye(t))return e.lastIntValue=-1,e.advance(),!0;if(e.switchU&&this.options.ecmaVersion>=9&&(80===t||112===t)){if(e.lastIntValue=-1,e.advance(),e.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(e)&&e.eat(125))return!0;e.raise("Invalid property name")}return!1},Fe.regexp_eatUnicodePropertyValueExpression=function(e){var t=e.pos;if(this.regexp_eatUnicodePropertyName(e)&&e.eat(61)){var n=e.lastStringValue;if(this.regexp_eatUnicodePropertyValue(e)){var r=e.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(e,n,r),!0}}if(e.pos=t,this.regexp_eatLoneUnicodePropertyNameOrValue(e)){var i=e.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(e,i),!0}return!1},Fe.regexp_validateUnicodePropertyNameAndValue=function(e,t,n){P(e.unicodeProperties.nonBinary,t)||e.raise("Invalid property name"),e.unicodeProperties.nonBinary[t].test(n)||e.raise("Invalid property value")},Fe.regexp_validateUnicodePropertyNameOrValue=function(e,t){e.unicodeProperties.binary.test(t)||e.raise("Invalid property name")},Fe.regexp_eatUnicodePropertyName=function(e){var t=0;e.lastStringValue="";while(qe(t=e.current()))e.lastStringValue+=Be(t),e.advance();return""!==e.lastStringValue},Fe.regexp_eatUnicodePropertyValue=function(e){var t=0;e.lastStringValue="";while(Ze(t=e.current()))e.lastStringValue+=Be(t),e.advance();return""!==e.lastStringValue},Fe.regexp_eatLoneUnicodePropertyNameOrValue=function(e){return this.regexp_eatUnicodePropertyValue(e)},Fe.regexp_eatCharacterClass=function(e){if(e.eat(91)){if(e.eat(94),this.regexp_classRanges(e),e.eat(93))return!0;e.raise("Unterminated character class")}return!1},Fe.regexp_classRanges=function(e){while(this.regexp_eatClassAtom(e)){var t=e.lastIntValue;if(e.eat(45)&&this.regexp_eatClassAtom(e)){var n=e.lastIntValue;!e.switchU||-1!==t&&-1!==n||e.raise("Invalid character class"),-1!==t&&-1!==n&&t>n&&e.raise("Range out of order in character class")}}},Fe.regexp_eatClassAtom=function(e){var t=e.pos;if(e.eat(92)){if(this.regexp_eatClassEscape(e))return!0;if(e.switchU){var n=e.current();(99===n||Je(n))&&e.raise("Invalid class escape"),e.raise("Invalid escape")}e.pos=t}var r=e.current();return 93!==r&&(e.lastIntValue=r,e.advance(),!0)},Fe.regexp_eatClassEscape=function(e){var t=e.pos;if(e.eat(98))return e.lastIntValue=8,!0;if(e.switchU&&e.eat(45))return e.lastIntValue=45,!0;if(!e.switchU&&e.eat(99)){if(this.regexp_eatClassControlLetter(e))return!0;e.pos=t}return this.regexp_eatCharacterClassEscape(e)||this.regexp_eatCharacterEscape(e)},Fe.regexp_eatClassControlLetter=function(e){var t=e.current();return!(!Ke(t)&&95!==t)&&(e.lastIntValue=t%32,e.advance(),!0)},Fe.regexp_eatHexEscapeSequence=function(e){var t=e.pos;if(e.eat(120)){if(this.regexp_eatFixedHexDigits(e,2))return!0;e.switchU&&e.raise("Invalid escape"),e.pos=t}return!1},Fe.regexp_eatDecimalDigits=function(e){var t=e.pos,n=0;e.lastIntValue=0;while(Ke(n=e.current()))e.lastIntValue=10*e.lastIntValue+(n-48),e.advance();return e.pos!==t},Fe.regexp_eatHexDigits=function(e){var t=e.pos,n=0;e.lastIntValue=0;while(Xe(n=e.current()))e.lastIntValue=16*e.lastIntValue+Qe(n),e.advance();return e.pos!==t},Fe.regexp_eatLegacyOctalEscapeSequence=function(e){if(this.regexp_eatOctalDigit(e)){var t=e.lastIntValue;if(this.regexp_eatOctalDigit(e)){var n=e.lastIntValue;t<=3&&this.regexp_eatOctalDigit(e)?e.lastIntValue=64*t+8*n+e.lastIntValue:e.lastIntValue=8*t+n}else e.lastIntValue=t;return!0}return!1},Fe.regexp_eatOctalDigit=function(e){var t=e.current();return Je(t)?(e.lastIntValue=t-48,e.advance(),!0):(e.lastIntValue=0,!1)},Fe.regexp_eatFixedHexDigits=function(e,t){var n=e.pos;e.lastIntValue=0;for(var r=0;r<t;++r){var i=e.current();if(!Xe(i))return e.pos=n,!1;e.lastIntValue=16*e.lastIntValue+Qe(i),e.advance()}return!0};var $e=function(e){this.type=e.type,this.value=e.value,this.start=e.start,this.end=e.end,e.options.locations&&(this.loc=new z(e,e.startLoc,e.endLoc)),e.options.ranges&&(this.range=[e.start,e.end])},et=re.prototype;function tt(e,t){return t?parseInt(e,8):parseFloat(e.replace(/_/g,""))}function nt(e){return"function"!==typeof BigInt?null:BigInt(e.replace(/_/g,""))}function rt(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e)))}et.next=function(e){!e&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new $e(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},et.getToken=function(){return this.next(),new $e(this)},"undefined"!==typeof Symbol&&(et[Symbol.iterator]=function(){var e=this;return{next:function(){var t=e.getToken();return{done:t.type===w.eof,value:t}}}}),et.curContext=function(){return this.context[this.context.length-1]},et.nextToken=function(){var e=this.curContext();return e&&e.preserveSpace||this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length?this.finishToken(w.eof):e.override?e.override(this):void this.readToken(this.fullCharCodeAtPos())},et.readToken=function(e){return v(e,this.options.ecmaVersion>=6)||92===e?this.readWord():this.getTokenFromCode(e)},et.fullCharCodeAtPos=function(){var e=this.input.charCodeAt(this.pos);if(e<=55295||e>=57344)return e;var t=this.input.charCodeAt(this.pos+1);return(e<<10)+t-56613888},et.skipBlockComment=function(){var e=this.options.onComment&&this.curPosition(),t=this.pos,n=this.input.indexOf("*/",this.pos+=2);if(-1===n&&this.raise(this.pos-2,"Unterminated comment"),this.pos=n+2,this.options.locations){var r;k.lastIndex=t;while((r=k.exec(this.input))&&r.index<this.pos)++this.curLine,this.lineStart=r.index+r[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(t+2,n),t,this.pos,e,this.curPosition())},et.skipLineComment=function(e){var t=this.pos,n=this.options.onComment&&this.curPosition(),r=this.input.charCodeAt(this.pos+=e);while(this.pos<this.input.length&&!A(r))r=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(t+e,this.pos),t,this.pos,n,this.curPosition())},et.skipSpace=function(){e:while(this.pos<this.input.length){var e=this.input.charCodeAt(this.pos);switch(e){case 32:case 160:++this.pos;break;case 13:10===this.input.charCodeAt(this.pos+1)&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(!(e>8&&e<14||e>=5760&&E.test(String.fromCharCode(e))))break e;++this.pos}}},et.finishToken=function(e,t){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var n=this.type;this.type=e,this.value=t,this.updateContext(n)},et.readToken_dot=function(){var e=this.input.charCodeAt(this.pos+1);if(e>=48&&e<=57)return this.readNumber(!0);var t=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&46===e&&46===t?(this.pos+=3,this.finishToken(w.ellipsis)):(++this.pos,this.finishToken(w.dot))},et.readToken_slash=function(){var e=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):61===e?this.finishOp(w.assign,2):this.finishOp(w.slash,1)},et.readToken_mult_modulo_exp=function(e){var t=this.input.charCodeAt(this.pos+1),n=1,r=42===e?w.star:w.modulo;return this.options.ecmaVersion>=7&&42===e&&42===t&&(++n,r=w.starstar,t=this.input.charCodeAt(this.pos+2)),61===t?this.finishOp(w.assign,n+1):this.finishOp(r,n)},et.readToken_pipe_amp=function(e){var t=this.input.charCodeAt(this.pos+1);if(t===e){if(this.options.ecmaVersion>=12){var n=this.input.charCodeAt(this.pos+2);if(61===n)return this.finishOp(w.assign,3)}return this.finishOp(124===e?w.logicalOR:w.logicalAND,2)}return 61===t?this.finishOp(w.assign,2):this.finishOp(124===e?w.bitwiseOR:w.bitwiseAND,1)},et.readToken_caret=function(){var e=this.input.charCodeAt(this.pos+1);return 61===e?this.finishOp(w.assign,2):this.finishOp(w.bitwiseXOR,1)},et.readToken_plus_min=function(e){var t=this.input.charCodeAt(this.pos+1);return t===e?45!==t||this.inModule||62!==this.input.charCodeAt(this.pos+2)||0!==this.lastTokEnd&&!C.test(this.input.slice(this.lastTokEnd,this.pos))?this.finishOp(w.incDec,2):(this.skipLineComment(3),this.skipSpace(),this.nextToken()):61===t?this.finishOp(w.assign,2):this.finishOp(w.plusMin,1)},et.readToken_lt_gt=function(e){var t=this.input.charCodeAt(this.pos+1),n=1;return t===e?(n=62===e&&62===this.input.charCodeAt(this.pos+2)?3:2,61===this.input.charCodeAt(this.pos+n)?this.finishOp(w.assign,n+1):this.finishOp(w.bitShift,n)):33!==t||60!==e||this.inModule||45!==this.input.charCodeAt(this.pos+2)||45!==this.input.charCodeAt(this.pos+3)?(61===t&&(n=2),this.finishOp(w.relational,n)):(this.skipLineComment(4),this.skipSpace(),this.nextToken())},et.readToken_eq_excl=function(e){var t=this.input.charCodeAt(this.pos+1);return 61===t?this.finishOp(w.equality,61===this.input.charCodeAt(this.pos+2)?3:2):61===e&&62===t&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(w.arrow)):this.finishOp(61===e?w.eq:w.prefix,1)},et.readToken_question=function(){var e=this.options.ecmaVersion;if(e>=11){var t=this.input.charCodeAt(this.pos+1);if(46===t){var n=this.input.charCodeAt(this.pos+2);if(n<48||n>57)return this.finishOp(w.questionDot,2)}if(63===t){if(e>=12){var r=this.input.charCodeAt(this.pos+2);if(61===r)return this.finishOp(w.assign,3)}return this.finishOp(w.coalesce,2)}}return this.finishOp(w.question,1)},et.getTokenFromCode=function(e){switch(e){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(w.parenL);case 41:return++this.pos,this.finishToken(w.parenR);case 59:return++this.pos,this.finishToken(w.semi);case 44:return++this.pos,this.finishToken(w.comma);case 91:return++this.pos,this.finishToken(w.bracketL);case 93:return++this.pos,this.finishToken(w.bracketR);case 123:return++this.pos,this.finishToken(w.braceL);case 125:return++this.pos,this.finishToken(w.braceR);case 58:return++this.pos,this.finishToken(w.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(w.backQuote);case 48:var t=this.input.charCodeAt(this.pos+1);if(120===t||88===t)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(111===t||79===t)return this.readRadixNumber(8);if(98===t||66===t)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(e);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(e);case 124:case 38:return this.readToken_pipe_amp(e);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(e);case 60:case 62:return this.readToken_lt_gt(e);case 61:case 33:return this.readToken_eq_excl(e);case 63:return this.readToken_question();case 126:return this.finishOp(w.prefix,1)}this.raise(this.pos,"Unexpected character '"+rt(e)+"'")},et.finishOp=function(e,t){var n=this.input.slice(this.pos,this.pos+t);return this.pos+=t,this.finishToken(e,n)},et.readRegexp=function(){for(var e,t,n=this.pos;;){this.pos>=this.input.length&&this.raise(n,"Unterminated regular expression");var r=this.input.charAt(this.pos);if(C.test(r)&&this.raise(n,"Unterminated regular expression"),e)e=!1;else{if("["===r)t=!0;else if("]"===r&&t)t=!1;else if("/"===r&&!t)break;e="\\"===r}++this.pos}var i=this.input.slice(n,this.pos);++this.pos;var a=this.pos,o=this.readWord1();this.containsEsc&&this.unexpected(a);var s=this.regexpState||(this.regexpState=new je(this));s.reset(n,i,o),this.validateRegExpFlags(s),this.validateRegExpPattern(s);var u=null;try{u=new RegExp(i,o)}catch(l){}return this.finishToken(w.regexp,{pattern:i,flags:o,value:u})},et.readInt=function(e,t,n){for(var r=this.options.ecmaVersion>=12&&void 0===t,i=n&&48===this.input.charCodeAt(this.pos),a=this.pos,o=0,s=0,u=0,l=null==t?1/0:t;u<l;++u,++this.pos){var c=this.input.charCodeAt(this.pos),f=void 0;if(r&&95===c)i&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),95===s&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),0===u&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),s=c;else{if(f=c>=97?c-97+10:c>=65?c-65+10:c>=48&&c<=57?c-48:1/0,f>=e)break;s=c,o=o*e+f}}return r&&95===s&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===a||null!=t&&this.pos-a!==t?null:o},et.readRadixNumber=function(e){var t=this.pos;this.pos+=2;var n=this.readInt(e);return null==n&&this.raise(this.start+2,"Expected number in radix "+e),this.options.ecmaVersion>=11&&110===this.input.charCodeAt(this.pos)?(n=nt(this.input.slice(t,this.pos)),++this.pos):v(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(w.num,n)},et.readNumber=function(e){var t=this.pos;e||null!==this.readInt(10,void 0,!0)||this.raise(t,"Invalid number");var n=this.pos-t>=2&&48===this.input.charCodeAt(t);n&&this.strict&&this.raise(t,"Invalid number");var r=this.input.charCodeAt(this.pos);if(!n&&!e&&this.options.ecmaVersion>=11&&110===r){var i=nt(this.input.slice(t,this.pos));return++this.pos,v(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(w.num,i)}n&&/[89]/.test(this.input.slice(t,this.pos))&&(n=!1),46!==r||n||(++this.pos,this.readInt(10),r=this.input.charCodeAt(this.pos)),69!==r&&101!==r||n||(r=this.input.charCodeAt(++this.pos),43!==r&&45!==r||++this.pos,null===this.readInt(10)&&this.raise(t,"Invalid number")),v(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var a=tt(this.input.slice(t,this.pos),n);return this.finishToken(w.num,a)},et.readCodePoint=function(){var e,t=this.input.charCodeAt(this.pos);if(123===t){this.options.ecmaVersion<6&&this.unexpected();var n=++this.pos;e=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,e>1114111&&this.invalidStringToken(n,"Code point out of bounds")}else e=this.readHexChar(4);return e},et.readString=function(e){for(var t="",n=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var r=this.input.charCodeAt(this.pos);if(r===e)break;92===r?(t+=this.input.slice(n,this.pos),t+=this.readEscapedChar(!1),n=this.pos):(A(r,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return t+=this.input.slice(n,this.pos++),this.finishToken(w.string,t)};var it={};et.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(e){if(e!==it)throw e;this.readInvalidTemplateToken()}this.inTemplateElement=!1},et.invalidStringToken=function(e,t){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw it;this.raise(e,t)},et.readTmplToken=function(){for(var e="",t=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var n=this.input.charCodeAt(this.pos);if(96===n||36===n&&123===this.input.charCodeAt(this.pos+1))return this.pos!==this.start||this.type!==w.template&&this.type!==w.invalidTemplate?(e+=this.input.slice(t,this.pos),this.finishToken(w.template,e)):36===n?(this.pos+=2,this.finishToken(w.dollarBraceL)):(++this.pos,this.finishToken(w.backQuote));if(92===n)e+=this.input.slice(t,this.pos),e+=this.readEscapedChar(!0),t=this.pos;else if(A(n)){switch(e+=this.input.slice(t,this.pos),++this.pos,n){case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:e+="\n";break;default:e+=String.fromCharCode(n);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),t=this.pos}else++this.pos}},et.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if("{"!==this.input[this.pos+1])break;case"`":return this.finishToken(w.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},et.readEscapedChar=function(e){var t=this.input.charCodeAt(++this.pos);switch(++this.pos,t){case 110:return"\n";case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return rt(this.readCodePoint());case 116:return"\t";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(e){var n=this.pos-1;return this.invalidStringToken(n,"Invalid escape sequence in template string"),null}default:if(t>=48&&t<=55){var r=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],i=parseInt(r,8);return i>255&&(r=r.slice(0,-1),i=parseInt(r,8)),this.pos+=r.length-1,t=this.input.charCodeAt(this.pos),"0"===r&&56!==t&&57!==t||!this.strict&&!e||this.invalidStringToken(this.pos-1-r.length,e?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(i)}return A(t)?"":String.fromCharCode(t)}},et.readHexChar=function(e){var t=this.pos,n=this.readInt(16,e);return null===n&&this.invalidStringToken(t,"Bad character escape sequence"),n},et.readWord1=function(){this.containsEsc=!1;var e="",t=!0,n=this.pos,r=this.options.ecmaVersion>=6;while(this.pos<this.input.length){var i=this.fullCharCodeAtPos();if(g(i,r))this.pos+=i<=65535?1:2;else{if(92!==i)break;this.containsEsc=!0,e+=this.input.slice(n,this.pos);var a=this.pos;117!==this.input.charCodeAt(++this.pos)&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var o=this.readCodePoint();(t?v:g)(o,r)||this.invalidStringToken(a,"Invalid Unicode escape"),e+=rt(o),n=this.pos}t=!1}return e+this.input.slice(n,this.pos)},et.readWord=function(){var e=this.readWord1(),t=w.name;return this.keywords.test(e)&&(t=b[e]),this.finishToken(t,e)};var at="7.4.1";function ot(e,t){return re.parse(e,t)}function st(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function ut(e){var t="function"===typeof Map?new Map:void 0;return ut=function(e){if(null===e||!ft(e))return e;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return ct(e,arguments,pt(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),ht(n,e)},ut(e)}function lt(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function ct(e,t,n){return ct=lt()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=Function.bind.apply(e,r),a=new i;return n&&ht(a,n.prototype),a},ct.apply(null,arguments)}function ft(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function ht(e,t){return ht=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ht(e,t)}function pt(e){return pt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},pt(e)}re.acorn={Parser:re,version:at,defaultOptions:F,Position:D,SourceLocation:z,getLineInfo:N,Node:be,TokenType:m,tokTypes:w,keywordTypes:b,TokContext:Ce,tokContexts:ke,isIdentifierChar:g,isIdentifierStart:v,Token:$e,isNewLine:A,lineBreak:C,lineBreakG:k,nonASCIIwhitespace:E};var dt=function(e){function t(){return e.apply(this,arguments)||this}return st(t,e),t}(ut(Error)),vt=function(e){function t(){return e.apply(this,arguments)||this}return st(t,e),t}(ut(SyntaxError)),gt=function(e){function t(){return e.apply(this,arguments)||this}return st(t,e),t}(ut(ReferenceError)),mt=function(e){function t(){return e.apply(this,arguments)||this}return st(t,e),t}(ut(TypeError)),yt=function(e){function t(){return e.apply(this,arguments)||this}return st(t,e),t}(dt),_t=function(e){function t(){return e.apply(this,arguments)||this}return st(t,e),t}(vt),xt=function(e){function t(){return e.apply(this,arguments)||this}return st(t,e),t}(gt),bt={UnknownError:[3001,"%0",yt],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",yt],NodeTypeSyntaxError:[1001,"Unknown node type: %0",xt],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",xt],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",xt],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",xt],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",xt],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",xt],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",xt],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",xt],ParamTypeSyntaxError:[1009,"Unknown param type: %0",xt],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",xt],FunctionUndefinedReferenceError:[2001,"%0 is not a function",gt],VariableUndefinedReferenceError:[2002,"%0 is not defined",gt],IsNotConstructor:[2003,"%0 is not a constructor",mt]};function St(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function wt(e,t,n){return wt=St()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=Function.bind.apply(e,r),a=new i;return n&&Ct(a,n.prototype),a},wt.apply(null,arguments)}function Ct(e,t){return Ct=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Ct(e,t)}var kt="0.0.3";function At(e,t){Object.defineProperty(e,"name",{value:t,writable:!1,enumerable:!1,configurable:!0})}var Et=Object.prototype.hasOwnProperty,Tt=Symbol("Break"),Mt=Symbol("Continue"),Ot=Symbol("DefaultCase"),Lt=Symbol("EmptyStatementReturn"),Pt=Symbol("WithScopeName"),Rt=Symbol("SuperScopeName"),It=Symbol("RootScopeName"),Dt=Symbol("GlobalScopeName");function zt(e){return"function"===typeof e}var Nt=function(){function e(e){this.interpreter=e}var t=e.prototype;return t.generator=function(){var e=this.interpreter;function t(){return this.getCurrentScope()}function n(){return this.getGlobalScope()}function r(){return this.getCurrentContext()}return{getOptions:e.getOptions.bind(e),getCurrentScope:t.bind(e),getGlobalScope:n.bind(e),getCurrentContext:r.bind(e),getExecStartTime:e.getExecStartTime.bind(e)}},e}();function Ft(e,t,n){if(void 0===n&&(n=!0),!(e instanceof Nt))throw new Error("Illegal call");if("string"!==typeof t)return t;if(t){var r=e.generator(),i=r.getOptions(),a={timeout:i.timeout,_initEnv:function(){n||this.setCurrentContext(r.getCurrentContext()),this.execStartTime=r.getExecStartTime(),this.execEndTime=this.execStartTime}},o=n?r.getGlobalScope():r.getCurrentScope(),s=new Zt(o,a);return s.evaluate(t)}}function jt(e){if(!(e instanceof Nt))throw new Error("Illegal call");for(var t=e.generator(),n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var a=r.pop(),o=new Zt(t.getGlobalScope(),t.getOptions()),s="\n\t\t    (function anonymous("+r.join(",")+"){\n\t\t        "+a+"\n\t\t    });\n\t\t    ";return o.evaluate(s)}Object.defineProperty(Ft,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1}),Object.defineProperty(jt,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var Bt=function(e){this.value=e},Ut=function(e){this.value=e},Vt=function(e){this.value=e},Gt=function(e,t,n){void 0===t&&(t=null),this.name=n,this.parent=t,this.data=e,this.labelStack=[]};function Ht(){}function Wt(e,t){return void 0===e&&(e=null),new Gt(Object.create(null),e,t)}function Yt(e){return Object.create(e)}var qt={NaN:NaN,Infinity:1/0,undefined:void 0,Object:Object,Array:Array,String:String,Boolean:Boolean,Number:Number,Date:Date,RegExp:RegExp,Error:Error,URIError:URIError,TypeError:TypeError,RangeError:RangeError,SyntaxError:SyntaxError,ReferenceError:ReferenceError,Float32Array:Float32Array,Float64Array:Float64Array,Uint32Array:Uint32Array,Math:Math,parseInt:parseInt,parseFloat:parseFloat,isNaN:isNaN,isFinite:isFinite,decodeURI:decodeURI,decodeURIComponent:decodeURIComponent,encodeURI:encodeURI,encodeURIComponent:encodeURIComponent,escape:escape,unescape:unescape,eval:Ft,Function:jt};"undefined"!==typeof JSON&&(qt.JSON=JSON),"undefined"!==typeof Promise&&(qt.Promise=Promise),"undefined"!==typeof Set&&(qt.Set=Set),"undefined"!==typeof Map&&(qt.Map=Map),"undefined"!==typeof Symbol&&(qt.Symbol=Symbol),"undefined"!==typeof Proxy&&(qt.Proxy=Proxy),"undefined"!==typeof WeakMap&&(qt.WeakMap=WeakMap),"undefined"!==typeof WeakSet&&(qt.WeakSet=WeakSet),"undefined"!==typeof Reflect&&(qt.Reflect=Reflect);var Zt=function(){function e(t,n){void 0===t&&(t=e.global),void 0===n&&(n={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:n.ecmaVersion||e.ecmaVersion,timeout:n.timeout||0,rootContext:n.rootContext,globalContextInFunction:void 0===n.globalContextInFunction?e.globalContextInFunction:n.globalContextInFunction,_initEnv:n._initEnv},this.context=t||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var t=e.prototype;return t.initEnvironment=function(e){var t;if(e instanceof Gt)t=e;else{var n=null,r=this.createSuperScope(e);this.options.rootContext&&(n=new Gt(Yt(this.options.rootContext),r,It)),t=new Gt(e,n||r,Dt)}this.globalScope=t,this.currentScope=this.globalScope,this.globalContext=t.data,this.currentContext=t.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var i=this.options._initEnv;i&&i.call(this)},t.getExecStartTime=function(){return this.execStartTime},t.getExecutionTime=function(){return this.execEndTime-this.execStartTime},t.setExecTimeout=function(e){void 0===e&&(e=0),this.options.timeout=e},t.getOptions=function(){return this.options},t.getGlobalScope=function(){return this.globalScope},t.getCurrentScope=function(){return this.currentScope},t.getCurrentContext=function(){return this.currentContext},t.isInterruptThrow=function(e){return e instanceof yt||e instanceof xt||e instanceof _t},t.createSuperScope=function(e){var t=Object.assign({},qt),n=Object.keys(t);return n.forEach((function(n){n in e&&delete t[n]})),new Gt(t,null,Rt)},t.setCurrentContext=function(e){this.currentContext=e},t.setCurrentScope=function(e){this.currentScope=e},t.evaluate=function(t){var n;if(void 0===t&&(t=""),t)return n=ot(t,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||e.ecmaVersion}),this.evaluateNode(n,t)},t.appendCode=function(e){return this.evaluate(e)},t.evaluateNode=function(e,t){var n=this;void 0===t&&(t=""),this.value=void 0,this.source=t,this.sourceList.push(t),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var r=this.getCurrentScope(),i=this.getCurrentContext(),a=r.labelStack.concat([]),o=this.callStack.concat([]),s=function(){n.setCurrentScope(r),n.setCurrentContext(i),r.labelStack=a,n.callStack=o};try{var u=this.createClosure(e);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),u()}catch(l){throw l}finally{s(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},t.createErrorMessage=function(e,t,n){var r=e[1].replace("%0",String(t));return null!==n&&(r+=this.getNodePosition(n||this.lastExecNode)),r},t.createError=function(e,t){return new t(e)},t.createThrowError=function(e,t){return this.createError(e,t)},t.createInternalThrowError=function(e,t,n){return this.createError(this.createErrorMessage(e,t,n),e[2])},t.checkTimeout=function(){if(!this.isRunning)return!1;var e=this.options.timeout||0,t=Date.now();return t-this.execStartTime>e},t.getNodePosition=function(e){if(e){var t="";return e.loc?" ["+e.loc.start.line+":"+e.loc.start.column+"]"+t:""}return""},t.createClosure=function(e){var t,n=this;switch(e.type){case"BinaryExpression":t=this.binaryExpressionHandler(e);break;case"LogicalExpression":t=this.logicalExpressionHandler(e);break;case"UnaryExpression":t=this.unaryExpressionHandler(e);break;case"UpdateExpression":t=this.updateExpressionHandler(e);break;case"ObjectExpression":t=this.objectExpressionHandler(e);break;case"ArrayExpression":t=this.arrayExpressionHandler(e);break;case"CallExpression":t=this.callExpressionHandler(e);break;case"NewExpression":t=this.newExpressionHandler(e);break;case"MemberExpression":t=this.memberExpressionHandler(e);break;case"ThisExpression":t=this.thisExpressionHandler(e);break;case"SequenceExpression":t=this.sequenceExpressionHandler(e);break;case"Literal":t=this.literalHandler(e);break;case"Identifier":t=this.identifierHandler(e);break;case"AssignmentExpression":t=this.assignmentExpressionHandler(e);break;case"FunctionDeclaration":t=this.functionDeclarationHandler(e);break;case"VariableDeclaration":t=this.variableDeclarationHandler(e);break;case"BlockStatement":case"Program":t=this.programHandler(e);break;case"ExpressionStatement":t=this.expressionStatementHandler(e);break;case"EmptyStatement":t=this.emptyStatementHandler(e);break;case"ReturnStatement":t=this.returnStatementHandler(e);break;case"FunctionExpression":t=this.functionExpressionHandler(e);break;case"IfStatement":t=this.ifStatementHandler(e);break;case"ConditionalExpression":t=this.conditionalExpressionHandler(e);break;case"ForStatement":t=this.forStatementHandler(e);break;case"WhileStatement":t=this.whileStatementHandler(e);break;case"DoWhileStatement":t=this.doWhileStatementHandler(e);break;case"ForInStatement":t=this.forInStatementHandler(e);break;case"WithStatement":t=this.withStatementHandler(e);break;case"ThrowStatement":t=this.throwStatementHandler(e);break;case"TryStatement":t=this.tryStatementHandler(e);break;case"ContinueStatement":t=this.continueStatementHandler(e);break;case"BreakStatement":t=this.breakStatementHandler(e);break;case"SwitchStatement":t=this.switchStatementHandler(e);break;case"LabeledStatement":t=this.labeledStatementHandler(e);break;case"DebuggerStatement":t=this.debuggerStatementHandler(e);break;default:throw this.createInternalThrowError(bt.NodeTypeSyntaxError,e.type,e)}return function(){var r=n.options.timeout;if(r&&r>0&&n.checkTimeout())throw n.createInternalThrowError(bt.ExecutionTimeOutError,r,null);return n.lastExecNode=e,t.apply(void 0,arguments)}},t.binaryExpressionHandler=function(e){var t=this,n=this.createClosure(e.left),r=this.createClosure(e.right);return function(){var i=n(),a=r();switch(e.operator){case"==":return i==a;case"!=":return i!=a;case"===":return i===a;case"!==":return i!==a;case"<":return i<a;case"<=":return i<=a;case">":return i>a;case">=":return i>=a;case"<<":return i<<a;case">>":return i>>a;case">>>":return i>>>a;case"+":return i+a;case"-":return i-a;case"*":return i*a;case"**":return Math.pow(i,a);case"/":return i/a;case"%":return i%a;case"|":return i|a;case"^":return i^a;case"&":return i&a;case"in":return i in a;case"instanceof":return i instanceof a;default:throw t.createInternalThrowError(bt.BinaryOperatorSyntaxError,e.operator,e)}}},t.logicalExpressionHandler=function(e){var t=this,n=this.createClosure(e.left),r=this.createClosure(e.right);return function(){switch(e.operator){case"||":return n()||r();case"&&":return n()&&r();default:throw t.createInternalThrowError(bt.LogicalOperatorSyntaxError,e.operator,e)}}},t.unaryExpressionHandler=function(e){var t=this;switch(e.operator){case"delete":var n=this.createObjectGetter(e.argument),r=this.createNameGetter(e.argument);return function(){var e=n(),t=r();return delete e[t]};default:var i;if("typeof"===e.operator&&"Identifier"===e.argument.type){var a=this.createObjectGetter(e.argument),o=this.createNameGetter(e.argument);i=function(){return a()[o()]}}else i=this.createClosure(e.argument);return function(){var n=i();switch(e.operator){case"-":return-n;case"+":return+n;case"!":return!n;case"~":return~n;case"void":return;case"typeof":return typeof n;default:throw t.createInternalThrowError(bt.UnaryOperatorSyntaxError,e.operator,e)}}}},t.updateExpressionHandler=function(e){var t=this,n=this.createObjectGetter(e.argument),r=this.createNameGetter(e.argument);return function(){var i=n(),a=r();switch(t.assertVariable(i,a,e),e.operator){case"++":return e.prefix?++i[a]:i[a]++;case"--":return e.prefix?--i[a]:i[a]--;default:throw t.createInternalThrowError(bt.UpdateOperatorSyntaxError,e.operator,e)}}},t.objectExpressionHandler=function(e){var t=this,n=[];function r(e){return"Identifier"===e.type?e.name:"Literal"===e.type?e.value:this.throwError(bt.ObjectStructureSyntaxError,e.type,e)}var i=Object.create(null);return e.properties.forEach((function(e){var a=e.kind,o=r(e.key);i[o]&&"init"!==a||(i[o]={}),i[o][a]=t.createClosure(e.value),n.push({key:o,property:e})})),function(){for(var e={},t=n.length,r=0;r<t;r++){var a=n[r],o=a.key,s=i[o],u=s.init?s.init():void 0,l=s.get?s.get():function(){},c=s.set?s.set():function(e){};if("set"in s||"get"in s){var f={configurable:!0,enumerable:!0,get:l,set:c};Object.defineProperty(e,o,f)}else{var h=a.property,p=h.kind;"Identifier"!==h.key.type||"FunctionExpression"!==h.value.type||"init"!==p||h.value.id||At(u,h.key.name),e[o]=u}}return e}},t.arrayExpressionHandler=function(e){var t=this,n=e.elements.map((function(e){return e?t.createClosure(e):e}));return function(){for(var e=n.length,t=Array(e),r=0;r<e;r++){var i=n[r];i&&(t[r]=i())}return t}},t.safeObjectGet=function(e,t,n){return e[t]},t.createCallFunctionGetter=function(e){var t=this;switch(e.type){case"MemberExpression":var n=this.createClosure(e.object),r=this.createMemberKeyGetter(e),i=this.source;return function(){var a=n(),o=r(),s=t.safeObjectGet(a,o,e);if(!s||!zt(s)){var u=i.slice(e.start,e.end);throw t.createInternalThrowError(bt.FunctionUndefinedReferenceError,u,e)}return s.__IS_EVAL_FUNC?function(e){return s(new Nt(t),e,!0)}:s.__IS_FUNCTION_FUNC?function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return s.apply(void 0,[new Nt(t)].concat(n))}:s.bind(a)};default:var a=this.createClosure(e);return function(){var n="";"Identifier"===e.type&&(n=e.name);var r=a();if(!r||!zt(r))throw t.createInternalThrowError(bt.FunctionUndefinedReferenceError,n,e);if("Identifier"===e.type&&r.__IS_EVAL_FUNC&&"eval"===n)return function(e){var i=t.getScopeFromName(n,t.getCurrentScope()),a=i.name===Rt||i.name===Dt||i.name===It;return r(new Nt(t),e,!a)};if(r.__IS_EVAL_FUNC)return function(e){return r(new Nt(t),e,!0)};if(r.__IS_FUNCTION_FUNC)return function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return r.apply(void 0,[new Nt(t)].concat(n))};var i=t.options.globalContextInFunction;if("Identifier"===e.type){var o=t.getIdentifierScope(e);o.name===Pt&&(i=o.data)}return r.bind(i)}}},t.callExpressionHandler=function(e){var t=this,n=this.createCallFunctionGetter(e.callee),r=e.arguments.map((function(e){return t.createClosure(e)}));return function(){return n().apply(void 0,r.map((function(e){return e()})))}},t.functionExpressionHandler=function(e){var t=this,n=this,r=this.source,i=this.collectDeclVars,a=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var o=e.id?e.id.name:"",s=e.params.length,u=e.params.map((function(e){return t.createParamNameGetter(e)})),l=this.createClosure(e.body),c=this.collectDeclVars,f=this.collectDeclFuncs;return this.collectDeclVars=i,this.collectDeclFuncs=a,function(){var t=n.getCurrentScope(),i=function e(){for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];n.callStack.push(""+o);var s=n.getCurrentScope(),h=Wt(t,"FunctionScope("+o+")");n.setCurrentScope(h),n.addDeclarationsToScope(c,f,h),o&&(h.data[o]=e),h.data["arguments"]=arguments,u.forEach((function(e,t){h.data[e()]=i[t]}));var p=n.getCurrentContext();n.setCurrentContext(this);var d=l();if(n.setCurrentContext(p),n.setCurrentScope(s),n.callStack.pop(),d instanceof Bt)return d.value};return At(i,o),Object.defineProperty(i,"length",{value:s,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(i,"toString",{value:function(){return r.slice(e.start,e.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(i,"valueOf",{value:function(){return r.slice(e.start,e.end)},writable:!0,configurable:!0,enumerable:!1}),i}},t.newExpressionHandler=function(e){var t=this,n=this.source,r=this.createClosure(e.callee),i=e.arguments.map((function(e){return t.createClosure(e)}));return function(){var a=r();if(!zt(a)||a.__IS_EVAL_FUNC){var o=e.callee,s=n.slice(o.start,o.end);throw t.createInternalThrowError(bt.IsNotConstructor,s,e)}return a.__IS_FUNCTION_FUNC?a.apply(void 0,[new Nt(t)].concat(i.map((function(e){return e()})))):wt(a,i.map((function(e){return e()})))}},t.memberExpressionHandler=function(e){var t=this.createClosure(e.object),n=this.createMemberKeyGetter(e);return function(){var e=t(),r=n();return e[r]}},t.thisExpressionHandler=function(e){var t=this;return function(){return t.getCurrentContext()}},t.sequenceExpressionHandler=function(e){var t=this,n=e.expressions.map((function(e){return t.createClosure(e)}));return function(){for(var e,t=n.length,r=0;r<t;r++){var i=n[r];e=i()}return e}},t.literalHandler=function(e){return function(){return e.regex?new RegExp(e.regex.pattern,e.regex.flags):e.value}},t.identifierHandler=function(e){var t=this;return function(){var n=t.getCurrentScope(),r=t.getScopeDataFromName(e.name,n);return t.assertVariable(r,e.name,e),r[e.name]}},t.getIdentifierScope=function(e){var t=this.getCurrentScope(),n=this.getScopeFromName(e.name,t);return n},t.assignmentExpressionHandler=function(e){var t=this;"Identifier"!==e.left.type||"FunctionExpression"!==e.right.type||e.right.id||(e.right.id={type:"Identifier",name:e.left.name});var n=this.createObjectGetter(e.left),r=this.createNameGetter(e.left),i=this.createClosure(e.right);return function(){var a=n(),o=r(),s=i();switch("="!==e.operator&&t.assertVariable(a,o,e),e.operator){case"=":return a[o]=s;case"+=":return a[o]+=s;case"-=":return a[o]-=s;case"*=":return a[o]*=s;case"**=":return a[o]=Math.pow(a[o],s);case"/=":return a[o]/=s;case"%=":return a[o]%=s;case"<<=":return a[o]<<=s;case">>=":return a[o]>>=s;case">>>=":return a[o]>>>=s;case"&=":return a[o]&=s;case"^=":return a[o]^=s;case"|=":return a[o]|=s;default:throw t.createInternalThrowError(bt.AssignmentExpressionSyntaxError,e.type,e)}}},t.functionDeclarationHandler=function(e){if(e.id){var t=this.functionExpressionHandler(e);Object.defineProperty(t,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(e.id.name,t)}return function(){return Lt}},t.getVariableName=function(e){if("Identifier"===e.type)return e.name;throw this.createInternalThrowError(bt.VariableTypeSyntaxError,e.type,e)},t.variableDeclarationHandler=function(e){for(var t,n=this,r=[],i=0;i<e.declarations.length;i++){var a=e.declarations[i];this.varDeclaration(this.getVariableName(a.id)),a.init&&r.push({type:"AssignmentExpression",operator:"=",left:a.id,right:a.init})}return r.length&&(t=this.createClosure({type:"BlockStatement",body:r})),function(){if(t){var e=n.isVarDeclMode;n.isVarDeclMode=!0,t(),n.isVarDeclMode=e}return Lt}},t.assertVariable=function(e,t,n){if(e===this.globalScope.data&&!(t in e))throw this.createInternalThrowError(bt.VariableUndefinedReferenceError,t,n)},t.programHandler=function(e){var t=this,n=e.body.map((function(e){return t.createClosure(e)}));return function(){for(var e=Lt,r=0;r<n.length;r++){var i=n[r],a=t.setValue(i());if(a!==Lt&&(e=a,e instanceof Bt||e instanceof Ut||e instanceof Vt||e===Tt||e===Mt))break}return e}},t.expressionStatementHandler=function(e){return this.createClosure(e.expression)},t.emptyStatementHandler=function(e){return function(){return Lt}},t.returnStatementHandler=function(e){var t=e.argument?this.createClosure(e.argument):Ht;return function(){return new Bt(t())}},t.ifStatementHandler=function(e){var t=this.createClosure(e.test),n=this.createClosure(e.consequent),r=e.alternate?this.createClosure(e.alternate):function(){return Lt};return function(){return t()?n():r()}},t.conditionalExpressionHandler=function(e){return this.ifStatementHandler(e)},t.forStatementHandler=function(e){var t=this,n=Ht,r=e.test?this.createClosure(e.test):function(){return!0},i=Ht,a=this.createClosure(e.body);return"ForStatement"===e.type&&(n=e.init?this.createClosure(e.init):n,i=e.update?this.createClosure(e.update):Ht),function(o){var s,u=Lt,l="DoWhileStatement"===e.type;for(o&&"LabeledStatement"===o.type&&(s=o.label.name),n();l||r();i()){l=!1;var c=t.setValue(a());if(c!==Lt&&c!==Mt){if(c===Tt)break;if(u=c,u instanceof Vt&&u.value===s)u=Lt;else if(u instanceof Bt||u instanceof Ut||u instanceof Vt)break}}return u}},t.whileStatementHandler=function(e){return this.forStatementHandler(e)},t.doWhileStatementHandler=function(e){return this.forStatementHandler(e)},t.forInStatementHandler=function(e){var t=this,n=e.left,r=this.createClosure(e.right),i=this.createClosure(e.body);return"VariableDeclaration"===e.left.type&&(this.createClosure(e.left)(),n=e.left.declarations[0].id),function(e){var a,o,s=Lt;e&&"LabeledStatement"===e.type&&(a=e.label.name);var u=r();for(o in u){t.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:n,right:{type:"Literal",value:o}})();var l=t.setValue(i());if(l!==Lt&&l!==Mt){if(l===Tt)break;if(s=l,s instanceof Vt&&s.value===a)s=Lt;else if(s instanceof Bt||s instanceof Ut||s instanceof Vt)break}}return s}},t.withStatementHandler=function(e){var t=this,n=this.createClosure(e.object),r=this.createClosure(e.body);return function(){var e=n(),i=t.getCurrentScope(),a=new Gt(e,i,Pt);t.setCurrentScope(a);var o=t.setValue(r());return t.setCurrentScope(i),o}},t.throwStatementHandler=function(e){var t=this,n=this.createClosure(e.argument);return function(){throw t.setValue(void 0),n()}},t.tryStatementHandler=function(e){var t=this,n=this.createClosure(e.block),r=e.handler?this.catchClauseHandler(e.handler):null,i=e.finalizer?this.createClosure(e.finalizer):null;return function(){var e,a,o=t.getCurrentScope(),s=t.getCurrentContext(),u=o.labelStack.concat([]),l=t.callStack.concat([]),c=Lt,f=function(){t.setCurrentScope(o),t.setCurrentContext(s),o.labelStack=u,t.callStack=l};try{c=t.setValue(n()),c instanceof Bt&&(e=c)}catch(h){if(f(),t.isInterruptThrow(h))throw h;if(r)try{c=t.setValue(r(h)),c instanceof Bt&&(e=c)}catch(h){if(f(),t.isInterruptThrow(h))throw h;a=h}}if(i)try{c=i(),c instanceof Bt&&(e=c)}catch(h){if(f(),t.isInterruptThrow(h))throw h;a=h}if(a)throw a;return e||c}},t.catchClauseHandler=function(e){var t=this,n=this.createParamNameGetter(e.param),r=this.createClosure(e.body);return function(e){var i,a=t.getCurrentScope(),o=a.data,s=n(),u=Et.call(o,s),l=o[s];return o[s]=e,i=r(),u?o[s]=l:delete o[s],i}},t.continueStatementHandler=function(e){return function(){return e.label?new Vt(e.label.name):Mt}},t.breakStatementHandler=function(e){return function(){return e.label?new Ut(e.label.name):Tt}},t.switchStatementHandler=function(e){var t=this,n=this.createClosure(e.discriminant),r=e.cases.map((function(e){return t.switchCaseHandler(e)}));return function(){for(var e,i,a,o=n(),s=!1,u=0;u<r.length;u++){var l=r[u](),c=l.testClosure();if(c!==Ot){if(s||c===o){if(s=!0,i=t.setValue(l.bodyClosure()),i===Lt)continue;if(i===Tt)break;if(e=i,e instanceof Bt||e instanceof Ut||e instanceof Vt||e===Mt)break}}else a=l}if(!s&&a){i=t.setValue(a.bodyClosure());var f=i===Lt||i===Tt||i===Mt;f||(e=i)}return e}},t.switchCaseHandler=function(e){var t=e.test?this.createClosure(e.test):function(){return Ot},n=this.createClosure({type:"BlockStatement",body:e.consequent});return function(){return{testClosure:t,bodyClosure:n}}},t.labeledStatementHandler=function(e){var t=this,n=e.label.name,r=this.createClosure(e.body);return function(){var i,a=t.getCurrentScope();return a.labelStack.push(n),i=r(e),i instanceof Ut&&i.value===n&&(i=Lt),a.labelStack.pop(),i}},t.debuggerStatementHandler=function(e){return function(){return Lt}},t.createParamNameGetter=function(e){if("Identifier"===e.type)return function(){return e.name};throw this.createInternalThrowError(bt.ParamTypeSyntaxError,e.type,e)},t.createObjectKeyGetter=function(e){var t;return t="Identifier"===e.type?function(){return e.name}:this.createClosure(e),function(){return t()}},t.createMemberKeyGetter=function(e){return e.computed?this.createClosure(e.property):this.createObjectKeyGetter(e.property)},t.createObjectGetter=function(e){var t=this;switch(e.type){case"Identifier":return function(){return t.getScopeDataFromName(e.name,t.getCurrentScope())};case"MemberExpression":return this.createClosure(e.object);default:throw this.createInternalThrowError(bt.AssignmentTypeSyntaxError,e.type,e)}},t.createNameGetter=function(e){switch(e.type){case"Identifier":return function(){return e.name};case"MemberExpression":return this.createMemberKeyGetter(e);default:throw this.createInternalThrowError(bt.AssignmentTypeSyntaxError,e.type,e)}},t.varDeclaration=function(e){var t=this.collectDeclVars;t[e]=void 0},t.funcDeclaration=function(e,t){var n=this.collectDeclFuncs;n[e]=t},t.addDeclarationsToScope=function(e,t,n){var r=n.data;for(var i in t){var a=t[i];r[i]=a?a():a}for(var o in e)o in r||(r[o]=void 0)},t.getScopeValue=function(e,t){var n=this.getScopeFromName(e,t);return n.data[e]},t.getScopeDataFromName=function(e,t){return this.getScopeFromName(e,t).data},t.getScopeFromName=function(e,t){var n=t;do{if(e in n.data)return n}while(n=n.parent);return this.globalScope},t.setValue=function(e){var t=this.callStack.length;return this.isVarDeclMode||t||e===Lt||e===Tt||e===Mt||e instanceof Ut||e instanceof Vt||(this.value=e instanceof Bt?e.value:e),e},t.getValue=function(){return this.value},e}();function Kt(e){return void 0===e&&(e=Object.create(null)),e}function Xt(e,t,n){void 0===t&&(t=[]),void 0===n&&(n={});var r=n.parsingContext,i=void 0===n.timeout?0:n.timeout,a="\n    (function anonymous("+t.join(",")+"){\n         "+e+"\n    });\n    ",o=new Zt(r,{ecmaVersion:n.ecmaVersion,timeout:i,rootContext:n.rootContext,globalContextInFunction:n.globalContextInFunction});return o.evaluate(a)}function Qt(e,t,n){var r=new Zt(t,n);return r.evaluate(e)}Zt.version=kt,Zt.eval=Ft,Zt.Function=jt,Zt.ecmaVersion=5,Zt.globalContextInFunction=void 0,Zt.global=Object.create(null);var Jt=Qt,$t=function(){function e(e){this._code=e}var t=e.prototype;return t.runInContext=function(e){return Qt(this._code,e)},t.runInNewContext=function(e){return Qt(this._code,e)},e}(),en=function(e,t,n){return Qt(e,t,n)};function tn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.pop();return Xt(r||"",t)}var nn=en},60996:function(e,t,n){(function(t,r){e.exports=r(n(4465))})(0,(function(e){"use strict";var t=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},n=function(e,t){for(var n=Object.keys(t),r=0;r<n.length;++r)e[n[r]]=t[n[r]];return e},r="\n";function i(e){return"undefined"!==typeof atob?atob(e):"base64:"+e}function a(e){var t=new Error("(regl) "+e);throw console.error(t),t}function o(e,t){e||a(t)}function s(e){return e?": "+e:""}function u(e,t,n){e in t||a("unknown parameter ("+e+")"+s(n)+". possible values: "+Object.keys(t).join())}function l(e,n){t(e)||a("invalid parameter type"+s(n)+". must be a typed array")}function c(e,t){switch(t){case"number":return"number"===typeof e;case"object":return"object"===typeof e;case"string":return"string"===typeof e;case"boolean":return"boolean"===typeof e;case"function":return"function"===typeof e;case"undefined":return"undefined"===typeof e;case"symbol":return"symbol"===typeof e}}function f(e,t,n){c(e,t)||a("invalid parameter type"+s(n)+". expected "+t+", got "+typeof e)}function h(e,t){e>=0&&(0|e)===e||a("invalid parameter type, ("+e+")"+s(t)+". must be a nonnegative integer")}function p(e,t,n){t.indexOf(e)<0&&a("invalid value"+s(n)+". must be one of: "+t)}var d=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function v(e){Object.keys(e).forEach((function(e){d.indexOf(e)<0&&a('invalid regl constructor argument "'+e+'". must be one of '+d)}))}function g(e,t){e+="";while(e.length<t)e=" "+e;return e}function m(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function y(e,t){this.number=e,this.line=t,this.errors=[]}function _(e,t,n){this.file=e,this.line=t,this.message=n}function x(){var e=new Error,t=(e.stack||e).toString(),n=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(t);return r?r[1]:"unknown"}function b(){var e=new Error,t=(e.stack||e).toString(),n=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(t);return r?r[1]:"unknown"}function S(e,t){var n=e.split("\n"),r=1,a=0,o={unknown:new m,0:new m};o.unknown.name=o[0].name=t||x(),o.unknown.lines.push(new y(0,""));for(var s=0;s<n.length;++s){var u=n[s],l=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(u);if(l)switch(l[1]){case"line":var c=/(\d+)(\s+\d+)?/.exec(l[2]);c&&(r=0|c[1],c[2]&&(a=0|c[2],a in o||(o[a]=new m)));break;case"define":var f=/SHADER_NAME(_B64)?\s+(.*)$/.exec(l[2]);f&&(o[a].name=f[1]?i(f[2]):f[2]);break}o[a].lines.push(new y(r++,u))}return Object.keys(o).forEach((function(e){var t=o[e];t.lines.forEach((function(e){t.index[e.number]=e}))})),o}function w(e){var t=[];return e.split("\n").forEach((function(e){if(!(e.length<5)){var n=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(e);n?t.push(new _(0|n[1],0|n[2],n[3].trim())):e.length>0&&t.push(new _("unknown",0,e))}})),t}function C(e,t){t.forEach((function(t){var n=e[t.file];if(n){var r=n.index[t.line];if(r)return r.errors.push(t),void(n.hasErrors=!0)}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(t)}))}function k(e,t,n,i,a){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){var s=e.getShaderInfoLog(t),u=i===e.FRAGMENT_SHADER?"fragment":"vertex";P(n,"string",u+" shader source must be a string",a);var l=S(n,a),c=w(s);C(l,c),Object.keys(l).forEach((function(e){var t=l[e];if(t.hasErrors){var n=[""],i=[""];a("file number "+e+": "+t.name+"\n","color:red;text-decoration:underline;font-weight:bold"),t.lines.forEach((function(e){if(e.errors.length>0){a(g(e.number,4)+"|  ","background-color:yellow; font-weight:bold"),a(e.line+r,"color:red; background-color:yellow; font-weight:bold");var t=0;e.errors.forEach((function(n){var i=n.message,o=/^\s*'(.*)'\s*:\s*(.*)$/.exec(i);if(o){var s=o[1];switch(i=o[2],s){case"assign":s="=";break}t=Math.max(e.line.indexOf(s,t),0)}else t=0;a(g("| ",6)),a(g("^^^",t+3)+r,"font-weight:bold"),a(g("| ",6)),a(i+r,"font-weight:bold")})),a(g("| ",6)+r)}else a(g(e.number,4)+"|  "),a(e.line+r,"color:red")})),"undefined"===typeof document||window.chrome?console.log(n.join("")):(i[0]=n.join("%c"),console.log.apply(console,i))}function a(e,t){n.push(e),i.push(t||"")}})),o.raise("Error compiling "+u+" shader, "+l[0].name)}}function A(e,t,n,i,a){if(!e.getProgramParameter(t,e.LINK_STATUS)){var s=e.getProgramInfoLog(t),u=S(n,a),l=S(i,a),c='Error linking program with vertex shader, "'+l[0].name+'", and fragment shader "'+u[0].name+'"';"undefined"!==typeof document?console.log("%c"+c+r+"%c"+s,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(c+r+s),o.raise(c)}}function E(e){e._commandRef=x()}function T(e,t,n,r){function i(e){return e?r.id(e):0}function a(e,t){Object.keys(t).forEach((function(t){e[r.id(t)]=!0}))}E(e),e._fragId=i(e.static.frag),e._vertId=i(e.static.vert);var o=e._uniformSet={};a(o,t.static),a(o,t.dynamic);var s=e._attributeSet={};a(s,n.static),a(s,n.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic}function M(e,t){var n=b();a(e+" in command "+(t||x())+("unknown"===n?"":" called from "+n))}function O(e,t,n){e||M(t,n||x())}function L(e,t,n,r){e in t||M("unknown parameter ("+e+")"+s(n)+". possible values: "+Object.keys(t).join(),r||x())}function P(e,t,n,r){c(e,t)||M("invalid parameter type"+s(n)+". expected "+t+", got "+typeof e,r||x())}function R(e){e()}function I(e,t,n){e.texture?p(e.texture._texture.internalformat,t,"unsupported texture format for attachment"):p(e.renderbuffer._renderbuffer.format,n,"unsupported renderbuffer format for attachment")}var D=33071,z=9728,N=9984,F=9985,j=9986,B=9987,U=5120,V=5121,G=5122,H=5123,W=5124,Y=5125,q=5126,Z=32819,K=32820,X=33635,Q=34042,J=36193,$={};function ee(e,t){return e===K||e===Z||e===X?2:e===Q?4:$[e]*t}function te(e){return!(e&e-1)&&!!e}function ne(e,t,n){var r,i=t.width,a=t.height,s=t.channels;o(i>0&&i<=n.maxTextureSize&&a>0&&a<=n.maxTextureSize,"invalid texture shape"),e.wrapS===D&&e.wrapT===D||o(te(i)&&te(a),"incompatible wrap mode for texture, both width and height must be power of 2"),1===t.mipmask?1!==i&&1!==a&&o(e.minFilter!==N&&e.minFilter!==j&&e.minFilter!==F&&e.minFilter!==B,"min filter requires mipmap"):(o(te(i)&&te(a),"texture must be a square power of 2 to support mipmapping"),o(t.mipmask===(i<<1)-1,"missing or incomplete mipmap data")),t.type===q&&(n.extensions.indexOf("oes_texture_float_linear")<0&&o(e.minFilter===z&&e.magFilter===z,"filter not supported, must enable oes_texture_float_linear"),o(!e.genMipmaps,"mipmap generation not supported with float textures"));var u=t.images;for(r=0;r<16;++r)if(u[r]){var l=i>>r,c=a>>r;o(t.mipmask&1<<r,"missing mipmap data");var f=u[r];if(o(f.width===l&&f.height===c,"invalid shape for mip images"),o(f.format===t.format&&f.internalformat===t.internalformat&&f.type===t.type,"incompatible type for mip image"),f.compressed);else if(f.data){var h=Math.ceil(ee(f.type,s)*l/f.unpackAlignment)*f.unpackAlignment;o(f.data.byteLength===h*c,"invalid data for image, buffer size is inconsistent with image format")}else f.element||f.copy}else e.genMipmaps||o(0===(t.mipmask&1<<r),"extra mipmap data");t.compressed&&o(!e.genMipmaps,"mipmap generation for compressed images not supported")}function re(e,t,n,r){var i=e.width,a=e.height,s=e.channels;o(i>0&&i<=r.maxTextureSize&&a>0&&a<=r.maxTextureSize,"invalid texture shape"),o(i===a,"cube map must be square"),o(t.wrapS===D&&t.wrapT===D,"wrap mode not supported by cube map");for(var u=0;u<n.length;++u){var l=n[u];o(l.width===i&&l.height===a,"inconsistent cube map face shape"),t.genMipmaps&&(o(!l.compressed,"can not generate mipmap for compressed textures"),o(1===l.mipmask,"can not specify mipmaps and generate mipmaps"));for(var c=l.images,f=0;f<16;++f){var h=c[f];if(h){var p=i>>f,d=a>>f;o(l.mipmask&1<<f,"missing mipmap data"),o(h.width===p&&h.height===d,"invalid shape for mip images"),o(h.format===e.format&&h.internalformat===e.internalformat&&h.type===e.type,"incompatible type for mip image"),h.compressed||(h.data?o(h.data.byteLength===p*d*Math.max(ee(h.type,s),h.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):h.element||h.copy)}}}}$[U]=$[V]=1,$[G]=$[H]=$[J]=$[X]=$[Z]=$[K]=2,$[W]=$[Y]=$[q]=$[Q]=4;var ie=n(o,{optional:R,raise:a,commandRaise:M,command:O,parameter:u,commandParameter:L,constructor:v,type:f,commandType:P,isTypedArray:l,nni:h,oneOf:p,shaderError:k,linkError:A,callSite:b,saveCommandRef:E,saveDrawInfo:T,framebufferFormat:I,guessCommand:x,texture2D:ne,textureCube:re}),ae=0,oe=0,se=5,ue=6;function le(e,t){this.id=ae++,this.type=e,this.data=t}function ce(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function fe(e){if(0===e.length)return[];var t=e.charAt(0),n=e.charAt(e.length-1);if(e.length>1&&t===n&&('"'===t||"'"===t))return['"'+ce(e.substr(1,e.length-2))+'"'];var r=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(e);if(r)return fe(e.substr(0,r.index)).concat(fe(r[1])).concat(fe(e.substr(r.index+r[0].length)));var i=e.split(".");if(1===i.length)return['"'+ce(e)+'"'];for(var a=[],o=0;o<i.length;++o)a=a.concat(fe(i[o]));return a}function he(e){return"["+fe(e).join("][")+"]"}function pe(e,t){return new le(e,he(t+""))}function de(e){return"function"===typeof e&&!e._reglType||e instanceof le}function ve(e,t){return"function"===typeof e?new le(oe,e):"number"===typeof e||"boolean"===typeof e?new le(se,e):Array.isArray(e)?new le(ue,e.map((function(e,n){return ve(e,t+"["+n+"]")}))):e instanceof le?e:void ie(!1,"invalid option type in uniform "+t)}var ge={DynamicVariable:le,define:pe,isDynamic:de,unbox:ve,accessor:he},me={next:"function"===typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:"function"===typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout},ye="undefined"!==typeof my&&!!my&&"function"===typeof my.showToast&&!0!==my.isFRM,_e=ye?function(){return+new Date}:"undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function xe(){var e={"":0},t=[""];return{id:function(n){var r=e[n];return r||(r=e[n]=t.length,t.push(n),r)},str:function(e){return t[e]}}}function be(e,t,r){var i,a=document.createElement("canvas");function o(){var t=window.innerWidth,n=window.innerHeight;if(e!==document.body){var i=a.getBoundingClientRect();t=i.right-i.left,n=i.bottom-i.top}a.width=r*t,a.height=r*n}function s(){i?i.disconnect():window.removeEventListener("resize",o),e.removeChild(a)}return n(a.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),e.appendChild(a),e===document.body&&(a.style.position="absolute",n(e.style,{margin:0,padding:0})),e!==document.body&&"function"===typeof ResizeObserver?(i=new ResizeObserver((function(){setTimeout(o)})),i.observe(e)):window.addEventListener("resize",o,!1),o(),{canvas:a,onDestroy:s}}function Se(e,t){function n(n){try{return e.getContext(n,t)}catch(r){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}function we(e){return"string"===typeof e.nodeName&&"function"===typeof e.appendChild&&"function"===typeof e.getBoundingClientRect}function Ce(e){return"function"===typeof e.drawArrays||"function"===typeof e.drawElements}function ke(e){return"string"===typeof e?e.split():(ie(Array.isArray(e),"invalid extension array"),e)}function Ae(e){return"string"===typeof e?(ie("undefined"!==typeof document,"not supported outside of DOM"),document.querySelector(e)):e}function Ee(e){var t,n,r,i,a=e||{},o={},s=[],u=[],l="undefined"===typeof window?1:window.devicePixelRatio,c=!1,f=function(e){e&&ie.raise(e)},h=function(){};if("string"===typeof a?(ie("undefined"!==typeof document,"selector queries only supported in DOM environments"),t=document.querySelector(a),ie(t,"invalid query string for element")):"object"===typeof a?we(a)?t=a:Ce(a)?(i=a,r=i.canvas):(ie.constructor(a),"gl"in a?i=a.gl:"canvas"in a?r=Ae(a.canvas):"container"in a&&(n=Ae(a.container)),"attributes"in a&&(o=a.attributes,ie.type(o,"object","invalid context attributes")),"extensions"in a&&(s=ke(a.extensions)),"optionalExtensions"in a&&(u=ke(a.optionalExtensions)),"onDone"in a&&(ie.type(a.onDone,"function","invalid or missing onDone callback"),f=a.onDone),"profile"in a&&(c=!!a.profile),"pixelRatio"in a&&(l=+a.pixelRatio,ie(l>0,"invalid pixel ratio"))):ie.raise("invalid arguments to regl"),t&&("canvas"===t.nodeName.toLowerCase()?r=t:n=t),!i){if(!r){ie("undefined"!==typeof document,"must manually specify webgl context outside of DOM environments");var p=be(n||document.body,f,l);if(!p)return null;r=p.canvas,h=p.onDestroy}void 0===o.premultipliedAlpha&&(o.premultipliedAlpha=!0),i=Se(r,o)}return i?{gl:i,canvas:r,container:n,extensions:s,optionalExtensions:u,pixelRatio:l,profile:c,onDone:f,onDestroy:h}:(h(),f("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Te(e,t){var n={};function r(e){ie.type(e,"string","extension name must be string");var t,r=e.toLowerCase();try{t=n[r]=i(e)}catch(a){}return!!t}function i(t){return e.getExtension(t)?e.getExtension(t):e.getExtension(t.toLowerCase())?e.getExtension(t.toLowerCase()):null}for(var a=0;a<t.extensions.length;++a){var o=t.extensions[a];if(!r(o))return t.onDestroy(),t.onDone('"'+o+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return t.optionalExtensions.forEach(r),{extensions:n,restore:function(){Object.keys(n).forEach((function(e){if(n[e]&&!r(e))throw new Error("(regl): error restoring extension "+e)}))}}}function Me(e,t){for(var n=Array(e),r=0;r<e;++r)n[r]=t(r);return n}var Oe=5120,Le=5121,Pe=5122,Re=5123,Ie=5124,De=5125,ze=5126;function Ne(e){for(var t=16;t<=1<<28;t*=16)if(e<=t)return t;return 0}function Fe(e){var t,n;return t=(e>65535)<<4,e>>>=t,n=(e>255)<<3,e>>>=n,t|=n,n=(e>15)<<2,e>>>=n,t|=n,n=(e>3)<<1,e>>>=n,t|=n,t|e>>1}function je(){var e=Me(8,(function(){return[]}));function t(t){var n=Ne(t),r=e[Fe(n)>>2];return r.length>0?r.pop():new ArrayBuffer(n)}function n(t){e[Fe(t.byteLength)>>2].push(t)}function r(e,n){var r=null;switch(e){case Oe:r=new Int8Array(t(n),0,n);break;case Le:r=new Uint8Array(t(n),0,n);break;case Pe:r=new Int16Array(t(2*n),0,n);break;case Re:r=new Uint16Array(t(2*n),0,n);break;case Ie:r=new Int32Array(t(4*n),0,n);break;case De:r=new Uint32Array(t(4*n),0,n);break;case ze:r=new Float32Array(t(4*n),0,n);break;default:return null}return r.length!==n?r.subarray(0,n):r}function i(e){n(e.buffer)}return{alloc:t,free:n,allocType:r,freeType:i}}var Be=je();Be.zero=je();var Ue=3408,Ve=3410,Ge=3411,He=3412,We=3413,Ye=3414,qe=3415,Ze=33901,Ke=33902,Xe=3379,Qe=3386,Je=34921,$e=36347,et=36348,tt=35661,nt=35660,rt=34930,it=36349,at=34076,ot=34024,st=7936,ut=7937,lt=7938,ct=35724,ft=34047,ht=36063,pt=34852,dt=3553,vt=34067,gt=34069,mt=33984,yt=6408,_t=5126,xt=5121,bt=36160,St=36053,wt=36064,Ct=16384,kt=function(e,t){var n=1;t.ext_texture_filter_anisotropic&&(n=e.getParameter(ft));var r=1,i=1;t.webgl_draw_buffers&&(r=e.getParameter(pt),i=e.getParameter(ht));var a=!!t.oes_texture_float;if(a){var o=e.createTexture();e.bindTexture(dt,o),e.texImage2D(dt,0,yt,1,1,0,yt,_t,null);var s=e.createFramebuffer();if(e.bindFramebuffer(bt,s),e.framebufferTexture2D(bt,wt,dt,o,0),e.bindTexture(dt,null),e.checkFramebufferStatus(bt)!==St)a=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(Ct);var u=Be.allocType(_t,4);e.readPixels(0,0,1,1,yt,_t,u),e.getError()?a=!1:(e.deleteFramebuffer(s),e.deleteTexture(o),a=1===u[0]),Be.freeType(u)}}var l="undefined"!==typeof navigator&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),c=!0;if(!l){var f=e.createTexture(),h=Be.allocType(xt,36);e.activeTexture(mt),e.bindTexture(vt,f),e.texImage2D(gt,0,yt,3,3,0,yt,xt,h),Be.freeType(h),e.bindTexture(vt,null),e.deleteTexture(f),c=!e.getError()}return{colorBits:[e.getParameter(Ve),e.getParameter(Ge),e.getParameter(He),e.getParameter(We)],depthBits:e.getParameter(Ye),stencilBits:e.getParameter(qe),subpixelBits:e.getParameter(Ue),extensions:Object.keys(t).filter((function(e){return!!t[e]})),maxAnisotropic:n,maxDrawbuffers:r,maxColorAttachments:i,pointSizeDims:e.getParameter(Ze),lineWidthDims:e.getParameter(Ke),maxViewportDims:e.getParameter(Qe),maxCombinedTextureUnits:e.getParameter(tt),maxCubeMapSize:e.getParameter(at),maxRenderbufferSize:e.getParameter(ot),maxTextureUnits:e.getParameter(rt),maxTextureSize:e.getParameter(Xe),maxAttributes:e.getParameter(Je),maxVertexUniforms:e.getParameter($e),maxVertexTextureUnits:e.getParameter(nt),maxVaryingVectors:e.getParameter(et),maxFragmentUniforms:e.getParameter(it),glsl:e.getParameter(ct),renderer:e.getParameter(ut),vendor:e.getParameter(st),version:e.getParameter(lt),readFloat:a,npotTextureCube:c}};function At(e){return!!e&&"object"===typeof e&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"===typeof e.offset&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||t(e.data))}var Et=function(e){return Object.keys(e).map((function(t){return e[t]}))},Tt={shape:It,flatten:Rt};function Mt(e,t,n){for(var r=0;r<t;++r)n[r]=e[r]}function Ot(e,t,n,r){for(var i=0,a=0;a<t;++a)for(var o=e[a],s=0;s<n;++s)r[i++]=o[s]}function Lt(e,t,n,r,i,a){for(var o=a,s=0;s<t;++s)for(var u=e[s],l=0;l<n;++l)for(var c=u[l],f=0;f<r;++f)i[o++]=c[f]}function Pt(e,t,n,r,i){for(var a=1,o=n+1;o<t.length;++o)a*=t[o];var s=t[n];if(t.length-n===4){var u=t[n+1],l=t[n+2],c=t[n+3];for(o=0;o<s;++o)Lt(e[o],u,l,c,r,i),i+=a}else for(o=0;o<s;++o)Pt(e[o],t,n+1,r,i),i+=a}function Rt(e,t,n,r){var i=1;if(t.length)for(var a=0;a<t.length;++a)i*=t[a];else i=0;var o=r||Be.allocType(n,i);switch(t.length){case 0:break;case 1:Mt(e,t[0],o);break;case 2:Ot(e,t[0],t[1],o);break;case 3:Lt(e,t[0],t[1],t[2],o,0);break;default:Pt(e,t,0,o,0)}return o}function It(e){for(var t=[],n=e;n.length;n=n[0])t.push(n.length);return t}var Dt={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},zt=5120,Nt=5122,Ft=5124,jt=5121,Bt=5123,Ut=5125,Vt=5126,Gt=5126,Ht={int8:zt,int16:Nt,int32:Ft,uint8:jt,uint16:Bt,uint32:Ut,float:Vt,float32:Gt},Wt=35048,Yt=35040,qt={dynamic:Wt,stream:Yt,static:35044},Zt=Tt.flatten,Kt=Tt.shape,Xt=35044,Qt=35040,Jt=5121,$t=5126,en=[];function tn(e){return 0|Dt[Object.prototype.toString.call(e)]}function nn(e,t){for(var n=0;n<t.length;++n)e[n]=t[n]}function rn(e,t,n,r,i,a,o){for(var s=0,u=0;u<n;++u)for(var l=0;l<r;++l)e[s++]=t[i*u+a*l+o]}function an(e,n,r,i){var a=0,o={};function s(t){this.id=a++,this.buffer=e.createBuffer(),this.type=t,this.usage=Xt,this.byteLength=0,this.dimension=1,this.dtype=Jt,this.persistentData=null,r.profile&&(this.stats={size:0})}s.prototype.bind=function(){e.bindBuffer(this.type,this.buffer)},s.prototype.destroy=function(){p(this)};var u=[];function l(e,t){var n=u.pop();return n||(n=new s(e)),n.bind(),h(n,t,Qt,0,1,!1),n}function c(e){u.push(e)}function f(t,n,r){t.byteLength=n.byteLength,e.bufferData(t.type,n,r)}function h(e,n,r,i,a,o){var s,u;if(e.usage=r,Array.isArray(n)){if(e.dtype=i||$t,n.length>0)if(Array.isArray(n[0])){s=Kt(n);for(var l=1,c=1;c<s.length;++c)l*=s[c];e.dimension=l,u=Zt(n,s,e.dtype),f(e,u,r),o?e.persistentData=u:Be.freeType(u)}else if("number"===typeof n[0]){e.dimension=a;var h=Be.allocType(e.dtype,n.length);nn(h,n),f(e,h,r),o?e.persistentData=h:Be.freeType(h)}else t(n[0])?(e.dimension=n[0].length,e.dtype=i||tn(n[0])||$t,u=Zt(n,[n.length,n[0].length],e.dtype),f(e,u,r),o?e.persistentData=u:Be.freeType(u)):ie.raise("invalid buffer data")}else if(t(n))e.dtype=i||tn(n),e.dimension=a,f(e,n,r),o&&(e.persistentData=new Uint8Array(new Uint8Array(n.buffer)));else if(At(n)){s=n.shape;var p=n.stride,d=n.offset,v=0,g=0,m=0,y=0;1===s.length?(v=s[0],g=1,m=p[0],y=0):2===s.length?(v=s[0],g=s[1],m=p[0],y=p[1]):ie.raise("invalid shape"),e.dtype=i||tn(n.data)||$t,e.dimension=g;var _=Be.allocType(e.dtype,v*g);rn(_,n.data,v,g,m,y,d),f(e,_,r),o?e.persistentData=_:Be.freeType(_)}else n instanceof ArrayBuffer?(e.dtype=Jt,e.dimension=a,f(e,n,r),o&&(e.persistentData=new Uint8Array(new Uint8Array(n)))):ie.raise("invalid buffer data")}function p(t){n.bufferCount--,i(t);var r=t.buffer;ie(r,"buffer must not be deleted already"),e.deleteBuffer(r),t.buffer=null,delete o[t.id]}function d(i,a,u,l){n.bufferCount++;var c=new s(a);function f(n){var i=Xt,a=null,o=0,s=0,u=1;return Array.isArray(n)||t(n)||At(n)||n instanceof ArrayBuffer?a=n:"number"===typeof n?o=0|n:n&&(ie.type(n,"object","buffer arguments must be an object, a number or an array"),"data"in n&&(ie(null===a||Array.isArray(a)||t(a)||At(a),"invalid data for buffer"),a=n.data),"usage"in n&&(ie.parameter(n.usage,qt,"invalid buffer usage"),i=qt[n.usage]),"type"in n&&(ie.parameter(n.type,Ht,"invalid buffer type"),s=Ht[n.type]),"dimension"in n&&(ie.type(n.dimension,"number","invalid dimension"),u=0|n.dimension),"length"in n&&(ie.nni(o,"buffer length must be a nonnegative integer"),o=0|n.length)),c.bind(),a?h(c,a,i,s,u,l):(o&&e.bufferData(c.type,o,i),c.dtype=s||Jt,c.usage=i,c.dimension=u,c.byteLength=o),r.profile&&(c.stats.size=c.byteLength*en[c.dtype]),f}function d(t,n){ie(n+t.byteLength<=c.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+t.byteLength+" starting from offset "+n+" to a buffer of size "+c.byteLength),e.bufferSubData(c.type,n,t)}function v(e,n){var r,i=0|(n||0);if(c.bind(),t(e)||e instanceof ArrayBuffer)d(e,i);else if(Array.isArray(e)){if(e.length>0)if("number"===typeof e[0]){var a=Be.allocType(c.dtype,e.length);nn(a,e),d(a,i),Be.freeType(a)}else if(Array.isArray(e[0])||t(e[0])){r=Kt(e);var o=Zt(e,r,c.dtype);d(o,i),Be.freeType(o)}else ie.raise("invalid buffer data")}else if(At(e)){r=e.shape;var s=e.stride,u=0,l=0,h=0,p=0;1===r.length?(u=r[0],l=1,h=s[0],p=0):2===r.length?(u=r[0],l=r[1],h=s[0],p=s[1]):ie.raise("invalid shape");var v=Array.isArray(e.data)?c.dtype:tn(e.data),g=Be.allocType(v,u*l);rn(g,e.data,u,l,h,p,e.offset),d(g,i),Be.freeType(g)}else ie.raise("invalid data for buffer subdata");return f}return o[c.id]=c,u||f(i),f._reglType="buffer",f._buffer=c,f.subdata=v,r.profile&&(f.stats=c.stats),f.destroy=function(){p(c)},f}function v(){Et(o).forEach((function(t){t.buffer=e.createBuffer(),e.bindBuffer(t.type,t.buffer),e.bufferData(t.type,t.persistentData||t.byteLength,t.usage)}))}return r.profile&&(n.getTotalBufferSize=function(){var e=0;return Object.keys(o).forEach((function(t){e+=o[t].stats.size})),e}),{create:d,createStream:l,destroyStream:c,clear:function(){Et(o).forEach(p),u.forEach(p)},getBuffer:function(e){return e&&e._buffer instanceof s?e._buffer:null},restore:v,_initBuffer:h}}en[5120]=1,en[5122]=2,en[5124]=4,en[5121]=1,en[5123]=2,en[5125]=4,en[5126]=4;var on=0,sn=0,un=1,ln=1,cn=4,fn=4,hn={points:on,point:sn,lines:un,line:ln,triangles:cn,triangle:fn,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},pn=0,dn=1,vn=4,gn=5120,mn=5121,yn=5122,_n=5123,xn=5124,bn=5125,Sn=34963,wn=35040,Cn=35044;function kn(e,n,r,i){var a={},o=0,s={uint8:mn,uint16:_n};function u(e){this.id=o++,a[this.id]=this,this.buffer=e,this.primType=vn,this.vertCount=0,this.type=0}n.oes_element_index_uint&&(s.uint32=bn),u.prototype.bind=function(){this.buffer.bind()};var l=[];function c(e){var t=l.pop();return t||(t=new u(r.create(null,Sn,!0,!1)._buffer)),h(t,e,wn,-1,-1,0,0),t}function f(e){l.push(e)}function h(i,a,o,s,u,l,c){var f;if(i.buffer.bind(),a){var h=c;c||t(a)&&(!At(a)||t(a.data))||(h=n.oes_element_index_uint?bn:_n),r._initBuffer(i.buffer,a,o,h,3)}else e.bufferData(Sn,l,o),i.buffer.dtype=f||mn,i.buffer.usage=o,i.buffer.dimension=3,i.buffer.byteLength=l;if(f=c,!c){switch(i.buffer.dtype){case mn:case gn:f=mn;break;case _n:case yn:f=_n;break;case bn:case xn:f=bn;break;default:ie.raise("unsupported type for element array")}i.buffer.dtype=f}i.type=f,ie(f!==bn||!!n.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var p=u;p<0&&(p=i.buffer.byteLength,f===_n?p>>=1:f===bn&&(p>>=2)),i.vertCount=p;var d=s;if(s<0){d=vn;var v=i.buffer.dimension;1===v&&(d=pn),2===v&&(d=dn),3===v&&(d=vn)}i.primType=d}function p(e){i.elementsCount--,ie(null!==e.buffer,"must not double destroy elements"),delete a[e.id],e.buffer.destroy(),e.buffer=null}function d(e,n){var a=r.create(null,Sn,!0),o=new u(a._buffer);function l(e){if(e)if("number"===typeof e)a(e),o.primType=vn,o.vertCount=0|e,o.type=mn;else{var n=null,r=Cn,i=-1,u=-1,c=0,f=0;Array.isArray(e)||t(e)||At(e)?n=e:(ie.type(e,"object","invalid arguments for elements"),"data"in e&&(n=e.data,ie(Array.isArray(n)||t(n)||At(n),"invalid data for element buffer")),"usage"in e&&(ie.parameter(e.usage,qt,"invalid element buffer usage"),r=qt[e.usage]),"primitive"in e&&(ie.parameter(e.primitive,hn,"invalid element buffer primitive"),i=hn[e.primitive]),"count"in e&&(ie("number"===typeof e.count&&e.count>=0,"invalid vertex count for elements"),u=0|e.count),"type"in e&&(ie.parameter(e.type,s,"invalid buffer type"),f=s[e.type]),"length"in e?c=0|e.length:(c=u,f===_n||f===yn?c*=2:f!==bn&&f!==xn||(c*=4))),h(o,n,r,i,u,c,f)}else a(),o.primType=vn,o.vertCount=0,o.type=mn;return l}return i.elementsCount++,l(e),l._reglType="elements",l._elements=o,l.subdata=function(e,t){return a.subdata(e,t),l},l.destroy=function(){p(o)},l}return{create:d,createStream:c,destroyStream:f,getElements:function(e){return"function"===typeof e&&e._elements instanceof u?e._elements:null},clear:function(){Et(a).forEach(p)}}}var An=new Float32Array(1),En=new Uint32Array(An.buffer),Tn=5123;function Mn(e){for(var t=Be.allocType(Tn,e.length),n=0;n<e.length;++n)if(isNaN(e[n]))t[n]=65535;else if(e[n]===1/0)t[n]=31744;else if(e[n]===-1/0)t[n]=64512;else{An[0]=e[n];var r=En[0],i=r>>>31<<15,a=(r<<1>>>24)-127,o=r>>13&1023;if(a<-24)t[n]=i;else if(a<-14){var s=-14-a;t[n]=i+(o+1024>>s)}else t[n]=a>15?i+31744:i+(a+15<<10)+o}return t}function On(e){return Array.isArray(e)||t(e)}var Ln=function(e){return!(e&e-1)&&!!e},Pn=34467,Rn=3553,In=34067,Dn=34069,zn=6408,Nn=6406,Fn=6407,jn=6409,Bn=6410,Un=32854,Vn=32855,Gn=36194,Hn=32819,Wn=32820,Yn=33635,qn=34042,Zn=6402,Kn=34041,Xn=35904,Qn=35906,Jn=36193,$n=33776,er=33777,tr=33778,nr=33779,rr=35986,ir=35987,ar=34798,or=35840,sr=35841,ur=35842,lr=35843,cr=36196,fr=5121,hr=5123,pr=5125,dr=5126,vr=10242,gr=10243,mr=10497,yr=33071,_r=33648,xr=10240,br=10241,Sr=9728,wr=9729,Cr=9984,kr=9985,Ar=9986,Er=9987,Tr=33170,Mr=4352,Or=4353,Lr=4354,Pr=34046,Rr=3317,Ir=37440,Dr=37441,zr=37443,Nr=37444,Fr=33984,jr=[Cr,Ar,kr,Er],Br=[0,jn,Bn,Fn,zn],Ur={};function Vr(e){return"[object "+e+"]"}Ur[jn]=Ur[Nn]=Ur[Zn]=1,Ur[Kn]=Ur[Bn]=2,Ur[Fn]=Ur[Xn]=3,Ur[zn]=Ur[Qn]=4;var Gr=Vr("HTMLCanvasElement"),Hr=Vr("OffscreenCanvas"),Wr=Vr("CanvasRenderingContext2D"),Yr=Vr("ImageBitmap"),qr=Vr("HTMLImageElement"),Zr=Vr("HTMLVideoElement"),Kr=Object.keys(Dt).concat([Gr,Hr,Wr,Yr,qr,Zr]),Xr=[];Xr[fr]=1,Xr[dr]=4,Xr[Jn]=2,Xr[hr]=2,Xr[pr]=4;var Qr=[];function Jr(e){return Array.isArray(e)&&(0===e.length||"number"===typeof e[0])}function $r(e){if(!Array.isArray(e))return!1;var t=e.length;return!(0===t||!On(e[0]))}function ei(e){return Object.prototype.toString.call(e)}function ti(e){return ei(e)===Gr}function ni(e){return ei(e)===Hr}function ri(e){return ei(e)===Wr}function ii(e){return ei(e)===Yr}function ai(e){return ei(e)===qr}function oi(e){return ei(e)===Zr}function si(e){var t="undefined"!==typeof my&&!!my&&"function"===typeof my.showToast&&!0!==my.isFRM;return!!(t&&e&&e.getContext)}function ui(e){var t="undefined"!==typeof my&&!!my&&"function"===typeof my.showToast&&!0!==my.isFRM;return!!(t&&e&&"src"in e&&"crossOrigin"in e)}function li(e){if(!e)return!1;if(si(e)||ui(e))return!0;var t=ei(e);return Kr.indexOf(t)>=0||(Jr(e)||$r(e)||At(e))}function ci(e){return 0|Dt[Object.prototype.toString.call(e)]}function fi(e,t){var n=t.length;switch(e.type){case fr:case hr:case pr:case dr:var r=Be.allocType(e.type,n);r.set(t),e.data=r;break;case Jn:e.data=Mn(t);break;default:ie.raise("unsupported texture type, must specify a typed array")}}function hi(e,t){return Be.allocType(e.type===Jn?dr:e.type,t)}function pi(e,t){e.type===Jn?(e.data=Mn(t),Be.freeType(t)):e.data=t}function di(e,t,n,r,i,a){for(var o=e.width,s=e.height,u=e.channels,l=o*s*u,c=hi(e,l),f=0,h=0;h<s;++h)for(var p=0;p<o;++p)for(var d=0;d<u;++d)c[f++]=t[n*p+r*h+i*d+a];pi(e,c)}function vi(e,t,n,r,i,a){var o;if(o="undefined"!==typeof Qr[e]?Qr[e]:Ur[e]*Xr[t],a&&(o*=6),i){var s=0,u=n;while(u>=1)s+=o*u*u,u/=2;return s}return o*n*r}function gi(e,r,i,a,o,s,u){var l={"don't care":Mr,"dont care":Mr,nice:Lr,fast:Or},c={repeat:mr,clamp:yr,mirror:_r},f={nearest:Sr,linear:wr},h=n({mipmap:Er,"nearest mipmap nearest":Cr,"linear mipmap nearest":kr,"nearest mipmap linear":Ar,"linear mipmap linear":Er},f),p={none:0,browser:Nr},d={uint8:fr,rgba4:Hn,rgb565:Yn,"rgb5 a1":Wn},v={alpha:Nn,luminance:jn,"luminance alpha":Bn,rgb:Fn,rgba:zn,rgba4:Un,"rgb5 a1":Vn,rgb565:Gn},g={};r.ext_srgb&&(v.srgb=Xn,v.srgba=Qn),r.oes_texture_float&&(d.float32=d.float=dr),r.oes_texture_half_float&&(d["float16"]=d["half float"]=Jn),r.webgl_depth_texture&&(n(v,{depth:Zn,"depth stencil":Kn}),n(d,{uint16:hr,uint32:pr,"depth stencil":qn})),r.webgl_compressed_texture_s3tc&&n(g,{"rgb s3tc dxt1":$n,"rgba s3tc dxt1":er,"rgba s3tc dxt3":tr,"rgba s3tc dxt5":nr}),r.webgl_compressed_texture_atc&&n(g,{"rgb atc":rr,"rgba atc explicit alpha":ir,"rgba atc interpolated alpha":ar}),r.webgl_compressed_texture_pvrtc&&n(g,{"rgb pvrtc 4bppv1":or,"rgb pvrtc 2bppv1":sr,"rgba pvrtc 4bppv1":ur,"rgba pvrtc 2bppv1":lr}),r.webgl_compressed_texture_etc1&&(g["rgb etc1"]=cr);var m=Array.prototype.slice.call(e.getParameter(Pn)||new Uint32Array(0));Object.keys(g).forEach((function(e){var t=g[e];m.indexOf(t)>=0&&(v[e]=t)}));var y=Object.keys(v);i.textureFormats=y;var _=[];Object.keys(v).forEach((function(e){var t=v[e];_[t]=e}));var x=[];Object.keys(d).forEach((function(e){var t=d[e];x[t]=e}));var b=[];Object.keys(f).forEach((function(e){var t=f[e];b[t]=e}));var S=[];Object.keys(h).forEach((function(e){var t=h[e];S[t]=e}));var w=[];Object.keys(c).forEach((function(e){var t=c[e];w[t]=e}));var C=y.reduce((function(e,t){var n=v[t];return n===jn||n===Nn||n===jn||n===Bn||n===Zn||n===Kn||r.ext_srgb&&(n===Xn||n===Qn)?e[n]=n:n===Vn||t.indexOf("rgba")>=0?e[n]=zn:e[n]=Fn,e}),{});function k(){this.internalformat=zn,this.format=zn,this.type=fr,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Nr,this.width=0,this.height=0,this.channels=0}function A(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function E(e,t){if("object"===typeof t&&t){if("premultiplyAlpha"in t&&(ie.type(t.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),e.premultiplyAlpha=t.premultiplyAlpha),"flipY"in t&&(ie.type(t.flipY,"boolean","invalid texture flip"),e.flipY=t.flipY),"alignment"in t&&(ie.oneOf(t.alignment,[1,2,4,8],"invalid texture unpack alignment"),e.unpackAlignment=t.alignment),"colorSpace"in t&&(ie.parameter(t.colorSpace,p,"invalid colorSpace"),e.colorSpace=p[t.colorSpace]),"type"in t){var n=t.type;ie(r.oes_texture_float||!("float"===n||"float32"===n),"you must enable the OES_texture_float extension in order to use floating point textures."),ie(r.oes_texture_half_float||!("half float"===n||"float16"===n),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),ie(r.webgl_depth_texture||!("uint16"===n||"uint32"===n||"depth stencil"===n),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),ie.parameter(n,d,"invalid texture type"),e.type=d[n]}var a=e.width,o=e.height,s=e.channels,u=!1;"shape"in t?(ie(Array.isArray(t.shape)&&t.shape.length>=2,"shape must be an array"),a=t.shape[0],o=t.shape[1],3===t.shape.length&&(s=t.shape[2],ie(s>0&&s<=4,"invalid number of channels"),u=!0),ie(a>=0&&a<=i.maxTextureSize,"invalid width"),ie(o>=0&&o<=i.maxTextureSize,"invalid height")):("radius"in t&&(a=o=t.radius,ie(a>=0&&a<=i.maxTextureSize,"invalid radius")),"width"in t&&(a=t.width,ie(a>=0&&a<=i.maxTextureSize,"invalid width")),"height"in t&&(o=t.height,ie(o>=0&&o<=i.maxTextureSize,"invalid height")),"channels"in t&&(s=t.channels,ie(s>0&&s<=4,"invalid number of channels"),u=!0)),e.width=0|a,e.height=0|o,e.channels=0|s;var l=!1;if("format"in t){var c=t.format;ie(r.webgl_depth_texture||!("depth"===c||"depth stencil"===c),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),ie.parameter(c,v,"invalid texture format");var f=e.internalformat=v[c];e.format=C[f],c in d&&("type"in t||(e.type=d[c])),c in g&&(e.compressed=!0),l=!0}!u&&l?e.channels=Ur[e.format]:u&&!l?e.channels!==Br[e.format]&&(e.format=e.internalformat=Br[e.channels]):l&&u&&ie(e.channels===Ur[e.format],"number of channels inconsistent with specified format")}}function T(t){e.pixelStorei(Ir,t.flipY),e.pixelStorei(Dr,t.premultiplyAlpha),e.pixelStorei(zr,t.colorSpace),e.pixelStorei(Rr,t.unpackAlignment)}function M(){k.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function O(e,n){var r=null;if(li(n)?r=n:n&&(ie.type(n,"object","invalid pixel data type"),E(e,n),"x"in n&&(e.xOffset=0|n.x),"y"in n&&(e.yOffset=0|n.y),li(n.data)&&(r=n.data)),ie(!e.compressed||r instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),n.copy){ie(!r,"can not specify copy and data field for the same texture");var a=o.viewportWidth,s=o.viewportHeight;e.width=e.width||a-e.xOffset,e.height=e.height||s-e.yOffset,e.needsCopy=!0,ie(e.xOffset>=0&&e.xOffset<a&&e.yOffset>=0&&e.yOffset<s&&e.width>0&&e.width<=a&&e.height>0&&e.height<=s,"copy texture read out of bounds")}else if(r){if(t(r))e.channels=e.channels||4,e.data=r,"type"in n||e.type!==fr||(e.type=ci(r));else if(Jr(r))e.channels=e.channels||4,fi(e,r),e.alignment=1,e.needsFree=!0;else if(At(r)){var u=r.data;Array.isArray(u)||e.type!==fr||(e.type=ci(u));var l,c,f,h,p,d,v=r.shape,g=r.stride;3===v.length?(f=v[2],d=g[2]):(ie(2===v.length,"invalid ndarray pixel data, must be 2 or 3D"),f=1,d=1),l=v[0],c=v[1],h=g[0],p=g[1],e.alignment=1,e.width=l,e.height=c,e.channels=f,e.format=e.internalformat=Br[f],e.needsFree=!0,di(e,u,h,p,d,r.offset)}else if(si(r)||ti(r)||ni(r)||ri(r))si(r)||ti(r)||ni(r)?e.element=r:e.element=r.canvas,e.width=e.element.width,e.height=e.element.height,e.channels=4;else if(ii(r))e.element=r,e.width=r.width,e.height=r.height,e.channels=4;else if(ai(r))e.element=r,e.width=r.naturalWidth,e.height=r.naturalHeight,e.channels=4;else if(ui(r))e.element=r,e.width=r.width,e.height=r.height,e.channels=4;else if(oi(r))e.element=r,e.width=r.videoWidth,e.height=r.videoHeight,e.channels=4;else if($r(r)){var m=e.width||r[0].length,y=e.height||r.length,_=e.channels;_=On(r[0][0])?_||r[0][0].length:_||1;for(var x=Tt.shape(r),b=1,S=0;S<x.length;++S)b*=x[S];var w=hi(e,b);Tt.flatten(r,x,"",w),pi(e,w),e.alignment=1,e.width=m,e.height=y,e.channels=_,e.format=e.internalformat=Br[_],e.needsFree=!0}}else e.width=e.width||1,e.height=e.height||1,e.channels=e.channels||4;e.type===dr?ie(i.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):e.type===Jn&&ie(i.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function L(t,n,r){var i=t.element,o=t.data,s=t.internalformat,u=t.format,l=t.type,c=t.width,f=t.height;T(t),i?e.texImage2D(n,r,u,u,l,i):t.compressed?e.compressedTexImage2D(n,r,s,c,f,0,o):t.needsCopy?(a(),e.copyTexImage2D(n,r,u,t.xOffset,t.yOffset,c,f,0)):e.texImage2D(n,r,u,c,f,0,u,l,o||null)}function P(t,n,r,i,o){var s=t.element,u=t.data,l=t.internalformat,c=t.format,f=t.type,h=t.width,p=t.height;T(t),s?e.texSubImage2D(n,o,r,i,c,f,s):t.compressed?e.compressedTexSubImage2D(n,o,r,i,l,h,p,u):t.needsCopy?(a(),e.copyTexSubImage2D(n,o,r,i,t.xOffset,t.yOffset,h,p)):e.texSubImage2D(n,o,r,i,h,p,c,f,u)}var R=[];function I(){return R.pop()||new M}function D(e){e.needsFree&&Be.freeType(e.data),M.call(e),R.push(e)}function z(){k.call(this),this.genMipmaps=!1,this.mipmapHint=Mr,this.mipmask=0,this.images=Array(16)}function N(e,t,n){var r=e.images[0]=I();e.mipmask=1,r.width=e.width=t,r.height=e.height=n,r.channels=e.channels=4}function F(e,t){var n=null;if(li(t))n=e.images[0]=I(),A(n,e),O(n,t),e.mipmask=1;else if(E(e,t),Array.isArray(t.mipmap))for(var r=t.mipmap,i=0;i<r.length;++i)n=e.images[i]=I(),A(n,e),n.width>>=i,n.height>>=i,O(n,r[i]),e.mipmask|=1<<i;else n=e.images[0]=I(),A(n,e),O(n,t),e.mipmask=1;A(e,e.images[0]),!e.compressed||e.internalformat!==$n&&e.internalformat!==er&&e.internalformat!==tr&&e.internalformat!==nr||ie(e.width%4===0&&e.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function j(e,t){for(var n=e.images,r=0;r<n.length;++r){if(!n[r])return;L(n[r],t,r)}}var B=[];function U(){var e=B.pop()||new z;k.call(e),e.mipmask=0;for(var t=0;t<16;++t)e.images[t]=null;return e}function V(e){for(var t=e.images,n=0;n<t.length;++n)t[n]&&D(t[n]),t[n]=null;B.push(e)}function G(){this.minFilter=Sr,this.magFilter=Sr,this.wrapS=yr,this.wrapT=yr,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Mr}function H(e,t){if("min"in t){var n=t.min;ie.parameter(n,h),e.minFilter=h[n],jr.indexOf(e.minFilter)>=0&&!("faces"in t)&&(e.genMipmaps=!0)}if("mag"in t){var r=t.mag;ie.parameter(r,f),e.magFilter=f[r]}var a=e.wrapS,o=e.wrapT;if("wrap"in t){var s=t.wrap;"string"===typeof s?(ie.parameter(s,c),a=o=c[s]):Array.isArray(s)&&(ie.parameter(s[0],c),ie.parameter(s[1],c),a=c[s[0]],o=c[s[1]])}else{if("wrapS"in t){var u=t.wrapS;ie.parameter(u,c),a=c[u]}if("wrapT"in t){var p=t.wrapT;ie.parameter(p,c),o=c[p]}}if(e.wrapS=a,e.wrapT=o,"anisotropic"in t){var d=t.anisotropic;ie("number"===typeof d&&d>=1&&d<=i.maxAnisotropic,"aniso samples must be between 1 and "),e.anisotropic=t.anisotropic}if("mipmap"in t){var v=!1;switch(typeof t.mipmap){case"string":ie.parameter(t.mipmap,l,"invalid mipmap hint"),e.mipmapHint=l[t.mipmap],e.genMipmaps=!0,v=!0;break;case"boolean":v=e.genMipmaps=t.mipmap;break;case"object":ie(Array.isArray(t.mipmap),"invalid mipmap type"),e.genMipmaps=!1,v=!0;break;default:ie.raise("invalid mipmap type")}v&&!("min"in t)&&(e.minFilter=Cr)}}function W(t,n){e.texParameteri(n,br,t.minFilter),e.texParameteri(n,xr,t.magFilter),e.texParameteri(n,vr,t.wrapS),e.texParameteri(n,gr,t.wrapT),r.ext_texture_filter_anisotropic&&e.texParameteri(n,Pr,t.anisotropic),t.genMipmaps&&(e.hint(Tr,t.mipmapHint),e.generateMipmap(n))}var Y=0,q={},Z=i.maxTextureUnits,K=Array(Z).map((function(){return null}));function X(t){k.call(this),this.mipmask=0,this.internalformat=zn,this.id=Y++,this.refCount=1,this.target=t,this.texture=e.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new G,u.profile&&(this.stats={size:0})}function Q(t){e.activeTexture(Fr),e.bindTexture(t.target,t.texture)}function J(){var t=K[0];t?e.bindTexture(t.target,t.texture):e.bindTexture(Rn,null)}function $(t){var n=t.texture;ie(n,"must not double destroy texture");var r=t.unit,i=t.target;r>=0&&(e.activeTexture(Fr+r),e.bindTexture(i,null),K[r]=null),e.deleteTexture(n),t.texture=null,t.params=null,t.pixels=null,t.refCount=0,delete q[t.id],s.textureCount--}function ee(t,n){var r=new X(Rn);function a(e,t){var n=r.texInfo;G.call(n);var o=U();return"number"===typeof e?N(o,0|e,"number"===typeof t?0|t:0|e):e?(ie.type(e,"object","invalid arguments to regl.texture"),H(n,e),F(o,e)):N(o,1,1),n.genMipmaps&&(o.mipmask=(o.width<<1)-1),r.mipmask=o.mipmask,A(r,o),ie.texture2D(n,o,i),r.internalformat=o.internalformat,a.width=o.width,a.height=o.height,Q(r),j(o,Rn),W(n,Rn),J(),V(o),u.profile&&(r.stats.size=vi(r.internalformat,r.type,o.width,o.height,n.genMipmaps,!1)),a.format=_[r.internalformat],a.type=x[r.type],a.mag=b[n.magFilter],a.min=S[n.minFilter],a.wrapS=w[n.wrapS],a.wrapT=w[n.wrapT],a}function o(e,t,n,i){ie(!!e,"must specify image data");var o=0|t,s=0|n,u=0|i,l=I();return A(l,r),l.width=0,l.height=0,O(l,e),l.width=l.width||(r.width>>u)-o,l.height=l.height||(r.height>>u)-s,ie(r.type===l.type&&r.format===l.format&&r.internalformat===l.internalformat,"incompatible format for texture.subimage"),ie(o>=0&&s>=0&&o+l.width<=r.width&&s+l.height<=r.height,"texture.subimage write out of bounds"),ie(r.mipmask&1<<u,"missing mipmap data"),ie(l.data||l.element||l.needsCopy,"missing image data"),Q(r),P(l,Rn,o,s,u),J(),D(l),a}function l(t,n){var i=0|t,o=0|n||i;if(i===r.width&&o===r.height)return a;a.width=r.width=i,a.height=r.height=o,Q(r);for(var s=0;r.mipmask>>s;++s){var l=i>>s,c=o>>s;if(!l||!c)break;e.texImage2D(Rn,s,r.format,l,c,0,r.format,r.type,null)}return J(),u.profile&&(r.stats.size=vi(r.internalformat,r.type,i,o,!1,!1)),a}return q[r.id]=r,s.textureCount++,a(t,n),a.subimage=o,a.resize=l,a._reglType="texture2d",a._texture=r,u.profile&&(a.stats=r.stats),a.destroy=function(){r.decRef()},a}function te(t,n,r,a,o,l){var c=new X(In);q[c.id]=c,s.cubeCount++;var f=new Array(6);function h(e,t,n,r,a,o){var s,l=c.texInfo;for(G.call(l),s=0;s<6;++s)f[s]=U();if("number"!==typeof e&&e)if("object"===typeof e)if(t)F(f[0],e),F(f[1],t),F(f[2],n),F(f[3],r),F(f[4],a),F(f[5],o);else if(H(l,e),E(c,e),"faces"in e){var p=e.faces;for(ie(Array.isArray(p)&&6===p.length,"cube faces must be a length 6 array"),s=0;s<6;++s)ie("object"===typeof p[s]&&!!p[s],"invalid input for cube map face"),A(f[s],c),F(f[s],p[s])}else for(s=0;s<6;++s)F(f[s],e);else ie.raise("invalid arguments to cube map");else{var d=0|e||1;for(s=0;s<6;++s)N(f[s],d,d)}for(A(c,f[0]),ie.optional((function(){i.npotTextureCube||ie(Ln(c.width)&&Ln(c.height),"your browser does not support non power or two texture dimensions")})),l.genMipmaps?c.mipmask=(f[0].width<<1)-1:c.mipmask=f[0].mipmask,ie.textureCube(c,l,f,i),c.internalformat=f[0].internalformat,h.width=f[0].width,h.height=f[0].height,Q(c),s=0;s<6;++s)j(f[s],Dn+s);for(W(l,In),J(),u.profile&&(c.stats.size=vi(c.internalformat,c.type,h.width,h.height,l.genMipmaps,!0)),h.format=_[c.internalformat],h.type=x[c.type],h.mag=b[l.magFilter],h.min=S[l.minFilter],h.wrapS=w[l.wrapS],h.wrapT=w[l.wrapT],s=0;s<6;++s)V(f[s]);return h}function p(e,t,n,r,i){ie(!!t,"must specify image data"),ie("number"===typeof e&&e===(0|e)&&e>=0&&e<6,"invalid face");var a=0|n,o=0|r,s=0|i,u=I();return A(u,c),u.width=0,u.height=0,O(u,t),u.width=u.width||(c.width>>s)-a,u.height=u.height||(c.height>>s)-o,ie(c.type===u.type&&c.format===u.format&&c.internalformat===u.internalformat,"incompatible format for texture.subimage"),ie(a>=0&&o>=0&&a+u.width<=c.width&&o+u.height<=c.height,"texture.subimage write out of bounds"),ie(c.mipmask&1<<s,"missing mipmap data"),ie(u.data||u.element||u.needsCopy,"missing image data"),Q(c),P(u,Dn+e,a,o,s),J(),D(u),h}function d(t){var n=0|t;if(n!==c.width){h.width=c.width=n,h.height=c.height=n,Q(c);for(var r=0;r<6;++r)for(var i=0;c.mipmask>>i;++i)e.texImage2D(Dn+r,i,c.format,n>>i,n>>i,0,c.format,c.type,null);return J(),u.profile&&(c.stats.size=vi(c.internalformat,c.type,h.width,h.height,!1,!0)),h}}return h(t,n,r,a,o,l),h.subimage=p,h.resize=d,h._reglType="textureCube",h._texture=c,u.profile&&(h.stats=c.stats),h.destroy=function(){c.decRef()},h}function ne(){for(var t=0;t<Z;++t)e.activeTexture(Fr+t),e.bindTexture(Rn,null),K[t]=null;Et(q).forEach($),s.cubeCount=0,s.textureCount=0}function re(){for(var t=0;t<Z;++t){var n=K[t];n&&(n.bindCount=0,n.unit=-1,K[t]=null)}Et(q).forEach((function(t){t.texture=e.createTexture(),e.bindTexture(t.target,t.texture);for(var n=0;n<32;++n)if(0!==(t.mipmask&1<<n))if(t.target===Rn)e.texImage2D(Rn,n,t.internalformat,t.width>>n,t.height>>n,0,t.internalformat,t.type,null);else for(var r=0;r<6;++r)e.texImage2D(Dn+r,n,t.internalformat,t.width>>n,t.height>>n,0,t.internalformat,t.type,null);W(t.texInfo,t.target)}))}function ae(){for(var t=0;t<Z;++t){var n=K[t];n&&(n.bindCount=0,n.unit=-1,K[t]=null),e.activeTexture(Fr+t),e.bindTexture(Rn,null),e.bindTexture(In,null)}}return n(X.prototype,{bind:function(){var t=this;t.bindCount+=1;var n=t.unit;if(n<0){for(var r=0;r<Z;++r){var i=K[r];if(i){if(i.bindCount>0)continue;i.unit=-1}K[r]=t,n=r;break}n>=Z&&ie.raise("insufficient number of texture units"),u.profile&&s.maxTextureUnits<n+1&&(s.maxTextureUnits=n+1),t.unit=n,e.activeTexture(Fr+n),e.bindTexture(t.target,t.texture)}return n},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&$(this)}}),u.profile&&(s.getTotalTextureSize=function(){var e=0;return Object.keys(q).forEach((function(t){e+=q[t].stats.size})),e}),{create2D:ee,createCube:te,clear:ne,getTexture:function(e){return null},restore:re,refresh:ae}}Qr[Un]=2,Qr[Vn]=2,Qr[Gn]=2,Qr[Kn]=4,Qr[$n]=.5,Qr[er]=.5,Qr[tr]=1,Qr[nr]=1,Qr[rr]=.5,Qr[ir]=1,Qr[ar]=1,Qr[or]=.5,Qr[sr]=.25,Qr[ur]=.5,Qr[lr]=.25,Qr[cr]=.5;var mi=36161,yi=32854,_i=32855,xi=36194,bi=33189,Si=36168,wi=34041,Ci=35907,ki=34836,Ai=34842,Ei=34843,Ti=[];function Mi(e,t,n){return Ti[e]*t*n}Ti[yi]=2,Ti[_i]=2,Ti[xi]=2,Ti[bi]=2,Ti[Si]=1,Ti[wi]=4,Ti[Ci]=4,Ti[ki]=16,Ti[Ai]=8,Ti[Ei]=6;var Oi=function(e,t,n,r,i){var a={rgba4:yi,rgb565:xi,"rgb5 a1":_i,depth:bi,stencil:Si,"depth stencil":wi};t.ext_srgb&&(a["srgba"]=Ci),t.ext_color_buffer_half_float&&(a["rgba16f"]=Ai,a["rgb16f"]=Ei),t.webgl_color_buffer_float&&(a["rgba32f"]=ki);var o=[];Object.keys(a).forEach((function(e){var t=a[e];o[t]=e}));var s=0,u={};function l(e){this.id=s++,this.refCount=1,this.renderbuffer=e,this.format=yi,this.width=0,this.height=0,i.profile&&(this.stats={size:0})}function c(t){var n=t.renderbuffer;ie(n,"must not double destroy renderbuffer"),e.bindRenderbuffer(mi,null),e.deleteRenderbuffer(n),t.renderbuffer=null,t.refCount=0,delete u[t.id],r.renderbufferCount--}function f(t,s){var c=new l(e.createRenderbuffer());function f(t,r){var s=0,u=0,l=yi;if("object"===typeof t&&t){var h=t;if("shape"in h){var p=h.shape;ie(Array.isArray(p)&&p.length>=2,"invalid renderbuffer shape"),s=0|p[0],u=0|p[1]}else"radius"in h&&(s=u=0|h.radius),"width"in h&&(s=0|h.width),"height"in h&&(u=0|h.height);"format"in h&&(ie.parameter(h.format,a,"invalid renderbuffer format"),l=a[h.format])}else"number"===typeof t?(s=0|t,u="number"===typeof r?0|r:s):t?ie.raise("invalid arguments to renderbuffer constructor"):s=u=1;if(ie(s>0&&u>0&&s<=n.maxRenderbufferSize&&u<=n.maxRenderbufferSize,"invalid renderbuffer size"),s!==c.width||u!==c.height||l!==c.format)return f.width=c.width=s,f.height=c.height=u,c.format=l,e.bindRenderbuffer(mi,c.renderbuffer),e.renderbufferStorage(mi,l,s,u),ie(0===e.getError(),"invalid render buffer format"),i.profile&&(c.stats.size=Mi(c.format,c.width,c.height)),f.format=o[c.format],f}function h(t,r){var a=0|t,o=0|r||a;return a===c.width&&o===c.height||(ie(a>0&&o>0&&a<=n.maxRenderbufferSize&&o<=n.maxRenderbufferSize,"invalid renderbuffer size"),f.width=c.width=a,f.height=c.height=o,e.bindRenderbuffer(mi,c.renderbuffer),e.renderbufferStorage(mi,c.format,a,o),ie(0===e.getError(),"invalid render buffer format"),i.profile&&(c.stats.size=Mi(c.format,c.width,c.height))),f}return u[c.id]=c,r.renderbufferCount++,f(t,s),f.resize=h,f._reglType="renderbuffer",f._renderbuffer=c,i.profile&&(f.stats=c.stats),f.destroy=function(){c.decRef()},f}function h(){Et(u).forEach((function(t){t.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(mi,t.renderbuffer),e.renderbufferStorage(mi,t.format,t.width,t.height)})),e.bindRenderbuffer(mi,null)}return l.prototype.decRef=function(){--this.refCount<=0&&c(this)},i.profile&&(r.getTotalRenderbufferSize=function(){var e=0;return Object.keys(u).forEach((function(t){e+=u[t].stats.size})),e}),{create:f,clear:function(){Et(u).forEach(c)},restore:h}},Li=36160,Pi=36161,Ri=3553,Ii=34069,Di=36064,zi=36096,Ni=36128,Fi=33306,ji=36053,Bi=36054,Ui=36055,Vi=36057,Gi=36061,Hi=36193,Wi=5121,Yi=5126,qi=6407,Zi=6408,Ki=6402,Xi=[qi,Zi],Qi=[];Qi[Zi]=4,Qi[qi]=3;var Ji=[];Ji[Wi]=1,Ji[Yi]=4,Ji[Hi]=2;var $i=32854,ea=32855,ta=36194,na=33189,ra=36168,ia=34041,aa=35907,oa=34836,sa=34842,ua=34843,la=[$i,ea,ta,aa,sa,ua,oa],ca={};function fa(e,t,r,i,a,o){var s={cur:null,next:null,dirty:!1,setFBO:null},u=["rgba"],l=["rgba4","rgb565","rgb5 a1"];t.ext_srgb&&l.push("srgba"),t.ext_color_buffer_half_float&&l.push("rgba16f","rgb16f"),t.webgl_color_buffer_float&&l.push("rgba32f");var c=["uint8"];function f(e,t,n){this.target=e,this.texture=t,this.renderbuffer=n;var r=0,i=0;t?(r=t.width,i=t.height):n&&(r=n.width,i=n.height),this.width=r,this.height=i}function h(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function p(e,t,n){if(e)if(e.texture){var r=e.texture._texture,i=Math.max(1,r.width),a=Math.max(1,r.height);ie(i===t&&a===n,"inconsistent width/height for supplied texture"),r.refCount+=1}else{var o=e.renderbuffer._renderbuffer;ie(o.width===t&&o.height===n,"inconsistent width/height for renderbuffer"),o.refCount+=1}}function d(t,n){n&&(n.texture?e.framebufferTexture2D(Li,t,n.target,n.texture._texture.texture,0):e.framebufferRenderbuffer(Li,t,Pi,n.renderbuffer._renderbuffer.renderbuffer))}function v(e){var t=Ri,n=null,r=null,i=e;"object"===typeof e&&(i=e.data,"target"in e&&(t=0|e.target)),ie.type(i,"function","invalid attachment data");var a=i._reglType;return"texture2d"===a?(n=i,ie(t===Ri)):"textureCube"===a?(n=i,ie(t>=Ii&&t<Ii+6,"invalid cube map target")):"renderbuffer"===a?(r=i,t=Pi):ie.raise("invalid regl object for attachment"),new f(t,n,r)}function g(e,t,n,r,o){if(n){var s=i.create2D({width:e,height:t,format:r,type:o});return s._texture.refCount=0,new f(Ri,s,null)}var u=a.create({width:e,height:t,format:r});return u._renderbuffer.refCount=0,new f(Pi,null,u)}function m(e){return e&&(e.texture||e.renderbuffer)}function y(e,t,n){e&&(e.texture?e.texture.resize(t,n):e.renderbuffer&&e.renderbuffer.resize(t,n),e.width=t,e.height=n)}t.oes_texture_half_float&&c.push("half float","float16"),t.oes_texture_float&&c.push("float","float32");var _=0,x={};function b(){this.id=_++,x[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function S(e){e.colorAttachments.forEach(h),h(e.depthAttachment),h(e.stencilAttachment),h(e.depthStencilAttachment)}function w(t){var n=t.framebuffer;ie(n,"must not double destroy framebuffer"),e.deleteFramebuffer(n),t.framebuffer=null,o.framebufferCount--,delete x[t.id]}function C(t){var n;e.bindFramebuffer(Li,t.framebuffer);var i=t.colorAttachments;for(n=0;n<i.length;++n)d(Di+n,i[n]);for(n=i.length;n<r.maxColorAttachments;++n)e.framebufferTexture2D(Li,Di+n,Ri,null,0);e.framebufferTexture2D(Li,Fi,Ri,null,0),e.framebufferTexture2D(Li,zi,Ri,null,0),e.framebufferTexture2D(Li,Ni,Ri,null,0),d(zi,t.depthAttachment),d(Ni,t.stencilAttachment),d(Fi,t.depthStencilAttachment);var a=e.checkFramebufferStatus(Li);e.isContextLost()||a===ji||ie.raise("framebuffer configuration not supported, status = "+ca[a]),e.bindFramebuffer(Li,s.next?s.next.framebuffer:null),s.cur=s.next,e.getError()}function k(e,i){var a=new b;function f(e,n){var i;ie(s.next!==a,"can not update framebuffer which is currently in use");var o=0,h=0,d=!0,y=!0,_=null,x=!0,b="rgba",w="uint8",k=1,A=null,E=null,T=null,M=!1;if("number"===typeof e)o=0|e,h=0|n||o;else if(e){ie.type(e,"object","invalid arguments for framebuffer");var O=e;if("shape"in O){var L=O.shape;ie(Array.isArray(L)&&L.length>=2,"invalid shape for framebuffer"),o=L[0],h=L[1]}else"radius"in O&&(o=h=O.radius),"width"in O&&(o=O.width),"height"in O&&(h=O.height);("color"in O||"colors"in O)&&(_=O.color||O.colors,Array.isArray(_)&&ie(1===_.length||t.webgl_draw_buffers,"multiple render targets not supported")),_||("colorCount"in O&&(k=0|O.colorCount,ie(k>0,"invalid color buffer count")),"colorTexture"in O&&(x=!!O.colorTexture,b="rgba4"),"colorType"in O&&(w=O.colorType,x?(ie(t.oes_texture_float||!("float"===w||"float32"===w),"you must enable OES_texture_float in order to use floating point framebuffer objects"),ie(t.oes_texture_half_float||!("half float"===w||"float16"===w),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===w||"float16"===w?(ie(t.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),b="rgba16f"):"float"!==w&&"float32"!==w||(ie(t.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),b="rgba32f"),ie.oneOf(w,c,"invalid color type")),"colorFormat"in O&&(b=O.colorFormat,u.indexOf(b)>=0?x=!0:l.indexOf(b)>=0?x=!1:ie.optional((function(){x?ie.oneOf(O.colorFormat,u,"invalid color format for texture"):ie.oneOf(O.colorFormat,l,"invalid color format for renderbuffer")})))),("depthTexture"in O||"depthStencilTexture"in O)&&(M=!(!O.depthTexture&&!O.depthStencilTexture),ie(!M||t.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in O&&("boolean"===typeof O.depth?d=O.depth:(A=O.depth,y=!1)),"stencil"in O&&("boolean"===typeof O.stencil?y=O.stencil:(E=O.stencil,d=!1)),"depthStencil"in O&&("boolean"===typeof O.depthStencil?d=y=O.depthStencil:(T=O.depthStencil,d=!1,y=!1))}else o=h=1;var P=null,R=null,I=null,D=null;if(Array.isArray(_))P=_.map(v);else if(_)P=[v(_)];else for(P=new Array(k),i=0;i<k;++i)P[i]=g(o,h,x,b,w);ie(t.webgl_draw_buffers||P.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),ie(P.length<=r.maxColorAttachments,"too many color attachments, not supported"),o=o||P[0].width,h=h||P[0].height,A?R=v(A):d&&!y&&(R=g(o,h,M,"depth","uint32")),E?I=v(E):y&&!d&&(I=g(o,h,!1,"stencil","uint8")),T?D=v(T):!A&&!E&&y&&d&&(D=g(o,h,M,"depth stencil","depth stencil")),ie(!!A+!!E+!!T<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var z=null;for(i=0;i<P.length;++i)if(p(P[i],o,h),ie(!P[i]||P[i].texture&&Xi.indexOf(P[i].texture._texture.format)>=0||P[i].renderbuffer&&la.indexOf(P[i].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+i+" is invalid"),P[i]&&P[i].texture){var N=Qi[P[i].texture._texture.format]*Ji[P[i].texture._texture.type];null===z?z=N:ie(z===N,"all color attachments much have the same number of bits per pixel.")}return p(R,o,h),ie(!R||R.texture&&R.texture._texture.format===Ki||R.renderbuffer&&R.renderbuffer._renderbuffer.format===na,"invalid depth attachment for framebuffer object"),p(I,o,h),ie(!I||I.renderbuffer&&I.renderbuffer._renderbuffer.format===ra,"invalid stencil attachment for framebuffer object"),p(D,o,h),ie(!D||D.texture&&D.texture._texture.format===ia||D.renderbuffer&&D.renderbuffer._renderbuffer.format===ia,"invalid depth-stencil attachment for framebuffer object"),S(a),a.width=o,a.height=h,a.colorAttachments=P,a.depthAttachment=R,a.stencilAttachment=I,a.depthStencilAttachment=D,f.color=P.map(m),f.depth=m(R),f.stencil=m(I),f.depthStencil=m(D),f.width=a.width,f.height=a.height,C(a),f}function h(e,t){ie(s.next!==a,"can not resize a framebuffer which is currently in use");var n=Math.max(0|e,1),r=Math.max(0|t||n,1);if(n===a.width&&r===a.height)return f;for(var i=a.colorAttachments,o=0;o<i.length;++o)y(i[o],n,r);return y(a.depthAttachment,n,r),y(a.stencilAttachment,n,r),y(a.depthStencilAttachment,n,r),a.width=f.width=n,a.height=f.height=r,C(a),f}return o.framebufferCount++,f(e,i),n(f,{resize:h,_reglType:"framebuffer",_framebuffer:a,destroy:function(){w(a),S(a)},use:function(e){s.setFBO({framebuffer:f},e)}})}function A(e){var a=Array(6);function o(e){var r;ie(a.indexOf(s.next)<0,"can not update framebuffer which is currently in use");var l,f={color:null},h=0,p=null,d="rgba",v="uint8",g=1;if("number"===typeof e)h=0|e;else if(e){ie.type(e,"object","invalid arguments for framebuffer");var m=e;if("shape"in m){var y=m.shape;ie(Array.isArray(y)&&y.length>=2,"invalid shape for framebuffer"),ie(y[0]===y[1],"cube framebuffer must be square"),h=y[0]}else"radius"in m&&(h=0|m.radius),"width"in m?(h=0|m.width,"height"in m&&ie(m.height===h,"must be square")):"height"in m&&(h=0|m.height);("color"in m||"colors"in m)&&(p=m.color||m.colors,Array.isArray(p)&&ie(1===p.length||t.webgl_draw_buffers,"multiple render targets not supported")),p||("colorCount"in m&&(g=0|m.colorCount,ie(g>0,"invalid color buffer count")),"colorType"in m&&(ie.oneOf(m.colorType,c,"invalid color type"),v=m.colorType),"colorFormat"in m&&(d=m.colorFormat,ie.oneOf(m.colorFormat,u,"invalid color format for texture"))),"depth"in m&&(f.depth=m.depth),"stencil"in m&&(f.stencil=m.stencil),"depthStencil"in m&&(f.depthStencil=m.depthStencil)}else h=1;if(p)if(Array.isArray(p))for(l=[],r=0;r<p.length;++r)l[r]=p[r];else l=[p];else{l=Array(g);var _={radius:h,format:d,type:v};for(r=0;r<g;++r)l[r]=i.createCube(_)}for(f.color=Array(l.length),r=0;r<l.length;++r){var x=l[r];ie("function"===typeof x&&"textureCube"===x._reglType,"invalid cube map"),h=h||x.width,ie(x.width===h&&x.height===h,"invalid cube map shape"),f.color[r]={target:Ii,data:l[r]}}for(r=0;r<6;++r){for(var b=0;b<l.length;++b)f.color[b].target=Ii+r;r>0&&(f.depth=a[0].depth,f.stencil=a[0].stencil,f.depthStencil=a[0].depthStencil),a[r]?a[r](f):a[r]=k(f)}return n(o,{width:h,height:h,color:l})}function l(e){var t,n=0|e;if(ie(n>0&&n<=r.maxCubeMapSize,"invalid radius for cube fbo"),n===o.width)return o;var i=o.color;for(t=0;t<i.length;++t)i[t].resize(n);for(t=0;t<6;++t)a[t].resize(n);return o.width=o.height=n,o}return o(e),n(o,{faces:a,resize:l,_reglType:"framebufferCube",destroy:function(){a.forEach((function(e){e.destroy()}))}})}function E(){s.cur=null,s.next=null,s.dirty=!0,Et(x).forEach((function(t){t.framebuffer=e.createFramebuffer(),C(t)}))}return n(s,{getFramebuffer:function(e){if("function"===typeof e&&"framebuffer"===e._reglType){var t=e._framebuffer;if(t instanceof b)return t}return null},create:k,createCube:A,clear:function(){Et(x).forEach(w)},restore:E})}ca[ji]="complete",ca[Bi]="incomplete attachment",ca[Vi]="incomplete dimensions",ca[Ui]="incomplete, missing attachment",ca[Gi]="unsupported";var ha=5126,pa=34962,da=34963,va=["attributes","elements","offset","count","primitive","instances"];function ga(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=ha,this.offset=0,this.stride=0,this.divisor=0}function ma(e,n,r,i,a,o,s){for(var u=r.maxAttributes,l=new Array(u),c=0;c<u;++c)l[c]=new ga;var f=0,h={},p={Record:ga,scope:{},state:l,currentVAO:null,targetVAO:null,restore:v()?S:function(){},createVAO:w,getVAO:m,destroyBuffer:d,setVAO:v()?y:_,clear:v()?x:function(){}};function d(t){for(var n=0;n<l.length;++n){var r=l[n];r.buffer===t&&(e.disableVertexAttribArray(n),r.buffer=null)}}function v(){return n.oes_vertex_array_object}function g(){return n.angle_instanced_arrays}function m(e){return"function"===typeof e&&e._vao?e._vao:null}function y(e){if(e!==p.currentVAO){var t=v();e?t.bindVertexArrayOES(e.vao):t.bindVertexArrayOES(null),p.currentVAO=e}}function _(t){if(t!==p.currentVAO){if(t)t.bindAttrs();else{for(var n=g(),r=0;r<l.length;++r){var i=l[r];i.buffer?(e.enableVertexAttribArray(r),i.buffer.bind(),e.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offfset),n&&i.divisor&&n.vertexAttribDivisorANGLE(r,i.divisor)):(e.disableVertexAttribArray(r),e.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}s.elements?e.bindBuffer(da,s.elements.buffer.buffer):e.bindBuffer(da,null)}p.currentVAO=t}}function x(){Et(h).forEach((function(e){e.destroy()}))}function b(){this.id=++f,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var e=v();this.vao=e?e.createVertexArrayOES():null,h[this.id]=this,this.buffers=[]}function S(){var e=v();e&&Et(h).forEach((function(e){e.refresh()}))}function w(e){var r=new b;function s(e){var i;if(Array.isArray(e))i=e,r.elements&&r.ownsElements&&r.elements.destroy(),r.elements=null,r.ownsElements=!1,r.offset=0,r.count=0,r.instances=-1,r.primitive=4;else{if(ie("object"===typeof e,"invalid arguments for create vao"),ie("attributes"in e,"must specify attributes for vao"),e.elements){var l=e.elements;r.ownsElements?"function"===typeof l&&"elements"===l._reglType?(r.elements.destroy(),r.ownsElements=!1):(r.elements(l),r.ownsElements=!1):o.getElements(e.elements)?(r.elements=e.elements,r.ownsElements=!1):(r.elements=o.create(e.elements),r.ownsElements=!0)}else r.elements=null,r.ownsElements=!1;i=e.attributes,r.offset=0,r.count=-1,r.instances=-1,r.primitive=4,r.elements&&(r.count=r.elements._elements.vertCount,r.primitive=r.elements._elements.primType),"offset"in e&&(r.offset=0|e.offset),"count"in e&&(r.count=0|e.count),"instances"in e&&(r.instances=0|e.instances),"primitive"in e&&(ie(e.primitive in hn,"bad primitive type: "+e.primitive),r.primitive=hn[e.primitive]),ie.optional((function(){for(var t=Object.keys(e),n=0;n<t.length;++n)ie(va.indexOf(t[n])>=0,'invalid option for vao: "'+t[n]+'" valid options are '+va)})),ie(Array.isArray(i),"attributes must be an array")}ie(i.length<u,"too many attributes"),ie(i.length>0,"must specify at least one attribute");var c={},f=r.attributes;f.length=i.length;for(var h=0;h<i.length;++h){var p,d=i[h],v=f[h]=new ga,g=d.data||d;if(Array.isArray(g)||t(g)||At(g))r.buffers[h]&&(p=r.buffers[h],t(g)&&p._buffer.byteLength>=g.byteLength?p.subdata(g):(p.destroy(),r.buffers[h]=null)),r.buffers[h]||(p=r.buffers[h]=a.create(d,pa,!1,!0)),v.buffer=a.getBuffer(p),v.size=0|v.buffer.dimension,v.normalized=!1,v.type=v.buffer.dtype,v.offset=0,v.stride=0,v.divisor=0,v.state=1,c[h]=1;else a.getBuffer(d)?(v.buffer=a.getBuffer(d),v.size=0|v.buffer.dimension,v.normalized=!1,v.type=v.buffer.dtype,v.offset=0,v.stride=0,v.divisor=0,v.state=1):a.getBuffer(d.buffer)?(v.buffer=a.getBuffer(d.buffer),v.size=0|(+d.size||v.buffer.dimension),v.normalized=!!d.normalized||!1,"type"in d?(ie.parameter(d.type,Ht,"invalid buffer type"),v.type=Ht[d.type]):v.type=v.buffer.dtype,v.offset=0|(d.offset||0),v.stride=0|(d.stride||0),v.divisor=0|(d.divisor||0),v.state=1,ie(v.size>=1&&v.size<=4,"size must be between 1 and 4"),ie(v.offset>=0,"invalid offset"),ie(v.stride>=0&&v.stride<=255,"stride must be between 0 and 255"),ie(v.divisor>=0,"divisor must be positive"),ie(!v.divisor||!!n.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in d?(ie(h>0,"first attribute must not be a constant"),v.x=+d.x||0,v.y=+d.y||0,v.z=+d.z||0,v.w=+d.w||0,v.state=2):ie(!1,"invalid attribute spec for location "+h)}for(var m=0;m<r.buffers.length;++m)!c[m]&&r.buffers[m]&&(r.buffers[m].destroy(),r.buffers[m]=null);return r.refresh(),s}return i.vaoCount+=1,s.destroy=function(){for(var e=0;e<r.buffers.length;++e)r.buffers[e]&&r.buffers[e].destroy();r.buffers.length=0,r.ownsElements&&(r.elements.destroy(),r.elements=null,r.ownsElements=!1),r.destroy()},s._vao=r,s._reglType="vao",s(e)}return b.prototype.bindAttrs=function(){for(var t=g(),n=this.attributes,r=0;r<n.length;++r){var i=n[r];i.buffer?(e.enableVertexAttribArray(r),e.bindBuffer(pa,i.buffer.buffer),e.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offset),t&&i.divisor&&t.vertexAttribDivisorANGLE(r,i.divisor)):(e.disableVertexAttribArray(r),e.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}for(var a=n.length;a<u;++a)e.disableVertexAttribArray(a);var s=o.getElements(this.elements);s?e.bindBuffer(da,s.buffer.buffer):e.bindBuffer(da,null)},b.prototype.refresh=function(){var e=v();e&&(e.bindVertexArrayOES(this.vao),this.bindAttrs(),p.currentVAO=null,e.bindVertexArrayOES(null))},b.prototype.destroy=function(){if(this.vao){var e=v();this===p.currentVAO&&(p.currentVAO=null,e.bindVertexArrayOES(null)),e.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),h[this.id]&&(delete h[this.id],i.vaoCount-=1)},p}var ya=35632,_a=35633,xa=35718,ba=35721;function Sa(e,t,r,i){var a={},o={};function s(e,t,n,r){this.name=e,this.id=t,this.location=n,this.info=r}function u(e,t){for(var n=0;n<e.length;++n)if(e[n].id===t.id)return void(e[n].location=t.location);e.push(t)}function l(n,r,i){var s=n===ya?a:o,u=s[r];if(!u){var l=t.str(r);u=e.createShader(n),e.shaderSource(u,l),e.compileShader(u),ie.shaderError(e,u,l,n,i),s[r]=u}return u}var c={},f=[],h=0;function p(e,t){this.id=h++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,i.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function d(n,r,a){var o,c,f=l(ya,n.fragId),h=l(_a,n.vertId),p=n.program=e.createProgram();if(e.attachShader(p,f),e.attachShader(p,h),a)for(o=0;o<a.length;++o){var d=a[o];e.bindAttribLocation(p,d[0],d[1])}e.linkProgram(p),ie.linkError(e,p,t.str(n.fragId),t.str(n.vertId),r);var v=e.getProgramParameter(p,xa);i.profile&&(n.stats.uniformsCount=v);var g=n.uniforms;for(o=0;o<v;++o)if(c=e.getActiveUniform(p,o),c)if(c.size>1)for(var m=0;m<c.size;++m){var y=c.name.replace("[0]","["+m+"]");u(g,new s(y,t.id(y),e.getUniformLocation(p,y),c))}else u(g,new s(c.name,t.id(c.name),e.getUniformLocation(p,c.name),c));var _=e.getProgramParameter(p,ba);i.profile&&(n.stats.attributesCount=_);var x=n.attributes;for(o=0;o<_;++o)c=e.getActiveAttrib(p,o),c&&u(x,new s(c.name,t.id(c.name),e.getAttribLocation(p,c.name),c))}function v(){a={},o={};for(var e=0;e<f.length;++e)d(f[e],null,f[e].attributes.map((function(e){return[e.location,e.name]})))}return i.profile&&(r.getMaxUniformsCount=function(){var e=0;return f.forEach((function(t){t.stats.uniformsCount>e&&(e=t.stats.uniformsCount)})),e},r.getMaxAttributesCount=function(){var e=0;return f.forEach((function(t){t.stats.attributesCount>e&&(e=t.stats.attributesCount)})),e}),{clear:function(){var t=e.deleteShader.bind(e);Et(a).forEach(t),a={},Et(o).forEach(t),o={},f.forEach((function(t){e.deleteProgram(t.program)})),f.length=0,c={},r.shaderCount=0},program:function(t,i,s,u){ie.command(t>=0,"missing vertex shader",s),ie.command(i>=0,"missing fragment shader",s);var l=c[i];l||(l=c[i]={});var h=l[t];if(h&&(h.refCount++,!u))return h;var v=new p(i,t);return r.shaderCount++,d(v,s,u),h||(l[t]=v),f.push(v),n(v,{destroy:function(){if(v.refCount--,v.refCount<=0){e.deleteProgram(v.program);var t=f.indexOf(v);f.splice(t,1),r.shaderCount--}l[v.vertId].refCount<=0&&(e.deleteShader(o[v.vertId]),delete o[v.vertId],delete c[v.fragId][v.vertId]),Object.keys(c[v.fragId]).length||(e.deleteShader(a[v.fragId]),delete a[v.fragId],delete c[v.fragId])}})},restore:v,shader:l,frag:-1,vert:-1}}var wa=6408,Ca=5121,ka=3333,Aa=5126;function Ea(e,n,r,i,a,o,s){function u(u){var l;null===n.next?(ie(a.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),l=Ca):(ie(null!==n.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),l=n.next.colorAttachments[0].texture._texture.type,ie.optional((function(){o.oes_texture_float?(ie(l===Ca||l===Aa,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),l===Aa&&ie(s.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):ie(l===Ca,"Reading from a framebuffer is only allowed for the type 'uint8'")})));var c=0,f=0,h=i.framebufferWidth,p=i.framebufferHeight,d=null;t(u)?d=u:u&&(ie.type(u,"object","invalid arguments to regl.read()"),c=0|u.x,f=0|u.y,ie(c>=0&&c<i.framebufferWidth,"invalid x offset for regl.read"),ie(f>=0&&f<i.framebufferHeight,"invalid y offset for regl.read"),h=0|(u.width||i.framebufferWidth-c),p=0|(u.height||i.framebufferHeight-f),d=u.data||null),d&&(l===Ca?ie(d instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):l===Aa&&ie(d instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),ie(h>0&&h+c<=i.framebufferWidth,"invalid width for read pixels"),ie(p>0&&p+f<=i.framebufferHeight,"invalid height for read pixels"),r();var v=h*p*4;return d||(l===Ca?d=new Uint8Array(v):l===Aa&&(d=d||new Float32Array(v))),ie.isTypedArray(d,"data buffer for regl.read() must be a typedarray"),ie(d.byteLength>=v,"data buffer for regl.read() too small"),e.pixelStorei(ka,4),e.readPixels(c,f,h,p,wa,l,d),d}function l(e){var t;return n.setFBO({framebuffer:e.framebuffer},(function(){t=u(e)})),t}function c(e){return e&&"framebuffer"in e?l(e):u(e)}return c}function Ta(e){return Array.prototype.slice.call(e)}function Ma(e){return Ta(e).join("")}function Oa(){var t=0,r=[],i=[];function a(e){for(var n=0;n<i.length;++n)if(i[n]===e)return r[n];var a="g"+t++;return r.push(a),i.push(e),a}function o(){var e=[];function r(){e.push.apply(e,Ta(arguments))}var i=[];function a(){var n="v"+t++;return i.push(n),arguments.length>0&&(e.push(n,"="),e.push.apply(e,Ta(arguments)),e.push(";")),n}return n(r,{def:a,toString:function(){return Ma([i.length>0?"var "+i.join(",")+";":"",Ma(e)])}})}function s(){var e=o(),t=o(),r=e.toString,i=t.toString;function a(n,r){t(n,r,"=",e.def(n,r),";")}return n((function(){e.apply(e,Ta(arguments))}),{def:e.def,entry:e,exit:t,save:a,set:function(t,n,r){a(t,n),e(t,n,"=",r,";")},toString:function(){return r()+i()}})}function u(){var e=Ma(arguments),t=s(),r=s(),i=t.toString,a=r.toString;return n(t,{then:function(){return t.apply(t,Ta(arguments)),this},else:function(){return r.apply(r,Ta(arguments)),this},toString:function(){var t=a();return t&&(t="else{"+t+"}"),Ma(["if(",e,"){",i(),"}",t])}})}var l=o(),c={};function f(e,t){var r=[];function i(){var e="a"+r.length;return r.push(e),e}t=t||0;for(var a=0;a<t;++a)i();var o=s(),u=o.toString,l=c[e]=n(o,{arg:i,toString:function(){return Ma(["function(",r.join(),"){",u(),"}"])}});return l}function h(){var t=['"use strict";',l,"return {"];Object.keys(c).forEach((function(e){t.push('"',e,'":',c[e].toString(),",")})),t.push("}");var n=Ma(t).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n"),a="undefined"!==typeof my&&!!my&&"function"===typeof my.showToast&&!0!==my.isFRM,o=a?e.Function.apply(null,r.concat(n)):Function.apply(null,r.concat(n));return o.apply(null,i)}return{global:l,link:a,block:o,proc:f,scope:s,cond:u,compile:h}}var La="xyzw".split(""),Pa=5121,Ra=1,Ia=2,Da=0,za=1,Na=2,Fa=3,ja=4,Ba=5,Ua=6,Va="dither",Ga="blend.enable",Ha="blend.color",Wa="blend.equation",Ya="blend.func",qa="depth.enable",Za="depth.func",Ka="depth.range",Xa="depth.mask",Qa="colorMask",Ja="cull.enable",$a="cull.face",eo="frontFace",to="lineWidth",no="polygonOffset.enable",ro="polygonOffset.offset",io="sample.alpha",ao="sample.enable",oo="sample.coverage",so="stencil.enable",uo="stencil.mask",lo="stencil.func",co="stencil.opFront",fo="stencil.opBack",ho="scissor.enable",po="scissor.box",vo="viewport",go="profile",mo="framebuffer",yo="vert",_o="frag",xo="elements",bo="primitive",So="count",wo="offset",Co="instances",ko="vao",Ao="Width",Eo="Height",To=mo+Ao,Mo=mo+Eo,Oo=vo+Ao,Lo=vo+Eo,Po="drawingBuffer",Ro=Po+Ao,Io=Po+Eo,Do=[Ya,Wa,lo,co,fo,oo,vo,po,ro],zo=34962,No=34963,Fo=35632,jo=35633,Bo=3553,Uo=34067,Vo=2884,Go=3042,Ho=3024,Wo=2960,Yo=2929,qo=3089,Zo=32823,Ko=32926,Xo=32928,Qo=5126,Jo=35664,$o=35665,es=35666,ts=5124,ns=35667,rs=35668,is=35669,as=35670,os=35671,ss=35672,us=35673,ls=35674,cs=35675,fs=35676,hs=35678,ps=35680,ds=4,vs=1028,gs=1029,ms=2304,ys=2305,_s=32775,xs=32776,bs=519,Ss=7680,ws=0,Cs=1,ks=32774,As=513,Es=36160,Ts=36064,Ms={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Os=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Ls={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Ps={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Rs={frag:Fo,vert:jo},Is={cw:ms,ccw:ys};function Ds(e){return Array.isArray(e)||t(e)||At(e)}function zs(e){return e.sort((function(e,t){return e===vo?-1:t===vo?1:e<t?-1:1}))}function Ns(e,t,n,r){this.thisDep=e,this.contextDep=t,this.propDep=n,this.append=r}function Fs(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function js(e){return new Ns(!1,!1,!1,e)}function Bs(e,t){var n=e.type;if(n===Da){var r=e.data.length;return new Ns(!0,r>=1,r>=2,t)}if(n===ja){var i=e.data;return new Ns(i.thisDep,i.contextDep,i.propDep,t)}if(n===Ba)return new Ns(!1,!1,!1,t);if(n===Ua){for(var a=!1,o=!1,s=!1,u=0;u<e.data.length;++u){var l=e.data[u];if(l.type===za)s=!0;else if(l.type===Na)o=!0;else if(l.type===Fa)a=!0;else if(l.type===Da){a=!0;var c=l.data;c>=1&&(o=!0),c>=2&&(s=!0)}else l.type===ja&&(a=a||l.data.thisDep,o=o||l.data.contextDep,s=s||l.data.propDep)}return new Ns(a,o,s,t)}return new Ns(n===Fa,n===Na,n===za,t)}var Us=new Ns(!1,!1,!1,(function(){}));function Vs(e,t,r,i,a,o,s,u,l,c,f,h,p,d,v){var g=c.Record,m={add:32774,subtract:32778,"reverse subtract":32779};r.ext_blend_minmax&&(m.min=_s,m.max=xs);var y=r.angle_instanced_arrays,_=r.webgl_draw_buffers,x=r.oes_vertex_array_object,b={dirty:!0,profile:v.profile},S={},w=[],C={},k={};function A(e){return e.replace(".","_")}function E(e,t,n){var r=A(e);w.push(e),S[r]=b[r]=!!n,C[r]=t}function T(e,t,n){var r=A(e);w.push(e),Array.isArray(n)?(b[r]=n.slice(),S[r]=n.slice()):b[r]=S[r]=n,k[r]=t}E(Va,Ho),E(Ga,Go),T(Ha,"blendColor",[0,0,0,0]),T(Wa,"blendEquationSeparate",[ks,ks]),T(Ya,"blendFuncSeparate",[Cs,ws,Cs,ws]),E(qa,Yo,!0),T(Za,"depthFunc",As),T(Ka,"depthRange",[0,1]),T(Xa,"depthMask",!0),T(Qa,Qa,[!0,!0,!0,!0]),E(Ja,Vo),T($a,"cullFace",gs),T(eo,eo,ys),T(to,to,1),E(no,Zo),T(ro,"polygonOffset",[0,0]),E(io,Ko),E(ao,Xo),T(oo,"sampleCoverage",[1,!1]),E(so,Wo),T(uo,"stencilMask",-1),T(lo,"stencilFunc",[bs,0,-1]),T(co,"stencilOpSeparate",[vs,Ss,Ss,Ss]),T(fo,"stencilOpSeparate",[gs,Ss,Ss,Ss]),E(ho,qo),T(po,"scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),T(vo,vo,[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var M={gl:e,context:p,strings:t,next:S,current:b,draw:h,elements:o,buffer:a,shader:f,attributes:c.state,vao:c,uniforms:l,framebuffer:u,extensions:r,timer:d,isBufferArgs:Ds},O={primTypes:hn,compareFuncs:Ls,blendFuncs:Ms,blendEquations:m,stencilOps:Ps,glTypes:Ht,orientationType:Is};ie.optional((function(){M.isArrayLike=On})),_&&(O.backBuffer=[gs],O.drawBuffer=Me(i.maxDrawbuffers,(function(e){return 0===e?[0]:Me(e,(function(e){return Ts+e}))})));var L=0;function P(){var e=Oa(),n=e.link,r=e.global;e.id=L++,e.batchId="0";var i=n(M),a=e.shared={props:"a0"};Object.keys(M).forEach((function(e){a[e]=r.def(i,".",e)})),ie.optional((function(){e.CHECK=n(ie),e.commandStr=ie.guessCommand(),e.command=n(e.commandStr),e.assert=function(e,t,r){e("if(!(",t,"))",this.CHECK,".commandRaise(",n(r),",",this.command,");")},O.invalidBlendCombinations=Os}));var o=e.next={},s=e.current={};Object.keys(k).forEach((function(e){Array.isArray(b[e])&&(o[e]=r.def(a.next,".",e),s[e]=r.def(a.current,".",e))}));var u=e.constants={};Object.keys(O).forEach((function(e){u[e]=r.def(JSON.stringify(O[e]))})),e.invoke=function(t,r){switch(r.type){case Da:var i=["this",a.context,a.props,e.batchId];return t.def(n(r.data),".call(",i.slice(0,Math.max(r.data.length+1,4)),")");case za:return t.def(a.props,r.data);case Na:return t.def(a.context,r.data);case Fa:return t.def("this",r.data);case ja:return r.data.append(e,t),r.data.ref;case Ba:return r.data.toString();case Ua:return r.data.map((function(n){return e.invoke(t,n)}))}},e.attribCache={};var l={};return e.scopeAttrib=function(e){var r=t.id(e);if(r in l)return l[r];var i=c.scope[r];i||(i=c.scope[r]=new g);var a=l[r]=n(i);return a},e}function R(e){var t,n=e.static,r=e.dynamic;if(go in n){var i=!!n[go];t=js((function(e,t){return i})),t.enable=i}else if(go in r){var a=r[go];t=Bs(a,(function(e,t){return e.invoke(t,a)}))}return t}function I(e,t){var n=e.static,r=e.dynamic;if(mo in n){var i=n[mo];return i?(i=u.getFramebuffer(i),ie.command(i,"invalid framebuffer object"),js((function(e,t){var n=e.link(i),r=e.shared;t.set(r.framebuffer,".next",n);var a=r.context;return t.set(a,"."+To,n+".width"),t.set(a,"."+Mo,n+".height"),n}))):js((function(e,t){var n=e.shared;t.set(n.framebuffer,".next","null");var r=n.context;return t.set(r,"."+To,r+"."+Ro),t.set(r,"."+Mo,r+"."+Io),"null"}))}if(mo in r){var a=r[mo];return Bs(a,(function(e,t){var n=e.invoke(t,a),r=e.shared,i=r.framebuffer,o=t.def(i,".getFramebuffer(",n,")");ie.optional((function(){e.assert(t,"!"+n+"||"+o,"invalid framebuffer object")})),t.set(i,".next",o);var s=r.context;return t.set(s,"."+To,o+"?"+o+".width:"+s+"."+Ro),t.set(s,"."+Mo,o+"?"+o+".height:"+s+"."+Io),o}))}return null}function D(e,t,n){var r=e.static,i=e.dynamic;function a(e){if(e in r){var a=r[e];ie.commandType(a,"object","invalid "+e,n.commandStr);var o,s,u=!0,l=0|a.x,c=0|a.y;return"width"in a?(o=0|a.width,ie.command(o>=0,"invalid "+e,n.commandStr)):u=!1,"height"in a?(s=0|a.height,ie.command(s>=0,"invalid "+e,n.commandStr)):u=!1,new Ns(!u&&t&&t.thisDep,!u&&t&&t.contextDep,!u&&t&&t.propDep,(function(e,t){var n=e.shared.context,r=o;"width"in a||(r=t.def(n,".",To,"-",l));var i=s;return"height"in a||(i=t.def(n,".",Mo,"-",c)),[l,c,r,i]}))}if(e in i){var f=i[e],h=Bs(f,(function(t,n){var r=t.invoke(n,f);ie.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)}));var i=t.shared.context,a=n.def(r,".x|0"),o=n.def(r,".y|0"),s=n.def('"width" in ',r,"?",r,".width|0:","(",i,".",To,"-",a,")"),u=n.def('"height" in ',r,"?",r,".height|0:","(",i,".",Mo,"-",o,")");return ie.optional((function(){t.assert(n,s+">=0&&"+u+">=0","invalid "+e)})),[a,o,s,u]}));return t&&(h.thisDep=h.thisDep||t.thisDep,h.contextDep=h.contextDep||t.contextDep,h.propDep=h.propDep||t.propDep),h}return t?new Ns(t.thisDep,t.contextDep,t.propDep,(function(e,t){var n=e.shared.context;return[0,0,t.def(n,".",To),t.def(n,".",Mo)]})):null}var o=a(vo);if(o){var s=o;o=new Ns(o.thisDep,o.contextDep,o.propDep,(function(e,t){var n=s.append(e,t),r=e.shared.context;return t.set(r,"."+Oo,n[2]),t.set(r,"."+Lo,n[3]),n}))}return{viewport:o,scissor_box:a(po)}}function z(e,t){var n=e.static,r="string"===typeof n[_o]&&"string"===typeof n[yo];if(r){if(Object.keys(t.dynamic).length>0)return null;var i=t.static,a=Object.keys(i);if(a.length>0&&"number"===typeof i[a[0]]){for(var o=[],s=0;s<a.length;++s)ie("number"===typeof i[a[s]],"must specify all vertex attribute locations when using vaos"),o.push([0|i[a[s]],a[s]]);return o}}return null}function N(e,n,r){var i=e.static,a=e.dynamic;function o(e){if(e in i){var n=t.id(i[e]);ie.optional((function(){f.shader(Rs[e],n,ie.guessCommand())}));var r=js((function(){return n}));return r.id=n,r}if(e in a){var o=a[e];return Bs(o,(function(t,n){var r=t.invoke(n,o),i=n.def(t.shared.strings,".id(",r,")");return ie.optional((function(){n(t.shared.shader,".shader(",Rs[e],",",i,",",t.command,");")})),i}))}return null}var s,u=o(_o),l=o(yo),c=null;return Fs(u)&&Fs(l)?(c=f.program(l.id,u.id,null,r),s=js((function(e,t){return e.link(c)}))):s=new Ns(u&&u.thisDep||l&&l.thisDep,u&&u.contextDep||l&&l.contextDep,u&&u.propDep||l&&l.propDep,(function(e,t){var n,r,i=e.shared.shader;n=u?u.append(e,t):t.def(i,".",_o),r=l?l.append(e,t):t.def(i,".",yo);var a=i+".program("+r+","+n;return ie.optional((function(){a+=","+e.command})),t.def(a+")")})),{frag:u,vert:l,progVar:s,program:c}}function F(e,t){var n=e.static,r=e.dynamic,i={},a=!1;function s(){if(ko in n){var e=n[ko];return null!==e&&null===c.getVAO(e)&&(e=c.createVAO(e)),a=!0,i.vao=e,js((function(t){var n=c.getVAO(e);return n?t.link(n):"null"}))}if(ko in r){a=!0;var t=r[ko];return Bs(t,(function(e,n){var r=e.invoke(n,t);return n.def(e.shared.vao+".getVAO("+r+")")}))}return null}var u=s(),l=!1;function f(){if(xo in n){var e=n[xo];if(i.elements=e,Ds(e)){var s=i.elements=o.create(e,!0);e=o.getElements(s),l=!0}else e&&(e=o.getElements(e),l=!0,ie.command(e,"invalid elements",t.commandStr));var c=js((function(t,n){if(e){var r=t.link(e);return t.ELEMENTS=r,r}return t.ELEMENTS=null,null}));return c.value=e,c}if(xo in r){l=!0;var f=r[xo];return Bs(f,(function(e,t){var n=e.shared,r=n.isBufferArgs,i=n.elements,a=e.invoke(t,f),o=t.def("null"),s=t.def(r,"(",a,")"),u=e.cond(s).then(o,"=",i,".createStream(",a,");").else(o,"=",i,".getElements(",a,");");return ie.optional((function(){e.assert(u.else,"!"+a+"||"+o,"invalid elements")})),t.entry(u),t.exit(e.cond(s).then(i,".destroyStream(",o,");")),e.ELEMENTS=o,o}))}return a?new Ns(u.thisDep,u.contextDep,u.propDep,(function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.elements+".getElements("+e.shared.vao+".currentVAO.elements):null")})):null}var h=f();function p(){if(bo in n){var e=n[bo];return i.primitive=e,ie.commandParameter(e,hn,"invalid primitve",t.commandStr),js((function(t,n){return hn[e]}))}if(bo in r){var o=r[bo];return Bs(o,(function(e,t){var n=e.constants.primTypes,r=e.invoke(t,o);return ie.optional((function(){e.assert(t,r+" in "+n,"invalid primitive, must be one of "+Object.keys(hn))})),t.def(n,"[",r,"]")}))}return l?Fs(h)?h.value?js((function(e,t){return t.def(e.ELEMENTS,".primType")})):js((function(){return ds})):new Ns(h.thisDep,h.contextDep,h.propDep,(function(e,t){var n=e.ELEMENTS;return t.def(n,"?",n,".primType:",ds)})):a?new Ns(u.thisDep,u.contextDep,u.propDep,(function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.vao+".currentVAO.primitive:"+ds)})):null}function d(e,o){if(e in n){var s=0|n[e];return o?i.offset=s:i.instances=s,ie.command(!o||s>=0,"invalid "+e,t.commandStr),js((function(e,t){return o&&(e.OFFSET=s),s}))}if(e in r){var c=r[e];return Bs(c,(function(t,n){var r=t.invoke(n,c);return o&&(t.OFFSET=r,ie.optional((function(){t.assert(n,r+">=0","invalid "+e)}))),r}))}if(o){if(l)return js((function(e,t){return e.OFFSET=0,0}));if(a)return new Ns(u.thisDep,u.contextDep,u.propDep,(function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.vao+".currentVAO.offset:0")}))}else if(a)return new Ns(u.thisDep,u.contextDep,u.propDep,(function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.vao+".currentVAO.instances:-1")}));return null}var v=d(wo,!0);function g(){if(So in n){var e=0|n[So];return i.count=e,ie.command("number"===typeof e&&e>=0,"invalid vertex count",t.commandStr),js((function(){return e}))}if(So in r){var o=r[So];return Bs(o,(function(e,t){var n=e.invoke(t,o);return ie.optional((function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">=0&&"+n+"===("+n+"|0)","invalid vertex count")})),n}))}if(l){if(Fs(h)){if(h)return v?new Ns(v.thisDep,v.contextDep,v.propDep,(function(e,t){var n=t.def(e.ELEMENTS,".vertCount-",e.OFFSET);return ie.optional((function(){e.assert(t,n+">=0","invalid vertex offset/element buffer too small")})),n})):js((function(e,t){return t.def(e.ELEMENTS,".vertCount")}));var s=js((function(){return-1}));return ie.optional((function(){s.MISSING=!0})),s}var c=new Ns(h.thisDep||v.thisDep,h.contextDep||v.contextDep,h.propDep||v.propDep,(function(e,t){var n=e.ELEMENTS;return e.OFFSET?t.def(n,"?",n,".vertCount-",e.OFFSET,":-1"):t.def(n,"?",n,".vertCount:-1")}));return ie.optional((function(){c.DYNAMIC=!0})),c}if(a){var f=new Ns(u.thisDep,u.contextDep,u.propDep,(function(e,t){return t.def(e.shared.vao,".currentVAO?",e.shared.vao,".currentVAO.count:-1")}));return f}return null}var m=p(),y=g(),_=d(Co,!1);return{elements:h,primitive:m,count:y,instances:_,offset:v,vao:u,vaoActive:a,elementsActive:l,static:i}}function j(e,t){var n=e.static,r=e.dynamic,a={};return w.forEach((function(e){var o=A(e);function s(t,i){if(e in n){var s=t(n[e]);a[o]=js((function(){return s}))}else if(e in r){var u=r[e];a[o]=Bs(u,(function(e,t){return i(e,t,e.invoke(t,u))}))}}switch(e){case Ja:case Ga:case Va:case so:case qa:case ho:case no:case io:case ao:case Xa:return s((function(n){return ie.commandType(n,"boolean",e,t.commandStr),n}),(function(t,n,r){return ie.optional((function(){t.assert(n,"typeof "+r+'==="boolean"',"invalid flag "+e,t.commandStr)})),r}));case Za:return s((function(n){return ie.commandParameter(n,Ls,"invalid "+e,t.commandStr),Ls[n]}),(function(t,n,r){var i=t.constants.compareFuncs;return ie.optional((function(){t.assert(n,r+" in "+i,"invalid "+e+", must be one of "+Object.keys(Ls))})),n.def(i,"[",r,"]")}));case Ka:return s((function(e){return ie.command(On(e)&&2===e.length&&"number"===typeof e[0]&&"number"===typeof e[1]&&e[0]<=e[1],"depth range is 2d array",t.commandStr),e}),(function(e,t,n){ie.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===2&&typeof "+n+'[0]==="number"&&typeof '+n+'[1]==="number"&&'+n+"[0]<="+n+"[1]","depth range must be a 2d array")}));var r=t.def("+",n,"[0]"),i=t.def("+",n,"[1]");return[r,i]}));case Ya:return s((function(e){ie.commandType(e,"object","blend.func",t.commandStr);var n="srcRGB"in e?e.srcRGB:e.src,r="srcAlpha"in e?e.srcAlpha:e.src,i="dstRGB"in e?e.dstRGB:e.dst,a="dstAlpha"in e?e.dstAlpha:e.dst;return ie.commandParameter(n,Ms,o+".srcRGB",t.commandStr),ie.commandParameter(r,Ms,o+".srcAlpha",t.commandStr),ie.commandParameter(i,Ms,o+".dstRGB",t.commandStr),ie.commandParameter(a,Ms,o+".dstAlpha",t.commandStr),ie.command(-1===Os.indexOf(n+", "+i),"unallowed blending combination (srcRGB, dstRGB) = ("+n+", "+i+")",t.commandStr),[Ms[n],Ms[i],Ms[r],Ms[a]]}),(function(t,n,r){var i=t.constants.blendFuncs;function a(a,o){var s=n.def('"',a,o,'" in ',r,"?",r,".",a,o,":",r,".",a);return ie.optional((function(){t.assert(n,s+" in "+i,"invalid "+e+"."+a+o+", must be one of "+Object.keys(Ms))})),s}ie.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid blend func, must be an object")}));var o=a("src","RGB"),s=a("dst","RGB");ie.optional((function(){var e=t.constants.invalidBlendCombinations;t.assert(n,e+".indexOf("+o+'+", "+'+s+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")}));var u=n.def(i,"[",o,"]"),l=n.def(i,"[",a("src","Alpha"),"]"),c=n.def(i,"[",s,"]"),f=n.def(i,"[",a("dst","Alpha"),"]");return[u,c,l,f]}));case Wa:return s((function(n){return"string"===typeof n?(ie.commandParameter(n,m,"invalid "+e,t.commandStr),[m[n],m[n]]):"object"===typeof n?(ie.commandParameter(n.rgb,m,e+".rgb",t.commandStr),ie.commandParameter(n.alpha,m,e+".alpha",t.commandStr),[m[n.rgb],m[n.alpha]]):void ie.commandRaise("invalid blend.equation",t.commandStr)}),(function(t,n,r){var i=t.constants.blendEquations,a=n.def(),o=n.def(),s=t.cond("typeof ",r,'==="string"');return ie.optional((function(){function n(e,n,r){t.assert(e,r+" in "+i,"invalid "+n+", must be one of "+Object.keys(m))}n(s.then,e,r),t.assert(s.else,r+"&&typeof "+r+'==="object"',"invalid "+e),n(s.else,e+".rgb",r+".rgb"),n(s.else,e+".alpha",r+".alpha")})),s.then(a,"=",o,"=",i,"[",r,"];"),s.else(a,"=",i,"[",r,".rgb];",o,"=",i,"[",r,".alpha];"),n(s),[a,o]}));case Ha:return s((function(e){return ie.command(On(e)&&4===e.length,"blend.color must be a 4d array",t.commandStr),Me(4,(function(t){return+e[t]}))}),(function(e,t,n){return ie.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","blend.color must be a 4d array")})),Me(4,(function(e){return t.def("+",n,"[",e,"]")}))}));case uo:return s((function(e){return ie.commandType(e,"number",o,t.commandStr),0|e}),(function(e,t,n){return ie.optional((function(){e.assert(t,"typeof "+n+'==="number"',"invalid stencil.mask")})),t.def(n,"|0")}));case lo:return s((function(n){ie.commandType(n,"object",o,t.commandStr);var r=n.cmp||"keep",i=n.ref||0,a="mask"in n?n.mask:-1;return ie.commandParameter(r,Ls,e+".cmp",t.commandStr),ie.commandType(i,"number",e+".ref",t.commandStr),ie.commandType(a,"number",e+".mask",t.commandStr),[Ls[r],i,a]}),(function(e,t,n){var r=e.constants.compareFuncs;ie.optional((function(){function i(){e.assert(t,Array.prototype.join.call(arguments,""),"invalid stencil.func")}i(n+"&&typeof ",n,'==="object"'),i('!("cmp" in ',n,")||(",n,".cmp in ",r,")")}));var i=t.def('"cmp" in ',n,"?",r,"[",n,".cmp]",":",Ss),a=t.def(n,".ref|0"),o=t.def('"mask" in ',n,"?",n,".mask|0:-1");return[i,a,o]}));case co:case fo:return s((function(n){ie.commandType(n,"object",o,t.commandStr);var r=n.fail||"keep",i=n.zfail||"keep",a=n.zpass||"keep";return ie.commandParameter(r,Ps,e+".fail",t.commandStr),ie.commandParameter(i,Ps,e+".zfail",t.commandStr),ie.commandParameter(a,Ps,e+".zpass",t.commandStr),[e===fo?gs:vs,Ps[r],Ps[i],Ps[a]]}),(function(t,n,r){var i=t.constants.stencilOps;function a(a){return ie.optional((function(){t.assert(n,'!("'+a+'" in '+r+")||("+r+"."+a+" in "+i+")","invalid "+e+"."+a+", must be one of "+Object.keys(Ps))})),n.def('"',a,'" in ',r,"?",i,"[",r,".",a,"]:",Ss)}return ie.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)})),[e===fo?gs:vs,a("fail"),a("zfail"),a("zpass")]}));case ro:return s((function(e){ie.commandType(e,"object",o,t.commandStr);var n=0|e.factor,r=0|e.units;return ie.commandType(n,"number",o+".factor",t.commandStr),ie.commandType(r,"number",o+".units",t.commandStr),[n,r]}),(function(t,n,r){ie.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)}));var i=n.def(r,".factor|0"),a=n.def(r,".units|0");return[i,a]}));case $a:return s((function(e){var n=0;return"front"===e?n=vs:"back"===e&&(n=gs),ie.command(!!n,o,t.commandStr),n}),(function(e,t,n){return ie.optional((function(){e.assert(t,n+'==="front"||'+n+'==="back"',"invalid cull.face")})),t.def(n,'==="front"?',vs,":",gs)}));case to:return s((function(e){return ie.command("number"===typeof e&&e>=i.lineWidthDims[0]&&e<=i.lineWidthDims[1],"invalid line width, must be a positive number between "+i.lineWidthDims[0]+" and "+i.lineWidthDims[1],t.commandStr),e}),(function(e,t,n){return ie.optional((function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">="+i.lineWidthDims[0]+"&&"+n+"<="+i.lineWidthDims[1],"invalid line width")})),n}));case eo:return s((function(e){return ie.commandParameter(e,Is,o,t.commandStr),Is[e]}),(function(e,t,n){return ie.optional((function(){e.assert(t,n+'==="cw"||'+n+'==="ccw"',"invalid frontFace, must be one of cw,ccw")})),t.def(n+'==="cw"?'+ms+":"+ys)}));case Qa:return s((function(e){return ie.command(On(e)&&4===e.length,"color.mask must be length 4 array",t.commandStr),e.map((function(e){return!!e}))}),(function(e,t,n){return ie.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","invalid color.mask")})),Me(4,(function(e){return"!!"+n+"["+e+"]"}))}));case oo:return s((function(e){ie.command("object"===typeof e&&e,o,t.commandStr);var n="value"in e?e.value:1,r=!!e.invert;return ie.command("number"===typeof n&&n>=0&&n<=1,"sample.coverage.value must be a number between 0 and 1",t.commandStr),[n,r]}),(function(e,t,n){ie.optional((function(){e.assert(t,n+"&&typeof "+n+'==="object"',"invalid sample.coverage")}));var r=t.def('"value" in ',n,"?+",n,".value:1"),i=t.def("!!",n,".invert");return[r,i]}))}})),a}function B(e,t){var n=e.static,r=e.dynamic,i={};return Object.keys(n).forEach((function(e){var r,a=n[e];if("number"===typeof a||"boolean"===typeof a)r=js((function(){return a}));else if("function"===typeof a){var o=a._reglType;"texture2d"===o||"textureCube"===o?r=js((function(e){return e.link(a)})):"framebuffer"===o||"framebufferCube"===o?(ie.command(a.color.length>0,'missing color attachment for framebuffer sent to uniform "'+e+'"',t.commandStr),r=js((function(e){return e.link(a.color[0])}))):ie.commandRaise('invalid data for uniform "'+e+'"',t.commandStr)}else On(a)?r=js((function(t){var n=t.global.def("[",Me(a.length,(function(n){return ie.command("number"===typeof a[n]||"boolean"===typeof a[n],"invalid uniform "+e,t.commandStr),a[n]})),"]");return n})):ie.commandRaise('invalid or missing data for uniform "'+e+'"',t.commandStr);r.value=a,i[e]=r})),Object.keys(r).forEach((function(e){var t=r[e];i[e]=Bs(t,(function(e,n){return e.invoke(n,t)}))})),i}function U(e,n){var r=e.static,i=e.dynamic,o={};return Object.keys(r).forEach((function(e){var i=r[e],s=t.id(e),u=new g;if(Ds(i))u.state=Ra,u.buffer=a.getBuffer(a.create(i,zo,!1,!0)),u.type=0;else{var l=a.getBuffer(i);if(l)u.state=Ra,u.buffer=l,u.type=0;else if(ie.command("object"===typeof i&&i,"invalid data for attribute "+e,n.commandStr),"constant"in i){var c=i.constant;u.buffer="null",u.state=Ia,"number"===typeof c?u.x=c:(ie.command(On(c)&&c.length>0&&c.length<=4,"invalid constant for attribute "+e,n.commandStr),La.forEach((function(e,t){t<c.length&&(u[e]=c[t])})))}else{l=Ds(i.buffer)?a.getBuffer(a.create(i.buffer,zo,!1,!0)):a.getBuffer(i.buffer),ie.command(!!l,'missing buffer for attribute "'+e+'"',n.commandStr);var f=0|i.offset;ie.command(f>=0,'invalid offset for attribute "'+e+'"',n.commandStr);var h=0|i.stride;ie.command(h>=0&&h<256,'invalid stride for attribute "'+e+'", must be integer betweeen [0, 255]',n.commandStr);var p=0|i.size;ie.command(!("size"in i)||p>0&&p<=4,'invalid size for attribute "'+e+'", must be 1,2,3,4',n.commandStr);var d=!!i.normalized,v=0;"type"in i&&(ie.commandParameter(i.type,Ht,"invalid type for attribute "+e,n.commandStr),v=Ht[i.type]);var m=0|i.divisor;ie.optional((function(){"divisor"in i&&(ie.command(0===m||y,'cannot specify divisor for attribute "'+e+'", instancing not supported',n.commandStr),ie.command(m>=0,'invalid divisor for attribute "'+e+'"',n.commandStr));var t=n.commandStr,r=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(i).forEach((function(n){ie.command(r.indexOf(n)>=0,'unknown parameter "'+n+'" for attribute pointer "'+e+'" (valid parameters are '+r+")",t)}))})),u.buffer=l,u.state=Ra,u.size=p,u.normalized=d,u.type=v||l.dtype,u.offset=f,u.stride=h,u.divisor=m}}o[e]=js((function(e,t){var n=e.attribCache;if(s in n)return n[s];var r={isStream:!1};return Object.keys(u).forEach((function(e){r[e]=u[e]})),u.buffer&&(r.buffer=e.link(u.buffer),r.type=r.type||r.buffer+".dtype"),n[s]=r,r}))})),Object.keys(i).forEach((function(e){var t=i[e];function n(n,r){var i=n.invoke(r,t),a=n.shared,o=n.constants,s=a.isBufferArgs,u=a.buffer;ie.optional((function(){n.assert(r,i+"&&(typeof "+i+'==="object"||typeof '+i+'==="function")&&('+s+"("+i+")||"+u+".getBuffer("+i+")||"+u+".getBuffer("+i+".buffer)||"+s+"("+i+'.buffer)||("constant" in '+i+"&&(typeof "+i+'.constant==="number"||'+a.isArrayLike+"("+i+".constant))))",'invalid dynamic attribute "'+e+'"')}));var l={isStream:r.def(!1)},c=new g;c.state=Ra,Object.keys(c).forEach((function(e){l[e]=r.def(""+c[e])}));var f=l.buffer,h=l.type;function p(e){r(l[e],"=",i,".",e,"|0;")}return r("if(",s,"(",i,")){",l.isStream,"=true;",f,"=",u,".createStream(",zo,",",i,");",h,"=",f,".dtype;","}else{",f,"=",u,".getBuffer(",i,");","if(",f,"){",h,"=",f,".dtype;",'}else if("constant" in ',i,"){",l.state,"=",Ia,";","if(typeof "+i+'.constant === "number"){',l[La[0]],"=",i,".constant;",La.slice(1).map((function(e){return l[e]})).join("="),"=0;","}else{",La.map((function(e,t){return l[e]+"="+i+".constant.length>"+t+"?"+i+".constant["+t+"]:0;"})).join(""),"}}else{","if(",s,"(",i,".buffer)){",f,"=",u,".createStream(",zo,",",i,".buffer);","}else{",f,"=",u,".getBuffer(",i,".buffer);","}",h,'="type" in ',i,"?",o.glTypes,"[",i,".type]:",f,".dtype;",l.normalized,"=!!",i,".normalized;"),p("size"),p("offset"),p("stride"),p("divisor"),r("}}"),r.exit("if(",l.isStream,"){",u,".destroyStream(",f,");","}"),l}o[e]=Bs(t,n)})),o}function V(e){var t=e.static,n=e.dynamic,r={};return Object.keys(t).forEach((function(e){var n=t[e];r[e]=js((function(e,t){return"number"===typeof n||"boolean"===typeof n?""+n:e.link(n)}))})),Object.keys(n).forEach((function(e){var t=n[e];r[e]=Bs(t,(function(e,n){return e.invoke(n,t)}))})),r}function G(e,t,n,i,a){var o=e.static,s=e.dynamic;ie.optional((function(){var e=[mo,yo,_o,xo,bo,wo,So,Co,go,ko].concat(w);function t(t){Object.keys(t).forEach((function(t){ie.command(e.indexOf(t)>=0,'unknown parameter "'+t+'"',a.commandStr)}))}t(o),t(s)}));var u=z(e,t),l=I(e,a),f=D(e,l,a),h=F(e,a),p=j(e,a),d=N(e,a,u);function v(e){var t=f[e];t&&(p[e]=t)}v(vo),v(A(po));var g=Object.keys(p).length>0,m={framebuffer:l,draw:h,shader:d,state:p,dirty:g,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(m.profile=R(e,a),m.uniforms=B(n,a),m.drawVAO=m.scopeVAO=h.vao,!m.drawVAO&&d.program&&!u&&r.angle_instanced_arrays&&h.static.elements){var y=!0,_=d.program.attributes.map((function(e){var n=t.static[e];return y=y&&!!n,n}));if(y&&_.length>0){var x=c.getVAO(c.createVAO({attributes:_,elements:h.static.elements}));m.drawVAO=new Ns(null,null,null,(function(e,t){return e.link(x)})),m.useVAO=!0}}return u?m.useVAO=!0:m.attributes=U(t,a),m.context=V(i,a),m}function H(e,t,n){var r=e.shared,i=r.context,a=e.scope();Object.keys(n).forEach((function(r){t.save(i,"."+r);var o=n[r],s=o.append(e,t);Array.isArray(s)?a(i,".",r,"=[",s.join(),"];"):a(i,".",r,"=",s,";")})),t(a)}function W(e,t,n,r){var i,a=e.shared,o=a.gl,s=a.framebuffer;_&&(i=t.def(a.extensions,".webgl_draw_buffers"));var u,l=e.constants,c=l.drawBuffer,f=l.backBuffer;u=n?n.append(e,t):t.def(s,".next"),r||t("if(",u,"!==",s,".cur){"),t("if(",u,"){",o,".bindFramebuffer(",Es,",",u,".framebuffer);"),_&&t(i,".drawBuffersWEBGL(",c,"[",u,".colorAttachments.length]);"),t("}else{",o,".bindFramebuffer(",Es,",null);"),_&&t(i,".drawBuffersWEBGL(",f,");"),t("}",s,".cur=",u,";"),r||t("}")}function Y(e,t,n){var r=e.shared,i=r.gl,a=e.current,o=e.next,s=r.current,u=r.next,l=e.cond(s,".dirty");w.forEach((function(t){var r,c,f=A(t);if(!(f in n.state))if(f in o){r=o[f],c=a[f];var h=Me(b[f].length,(function(e){return l.def(r,"[",e,"]")}));l(e.cond(h.map((function(e,t){return e+"!=="+c+"["+t+"]"})).join("||")).then(i,".",k[f],"(",h,");",h.map((function(e,t){return c+"["+t+"]="+e})).join(";"),";"))}else{r=l.def(u,".",f);var p=e.cond(r,"!==",s,".",f);l(p),f in C?p(e.cond(r).then(i,".enable(",C[f],");").else(i,".disable(",C[f],");"),s,".",f,"=",r,";"):p(i,".",k[f],"(",r,");",s,".",f,"=",r,";")}})),0===Object.keys(n.state).length&&l(s,".dirty=false;"),t(l)}function q(e,t,n,r){var i=e.shared,a=e.current,o=i.current,s=i.gl;zs(Object.keys(n)).forEach((function(i){var u=n[i];if(!r||r(u)){var l=u.append(e,t);if(C[i]){var c=C[i];Fs(u)?t(s,l?".enable(":".disable(",c,");"):t(e.cond(l).then(s,".enable(",c,");").else(s,".disable(",c,");")),t(o,".",i,"=",l,";")}else if(On(l)){var f=a[i];t(s,".",k[i],"(",l,");",l.map((function(e,t){return f+"["+t+"]="+e})).join(";"),";")}else t(s,".",k[i],"(",l,");",o,".",i,"=",l,";")}}))}function Z(e,t){y&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function K(e,t,n,r,i){var a,o,s,u=e.shared,l=e.stats,c=u.current,f=u.timer,h=n.profile;function p(){var e="undefined"!==typeof my&&!!my&&"function"===typeof my.showToast&&!0!==my.isFRM;return e||"undefined"===typeof performance?"Date.now()":"performance.now()"}function v(e){a=t.def(),e(a,"=",p(),";"),"string"===typeof i?e(l,".count+=",i,";"):e(l,".count++;"),d&&(r?(o=t.def(),e(o,"=",f,".getNumPendingQueries();")):e(f,".beginQuery(",l,");"))}function g(e){e(l,".cpuTime+=",p(),"-",a,";"),d&&(r?e(f,".pushScopeStats(",o,",",f,".getNumPendingQueries(),",l,");"):e(f,".endQuery();"))}function m(e){var n=t.def(c,".profile");t(c,".profile=",e,";"),t.exit(c,".profile=",n,";")}if(h){if(Fs(h))return void(h.enable?(v(t),g(t.exit),m("true")):m("false"));s=h.append(e,t),m(s)}else s=t.def(c,".profile");var y=e.block();v(y),t("if(",s,"){",y,"}");var _=e.block();g(_),t.exit("if(",s,"){",_,"}")}function X(e,t,n,r,i){var a=e.shared;function o(e){switch(e){case Jo:case ns:case os:return 2;case $o:case rs:case ss:return 3;case es:case is:case us:return 4;default:return 1}}function s(n,r,i){var o=a.gl,s=t.def(n,".location"),u=t.def(a.attributes,"[",s,"]"),l=i.state,c=i.buffer,f=[i.x,i.y,i.z,i.w],h=["buffer","normalized","offset","stride"];function p(){t("if(!",u,".buffer){",o,".enableVertexAttribArray(",s,");}");var n,a=i.type;if(n=i.size?t.def(i.size,"||",r):r,t("if(",u,".type!==",a,"||",u,".size!==",n,"||",h.map((function(e){return u+"."+e+"!=="+i[e]})).join("||"),"){",o,".bindBuffer(",zo,",",c,".buffer);",o,".vertexAttribPointer(",[s,n,a,i.normalized,i.stride,i.offset],");",u,".type=",a,";",u,".size=",n,";",h.map((function(e){return u+"."+e+"="+i[e]+";"})).join(""),"}"),y){var l=i.divisor;t("if(",u,".divisor!==",l,"){",e.instancing,".vertexAttribDivisorANGLE(",[s,l],");",u,".divisor=",l,";}")}}function d(){t("if(",u,".buffer){",o,".disableVertexAttribArray(",s,");",u,".buffer=null;","}if(",La.map((function(e,t){return u+"."+e+"!=="+f[t]})).join("||"),"){",o,".vertexAttrib4f(",s,",",f,");",La.map((function(e,t){return u+"."+e+"="+f[t]+";"})).join(""),"}")}l===Ra?p():l===Ia?d():(t("if(",l,"===",Ra,"){"),p(),t("}else{"),d(),t("}"))}r.forEach((function(r){var a,u=r.name,l=n.attributes[u];if(l){if(!i(l))return;a=l.append(e,t)}else{if(!i(Us))return;var c=e.scopeAttrib(u);ie.optional((function(){e.assert(t,c+".state","missing attribute "+u)})),a={},Object.keys(new g).forEach((function(e){a[e]=t.def(c,".",e)}))}s(e.link(r),o(r.info.type),a)}))}function Q(e,n,r,i,a,o){for(var s,u=e.shared,l=u.gl,c=0;c<i.length;++c){var f,h=i[c],p=h.name,d=h.info.type,v=r.uniforms[p],g=e.link(h),m=g+".location";if(v){if(!a(v))continue;if(Fs(v)){var y=v.value;if(ie.command(null!==y&&"undefined"!==typeof y,'missing uniform "'+p+'"',e.commandStr),d===hs||d===ps){ie.command("function"===typeof y&&(d===hs&&("texture2d"===y._reglType||"framebuffer"===y._reglType)||d===ps&&("textureCube"===y._reglType||"framebufferCube"===y._reglType)),"invalid texture for uniform "+p,e.commandStr);var _=e.link(y._texture||y.color[0]._texture);n(l,".uniform1i(",m,",",_+".bind());"),n.exit(_,".unbind();")}else if(d===ls||d===cs||d===fs){ie.optional((function(){ie.command(On(y),"invalid matrix for uniform "+p,e.commandStr),ie.command(d===ls&&4===y.length||d===cs&&9===y.length||d===fs&&16===y.length,"invalid length for matrix uniform "+p,e.commandStr)}));var x=e.global.def("new Float32Array(["+Array.prototype.slice.call(y)+"])"),b=2;d===cs?b=3:d===fs&&(b=4),n(l,".uniformMatrix",b,"fv(",m,",false,",x,");")}else{switch(d){case Qo:ie.commandType(y,"number","uniform "+p,e.commandStr),s="1f";break;case Jo:ie.command(On(y)&&2===y.length,"uniform "+p,e.commandStr),s="2f";break;case $o:ie.command(On(y)&&3===y.length,"uniform "+p,e.commandStr),s="3f";break;case es:ie.command(On(y)&&4===y.length,"uniform "+p,e.commandStr),s="4f";break;case as:ie.commandType(y,"boolean","uniform "+p,e.commandStr),s="1i";break;case ts:ie.commandType(y,"number","uniform "+p,e.commandStr),s="1i";break;case os:ie.command(On(y)&&2===y.length,"uniform "+p,e.commandStr),s="2i";break;case ns:ie.command(On(y)&&2===y.length,"uniform "+p,e.commandStr),s="2i";break;case ss:ie.command(On(y)&&3===y.length,"uniform "+p,e.commandStr),s="3i";break;case rs:ie.command(On(y)&&3===y.length,"uniform "+p,e.commandStr),s="3i";break;case us:ie.command(On(y)&&4===y.length,"uniform "+p,e.commandStr),s="4i";break;case is:ie.command(On(y)&&4===y.length,"uniform "+p,e.commandStr),s="4i";break}n(l,".uniform",s,"(",m,",",On(y)?Array.prototype.slice.call(y):y,");")}continue}f=v.append(e,n)}else{if(!a(Us))continue;f=n.def(u.uniforms,"[",t.id(p),"]")}d===hs?(ie(!Array.isArray(f),"must specify a scalar prop for textures"),n("if(",f,"&&",f,'._reglType==="framebuffer"){',f,"=",f,".color[0];","}")):d===ps&&(ie(!Array.isArray(f),"must specify a scalar prop for cube maps"),n("if(",f,"&&",f,'._reglType==="framebufferCube"){',f,"=",f,".color[0];","}")),ie.optional((function(){function t(t,r){e.assert(n,t,'bad data or missing for uniform "'+p+'".  '+r)}function r(e){ie(!Array.isArray(f),"must not specify an array type for uniform"),t("typeof "+f+'==="'+e+'"',"invalid type, expected "+e)}function i(n,r){Array.isArray(f)?ie(f.length===n,"must have length "+n):t(u.isArrayLike+"("+f+")&&"+f+".length==="+n,"invalid vector, should have length "+n,e.commandStr)}function a(n){ie(!Array.isArray(f),"must not specify a value type"),t("typeof "+f+'==="function"&&'+f+'._reglType==="texture'+(n===Bo?"2d":"Cube")+'"',"invalid texture type",e.commandStr)}switch(d){case ts:r("number");break;case ns:i(2,"number");break;case rs:i(3,"number");break;case is:i(4,"number");break;case Qo:r("number");break;case Jo:i(2,"number");break;case $o:i(3,"number");break;case es:i(4,"number");break;case as:r("boolean");break;case os:i(2,"boolean");break;case ss:i(3,"boolean");break;case us:i(4,"boolean");break;case ls:i(4,"number");break;case cs:i(9,"number");break;case fs:i(16,"number");break;case hs:a(Bo);break;case ps:a(Uo);break}}));var S=1;switch(d){case hs:case ps:var w=n.def(f,"._texture");n(l,".uniform1i(",m,",",w,".bind());"),n.exit(w,".unbind();");continue;case ts:case as:s="1i";break;case ns:case os:s="2i",S=2;break;case rs:case ss:s="3i",S=3;break;case is:case us:s="4i",S=4;break;case Qo:s="1f";break;case Jo:s="2f",S=2;break;case $o:s="3f",S=3;break;case es:s="4f",S=4;break;case ls:s="Matrix2fv";break;case cs:s="Matrix3fv";break;case fs:s="Matrix4fv";break}if("M"===s.charAt(0)){n(l,".uniform",s,"(",m,",");var C=Math.pow(d-ls+2,2),k=e.global.def("new Float32Array(",C,")");Array.isArray(f)?n("false,(",Me(C,(function(e){return k+"["+e+"]="+f[e]})),",",k,")"):n("false,(Array.isArray(",f,")||",f," instanceof Float32Array)?",f,":(",Me(C,(function(e){return k+"["+e+"]="+f+"["+e+"]"})),",",k,")"),n(");")}else if(S>1){for(var A=[],E=[],T=0;T<S;++T)Array.isArray(f)?E.push(f[T]):E.push(n.def(f+"["+T+"]")),o&&A.push(n.def());o&&n("if(!",e.batchId,"||",A.map((function(e,t){return e+"!=="+E[t]})).join("||"),"){",A.map((function(e,t){return e+"="+E[t]+";"})).join("")),n(l,".uniform",s,"(",m,",",E.join(","),");"),o&&n("}")}else{if(ie(!Array.isArray(f),"uniform value must not be an array"),o){var M=n.def();n("if(!",e.batchId,"||",M,"!==",f,"){",M,"=",f,";")}n(l,".uniform",s,"(",m,",",f,");"),o&&n("}")}}}function J(e,t,n,r){var i=e.shared,a=i.gl,o=i.draw,s=r.draw;function u(){var u,l=s.elements,c=t;return l?((l.contextDep&&r.contextDynamic||l.propDep)&&(c=n),u=l.append(e,c),s.elementsActive&&c("if("+u+")"+a+".bindBuffer("+No+","+u+".buffer.buffer);")):(u=c.def(),c(u,"=",o,".",xo,";","if(",u,"){",a,".bindBuffer(",No,",",u,".buffer.buffer);}","else if(",i.vao,".currentVAO){",u,"=",e.shared.elements+".getElements("+i.vao,".currentVAO.elements);",x?"":"if("+u+")"+a+".bindBuffer("+No+","+u+".buffer.buffer);","}")),u}function l(){var i,a=s.count,u=t;return a?((a.contextDep&&r.contextDynamic||a.propDep)&&(u=n),i=a.append(e,u),ie.optional((function(){a.MISSING&&e.assert(t,"false","missing vertex count"),a.DYNAMIC&&e.assert(u,i+">=0","missing vertex count")}))):(i=u.def(o,".",So),ie.optional((function(){e.assert(u,i+">=0","missing vertex count")}))),i}var c=u();function f(i){var a=s[i];return a?a.contextDep&&r.contextDynamic||a.propDep?a.append(e,n):a.append(e,t):t.def(o,".",i)}var h,p,d=f(bo),v=f(wo),g=l();if("number"===typeof g){if(0===g)return}else n("if(",g,"){"),n.exit("}");y&&(h=f(Co),p=e.instancing);var m=c+".type",_=s.elements&&Fs(s.elements)&&!s.vaoActive;function b(){function e(){n(p,".drawElementsInstancedANGLE(",[d,g,m,v+"<<(("+m+"-"+Pa+")>>1)",h],");")}function t(){n(p,".drawArraysInstancedANGLE(",[d,v,g,h],");")}c&&"null"!==c?_?e():(n("if(",c,"){"),e(),n("}else{"),t(),n("}")):t()}function S(){function e(){n(a+".drawElements("+[d,g,m,v+"<<(("+m+"-"+Pa+")>>1)"]+");")}function t(){n(a+".drawArrays("+[d,v,g]+");")}c&&"null"!==c?_?e():(n("if(",c,"){"),e(),n("}else{"),t(),n("}")):t()}y&&("number"!==typeof h||h>=0)?"string"===typeof h?(n("if(",h,">0){"),b(),n("}else if(",h,"<0){"),S(),n("}")):b():S()}function $(e,t,n,r,i){var a=P(),o=a.proc("body",i);return ie.optional((function(){a.commandStr=t.commandStr,a.command=a.link(t.commandStr)})),y&&(a.instancing=o.def(a.shared.extensions,".angle_instanced_arrays")),e(a,o,n,r),a.compile().body}function ee(e,t,n,r){Z(e,t),n.useVAO?n.drawVAO?t(e.shared.vao,".setVAO(",n.drawVAO.append(e,t),");"):t(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(t(e.shared.vao,".setVAO(null);"),X(e,t,n,r.attributes,(function(){return!0}))),Q(e,t,n,r.uniforms,(function(){return!0}),!1),J(e,t,t,n)}function te(e,t){var n=e.proc("draw",1);Z(e,n),H(e,n,t.context),W(e,n,t.framebuffer),Y(e,n,t),q(e,n,t.state),K(e,n,t,!1,!0);var r=t.shader.progVar.append(e,n);if(n(e.shared.gl,".useProgram(",r,".program);"),t.shader.program)ee(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var i=e.global.def("{}"),a=n.def(r,".id"),o=n.def(i,"[",a,"]");n(e.cond(o).then(o,".call(this,a0);").else(o,"=",i,"[",a,"]=",e.link((function(n){return $(ee,e,t,n,1)})),"(",r,");",o,".call(this,a0);"))}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;"),e.shared.vao&&n(e.shared.vao,".setVAO(null);")}function ne(e,t,n,r){function i(){return!0}e.batchId="a1",Z(e,t),X(e,t,n,r.attributes,i),Q(e,t,n,r.uniforms,i,!1),J(e,t,t,n)}function re(e,t,n,r){Z(e,t);var i=n.contextDep,a=t.def(),o="a0",s="a1",u=t.def();e.shared.props=u,e.batchId=a;var l=e.scope(),c=e.scope();function f(e){return e.contextDep&&i||e.propDep}function h(e){return!f(e)}if(t(l.entry,"for(",a,"=0;",a,"<",s,";++",a,"){",u,"=",o,"[",a,"];",c,"}",l.exit),n.needsContext&&H(e,c,n.context),n.needsFramebuffer&&W(e,c,n.framebuffer),q(e,c,n.state,f),n.profile&&f(n.profile)&&K(e,c,n,!1,!0),r)n.useVAO?n.drawVAO?f(n.drawVAO)?c(e.shared.vao,".setVAO(",n.drawVAO.append(e,c),");"):l(e.shared.vao,".setVAO(",n.drawVAO.append(e,l),");"):l(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(l(e.shared.vao,".setVAO(null);"),X(e,l,n,r.attributes,h),X(e,c,n,r.attributes,f)),Q(e,l,n,r.uniforms,h,!1),Q(e,c,n,r.uniforms,f,!0),J(e,l,c,n);else{var p=e.global.def("{}"),d=n.shader.progVar.append(e,c),v=c.def(d,".id"),g=c.def(p,"[",v,"]");c(e.shared.gl,".useProgram(",d,".program);","if(!",g,"){",g,"=",p,"[",v,"]=",e.link((function(t){return $(ne,e,n,t,2)})),"(",d,");}",g,".call(this,a0[",a,"],",a,");")}}function ae(e,t){var n=e.proc("batch",2);e.batchId="0",Z(e,n);var r=!1,i=!0;Object.keys(t.context).forEach((function(e){r=r||t.context[e].propDep})),r||(H(e,n,t.context),i=!1);var a=t.framebuffer,o=!1;function s(e){return e.contextDep&&r||e.propDep}a?(a.propDep?r=o=!0:a.contextDep&&r&&(o=!0),o||W(e,n,a)):W(e,n,null),t.state.viewport&&t.state.viewport.propDep&&(r=!0),Y(e,n,t),q(e,n,t.state,(function(e){return!s(e)})),t.profile&&s(t.profile)||K(e,n,t,!1,"a1"),t.contextDep=r,t.needsContext=i,t.needsFramebuffer=o;var u=t.shader.progVar;if(u.contextDep&&r||u.propDep)re(e,n,t,null);else{var l=u.append(e,n);if(n(e.shared.gl,".useProgram(",l,".program);"),t.shader.program)re(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var c=e.global.def("{}"),f=n.def(l,".id"),h=n.def(c,"[",f,"]");n(e.cond(h).then(h,".call(this,a0,a1);").else(h,"=",c,"[",f,"]=",e.link((function(n){return $(re,e,t,n,2)})),"(",l,");",h,".call(this,a0,a1);"))}}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;"),e.shared.vao&&n(e.shared.vao,".setVAO(null);")}function oe(e,n){var r=e.proc("scope",3);e.batchId="a2";var i=e.shared,a=i.current;function o(t){var a=n.shader[t];a&&r.set(i.shader,"."+t,a.append(e,r))}H(e,r,n.context),n.framebuffer&&n.framebuffer.append(e,r),zs(Object.keys(n.state)).forEach((function(t){var a=n.state[t],o=a.append(e,r);On(o)?o.forEach((function(n,i){r.set(e.next[t],"["+i+"]",n)})):r.set(i.next,"."+t,o)})),K(e,r,n,!0,!0),[xo,wo,So,Co,bo].forEach((function(t){var a=n.draw[t];a&&r.set(i.draw,"."+t,""+a.append(e,r))})),Object.keys(n.uniforms).forEach((function(a){var o=n.uniforms[a].append(e,r);Array.isArray(o)&&(o="["+o.join()+"]"),r.set(i.uniforms,"["+t.id(a)+"]",o)})),Object.keys(n.attributes).forEach((function(t){var i=n.attributes[t].append(e,r),a=e.scopeAttrib(t);Object.keys(new g).forEach((function(e){r.set(a,"."+e,i[e])}))})),n.scopeVAO&&r.set(i.vao,".targetVAO",n.scopeVAO.append(e,r)),o(yo),o(_o),Object.keys(n.state).length>0&&(r(a,".dirty=true;"),r.exit(a,".dirty=true;")),r("a1(",e.shared.context,",a0,",e.batchId,");")}function se(e){if("object"===typeof e&&!On(e)){for(var t=Object.keys(e),n=0;n<t.length;++n)if(ge.isDynamic(e[t[n]]))return!0;return!1}}function ue(e,t,n){var r=t.static[n];if(r&&se(r)){var i=e.global,a=Object.keys(r),o=!1,s=!1,u=!1,l=e.global.def("{}");a.forEach((function(t){var n=r[t];if(ge.isDynamic(n)){"function"===typeof n&&(n=r[t]=ge.unbox(n));var a=Bs(n,null);o=o||a.thisDep,u=u||a.propDep,s=s||a.contextDep}else{switch(i(l,".",t,"="),typeof n){case"number":i(n);break;case"string":i('"',n,'"');break;case"object":Array.isArray(n)&&i("[",n.join(),"]");break;default:i(e.link(n));break}i(";")}})),t.dynamic[n]=new ge.DynamicVariable(ja,{thisDep:o,contextDep:s,propDep:u,ref:l,append:c}),delete t.static[n]}function c(e,t){a.forEach((function(n){var i=r[n];if(ge.isDynamic(i)){var a=e.invoke(t,i);t(l,".",n,"=",a,";")}}))}}function le(e,t,r,i,a){var o=P();o.stats=o.link(a),Object.keys(t.static).forEach((function(e){ue(o,t,e)})),Do.forEach((function(t){ue(o,e,t)}));var s=G(e,t,r,i,o);return te(o,s),oe(o,s),ae(o,s),n(o.compile(),{destroy:function(){s.shader.program.destroy()}})}return{next:S,current:b,procs:function(){var e=P(),t=e.proc("poll"),n=e.proc("refresh"),a=e.block();t(a),n(a);var o,s=e.shared,u=s.gl,l=s.next,c=s.current;a(c,".dirty=false;"),W(e,t),W(e,n,null,!0),y&&(o=e.link(y)),r.oes_vertex_array_object&&n(e.link(r.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var f=0;f<i.maxAttributes;++f){var h=n.def(s.attributes,"[",f,"]"),p=e.cond(h,".buffer");p.then(u,".enableVertexAttribArray(",f,");",u,".bindBuffer(",zo,",",h,".buffer.buffer);",u,".vertexAttribPointer(",f,",",h,".size,",h,".type,",h,".normalized,",h,".stride,",h,".offset);").else(u,".disableVertexAttribArray(",f,");",u,".vertexAttrib4f(",f,",",h,".x,",h,".y,",h,".z,",h,".w);",h,".buffer=null;"),n(p),y&&n(o,".vertexAttribDivisorANGLE(",f,",",h,".divisor);")}return n(e.shared.vao,".currentVAO=null;",e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"),Object.keys(C).forEach((function(r){var i=C[r],o=a.def(l,".",r),s=e.block();s("if(",o,"){",u,".enable(",i,")}else{",u,".disable(",i,")}",c,".",r,"=",o,";"),n(s),t("if(",o,"!==",c,".",r,"){",s,"}")})),Object.keys(k).forEach((function(r){var i,o,s=k[r],f=b[r],h=e.block();if(h(u,".",s,"("),On(f)){var p=f.length;i=e.global.def(l,".",r),o=e.global.def(c,".",r),h(Me(p,(function(e){return i+"["+e+"]"})),");",Me(p,(function(e){return o+"["+e+"]="+i+"["+e+"];"})).join("")),t("if(",Me(p,(function(e){return i+"["+e+"]!=="+o+"["+e+"]"})).join("||"),"){",h,"}")}else i=a.def(l,".",r),o=a.def(c,".",r),h(i,");",c,".",r,"=",i,";"),t("if(",i,"!==",o,"){",h,"}");n(h)})),e.compile()}(),compile:le}}function Gs(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Hs=34918,Ws=34919,Ys=35007,qs=function(e,t){if(!t.ext_disjoint_timer_query)return null;var n=[];function r(){return n.pop()||t.ext_disjoint_timer_query.createQueryEXT()}function i(e){n.push(e)}var a=[];function o(e){var n=r();t.ext_disjoint_timer_query.beginQueryEXT(Ys,n),a.push(n),p(a.length-1,a.length,e)}function s(){t.ext_disjoint_timer_query.endQueryEXT(Ys)}function u(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var l=[];function c(){return l.pop()||new u}function f(e){l.push(e)}var h=[];function p(e,t,n){var r=c();r.startQueryIndex=e,r.endQueryIndex=t,r.sum=0,r.stats=n,h.push(r)}var d=[],v=[];function g(){var e,n,r=a.length;if(0!==r){v.length=Math.max(v.length,r+1),d.length=Math.max(d.length,r+1),d[0]=0,v[0]=0;var o=0;for(e=0,n=0;n<a.length;++n){var s=a[n];t.ext_disjoint_timer_query.getQueryObjectEXT(s,Ws)?(o+=t.ext_disjoint_timer_query.getQueryObjectEXT(s,Hs),i(s)):a[e++]=s,d[n+1]=o,v[n+1]=e}for(a.length=e,e=0,n=0;n<h.length;++n){var u=h[n],l=u.startQueryIndex,c=u.endQueryIndex;u.sum+=d[c]-d[l];var p=v[l],g=v[c];g===p?(u.stats.gpuTime+=u.sum/1e6,f(u)):(u.startQueryIndex=p,u.endQueryIndex=g,h[e++]=u)}h.length=e}}return{beginQuery:o,endQuery:s,pushScopeStats:p,update:g,getNumPendingQueries:function(){return a.length},clear:function(){n.push.apply(n,a);for(var e=0;e<n.length;e++)t.ext_disjoint_timer_query.deleteQueryEXT(n[e]);a.length=0,n.length=0},restore:function(){a.length=0,n.length=0}}},Zs=16384,Ks=256,Xs=1024,Qs=34962,Js="webglcontextlost",$s="webglcontextrestored",eu=1,tu=2,nu=3;function ru(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}function iu(e){var t=Ee(e);if(!t)return null;var r=t.gl,i=r.getContextAttributes(),a=r.isContextLost(),o=Te(r,t);if(!o)return null;var s=xe(),u=Gs(),l=o.extensions,c=qs(r,l),f=_e(),h=r.drawingBufferWidth,p=r.drawingBufferHeight,d={tick:0,time:0,viewportWidth:h,viewportHeight:p,framebufferWidth:h,framebufferHeight:p,drawingBufferWidth:h,drawingBufferHeight:p,pixelRatio:t.pixelRatio},v={},g={elements:null,primitive:4,count:-1,offset:0,instances:-1},m=kt(r,l),y=an(r,u,t,b),_=kn(r,l,y,u),x=ma(r,l,m,u,y,_,g);function b(e){return x.destroyBuffer(e)}var S=Sa(r,s,u,t),w=gi(r,l,m,(function(){A.procs.poll()}),d,u,t),C=Oi(r,l,m,u,t),k=fa(r,l,m,w,C,u),A=Vs(r,s,l,m,y,_,w,k,v,x,S,g,d,c,t),E=Ea(r,k,A.procs.poll,d,i,l,m),T=A.next,M=r.canvas,O=[],L=[],P=[],R=[t.onDestroy],I=null;function D(){if(0===O.length)return c&&c.update(),void(I=null);I=me.next(D),Z();for(var e=O.length-1;e>=0;--e){var t=O[e];t&&t(d,null,0)}r.flush(),c&&c.update()}function z(){!I&&O.length>0&&(I=me.next(D))}function N(){I&&(me.cancel(D),I=null)}function F(e){e.preventDefault(),a=!0,N(),L.forEach((function(e){e()}))}function j(e){r.getError(),a=!1,o.restore(),S.restore(),y.restore(),w.restore(),C.restore(),k.restore(),x.restore(),c&&c.restore(),A.procs.refresh(),z(),P.forEach((function(e){e()}))}var B="undefined"!==typeof my&&!!my&&"function"===typeof my.showToast&&!0!==my.isFRM;function U(){O.length=0,N(),!B&&M&&(M.removeEventListener(Js,F),M.removeEventListener($s,j)),S.clear(),k.clear(),C.clear(),x.clear(),w.clear(),_.clear(),y.clear(),c&&c.clear(),R.forEach((function(e){e()}))}function V(e){function t(e){var t=n({},e);function r(e){if(e in t){var n=t[e];delete t[e],Object.keys(n).forEach((function(r){t[e+"."+r]=n[r]}))}}return delete t.uniforms,delete t.attributes,delete t.context,delete t.vao,"stencil"in t&&t.stencil.op&&(t.stencil.opBack=t.stencil.opFront=t.stencil.op,delete t.stencil.op),r("blend"),r("depth"),r("cull"),r("stencil"),r("polygonOffset"),r("scissor"),r("sample"),"vao"in e&&(t.vao=e.vao),t}function r(e,t){var n={},r={};return Object.keys(e).forEach((function(i){var a=e[i];if(ge.isDynamic(a))r[i]=ge.unbox(a,i);else{if(t&&Array.isArray(a))for(var o=0;o<a.length;++o)if(ge.isDynamic(a[o]))return void(r[i]=ge.unbox(a,i));n[i]=a}})),{dynamic:r,static:n}}ie(!!e,"invalid args to regl({...})"),ie.type(e,"object","invalid args to regl({...})");var i=r(e.context||{},!0),o=r(e.uniforms||{},!0),s=r(e.attributes||{},!1),u=r(t(e),!1),l={gpuTime:0,cpuTime:0,count:0},c=A.compile(u,s,o,i,l),f=c.draw,h=c.batch,p=c.scope,d=[];function v(e){while(d.length<e)d.push(null);return d}function g(e,t){var n;if(a&&ie.raise("context lost"),"function"===typeof e)return p.call(this,null,e,0);if("function"===typeof t)if("number"===typeof e)for(n=0;n<e;++n)p.call(this,null,t,n);else{if(!Array.isArray(e))return p.call(this,e,t,0);for(n=0;n<e.length;++n)p.call(this,e[n],t,n)}else if("number"===typeof e){if(e>0)return h.call(this,v(0|e),0|e)}else{if(!Array.isArray(e))return f.call(this,e);if(e.length)return h.call(this,e,e.length)}}return n(g,{stats:l,destroy:function(){c.destroy()}})}!B&&M&&(M.addEventListener(Js,F,!1),M.addEventListener($s,j,!1));var G=k.setFBO=V({framebuffer:ge.define.call(null,eu,"framebuffer")});function H(e,t){var n=0;A.procs.poll();var i=t.color;i&&(r.clearColor(+i[0]||0,+i[1]||0,+i[2]||0,+i[3]||0),n|=Zs),"depth"in t&&(r.clearDepth(+t.depth),n|=Ks),"stencil"in t&&(r.clearStencil(0|t.stencil),n|=Xs),ie(!!n,"called regl.clear with no buffer specified"),r.clear(n)}function W(e){if(ie("object"===typeof e&&e,"regl.clear() takes an object as input"),"framebuffer"in e)if(e.framebuffer&&"framebufferCube"===e.framebuffer_reglType)for(var t=0;t<6;++t)G(n({framebuffer:e.framebuffer.faces[t]},e),H);else G(e,H);else H(null,e)}function Y(e){function t(){var t=ru(O,e);function n(){var e=ru(O,n);O[e]=O[O.length-1],O.length-=1,O.length<=0&&N()}ie(t>=0,"cannot cancel a frame twice"),O[t]=n}return ie.type(e,"function","regl.frame() callback must be a function"),O.push(e),z(),{cancel:t}}function q(){var e=T.viewport,t=T.scissor_box;e[0]=e[1]=t[0]=t[1]=0,d.viewportWidth=d.framebufferWidth=d.drawingBufferWidth=e[2]=t[2]=r.drawingBufferWidth,d.viewportHeight=d.framebufferHeight=d.drawingBufferHeight=e[3]=t[3]=r.drawingBufferHeight}function Z(){d.tick+=1,d.time=X(),q(),A.procs.poll()}function K(){w.refresh(),q(),A.procs.refresh(),c&&c.update()}function X(){return(_e()-f)/1e3}function Q(e,t){var n;switch(ie.type(t,"function","listener callback must be a function"),e){case"frame":return Y(t);case"lost":n=L;break;case"restore":n=P;break;case"destroy":n=R;break;default:ie.raise("invalid event, must be one of frame,lost,restore,destroy")}return n.push(t),{cancel:function(){for(var e=0;e<n.length;++e)if(n[e]===t)return n[e]=n[n.length-1],void n.pop()}}}K();var J=n(V,{clear:W,prop:ge.define.bind(null,eu),context:ge.define.bind(null,tu),this:ge.define.bind(null,nu),draw:V({}),buffer:function(e){return y.create(e,Qs,!1,!1)},elements:function(e){return _.create(e,!1)},texture:w.create2D,cube:w.createCube,renderbuffer:C.create,framebuffer:k.create,framebufferCube:k.createCube,vao:x.createVAO,attributes:i,frame:Y,on:Q,limits:m,hasExtension:function(e){return m.extensions.indexOf(e.toLowerCase())>=0},read:E,destroy:U,_gl:r,_refresh:K,poll:function(){Z(),c&&c.update()},now:X,stats:u});return t.onDone(null,J),J}return iu}))},76642:function(e,t,n){"use strict";e.exports=i;var r=n(62333);function i(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}i.Varint=0,i.Fixed64=1,i.Bytes=2,i.Fixed32=5;var a=4294967296,o=1/a,s=12,u="undefined"===typeof TextDecoder?null:new TextDecoder("utf8");function l(e,t,n){var r,i,a=n.buf;if(i=a[n.pos++],r=(112&i)>>4,i<128)return f(e,r,t);if(i=a[n.pos++],r|=(127&i)<<3,i<128)return f(e,r,t);if(i=a[n.pos++],r|=(127&i)<<10,i<128)return f(e,r,t);if(i=a[n.pos++],r|=(127&i)<<17,i<128)return f(e,r,t);if(i=a[n.pos++],r|=(127&i)<<24,i<128)return f(e,r,t);if(i=a[n.pos++],r|=(1&i)<<31,i<128)return f(e,r,t);throw new Error("Expected varint not more than 10 bytes")}function c(e){return e.type===i.Bytes?e.readVarint()+e.pos:e.pos+1}function f(e,t,n){return n?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function h(e,t){var n,r;if(e>=0?(n=e%4294967296|0,r=e/4294967296|0):(n=~(-e%4294967296),r=~(-e/4294967296),4294967295^n?n=n+1|0:(n=0,r=r+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),p(n,r,t),d(r,t)}function p(e,t,n){n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos]=127&e}function d(e,t){var n=(7&e)<<4;t.buf[t.pos++]|=n|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}function v(e,t,n){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(r);for(var i=n.pos-1;i>=e;i--)n.buf[i+r]=n.buf[i]}function g(e,t){for(var n=0;n<e.length;n++)t.writeVarint(e[n])}function m(e,t){for(var n=0;n<e.length;n++)t.writeSVarint(e[n])}function y(e,t){for(var n=0;n<e.length;n++)t.writeFloat(e[n])}function _(e,t){for(var n=0;n<e.length;n++)t.writeDouble(e[n])}function x(e,t){for(var n=0;n<e.length;n++)t.writeBoolean(e[n])}function b(e,t){for(var n=0;n<e.length;n++)t.writeFixed32(e[n])}function S(e,t){for(var n=0;n<e.length;n++)t.writeSFixed32(e[n])}function w(e,t){for(var n=0;n<e.length;n++)t.writeFixed64(e[n])}function C(e,t){for(var n=0;n<e.length;n++)t.writeSFixed64(e[n])}function k(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function A(e,t,n){e[n]=t,e[n+1]=t>>>8,e[n+2]=t>>>16,e[n+3]=t>>>24}function E(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function T(e,t,n){var r="",i=t;while(i<n){var a,o,s,u=e[i],l=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c>n)break;1===c?u<128&&(l=u):2===c?(a=e[i+1],128===(192&a)&&(l=(31&u)<<6|63&a,l<=127&&(l=null))):3===c?(a=e[i+1],o=e[i+2],128===(192&a)&&128===(192&o)&&(l=(15&u)<<12|(63&a)<<6|63&o,(l<=2047||l>=55296&&l<=57343)&&(l=null))):4===c&&(a=e[i+1],o=e[i+2],s=e[i+3],128===(192&a)&&128===(192&o)&&128===(192&s)&&(l=(15&u)<<18|(63&a)<<12|(63&o)<<6|63&s,(l<=65535||l>=1114112)&&(l=null))),null===l?(l=65533,c=1):l>65535&&(l-=65536,r+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),r+=String.fromCharCode(l),i+=c}return r}function M(e,t,n){return u.decode(e.subarray(t,n))}function O(e,t,n){for(var r,i,a=0;a<t.length;a++){if(r=t.charCodeAt(a),r>55295&&r<57344){if(!i){r>56319||a+1===t.length?(e[n++]=239,e[n++]=191,e[n++]=189):i=r;continue}if(r<56320){e[n++]=239,e[n++]=191,e[n++]=189,i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&(e[n++]=239,e[n++]=191,e[n++]=189,i=null);r<128?e[n++]=r:(r<2048?e[n++]=r>>6|192:(r<65536?e[n++]=r>>12|224:(e[n++]=r>>18|240,e[n++]=r>>12&63|128),e[n++]=r>>6&63|128),e[n++]=63&r|128)}return n}i.prototype={destroy:function(){this.buf=null},readFields:function(e,t,n){n=n||this.length;while(this.pos<n){var r=this.readVarint(),i=r>>3,a=this.pos;this.type=7&r,e(i,t,this),this.pos===a&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=k(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=E(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=k(this.buf,this.pos)+k(this.buf,this.pos+4)*a;return this.pos+=8,e},readSFixed64:function(){var e=k(this.buf,this.pos)+E(this.buf,this.pos+4)*a;return this.pos+=8,e},readFloat:function(){var e=r.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=r.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,n,r=this.buf;return n=r[this.pos++],t=127&n,n<128?t:(n=r[this.pos++],t|=(127&n)<<7,n<128?t:(n=r[this.pos++],t|=(127&n)<<14,n<128?t:(n=r[this.pos++],t|=(127&n)<<21,n<128?t:(n=r[this.pos],t|=(15&n)<<28,l(t,e,this)))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2===1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=s&&u?M(this.buf,t,e):T(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==i.Bytes)return e.push(this.readVarint(t));var n=c(this);e=e||[];while(this.pos<n)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==i.Bytes)return e.push(this.readSVarint());var t=c(this);e=e||[];while(this.pos<t)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==i.Bytes)return e.push(this.readBoolean());var t=c(this);e=e||[];while(this.pos<t)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==i.Bytes)return e.push(this.readFloat());var t=c(this);e=e||[];while(this.pos<t)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==i.Bytes)return e.push(this.readDouble());var t=c(this);e=e||[];while(this.pos<t)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==i.Bytes)return e.push(this.readFixed32());var t=c(this);e=e||[];while(this.pos<t)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==i.Bytes)return e.push(this.readSFixed32());var t=c(this);e=e||[];while(this.pos<t)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==i.Bytes)return e.push(this.readFixed64());var t=c(this);e=e||[];while(this.pos<t)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==i.Bytes)return e.push(this.readSFixed64());var t=c(this);e=e||[];while(this.pos<t)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===i.Varint)while(this.buf[this.pos++]>127);else if(t===i.Bytes)this.pos=this.readVarint()+this.pos;else if(t===i.Fixed32)this.pos+=4;else{if(t!==i.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){var t=this.length||16;while(t<this.pos+e)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),A(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),A(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),A(this.buf,-1&e,this.pos),A(this.buf,Math.floor(e*o),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),A(this.buf,-1&e,this.pos),A(this.buf,Math.floor(e*o),this.pos+4),this.pos+=8},writeVarint:function(e){e=+e||0,e>268435455||e<0?h(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=O(this.buf,e,this.pos);var n=this.pos-t;n>=128&&v(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(e){this.realloc(4),r.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),r.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=e[n]},writeRawMessage:function(e,t){this.pos++;var n=this.pos;e(t,this);var r=this.pos-n;r>=128&&v(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,t,n){this.writeTag(e,i.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,g,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,m,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,x,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,y,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,_,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,b,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,S,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,w,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,C,t)},writeBytesField:function(e,t){this.writeTag(e,i.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,i.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,i.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,i.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,i.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,i.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,i.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,i.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,i.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,i.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}}},12888:function(e,t,n){var r=n(34406);(function(t,n){e.exports=n()})(0,(function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}var i=function(){function e(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return e}();function a(e,t){return e>t?1:e<t?-1:0}function o(e,t,n){var r=new i(null,null),a=r,o=r;while(1){var s=n(e,t.key);if(s<0){if(null===t.left)break;if(n(e,t.left.key)<0){var u=t.left;if(t.left=u.right,u.right=t,t=u,null===t.left)break}o.left=t,o=t,t=t.left}else{if(!(s>0))break;if(null===t.right)break;if(n(e,t.right.key)>0){u=t.right;if(t.right=u.left,u.left=t,t=u,null===t.right)break}a.right=t,a=t,t=t.right}}return a.right=t.left,o.left=t.right,t.left=r.right,t.right=r.left,t}function s(e,t,n,r){var a=new i(e,t);if(null===n)return a.left=a.right=null,a;n=o(e,n,r);var s=r(e,n.key);return s<0?(a.left=n.left,a.right=n,n.left=null):s>=0&&(a.right=n.right,a.left=n,n.right=null),a}function u(e,t,n){var r=null,i=null;if(t){t=o(e,t,n);var a=n(t.key,e);0===a?(r=t.left,i=t.right):a<0?(i=t.right,t.right=null,r=t):(r=t.left,t.left=null,i=t)}return{left:r,right:i}}function l(e,t,n){return null===t?e:(null===e||(t=o(e.key,t,n),t.left=e),t)}function c(e,t,n,r,i){if(e){r(t+(n?"\u2514\u2500\u2500 ":"\u251c\u2500\u2500 ")+i(e)+"\n");var a=t+(n?"    ":"\u2502   ");e.left&&c(e.left,a,!1,r,i),e.right&&c(e.right,a,!0,r,i)}}var f=function(){function e(e){void 0===e&&(e=a),this._root=null,this._size=0,this._comparator=e}return e.prototype.insert=function(e,t){return this._size++,this._root=s(e,t,this._root,this._comparator)},e.prototype.add=function(e,t){var n=new i(e,t);null===this._root&&(n.left=n.right=null,this._size++,this._root=n);var r=this._comparator,a=o(e,this._root,r),s=r(e,a.key);return 0===s?this._root=a:(s<0?(n.left=a.left,n.right=a,a.left=null):s>0&&(n.right=a.right,n.left=a,a.right=null),this._size++,this._root=n),this._root},e.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},e.prototype._remove=function(e,t,n){var r;if(null===t)return null;t=o(e,t,n);var i=n(e,t.key);return 0===i?(null===t.left?r=t.right:(r=o(e,t.left,n),r.right=t.right),this._size--,r):t},e.prototype.pop=function(){var e=this._root;if(e){while(e.left)e=e.left;return this._root=o(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},e.prototype.findStatic=function(e){var t=this._root,n=this._comparator;while(t){var r=n(e,t.key);if(0===r)return t;t=r<0?t.left:t.right}return null},e.prototype.find=function(e){return this._root&&(this._root=o(e,this._root,this._comparator),0!==this._comparator(e,this._root.key))?null:this._root},e.prototype.contains=function(e){var t=this._root,n=this._comparator;while(t){var r=n(e,t.key);if(0===r)return!0;t=r<0?t.left:t.right}return!1},e.prototype.forEach=function(e,t){var n=this._root,r=[],i=!1;while(!i)null!==n?(r.push(n),n=n.left):0!==r.length?(n=r.pop(),e.call(t,n),n=n.right):i=!0;return this},e.prototype.range=function(e,t,n,r){var i,a=[],o=this._comparator,s=this._root;while(0!==a.length||s)if(s)a.push(s),s=s.left;else{if(s=a.pop(),i=o(s.key,t),i>0)break;if(o(s.key,e)>=0&&n.call(r,s))return this;s=s.right}return this},e.prototype.keys=function(){var e=[];return this.forEach((function(t){var n=t.key;return e.push(n)})),e},e.prototype.values=function(){var e=[];return this.forEach((function(t){var n=t.data;return e.push(n)})),e},e.prototype.min=function(){return this._root?this.minNode(this._root).key:null},e.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},e.prototype.minNode=function(e){if(void 0===e&&(e=this._root),e)while(e.left)e=e.left;return e},e.prototype.maxNode=function(e){if(void 0===e&&(e=this._root),e)while(e.right)e=e.right;return e},e.prototype.at=function(e){var t=this._root,n=!1,r=0,i=[];while(!n)if(t)i.push(t),t=t.left;else if(i.length>0){if(t=i.pop(),r===e)return t;r++,t=t.right}else n=!0;return null},e.prototype.next=function(e){var t=this._root,n=null;if(e.right){n=e.right;while(n.left)n=n.left;return n}var r=this._comparator;while(t){var i=r(e.key,t.key);if(0===i)break;i<0?(n=t,t=t.left):t=t.right}return n},e.prototype.prev=function(e){var t=this._root,n=null;if(null!==e.left){n=e.left;while(n.right)n=n.right;return n}var r=this._comparator;while(t){var i=r(e.key,t.key);if(0===i)break;i<0?t=t.left:(n=t,t=t.right)}return n},e.prototype.clear=function(){return this._root=null,this._size=0,this},e.prototype.toList=function(){return d(this._root)},e.prototype.load=function(e,t,n){void 0===t&&(t=[]),void 0===n&&(n=!1);var r=e.length,i=this._comparator;if(n&&m(e,t,0,r-1,i),null===this._root)this._root=h(e,t,0,r),this._size=r;else{var a=g(this.toList(),p(e,t),i);r=this._size+r,this._root=v({head:a},0,r)}return this},e.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),e.prototype.toString=function(e){void 0===e&&(e=function(e){return String(e.key)});var t=[];return c(this._root,"",!0,(function(e){return t.push(e)}),e),t.join("")},e.prototype.update=function(e,t,n){var r=this._comparator,i=u(e,this._root,r),a=i.left,o=i.right;r(e,t)<0?o=s(t,n,o,r):a=s(t,n,a,r),this._root=l(a,o,r)},e.prototype.split=function(e){return u(e,this._root,this._comparator)},e}();function h(e,t,n,r){var a=r-n;if(a>0){var o=n+Math.floor(a/2),s=e[o],u=t[o],l=new i(s,u);return l.left=h(e,t,n,o),l.right=h(e,t,o+1,r),l}return null}function p(e,t){for(var n=new i(null,null),r=n,a=0;a<e.length;a++)r=r.next=new i(e[a],t[a]);return r.next=null,n.next}function d(e){var t=e,n=[],r=!1,a=new i(null,null),o=a;while(!r)t?(n.push(t),t=t.left):n.length>0?(t=o=o.next=n.pop(),t=t.right):r=!0;return o.next=null,a.next}function v(e,t,n){var r=n-t;if(r>0){var i=t+Math.floor(r/2),a=v(e,t,i),o=e.head;return o.left=a,e.head=e.head.next,o.right=v(e,i+1,n),o}return null}function g(e,t,n){var r=new i(null,null),a=r,o=e,s=t;while(null!==o&&null!==s)n(o.key,s.key)<0?(a.next=o,o=o.next):(a.next=s,s=s.next),a=a.next;return null!==o?a.next=o:null!==s&&(a.next=s),r.next}function m(e,t,n,r,i){if(!(n>=r)){var a=e[n+r>>1],o=n-1,s=r+1;while(1){do{o++}while(i(e[o],a)<0);do{s--}while(i(e[s],a)>0);if(o>=s)break;var u=e[o];e[o]=e[s],e[s]=u,u=t[o],t[o]=t[s],t[s]=u}m(e,t,n,s,i),m(e,t,s+1,r,i)}}var y=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},_=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,r=e.ur.x<t.ur.x?e.ur.x:t.ur.x,i=e.ll.y<t.ll.y?t.ll.y:e.ll.y,a=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:i},ur:{x:r,y:a}}},x=Number.EPSILON;void 0===x&&(x=Math.pow(2,-52));var b=x*x,S=function(e,t){if(-x<e&&e<x&&-x<t&&t<x)return 0;var n=e-t;return n*n<b*e*t?0:e<t?-1:1},w=function(){function t(){e(this,t),this.reset()}return n(t,[{key:"reset",value:function(){this.xRounder=new C,this.yRounder=new C}},{key:"round",value:function(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}]),t}(),C=function(){function t(){e(this,t),this.tree=new f,this.round(0)}return n(t,[{key:"round",value:function(e){var t=this.tree.add(e),n=this.tree.prev(t);if(null!==n&&0===S(t.key,n.key))return this.tree.remove(e),n.key;var r=this.tree.next(t);return null!==r&&0===S(t.key,r.key)?(this.tree.remove(e),r.key):e}}]),t}(),k=new w,A=function(e,t){return e.x*t.y-e.y*t.x},E=function(e,t){return e.x*t.x+e.y*t.y},T=function(e,t,n){var r={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y},a=A(r,i);return S(a,0)},M=function(e){return Math.sqrt(E(e,e))},O=function(e,t,n){var r={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y};return A(i,r)/M(i)/M(r)},L=function(e,t,n){var r={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y};return E(i,r)/M(i)/M(r)},P=function(e,t,n){return 0===t.y?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},R=function(e,t,n){return 0===t.x?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},I=function(e,t,n,r){if(0===t.x)return R(n,r,e.x);if(0===r.x)return R(e,t,n.x);if(0===t.y)return P(n,r,e.y);if(0===r.y)return P(e,t,n.y);var i=A(t,r);if(0==i)return null;var a={x:n.x-e.x,y:n.y-e.y},o=A(a,t)/i,s=A(a,r)/i,u=e.x+s*t.x,l=n.x+o*r.x,c=e.y+s*t.y,f=n.y+o*r.y,h=(u+l)/2,p=(c+f)/2;return{x:h,y:p}},D=function(){function t(n,r){e(this,t),void 0===n.events?n.events=[this]:n.events.push(this),this.point=n,this.isLeft=r}return n(t,null,[{key:"compare",value:function(e,n){var r=t.comparePoints(e.point,n.point);return 0!==r?r:(e.point!==n.point&&e.link(n),e.isLeft!==n.isLeft?e.isLeft?1:-1:N.compare(e.segment,n.segment))}},{key:"comparePoints",value:function(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}}]),n(t,[{key:"link",value:function(e){if(e.point===this.point)throw new Error("Tried to link already linked events");for(var t=e.point.events,n=0,r=t.length;n<r;n++){var i=t[n];this.point.events.push(i),i.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var e=this.point.events.length,t=0;t<e;t++){var n=this.point.events[t];if(void 0===n.segment.consumedBy)for(var r=t+1;r<e;r++){var i=this.point.events[r];void 0===i.consumedBy&&(n.otherSE.point.events===i.otherSE.point.events&&n.segment.consume(i.segment))}}}},{key:"getAvailableLinkedEvents",value:function(){for(var e=[],t=0,n=this.point.events.length;t<n;t++){var r=this.point.events[t];r!==this&&!r.segment.ringOut&&r.segment.isInResult()&&e.push(r)}return e}},{key:"getLeftmostComparator",value:function(e){var t=this,n=new Map,r=function(r){var i=r.otherSE;n.set(r,{sine:O(t.point,e.point,i.point),cosine:L(t.point,e.point,i.point)})};return function(e,t){n.has(e)||r(e),n.has(t)||r(t);var i=n.get(e),a=i.sine,o=i.cosine,s=n.get(t),u=s.sine,l=s.cosine;return a>=0&&u>=0?o<l?1:o>l?-1:0:a<0&&u<0?o<l?-1:o>l?1:0:u<a?-1:u>a?1:0}}}]),t}(),z=0,N=function(){function t(n,r,i,a){e(this,t),this.id=++z,this.leftSE=n,n.segment=this,n.otherSE=r,this.rightSE=r,r.segment=this,r.otherSE=n,this.rings=i,this.windings=a}return n(t,null,[{key:"compare",value:function(e,t){var n=e.leftSE.point.x,r=t.leftSE.point.x,i=e.rightSE.point.x,a=t.rightSE.point.x;if(a<n)return 1;if(i<r)return-1;var o=e.leftSE.point.y,s=t.leftSE.point.y,u=e.rightSE.point.y,l=t.rightSE.point.y;if(n<r){if(s<o&&s<u)return 1;if(s>o&&s>u)return-1;var c=e.comparePoint(t.leftSE.point);if(c<0)return 1;if(c>0)return-1;var f=t.comparePoint(e.rightSE.point);return 0!==f?f:-1}if(n>r){if(o<s&&o<l)return-1;if(o>s&&o>l)return 1;var h=t.comparePoint(e.leftSE.point);if(0!==h)return h;var p=e.comparePoint(t.rightSE.point);return p<0?1:p>0?-1:1}if(o<s)return-1;if(o>s)return 1;if(i<a){var d=t.comparePoint(e.rightSE.point);if(0!==d)return d}if(i>a){var v=e.comparePoint(t.rightSE.point);if(v<0)return 1;if(v>0)return-1}if(i!==a){var g=u-o,m=i-n,y=l-s,_=a-r;if(g>m&&y<_)return 1;if(g<m&&y>_)return-1}return i>a?1:i<a||u<l?-1:u>l?1:e.id<t.id?-1:e.id>t.id?1:0}}]),n(t,[{key:"replaceRightSE",value:function(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}},{key:"comparePoint",value:function(e){if(this.isAnEndpoint(e))return 0;var t=this.leftSE.point,n=this.rightSE.point,r=this.vector();if(t.x===n.x)return e.x===t.x?0:e.x<t.x?1:-1;var i=(e.y-t.y)/r.y,a=t.x+i*r.x;if(e.x===a)return 0;var o=(e.x-t.x)/r.x,s=t.y+o*r.y;return e.y===s?0:e.y<s?-1:1}},{key:"getIntersection",value:function(e){var t=this.bbox(),n=e.bbox(),r=_(t,n);if(null===r)return null;var i=this.leftSE.point,a=this.rightSE.point,o=e.leftSE.point,s=e.rightSE.point,u=y(t,o)&&0===this.comparePoint(o),l=y(n,i)&&0===e.comparePoint(i),c=y(t,s)&&0===this.comparePoint(s),f=y(n,a)&&0===e.comparePoint(a);if(l&&u)return f&&!c?a:!f&&c?s:null;if(l)return c&&i.x===s.x&&i.y===s.y?null:i;if(u)return f&&a.x===o.x&&a.y===o.y?null:o;if(f&&c)return null;if(f)return a;if(c)return s;var h=I(i,this.vector(),o,e.vector());return null===h?null:y(r,h)?k.round(h.x,h.y):null}},{key:"split",value:function(e){var n=[],r=void 0!==e.events,i=new D(e,!0),a=new D(e,!1),o=this.rightSE;this.replaceRightSE(a),n.push(a),n.push(i);var s=new t(i,o,this.rings.slice(),this.windings.slice());return D.comparePoints(s.leftSE.point,s.rightSE.point)>0&&s.swapEvents(),D.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(i.checkForConsuming(),a.checkForConsuming()),n}},{key:"swapEvents",value:function(){var e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var t=0,n=this.windings.length;t<n;t++)this.windings[t]*=-1}},{key:"consume",value:function(e){var n=this,r=e;while(n.consumedBy)n=n.consumedBy;while(r.consumedBy)r=r.consumedBy;var i=t.compare(n,r);if(0!==i){if(i>0){var a=n;n=r,r=a}if(n.prev===r){var o=n;n=r,r=o}for(var s=0,u=r.rings.length;s<u;s++){var l=r.rings[s],c=r.windings[s],f=n.rings.indexOf(l);-1===f?(n.rings.push(l),n.windings.push(c)):n.windings[f]+=c}r.rings=null,r.windings=null,r.consumedBy=n,r.leftSE.consumedBy=n.leftSE,r.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}},{key:"beforeState",value:function(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){var e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}},{key:"afterState",value:function(){if(void 0!==this._afterState)return this._afterState;var e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};for(var t=this._afterState.rings,n=this._afterState.windings,r=this._afterState.multiPolys,i=0,a=this.rings.length;i<a;i++){var o=this.rings[i],s=this.windings[i],u=t.indexOf(o);-1===u?(t.push(o),n.push(s)):n[u]+=s}for(var l=[],c=[],f=0,h=t.length;f<h;f++)if(0!==n[f]){var p=t[f],d=p.poly;if(-1===c.indexOf(d))if(p.isExterior)l.push(d);else{-1===c.indexOf(d)&&c.push(d);var v=l.indexOf(p.poly);-1!==v&&l.splice(v,1)}}for(var g=0,m=l.length;g<m;g++){var y=l[g].multiPoly;-1===r.indexOf(y)&&r.push(y)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;var e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(Z.type){case"union":var n=0===e.length,r=0===t.length;this._isInResult=n!==r;break;case"intersection":var i,a;e.length<t.length?(i=e.length,a=t.length):(i=t.length,a=e.length),this._isInResult=a===Z.numMultiPolys&&i<a;break;case"xor":var o=Math.abs(e.length-t.length);this._isInResult=o%2===1;break;case"difference":var s=function(e){return 1===e.length&&e[0].isSubject};this._isInResult=s(e)!==s(t);break;default:throw new Error("Unrecognized operation type found ".concat(Z.type))}return this._isInResult}}],[{key:"fromRing",value:function(e,n,r){var i,a,o,s=D.comparePoints(e,n);if(s<0)i=e,a=n,o=1;else{if(!(s>0))throw new Error("Tried to create degenerate segment at [".concat(e.x,", ").concat(e.y,"]"));i=n,a=e,o=-1}var u=new D(i,!0),l=new D(a,!1);return new t(u,l,[r],[o])}}]),t}(),F=function(){function t(n,r,i){if(e(this,t),!Array.isArray(n)||0===n.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=r,this.isExterior=i,this.segments=[],"number"!==typeof n[0][0]||"number"!==typeof n[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var a=k.round(n[0][0],n[0][1]);this.bbox={ll:{x:a.x,y:a.y},ur:{x:a.x,y:a.y}};for(var o=a,s=1,u=n.length;s<u;s++){if("number"!==typeof n[s][0]||"number"!==typeof n[s][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=k.round(n[s][0],n[s][1]);l.x===o.x&&l.y===o.y||(this.segments.push(N.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}a.x===o.x&&a.y===o.y||this.segments.push(N.fromRing(o,a,this))}return n(t,[{key:"getSweepEvents",value:function(){for(var e=[],t=0,n=this.segments.length;t<n;t++){var r=this.segments[t];e.push(r.leftSE),e.push(r.rightSE)}return e}}]),t}(),j=function(){function t(n,r){if(e(this,t),!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new F(n[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var i=1,a=n.length;i<a;i++){var o=new F(n[i],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=r}return n(t,[{key:"getSweepEvents",value:function(){for(var e=this.exteriorRing.getSweepEvents(),t=0,n=this.interiorRings.length;t<n;t++)for(var r=this.interiorRings[t].getSweepEvents(),i=0,a=r.length;i<a;i++)e.push(r[i]);return e}}]),t}(),B=function(){function t(n,r){if(e(this,t),!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"===typeof n[0][0][0]&&(n=[n])}catch(s){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var i=0,a=n.length;i<a;i++){var o=new j(n[i],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=r}return n(t,[{key:"getSweepEvents",value:function(){for(var e=[],t=0,n=this.polys.length;t<n;t++)for(var r=this.polys[t].getSweepEvents(),i=0,a=r.length;i<a;i++)e.push(r[i]);return e}}]),t}(),U=function(){function t(n){e(this,t),this.events=n;for(var r=0,i=n.length;r<i;r++)n[r].segment.ringOut=this;this.poly=null}return n(t,null,[{key:"factory",value:function(e){for(var n=[],r=0,i=e.length;r<i;r++){var a=e[r];if(a.isInResult()&&!a.ringOut){var o=null,s=a.leftSE,u=a.rightSE,l=[s],c=s.point,f=[];while(1){if(o=s,s=u,l.push(s),s.point===c)break;while(1){var h=s.getAvailableLinkedEvents();if(0===h.length){var p=l[0].point,d=l[l.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(p.x,",")+" ".concat(p.y,"]. Last matching segment found ends at")+" [".concat(d.x,", ").concat(d.y,"]."))}if(1===h.length){u=h[0].otherSE;break}for(var v=null,g=0,m=f.length;g<m;g++)if(f[g].point===s.point){v=g;break}if(null===v){f.push({index:l.length,point:s.point});var y=s.getLeftmostComparator(o);u=h.sort(y)[0].otherSE;break}var _=f.splice(v)[0],x=l.splice(_.index);x.unshift(x[0].otherSE),n.push(new t(x.reverse()))}}n.push(new t(l))}}return n}}]),n(t,[{key:"getGeom",value:function(){for(var e=this.events[0].point,t=[e],n=1,r=this.events.length-1;n<r;n++){var i=this.events[n].point,a=this.events[n+1].point;0!==T(i,e,a)&&(t.push(i),e=i)}if(1===t.length)return null;var o=t[0],s=t[1];0===T(o,e,s)&&t.shift(),t.push(t[0]);for(var u=this.isExteriorRing()?1:-1,l=this.isExteriorRing()?0:t.length-1,c=this.isExteriorRing()?t.length:-1,f=[],h=l;h!=c;h+=u)f.push([t[h].x,t[h].y]);return f}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var e=this.enclosingRing();this._isExteriorRing=!e||!e.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var e=this.events[0],t=1,n=this.events.length;t<n;t++){var r=this.events[t];D.compare(e,r)>0&&(e=r)}var i=e.segment.prevInResult(),a=i?i.prevInResult():null;while(1){if(!i)return null;if(!a)return i.ringOut;if(a.ringOut!==i.ringOut)return a.ringOut.enclosingRing()!==i.ringOut?i.ringOut:i.ringOut.enclosingRing();i=a.prevInResult(),a=i?i.prevInResult():null}}}]),t}(),V=function(){function t(n){e(this,t),this.exteriorRing=n,n.poly=this,this.interiorRings=[]}return n(t,[{key:"addInterior",value:function(e){this.interiorRings.push(e),e.poly=this}},{key:"getGeom",value:function(){var e=[this.exteriorRing.getGeom()];if(null===e[0])return null;for(var t=0,n=this.interiorRings.length;t<n;t++){var r=this.interiorRings[t].getGeom();null!==r&&e.push(r)}return e}}]),t}(),G=function(){function t(n){e(this,t),this.rings=n,this.polys=this._composePolys(n)}return n(t,[{key:"getGeom",value:function(){for(var e=[],t=0,n=this.polys.length;t<n;t++){var r=this.polys[t].getGeom();null!==r&&e.push(r)}return e}},{key:"_composePolys",value:function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];if(!i.poly)if(i.isExteriorRing())t.push(new V(i));else{var a=i.enclosingRing();a.poly||t.push(new V(a)),a.poly.addInterior(i)}}return t}}]),t}(),H=function(){function t(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:N.compare;e(this,t),this.queue=n,this.tree=new f(r),this.segments=[]}return n(t,[{key:"process",value:function(e){var t=e.segment,n=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),n;var r=e.isLeft?this.tree.insert(t):this.tree.find(t);if(!r)throw new Error("Unable to find segment #".concat(t.id," ")+"[".concat(t.leftSE.point.x,", ").concat(t.leftSE.point.y,"] -> ")+"[".concat(t.rightSE.point.x,", ").concat(t.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");var i=r,a=r,o=void 0,s=void 0;while(void 0===o)i=this.tree.prev(i),null===i?o=null:void 0===i.key.consumedBy&&(o=i.key);while(void 0===s)a=this.tree.next(a),null===a?s=null:void 0===a.key.consumedBy&&(s=a.key);if(e.isLeft){var u=null;if(o){var l=o.getIntersection(t);if(null!==l&&(t.isAnEndpoint(l)||(u=l),!o.isAnEndpoint(l)))for(var c=this._splitSafely(o,l),f=0,h=c.length;f<h;f++)n.push(c[f])}var p=null;if(s){var d=s.getIntersection(t);if(null!==d&&(t.isAnEndpoint(d)||(p=d),!s.isAnEndpoint(d)))for(var v=this._splitSafely(s,d),g=0,m=v.length;g<m;g++)n.push(v[g])}if(null!==u||null!==p){var y=null;if(null===u)y=p;else if(null===p)y=u;else{var _=D.comparePoints(u,p);y=_<=0?u:p}this.queue.remove(t.rightSE),n.push(t.rightSE);for(var x=t.split(y),b=0,S=x.length;b<S;b++)n.push(x[b])}n.length>0?(this.tree.remove(t),n.push(e)):(this.segments.push(t),t.prev=o)}else{if(o&&s){var w=o.getIntersection(s);if(null!==w){if(!o.isAnEndpoint(w))for(var C=this._splitSafely(o,w),k=0,A=C.length;k<A;k++)n.push(C[k]);if(!s.isAnEndpoint(w))for(var E=this._splitSafely(s,w),T=0,M=E.length;T<M;T++)n.push(E[T])}}this.tree.remove(t)}return n}},{key:"_splitSafely",value:function(e,t){this.tree.remove(e);var n=e.rightSE;this.queue.remove(n);var r=e.split(t);return r.push(n),void 0===e.consumedBy&&this.tree.insert(e),r}}]),t}(),W="undefined"!==typeof r&&{NODE_ENV:"production"}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Y="undefined"!==typeof r&&{NODE_ENV:"production"}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,q=function(){function t(){e(this,t)}return n(t,[{key:"run",value:function(e,t,n){Z.type=e,k.reset();for(var r=[new B(t,!0)],i=0,a=n.length;i<a;i++)r.push(new B(n[i],!1));if(Z.numMultiPolys=r.length,"difference"===Z.type){var o=r[0],s=1;while(s<r.length)null!==_(r[s].bbox,o.bbox)?s++:r.splice(s,1)}if("intersection"===Z.type)for(var u=0,l=r.length;u<l;u++)for(var c=r[u],h=u+1,p=r.length;h<p;h++)if(null===_(c.bbox,r[h].bbox))return[];for(var d=new f(D.compare),v=0,g=r.length;v<g;v++)for(var m=r[v].getSweepEvents(),y=0,x=m.length;y<x;y++)if(d.insert(m[y]),d.size>W)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");var b=new H(d),S=d.size,w=d.pop();while(w){var C=w.key;if(d.size===S){var A=C.segment;throw new Error("Unable to pop() ".concat(C.isLeft?"left":"right"," SweepEvent ")+"[".concat(C.point.x,", ").concat(C.point.y,"] from segment #").concat(A.id," ")+"[".concat(A.leftSE.point.x,", ").concat(A.leftSE.point.y,"] -> ")+"[".concat(A.rightSE.point.x,", ").concat(A.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(d.size>W)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(b.segments.length>Y)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var E=b.process(C),T=0,M=E.length;T<M;T++){var O=E[T];void 0===O.consumedBy&&d.insert(O)}S=d.size,w=d.pop()}k.reset();var L=U.factory(b.segments),P=new G(L);return P.getGeom()}}]),t}(),Z=new q,K=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Z.run("union",e,n)},X=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Z.run("intersection",e,n)},Q=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Z.run("xor",e,n)},J=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Z.run("difference",e,n)},$={union:K,intersection:X,xor:Q,difference:J};return $}))},56992:function(e){(function(t,n){e.exports=n()})(0,(function(){"use strict";function e(n,r,i,a,o,s){if(!(o-a<=i)){var u=a+o>>1;t(n,r,u,a,o,s%2),e(n,r,i,a,u-1,s+1),e(n,r,i,u+1,o,s+1)}}function t(e,r,i,a,o,s){while(o>a){if(o-a>600){var u=o-a+1,l=i-a+1,c=Math.log(u),f=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*f*(u-f)/u)*(l-u/2<0?-1:1),p=Math.max(a,Math.floor(i-l*f/u+h)),d=Math.min(o,Math.floor(i+(u-l)*f/u+h));t(e,r,i,p,d,s)}var v=r[2*i+s],g=a,m=o;n(e,r,a,i),r[2*o+s]>v&&n(e,r,a,o);while(g<m){n(e,r,g,m),g++,m--;while(r[2*g+s]<v)g++;while(r[2*m+s]>v)m--}r[2*a+s]===v?n(e,r,a,m):(m++,n(e,r,m,o)),m<=i&&(a=m+1),i<=m&&(o=m-1)}}function n(e,t,n,i){r(e,n,i),r(t,2*n,2*i),r(t,2*n+1,2*i+1)}function r(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function i(e,t,n,r,i,a,o){var s,u,l=[0,e.length-1,0],c=[];while(l.length){var f=l.pop(),h=l.pop(),p=l.pop();if(h-p<=o)for(var d=p;d<=h;d++)s=t[2*d],u=t[2*d+1],s>=n&&s<=i&&u>=r&&u<=a&&c.push(e[d]);else{var v=Math.floor((p+h)/2);s=t[2*v],u=t[2*v+1],s>=n&&s<=i&&u>=r&&u<=a&&c.push(e[v]);var g=(f+1)%2;(0===f?n<=s:r<=u)&&(l.push(p),l.push(v-1),l.push(g)),(0===f?i>=s:a>=u)&&(l.push(v+1),l.push(h),l.push(g))}}return c}function a(e,t,n,r,i,a){var s=[0,e.length-1,0],u=[],l=i*i;while(s.length){var c=s.pop(),f=s.pop(),h=s.pop();if(f-h<=a)for(var p=h;p<=f;p++)o(t[2*p],t[2*p+1],n,r)<=l&&u.push(e[p]);else{var d=Math.floor((h+f)/2),v=t[2*d],g=t[2*d+1];o(v,g,n,r)<=l&&u.push(e[d]);var m=(c+1)%2;(0===c?n-i<=v:r-i<=g)&&(s.push(h),s.push(d-1),s.push(m)),(0===c?n+i>=v:r+i>=g)&&(s.push(d+1),s.push(f),s.push(m))}}return u}function o(e,t,n,r){var i=e-n,a=t-r;return i*i+a*a}var s=function(e){return e[0]},u=function(e){return e[1]},l=function(t,n,r,i,a){void 0===n&&(n=s),void 0===r&&(r=u),void 0===i&&(i=64),void 0===a&&(a=Float64Array),this.nodeSize=i,this.points=t;for(var o=t.length<65536?Uint16Array:Uint32Array,l=this.ids=new o(t.length),c=this.coords=new a(2*t.length),f=0;f<t.length;f++)l[f]=f,c[2*f]=n(t[f]),c[2*f+1]=r(t[f]);e(l,c,i,0,l.length-1,0)};l.prototype.range=function(e,t,n,r){return i(this.ids,this.coords,e,t,n,r,this.nodeSize)},l.prototype.within=function(e,t,n){return a(this.ids,this.coords,e,t,n,this.nodeSize)};var c={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(e){return e}},f=Math.fround||function(e){return function(t){return e[0]=+t,e[0]}}(new Float32Array(1)),h=function(e){this.options=b(Object.create(c),e),this.trees=new Array(this.options.maxZoom+1)};function p(e,t,n,r,i){return{x:f(e),y:f(t),zoom:1/0,id:n,parentId:-1,numPoints:r,properties:i}}function d(e,t){var n=e.geometry.coordinates,r=n[0],i=n[1];return{x:f(m(r)),y:f(y(i)),zoom:1/0,index:t,parentId:-1}}function v(e){return{type:"Feature",id:e.id,properties:g(e),geometry:{type:"Point",coordinates:[_(e.x),x(e.y)]}}}function g(e){var t=e.numPoints,n=t>=1e4?Math.round(t/1e3)+"k":t>=1e3?Math.round(t/100)/10+"k":t;return b(b({},e.properties),{cluster:!0,cluster_id:e.id,point_count:t,point_count_abbreviated:n})}function m(e){return e/360+.5}function y(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function _(e){return 360*(e-.5)}function x(e){var t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function b(e,t){for(var n in t)e[n]=t[n];return e}function S(e){return e.x}function w(e){return e.y}return h.prototype.load=function(e){var t=this.options,n=t.log,r=t.minZoom,i=t.maxZoom,a=t.nodeSize;n&&console.time("total time");var o="prepare "+e.length+" points";n&&console.time(o),this.points=e;for(var s=[],u=0;u<e.length;u++)e[u].geometry&&s.push(d(e[u],u));this.trees[i+1]=new l(s,S,w,a,Float32Array),n&&console.timeEnd(o);for(var c=i;c>=r;c--){var f=+Date.now();s=this._cluster(s,c),this.trees[c]=new l(s,S,w,a,Float32Array),n&&console.log("z%d: %d clusters in %dms",c,s.length,+Date.now()-f)}return n&&console.timeEnd("total time"),this},h.prototype.getClusters=function(e,t){var n=((e[0]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,e[1])),i=180===e[2]?180:((e[2]+180)%360+360)%360-180,a=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,i=180;else if(n>i){var o=this.getClusters([n,r,180,a],t),s=this.getClusters([-180,r,i,a],t);return o.concat(s)}for(var u=this.trees[this._limitZoom(t)],l=u.range(m(n),y(a),m(i),y(r)),c=[],f=0,h=l;f<h.length;f+=1){var p=h[f],d=u.points[p];c.push(d.numPoints?v(d):this.points[d.index])}return c},h.prototype.getChildren=function(e){var t=this._getOriginId(e),n=this._getOriginZoom(e),r="No cluster with the specified id.",i=this.trees[n];if(!i)throw new Error(r);var a=i.points[t];if(!a)throw new Error(r);for(var o=this.options.radius/(this.options.extent*Math.pow(2,n-1)),s=i.within(a.x,a.y,o),u=[],l=0,c=s;l<c.length;l+=1){var f=c[l],h=i.points[f];h.parentId===e&&u.push(h.numPoints?v(h):this.points[h.index])}if(0===u.length)throw new Error(r);return u},h.prototype.getLeaves=function(e,t,n){t=t||10,n=n||0;var r=[];return this._appendLeaves(r,e,t,n,0),r},h.prototype.getTile=function(e,t,n){var r=this.trees[this._limitZoom(e)],i=Math.pow(2,e),a=this.options,o=a.extent,s=a.radius,u=s/o,l=(n-u)/i,c=(n+1+u)/i,f={features:[]};return this._addTileFeatures(r.range((t-u)/i,l,(t+1+u)/i,c),r.points,t,n,i,f),0===t&&this._addTileFeatures(r.range(1-u/i,l,1,c),r.points,i,n,i,f),t===i-1&&this._addTileFeatures(r.range(0,l,u/i,c),r.points,-1,n,i,f),f.features.length?f:null},h.prototype.getClusterExpansionZoom=function(e){var t=this._getOriginZoom(e)-1;while(t<=this.options.maxZoom){var n=this.getChildren(e);if(t++,1!==n.length)break;e=n[0].properties.cluster_id}return t},h.prototype._appendLeaves=function(e,t,n,r,i){for(var a=this.getChildren(t),o=0,s=a;o<s.length;o+=1){var u=s[o],l=u.properties;if(l&&l.cluster?i+l.point_count<=r?i+=l.point_count:i=this._appendLeaves(e,l.cluster_id,n,r,i):i<r?i++:e.push(u),e.length===n)break}return i},h.prototype._addTileFeatures=function(e,t,n,r,i,a){for(var o=0,s=e;o<s.length;o+=1){var u=s[o],l=t[u],c=l.numPoints,f=void 0,h=void 0,p=void 0;if(c)f=g(l),h=l.x,p=l.y;else{var d=this.points[l.index];f=d.properties,h=m(d.geometry.coordinates[0]),p=y(d.geometry.coordinates[1])}var v={type:1,geometry:[[Math.round(this.options.extent*(h*i-n)),Math.round(this.options.extent*(p*i-r))]],tags:f},_=void 0;c?_=l.id:this.options.generateId?_=l.index:this.points[l.index].id&&(_=this.points[l.index].id),void 0!==_&&(v.id=_),a.features.push(v)}},h.prototype._limitZoom=function(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))},h.prototype._cluster=function(e,t){for(var n=[],r=this.options,i=r.radius,a=r.extent,o=r.reduce,s=r.minPoints,u=i/(a*Math.pow(2,t)),l=0;l<e.length;l++){var c=e[l];if(!(c.zoom<=t)){c.zoom=t;for(var f=this.trees[t+1],h=f.within(c.x,c.y,u),d=c.numPoints||1,v=d,g=0,m=h;g<m.length;g+=1){var y=m[g],_=f.points[y];_.zoom>t&&(v+=_.numPoints||1)}if(v>d&&v>=s){for(var x=c.x*d,b=c.y*d,S=o&&d>1?this._map(c,!0):null,w=(l<<5)+(t+1)+this.points.length,C=0,k=h;C<k.length;C+=1){var A=k[C],E=f.points[A];if(!(E.zoom<=t)){E.zoom=t;var T=E.numPoints||1;x+=E.x*T,b+=E.y*T,E.parentId=w,o&&(S||(S=this._map(c,!0)),o(S,this._map(E)))}}c.parentId=w,n.push(p(x/v,b/v,w,v,S))}else if(n.push(c),v>1)for(var M=0,O=h;M<O.length;M+=1){var L=O[M],P=f.points[L];P.zoom<=t||(P.zoom=t,n.push(P))}}}return n},h.prototype._getOriginId=function(e){return e-this.points.length>>5},h.prototype._getOriginZoom=function(e){return(e-this.points.length)%32},h.prototype._map=function(e,t){if(e.numPoints)return t?b({},e.properties):e.properties;var n=this.points[e.index].properties,r=this.options.map(n);return t&&r===n?b({},r):r},h}))}}]);
//# sourceMappingURL=71.2cd78ab0.async.js.map