"use strict";function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){_defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}define("PropertyCardchart",["Utility","Kit","ui/extendIconUI","BaseQueryComponent","template/compile","model/Component","log/Log","utility/colors","sizes","Event","echartbase/Echart_cda","underscore","utility/runtime","Base.Panel","numeral","promise","echartbase/EchartsBase.Panel","render/Base","render/Renderer","nicescroll"],(function(e,t,n,r,o,i,l,a,s,c,u,d,p,m,y,h,f,b){var v=new m,g={label:"Untitle",cardtext:"",cardMessage:{},textStyle:{color:"#888",fontSize:24,fontFamily:""},wrap:!0,title:{show:!0,textStyle:{},text:"Untitle"}},x="PropertyCardchart",w=r.getLocaleFn(["components","extends",x]),_=r.extend({type:x,name:w("name"),classify:"_data",description:w("name tip"),_queryLevelChanged:function(){var e=this.model.getAxesLevels("ROWS"),t=new Array,n="";return Array.isArray(e)&&e.every((function(e){return this.push(e.label)||!0}),t),t.length&&(n+=t.join(",")),this.model.locking=!0,this.model.checkTitleUpdatedByUser()||this.model.customizationUpdate("style.title",n),this.model.defaultValueUpdated(null),this.model.locking=!1,this.panelMerge(!0),this.model.isValidQueryModel()||this.render(),d.isFunction(this.axisUpdate)&&this.axisUpdate(),this},queryExtend:function(){var t=this.model.isValidQueryModel.bind(this.model),n=this,r=this.remove.bind(this);return this.remove=function(){this.$el.off("click"),r()},this.model.isValidQueryModel=function(){return t(!1,!0)&&n.axisLevelsRequired("ROWS")&&n.axisLevelsRequired("Measures",-1)},this.options=e.deepCopy(g),this.model.backup=e.deepCopy(this.model.toJSON()),this.$el.closest(".c-node").find(".panel-body").css({overflow:"inherit"}),this.$el.addClass("flex"),this.$el.on("click",(function(e){var t,r,o=n.getCustomizeFunction("action","_plotclick"),i={};n.readonly&&(i.message={},i.message.measures=[],i.message.levels=n.levels,d.isFunction(o)&&(t=n.levels[0].caption,r=o.call(n,_objectSpread({},i),e,null,t,null,{})),!1!==r&&n.isJumpMode()&&d.isFunction(n.onExecuteJumpEvent)&&n.onExecuteJumpEvent(i,e,r))})),this},beforeQuery:function(t){var n=this.getCustomizeFunction("action","_preFetch"),r=new i({chartType:this.model.get("chartType"),query:e.deepCopy(t)}),o=(t.cube,r.getMeasures());return t&&t.queryModel&&t.queryModel.axes&&t.queryModel.axes.COLUMNS&&r.setAxisNonEmpty("COLUMNS",!1),0==o.length&&r.includeMeasure({name:"Fact Count",type:"EXACT",caption:"Fact Count",uniqueName:"[Measures].[Fact Count]",id:"[Measures].[Fact Count]"}),o=r.getMeasures()[0],r.setPropertyFilters(null,"ROWS",{flavour:"N",function:"TopCount",operator:null,expressions:["1",o.id]}),t=r.get("query"),d.isFunction(n)?n.call(this,t):t},options:null,checkQm:function(e,t,n){return this.model.hslice("COLUMNS",0),this.model.hslice("ROWS",1),this.model.mslice(0),null},onExecuteJumpEvent:function(e,n,r){var o,i=this,l=null===(o=this.model.getAxesLevels("ROWS"))||void 0===o||null===(o=o[0])||void 0===o?void 0:o.id;return l?(function(o){var l=i.model.getSavedJumpOptions(o,!0),a=null==l?void 0:l.find((function(e){return e.uniqueName==o}));if(!a)return i;var s=a.options;t.openLinkedPage({savedJumpOptions:_objectSpread({},s),component:i,params:_objectSpread({},e),event:n},r)}(l),this):this},dataFormatter:function(t,n,r,o){this.model.getCustomizations();var i=this;return o&&Array.isArray(o.children)&&0!=o.children.length?(u.travelDeeply(o,null,(function(t,n,r){i.levels=e.deepCopy(r)})),this.options.cardtext=o.children[0].caption,this.options.cardMessage={caption:o.children[0].caption,level:o.children[0].level,hierarchy:o.children[0].hierarchy,id:o.children[0].uniqueName,header:o.children[0].headerName},this):(this.dataEmpty(),this)},dataEmpty:function(){return this.blocking||(this.options.cardtext="",this.options.cardMessage={},(new r).dataEmpty.call(this)),this},clearContent:function(){return this.$el.children().remove(),this},draw:function(){var e,t=null==this.options.cardtext?"N/A":this.options.cardtext,n=this.$el,r=this.getPanelControlValue("style","mainFont")||[18,a.chartDefaultColor(),"",!1,!1];Number(r[0]),r[2],r[3],r[4];if(this.$el.css("overflow","visible"),d.isEmpty(this.options.cardMessage))return this.dataEmpty(),this;try{n.css("padding","0px 0.35em 0.35em").children().remove()}catch(e){console.log(e.message)}return e=this.options.wrap?"width:100%;white-space:wrap;overflow:visible;":"width:100%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;",n.append(o.plainCompile([{class:"indicator-main",html:t,style:e}])),n.find(".indicator-main").css(this.options.textStyle),this},colorsUpdated:function(e){return this}},{thumbnail:"icon iconfont icon-datafor-str",menus:function(){return{outer:[],inner:[{value:"Export",children:[{value:"Excel"},{value:"Csv"},{value:"Image"}]},{value:"Preview"}]}},privates:{disableDrilldown:!0,entranceConstraintsForLinkConfs:["row_dim"]},_sort_order:3.2,symbol:"indicate.svg",logo:n.getDimComponentIcon(),staticPanelOptions:d.extend([],[{name:"data",label:e.locale("panel","data"),active:!0,datasets:[v.datasource(null,["row_dim","date_dim","filter"]),v.line(),v.dimensionPrimary(w("field"),"single",null,null,null,[]),v.line()].concat(_toConsumableArray(v.getAxisLinkPanelGroup()),[v.filters()])},{name:"style",label:e.locale("panel","styles"),active:!1,datasets:[v.label(e.locale("panel","title style")),v.titleSwitch(e.locale("panel","shown")),v.titleParimary(e.locale("panel","content")),v.titlePrimaryAlign(),v.titlePrimaryStyle(),v.titleBackground("transparent"),v.line(),v.label(e.locale("panel","frame style")),v.background(e.locale("panel","background color")),v.border(e.locale("panel","border")),v.styleRadius(),v.shadow(),v.line(),v.label(e.locale("components","system default","indicator","main value style")),d.extend(b.getRendererBaseAttrs("Font"),{name:"mainFont",label:e.locale("components","system default","indicator","main value font"),value:[28,a.chartDefaultColor(),"",!1,!1],sizes:[12,14,16,18,20,22,24,26,28,32,36,42,48,60,72,84,96,128],bold:!0,italic:!0,tooltip:e.locale("components","system default","indicator","main value font description"),execute:function(e,t,n){t.textStyle=d.extend(t.textStyle||{},{color:e[1],fontSize:Number(e[0]),fontFamily:e[2],fontWeight:e[3]?"bold":"normal",fontStyle:e[4]?"italic":"normal"})}}),d.extend(b.getRendererBaseAttrs("QuickPicker"),{name:"_mainAlign",value:"left",tooltip:e.locale("components","system default","indicator","value align description"),label:e.locale("components","system default","indicator","value align"),execute:function(e,t,n){t.textStyle.textAlign=e}}),d.extend(b.getRendererBaseAttrs("RadioBox"),{name:"_content_wrap",value:!0,label:w("content wrap"),tooltip:w("content wrap description"),execute:function(e,t,n){t.wrap=!!e}}),v.line(),v.label(e.locale("panel","style panel","component menu settings","name")),v.menuEnable(),v.setOuterMenuColor(),v.enlargeBackground()]},{name:"action",label:e.locale("panel","actions"),datasets:[v.label(e.locale("panel","action panel","refresh")),v.refresh(),v.period(),v.line(),v.label(e.locale("panel","action panel","custom blocks")),f.clickPlotEvent(),v.preExecution(),v.preFetch(),v.postExecution()]}])});return r.register(_),_}));
//# sourceMappingURL=PropertyCardchart.js.map