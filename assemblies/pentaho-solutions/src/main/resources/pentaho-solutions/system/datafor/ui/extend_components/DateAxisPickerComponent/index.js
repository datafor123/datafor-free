"use strict";function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function ownKeys(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(a),!0).forEach((function(t){_defineProperty(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function _defineProperty(e,t,a){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var r=a.call(e,t||"default");if("object"!==_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}define("DateAxisPickerComponent",["Utility","utility/params","utility/relExpression","ui/extendIconUI","underscore","utility/CubeCollection","template/compile","BaseDatepicker","model/Component","log/Log","utility/colors","utility/runtime","validator","Base.Panel","render/Base","moment","lib/backbone.daterange","render/Renderer"],(function(e,t,a,r,i,n,o,l,s,c,d,p,u,m,y,f){var h=new m,v=l.extend({type:"DateAxisPicker",name:e.locale("components","system default","datepicker","timeline component"),description:e.locale("components","system default","datepicker","timeline component description"),tryUpdatePicker:function(t){var a=e.getReactExport("daterpicker"),r=this;return this.timerUpdate&&clearTimeout(this.timerUpdate),this.timerUpdate=setTimeout((function(){t&&(r.options=t),r.options.format=e.toMomentFormat(r.options.format),r.options.timestamp=(new Date).getTime(),["day","days"].indexOf(r.options.picker)>=0&&(r.options.picker="date"),a&&a(r.el,r.options)}),200),this},tryUpdateCaptionUI:function(e,t){this.$el.closest(".c-node").find(".panel-heading");return t&&t.hasOwnProperty("display")&&"false"!=String(this.getPanelControlValue("style","title.on"))&&(t.display="flex"),(new l).tryUpdateCaptionUI.call(this,e,t),this.resize(),this},timeMode:"axis",staticExtend:function(){this.tryGetUIScale();var t=this;this.model.customizationSilentUpdate("data._dateAxisLink",[this.timeMode]),(new l).staticExtend.call(this),this.model.getLabel=function(){return e.locale("notice","date caption")},this.options={placeholder:e.locale("others","please select"),getPopupContainer:function(){var e;return null===(e=t.$el.closest(".page-body"))||void 0===e?void 0:e[0]},locale:__ENV.locale||"zh-CN",allowClear:!1,onChange:function(e){i.isFunction(t.onPickUpdatedEvent)&&t.onPickUpdatedEvent(e)},dropdownClassName:"visualizer-datepicker-popdown",picker:"year",style:{fontSize:20}};try{this.daterangePicker&&this.daterangePicker.remove(),this.$el.children().remove()}catch(e){}return this.$el.closest(".c-node").addClass("axis-picker-component"),this.tryUpdatePicker(),this},onPickUpdatedEvent:function(e){var t,a,r=this.getDateType();if(e&&r){"years"===r?(t=e.startOf("year").valueOf(),a=e.endOf("year").valueOf()):"quarters"===r?(t=e.startOf("quarter").valueOf(),a=e.endOf("quarter").valueOf()):"months"===r?(t=e.startOf("month").valueOf(),a=e.endOf("month").valueOf()):"days"===r&&(t=e.startOf("day").valueOf(),a=e.endOf("day").valueOf()),this.model.defaultValueUpdated({start:t,end:a});var i=this.model.getCustomizations()["data._defaults"]||{};return this.model.customizationUpdate("data._defaults",_objectSpread(_objectSpread({},i),{},{start:t,end:a})),this.options.value=e,this}},displayFormatters:{},getSelectedLabel:function(){var e=this.options.format,t=this.options.value||[];return t=Array.isArray(t)?t:[t],this.options.rangeMode?[t.map((function(t){return t&&t.isValid()?t.format(e):f().format(e)})).join(" - ")]:[t[0].format(e)]}},{thumbnail:"icon iconfont icon-datafor-date",logo:r.getDatepickIcon(),_sort_order:6.3,staticPanelOptions:[{name:"data",label:e.locale("panel","data"),active:!0,datasets:[h.label(e.locale("components","system default","datepicker","calendar type"),null,!0),i.extend(y.getRendererBaseAttrs("SingleSelect"),{name:"_dateType",listeners:["_defaults","_displayFormat"],tooltip:e.locale("components","system default","datepicker","description of calendar type"),available:{dataArray:function(e){return this.getAvailableTimetypeArray()}},value:"years",singleRequireSelected:!0,mul:!1,search:!1,label:e.locale("components","system default","datepicker","calendar type"),chainLinker:function(e,t,a){var r=this.getAvailableTimetypeArray();a.model.unset("available",{silent:!0}),a.model.set("available",r),a.model.set("value","years"),this.model.customizationSilentUpdate("data._dateType","years"),a.render()},execute:function(t,a,r){t=Array.isArray(t)?t[0]:t,a.picker=String(t).replace(/s$/g,""),a.placeholder=e.locale("others","please select")+e.locale("components","system default","datepicker","date time type",t),this.tryUpdatePicker(a)},init:function(e,t,a,r){var n,o=this.getAvailableTimetypeArray(),l=this.getDateType();return a&&a.model.set({available:o},{silent:!0}),l?(n=Array.isArray(l)?l[0]:l,i.find(o,(function(e){return e.value==n}))||(l=o.length?[o[0].value]:[n]),l):(n="years",e.customizationSilentUpdate("data._dateType",n),n)}}),i.extend(y.getRendererBaseAttrs("SingleSelect"),{name:"_displayFormat",listeners:[],tooltip:e.locale("panel","data panel","date level format"),available:{url:e.getWebAppName()+"/content/datafor/ui/data/format.json",dataArray:function(e){this.model.getCustomizations();var t,a,r=this.getDateType(),i=e,n=__ENV.locale||"zh-CN";for(var o in t="years"==(t=(r=Array.isArray(r)?r[0]:r)||"years")?"TimeYears":"quarters"==t?"TimeQuarters":"months"==t?"TimeMonths":"weeks"==t?"TimeWeeks":"TimeDays",i)"TimeQuarters"===o&&(i[o]=i[o].filter((function(e){return!e.format||!e.format.match(/qq|QQ/g)&&"'QTR'q"!==e.format&&"'Q'q"!==e.format}))),o==t&&(a=i[o]);return this.displayFormatters=i,a.filter((function(e){return(!e.format||!e.format.match(/qq|QQ/g)&&"'QTR'q"!==e.format&&"'Q'q"!==e.format)&&!(e.loginLocale.indexOf(n)<0)})).map((function(e){return{value:e.format,label:e.caption}}))}},value:"years",singleRequireSelected:!0,mul:!1,search:!1,label:e.locale("panel","data panel","date level format"),chainLinker:function(e,t,a){this.model.getCustomizations();var r,i=e.value,n=__ENV.locale||"zh-CN";i="years"==(i=this.getDateType())?"TimeYears":"quarters"==i?"TimeQuarters":"months"==i?"TimeMonths":"weeks"==i?"TimeWeeks":"TimeDays",r=this.displayFormatters[i],r=Array.isArray(r)?r.filter((function(e){return(!e.format||!e.format.match(/qq|QQ/g)&&"'QTR'q"!==e.format&&"'Q'q"!==e.format)&&!(e.loginLocale.indexOf(n)<0)})).map((function(e){return{value:e.format,label:e.caption}})):[],a.model.unset("available",{silent:!0}),i=this.getDefaultDatetypeFormat(i),a.model.set({available:r,value:i}),a.model.get("execute").call(this,i,this.options,this.$el),this.model.customizationSilentUpdate("data._displayFormat",i)},execute:function(e,t,a){var r=Array.isArray(e)?e[0]:e;t.format=r,this.tryUpdatePicker(t)},init:function(e,t,a,r){var n,o=r["data._displayFormat"],l=this.getDateType(),s=__ENV.locale||"zh-CN",c=new Array;return l=Array.isArray(l)?l[0]:l,a&&r&&Object.keys(this.displayFormatters).length&&(l="years"==l?"TimeYears":"quarters"==l?"TimeQuarters":"months"==l?"TimeMonths":"weeks"==l?"TimeWeeks":"TimeDays",c=this.displayFormatters[l],c=Array.isArray(c)?c.filter((function(e){return(!e.format||!e.format.match(/qq|QQ/g)&&"'QTR'q"!==e.format&&"'Q'q"!==e.format)&&!(e.loginLocale.indexOf(s)<0)})).map((function(e){return{value:e.format,label:e.caption}})):[],a.model.set({available:c},{silent:!0})),o?(o=Array.isArray(o)?o:[o],n=o[0],c.length&&!i.find(c,(function(e){return e.value==n}))&&(o=this.getDefaultDatetypeFormat(l)),o):(n=this.getDefaultDatetypeFormat(l),e.customizationSilentUpdate("data._displayFormat",n),n)}}),h.line(),h.label(e.locale("panel","action panel","default value"),null,!0),i.extend(y.getRendererBaseAttrs("SingleDate"),{name:"_defaults",tooltip:e.locale("components","system default","datepicker","description of date default"),label:e.locale("components","system default","datepicker","date default"),width:200,chainLinker:function(e,t,a){this.model.getCustomizations();var r=a.model.get("value"),i=e.value;i=this.getDateType(),this.toProperDate(r,i),r.dateType=i,this.model.clearDateListener(),a.model.set({value:r},{silent:!0}),a.render().show()},execute:function(e,t,r){var n,o=this.getDateType(),l=a.getElement(e.expression);e.start&&(l&&i.isFunction(l.expression)&&"relative"==e.type&&(l=l.expression(),e.start=l.start),this.toProperDate(e,o),this.model.defaultValueUpdated({start:e.start,end:e.end},!0),n=f(e.start),t.value=n,this.tryUpdatePicker(t))},init:function(e,t,r,n){var o,l,s,c=e.getCustomizations()["data._defaults"],d=this.getDateType();c||(c={type:"relative",expression:"Last 7 Days"},"months"==d?c.expression="This Month":"years"==d&&(c.expression="This Year")),"relative"===c.type?(o=a.getElement(c.expression))&&i.isFunction(o.expression)&&(o=o.expression(),this.toProperDate(o,d),l=o.start,s=o.end,this.model.tryResetDefaultDynamic({start:l,end:s})):(l=c.start,s=c.end);var p={dateType:d,type:c.type,expression:c.expression,start:l,end:s};return setTimeout((function(){null==r||r.model.set({value:p},{silent:!1})}),0),p}})]},{name:"style",label:e.locale("panel","styles"),active:!1,datasets:[h.label(e.locale("components","system default","lists","title style")),h.titleSwitch(!1),h.titleParimary(),h.titlePrimaryStyle(),h.line(),h.label(e.locale("panel","frame style")),h.background(e.locale("panel","background color"),"#ffffff"),h.border(e.locale("panel","border"),[1,"rgb(217, 217, 217)","solid"]),h.styleRadius(),h.shadow(null,".c-ui"),h.line(),h.label(e.locale("panel","content")),i.extend(y.getRendererBaseAttrs("Font"),{name:"_content_font",label:e.locale("panel","style panel","universal","font"),tooltip:e.locale("panel","universal","font description"),value:[14,d.chartDefaultColor(),"",!1,!1],bold:!0,italic:!0,execute:function(e,t,a){t.style=i.extend({},t.style||{},{fontSize:Number(e[0]),color:e[1],fontFamily:e[2],fontWeight:e[3]?"bold":"normal",fontStyle:e[4]?"italic":"normal"}),this.tryUpdatePicker()}})]},{name:"action",label:e.locale("panel","actions"),datasets:[h.label(e.locale("panel","action panel","subscribers")),i.extend(y.getRendererBaseAttrs("DateAxisSubscribers"),{name:"_subscribers",tooltip:e.locale("components","system default","datepicker","date subscription description"),dateType:"days",chainLinker:function(e,t,a){a.render()},save:function(e,t){var a=new Array;a=Array.isArray(e)?e:[e],t.addDateListeners(a,!0)},init:function(e,t){var a=this.getDateType(),r=e.getDateListeners();return t.dateType=a||"days",i.extend([],r)},execute:function(e,t,a){}})]}]});return l.register(v),v}));
//# sourceMappingURL=DateAxisPickerComponent.js.map