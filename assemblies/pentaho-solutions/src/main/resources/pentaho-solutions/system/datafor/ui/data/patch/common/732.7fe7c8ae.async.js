(self["webpackChunkdataforui_common"]=self["webpackChunkdataforui_common"]||[]).push([[732],{83732:function(e,t,a){"use strict";a.r(t),a.d(t,{test:function(){return N}});a(2468);var s=a(96535),i=(a(68559),a(11927)),n=a(24706),o=a(28162),r=(a(96878),a(96894)),l=a(2784),d=a(28316),m=a(25567),c=a(81954),u=a(76635),g=a.n(u),h=a(57200),p=a(58233),y=a(48928),v=a(71260),f=a(47443),x=(a(19034),a(52322)),j=r.Z.TextArea,w={openai:(0,x.jsx)(p.pH,{style:{color:"rgb(115, 186, 37)",fontSize:20}}),datafor:(0,x.jsx)(m.Z,{style:{color:"rgb(24, 144, 255)",fontSize:20}})},b=[{type:"datafor",msg:"Hello",time:new Date("2021-01-01 12:00:00").getTime()},{type:"openai",msg:"Hello",time:new Date("2021-01-01 12:01:00").getTime()},{type:"datafor",msg:"Hello",time:new Date("2021-01-01 12:00:00").getTime()},{type:"openai",msg:"Hello",time:new Date("2021-01-01 12:01:00").getTime()},{type:"datafor",msg:"Hello",time:new Date("2021-01-01 12:00:00").getTime()},{type:"openai",msg:"Hello",time:new Date("2021-01-01 12:01:00").getTime()},{type:"datafor",msg:"Hello",time:new Date("2021-01-01 12:00:00").getTime()},{type:"openai",msg:"Hello",time:new Date("2021-01-01 12:01:00").getTime()}],T=e=>{var t=e.queryId,a=e.initMessage,s=void 0===a?[]:a,o=e.labels,r=void 0===o?{}:o,d=e.firstQuery,m=e.queryRef,u=e.model,p=e.extroCommand,b=(0,l.useState)(s),T=(0,n.Z)(b,2),C=T[0],N=T[1],Z=(0,l.useState)(!1),S=(0,n.Z)(Z,2),H=S[0],D=S[1],q=(0,l.useState)(""),k=(0,n.Z)(q,2),I=k[0],M=k[1],P=(e,a)=>{var s=a?d:I;if(s){var i=C.concat({type:"datafor",msg:s,time:(new Date).getTime()},{type:"openai",msg:(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(c.Z,{style:{fontSize:20,marginRight:10,color:"#005c03",verticalAlign:"-0.2em"}}),(0,f.ZP)({id:"notice.ai.request.is.working"})]}),time:(new Date).getTime()});N(i),M(""),D(!0);var n=i.filter((e=>"string"===typeof e.msg)).map((e=>({role:"datafor"==e.type?"user":"assistant",content:e.msg}))),o=(0,v.chatGptAsk)({id:t,data:n,model:u||"gpt-3.5-turbo",extroCommand:p});g().isFunction(m)&&m(o.cancel),o.then((e=>{e||y.O9["@error"];var t=i.slice(0,i.length-1).concat({type:"openai",msg:e||(0,f.ZP)({id:"notice.ai.request.error.contact.administrator"}),time:(new Date).getTime()});N(t),D(!1)}))}};return(0,l.useEffect)((()=>{var e=document.querySelector(".chat-body"),t=new h.Z(e,y.TB);return e.scrollTop=t.contentHeight,()=>{t.destroy()}}),[C]),(0,l.useEffect)((()=>{d&&P(null,d)}),[]),(0,x.jsxs)("div",{className:"openai-chat-window",children:[(0,x.jsx)("div",{className:"chat-body",children:(0,x.jsx)("div",{className:"chat-messages",children:C.length?C.map(((e,t)=>{var a=e.msg,s=e.type;return"datafor"==s&&a==d&&(a=String(a).replace("${data}","")),(0,x.jsxs)("div",{className:"chat-message ".concat(s),children:[w[s],(0,x.jsx)("div",{className:"chat-message-content",children:(0,x.jsx)("div",{className:"chat-message-content-inner",children:g().isString(a)?(0,x.jsx)("div",{className:"chat-message-text",dangerouslySetInnerHTML:{__html:a}}):(0,x.jsx)("div",{className:"chat-message-text",children:a})})})]},t)})):(0,x.jsx)("div",{className:"empty-chat-placeholder",dangerouslySetInnerHTML:{__html:null===r||void 0===r?void 0:r.historyPlaceholder}})})}),(0,x.jsx)("div",{className:"chat-input-toolbar"}),(0,x.jsx)("div",{className:"chat-input",children:(0,x.jsx)(j,{placeholder:null===r||void 0===r?void 0:r.inputPlaceholder,className:"chat-input-textarea",value:I,onChange:e=>{M(e.target.value)}})}),(0,x.jsx)("div",{className:"chat-foot",children:(0,x.jsx)(i.Z,{type:"primary",onClick:P,disabled:H,children:(null===r||void 0===r?void 0:r.sendButton)||"Send"})})]})},C=e=>{var t,a,i=e.initMessage,r=void 0===i?[]:i,m=e.labels,c=void 0===m?{}:m,u=e.queryId,g=e.firstQuery,h=e.model,p=e.extroCommand,y=e=>{var i=(0,l.useState)(!1),m=(0,n.Z)(i,2),y=m[0],v=m[1];return(0,l.useEffect)((()=>(v(!0),()=>{v(!1),a&&a()})),[]),(0,x.jsx)(x.Fragment,{children:(0,x.jsx)(s.Z,(0,o.Z)((0,o.Z)({},e),{},{title:(null===c||void 0===c?void 0:c.title)||"Chat",className:"openai-chat-drawer",placement:"right",maskClosable:!1,destroyOnClose:!0,width:620,visible:y,onClose:()=>{v(!1),setTimeout((()=>{d.unmountComponentAtNode(t),document.body.removeChild(t)}),300)},style:{position:"absolute"},children:(0,x.jsx)(T,{initMessage:r,labels:c,queryId:u,firstQuery:g,queryRef:e=>{a=e},model:h,extroCommand:p})}))})};t=document.createElement("div"),document.body.appendChild(t),d.render((0,x.jsx)(y,{getContainer:()=>t}),t)},N=()=>{C({initMessage:b,labels:{historyPlaceholder:"\u5386\u53f2\u8bb0\u5f55",title:"\u4eba\u5de5\u667a\u80fd\u95ee\u7b54",inputPlaceholder:"\u8fd9\u91cc\u8f93\u5165\u60a8\u7684\u95ee\u9898",sendButton:"\u53d1\u9001"},queryId:"test",firstQuery:"\u4f60\u597d\uff0c\u5e2e\u6211\u603b\u7ed3\u8fd9\u53e5\u8bdd"})};t["default"]=C}}]);
//# sourceMappingURL=732.7fe7c8ae.async.js.map